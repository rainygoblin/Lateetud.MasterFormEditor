/**************************************************
LEADTOOLS (C) 1991-2016 LEAD Technologies, Inc. ALL RIGHTS RESERVED.
This software is protected by United States and International copyright laws.
Any copying, duplication, deployment, redistribution, modification or other
disposition hereof is STRICTLY PROHIBITED without an express written license
granted by LEAD Technologies, Inc.. This notice may not be removed or otherwise
altered under any circumstances.
Portions of this product are licensed under US patent 5,327,254 and foreign
counterparts.
For more information, contact LEAD Technologies, Inc. at 704-332-5532 or visit
https://www.leadtools.com
**************************************************/
// Leadtools.Controls.Medical.js
// Version:19.0.0.6
(function(){Type.registerNamespace("lt.Controls.Medical");window.lt.Controls.Medical._lT_VersionNumber=function(){};lt.Controls.Medical.WindowLevelPaletteType=function(){};lt.Controls.Medical.WindowLevelPaletteType.prototype={none:0,cool:1,cyanHot:2,fire:3,icA2:4,ice:5,orangeHot:6,rainbowRGB:7,redHot:8,spectrum:9};lt.Controls.Medical.WindowLevelPaletteType.registerEnum("lt.Controls.Medical.WindowLevelPaletteType",!1);lt.Controls.Medical.MedicalViewerSizeMode=function(){};lt.Controls.Medical.MedicalViewerSizeMode.prototype=
{none:0,actualSize:1,fit:2,trueSize:3};lt.Controls.Medical.MedicalViewerSizeMode.registerEnum("lt.Controls.Medical.MedicalViewerSizeMode",!1);lt.Controls.Medical.CellsArrangment=function(){};lt.Controls.Medical.CellsArrangment.prototype={grid:0,random:1};lt.Controls.Medical.CellsArrangment.registerEnum("lt.Controls.Medical.CellsArrangment",!1);lt.Controls.Medical.FrameArrangment=function(){};lt.Controls.Medical.FrameArrangment.prototype={grid:0,custom:1,rowSymmetric:2,colSymmetric:3};lt.Controls.Medical.FrameArrangment.registerEnum("lt.Controls.Medical.FrameArrangment",
!1);lt.Controls.Medical.MPRStatus=function(){};lt.Controls.Medical.MPRStatus.prototype={ok:0,notEnoughFrames:-1,imagePositionNotReady:2,allFramesNotReady:4,cellNotValid:8};lt.Controls.Medical.MPRStatus.registerEnum("lt.Controls.Medical.MPRStatus",!1);lt.Controls.Medical.CellMPRType=function(){};lt.Controls.Medical.CellMPRType.prototype={none:-1,axial:0,sagittal:1,coronal:2};lt.Controls.Medical.CellMPRType.registerEnum("lt.Controls.Medical.CellMPRType",!1);lt.Controls.Medical.OverlayTextType=function(){};
lt.Controls.Medical.OverlayTextType.prototype={windowLevel:0,instanceNumber:1,userData:2,imageQuality:3,frameNumber:4,leftOrientation:5,rightOrientation:6,topOrientation:7,bottomOrientation:8,mprType:9,retakeImage:10};lt.Controls.Medical.OverlayTextType.registerEnum("lt.Controls.Medical.OverlayTextType",!1);lt.Controls.Medical.OverlayAlignment=function(){};lt.Controls.Medical.OverlayAlignment.prototype={none:-1,topLeft:0,topRight:1,bottomLeft:2,bottomRight:3,centerTop:4,centerLeft:5,centerRight:6,
centerBottom:7};lt.Controls.Medical.OverlayAlignment.registerEnum("lt.Controls.Medical.OverlayAlignment",!1);lt.Controls.Medical.MedicalNotifyCollectionChangedAction=function(){};lt.Controls.Medical.MedicalNotifyCollectionChangedAction.prototype={reset:0,add:1,move:2,remove:3,replace:4,insert:5};lt.Controls.Medical.MedicalNotifyCollectionChangedAction.registerEnum("lt.Controls.Medical.MedicalNotifyCollectionChangedAction",!1);lt.Controls.Medical.LineProfileChannel=function(){};lt.Controls.Medical.LineProfileChannel.prototype=
{red:0,green:1,blue:2,gray:3};lt.Controls.Medical.LineProfileChannel.registerEnum("lt.Controls.Medical.LineProfileChannel",!1);lt.Controls.Medical._imrtiRenderer=function(){};lt.Controls.Medical._imrtiRenderer.prototype={get_image:null,set_image:null,renderAsync:null,add_renderChunk:null,remove_renderChunk:null};lt.Controls.Medical._imrtiRenderer.registerInterface("lt.Controls.Medical._imrtiRenderer");lt.Controls.Medical.ProjectionOrientationType=function(){};lt.Controls.Medical.ProjectionOrientationType.prototype=
{none:0,faceToFace:1,faceToBack:2};lt.Controls.Medical.ProjectionOrientationType.registerEnum("lt.Controls.Medical.ProjectionOrientationType",!1);lt.Controls.Medical.AutomationImageViewer=function(a){this._annRenderingEngine$1=new lt.Annotations.Rendering.AnnHtml5RenderingEngine;this._imageExtraPixelSize$1=lt.LeadSizeD.create(0,0);this._identityMatrix$1=lt.LeadMatrix.get_identity();lt.Controls.Medical.AutomationImageViewer.initializeBase(this,[a]);null!=this.__automationEnabledChanged$1&&this.__automationEnabledChanged$1(this,
lt.LeadEventArgs.Empty);null!=this.__automationUseDpiChanged$1&&this.__automationUseDpiChanged$1(this,lt.LeadEventArgs.Empty);null!=this.__automationGotFocus$1&&this.__automationGotFocus$1(this,lt.LeadEventArgs.Empty);null!=this.__automationLostFocus$1&&this.__automationLostFocus$1(this,lt.LeadEventArgs.Empty);this.set_imageBackgroundColor("transparent")};lt.Controls.Medical.AutomationImageViewer.prototype={_container$1:null,get_automationScrollOffset:function(){return lt.LeadPointD.create(0,0)},
_customObjects$1:null,get_customObjects:function(){return this._customObjects$1},set_customObjects:function(a){return this._customObjects$1=a},_automationObject$1:null,get_automationObject:function(){return this._automationObject$1},set_automationObject:function(a){return this._automationObject$1=a},_automationObject_ActiveContainerChanged$1:function(){for(var a=ss.IEnumerator.getEnumerator(this._automationObject$1.get_containers());a.moveNext();){var b=a.current;b===this._automationObject$1.get_activeContainer()?
b.set_stroke(lt.Controls.Medical.AutomationImageViewer._activeStroke$1):b.set_stroke(lt.Controls.Medical.AutomationImageViewer._normalStroke$1)}this._automationObject$1.invalidate(lt.LeadRectD.get_empty())},_onCanvasSizeChanged$1:function(){lt.LeadRectD.create(0,0,this.get_mainDiv().clientWidth,this.get_mainDiv().clientHeight)},_isAttached$1:!1,automationAttach:function(a){this._isAttached$1||(this._container$1=a);this._isAttached$1=!0},automationDetach:function(){this._container$1=null;this._isAttached$1=
!1},add_automationDoubleClick:function(a){this.__automationDoubleClick$1=ss.Delegate.combine(this.__automationDoubleClick$1,a)},remove_automationDoubleClick:function(a){this.__automationDoubleClick$1=ss.Delegate.remove(this.__automationDoubleClick$1,a)},__automationDoubleClick$1_handler_get:function(){null==this.__automationDoubleClick$1_handler&&(this.__automationDoubleClick$1_handler=ss.EventHandler.create(this,this.add_automationDoubleClick,this.remove_automationDoubleClick));return this.__automationDoubleClick$1_handler},
__automationDoubleClick$1:null,__automationDoubleClick$1_handler:null,get_automationDpiX:function(){return 96},get_automationDpiY:function(){return 96},get_automationEnabled:function(){return!0},add_automationEnabledChanged:function(a){this.__automationEnabledChanged$1=ss.Delegate.combine(this.__automationEnabledChanged$1,a)},remove_automationEnabledChanged:function(a){this.__automationEnabledChanged$1=ss.Delegate.remove(this.__automationEnabledChanged$1,a)},__automationEnabledChanged$1_handler_get:function(){null==
this.__automationEnabledChanged$1_handler&&(this.__automationEnabledChanged$1_handler=ss.EventHandler.create(this,this.add_automationEnabledChanged,this.remove_automationEnabledChanged));return this.__automationEnabledChanged$1_handler},__automationEnabledChanged$1:null,__automationEnabledChanged$1_handler:null,_automationGetContainersCallback$1:null,get_automationGetContainersCallback:function(){return this._automationGetContainersCallback$1},set_automationGetContainersCallback:function(a){return this._automationGetContainersCallback$1=
a},add_automationGotFocus:function(a){this.__automationGotFocus$1=ss.Delegate.combine(this.__automationGotFocus$1,a)},remove_automationGotFocus:function(a){this.__automationGotFocus$1=ss.Delegate.remove(this.__automationGotFocus$1,a)},__automationGotFocus$1_handler_get:function(){null==this.__automationGotFocus$1_handler&&(this.__automationGotFocus$1_handler=ss.EventHandler.create(this,this.add_automationGotFocus,this.remove_automationGotFocus));return this.__automationGotFocus$1_handler},__automationGotFocus$1:null,
__automationGotFocus$1_handler:null,automationInvalidate:function(a){this._invalidate1$1(null==a?lt.LeadRectD.get_empty():a)},_invalidate1$1:function(a){if(null!=this._automationGetContainersCallback$1){var b=this._automationGetContainersCallback$1(),c=0,d=b.get_count(),e,f,g,h,i=!1;a.get_isEmpty()||(i=!0);for(c=0;c<d;c++)if(g=b.get_item(c),e=g.AttachedSubCell,null!=e&&(f=e.get_attachedFrame(),e=e.get_annotationCanvas(),h=e.getContext("2d"),a.get_isEmpty()&&(a=lt.LeadRectD.create(0,0,e.width,e.height)),
!i||g.get_isEnabled()))a=lt.LeadRectD.create(a.get_x()+0.5,a.get_y()+0.5,a.get_width()+0.5,a.get_height()+0.5),h.clearRect(a.get_x(),a.get_y(),a.get_width(),a.get_height()),g.get_children().get_count()&&e.width&&e.height&&(h.save(),h.beginPath(),h.rect(a.get_x(),a.get_y(),a.get_width(),a.get_height()),h.clip(),this._renderContainer$1(h,this._annRenderingEngine$1,g,a),h.closePath(),h.restore(),null!=f&&null!=f.get_shutter()&&f.get_shutter().get_objects().get_count()&&f.get_shutter().updateView())}else null!=
this._container$1&&(e=this._getCurrentSubCell$1(),null!=e&&(e=e.get_annotationCanvas(),h=e.getContext("2d"),h.clearRect(0,0,e.width,e.height),this._renderContainer$1(h,this._annRenderingEngine$1,this._container$1,a)))},_renderContainer$1:function(a,b,c,d){b.attach(c,a);try{var e=lt.LeadRectD.get_empty();d.get_isEmpty()||(e=lt.LeadRectD.create(d.get_x(),d.get_y(),d.get_width(),d.get_height()),e=c.get_mapper().rectToContainerCoordinates(e));b.renderContainer(e,c,!1)}finally{b.detach()}},add_automationLostFocus:function(a){this.__automationLostFocus$1=
ss.Delegate.combine(this.__automationLostFocus$1,a)},remove_automationLostFocus:function(a){this.__automationLostFocus$1=ss.Delegate.remove(this.__automationLostFocus$1,a)},__automationLostFocus$1_handler_get:function(){null==this.__automationLostFocus$1_handler&&(this.__automationLostFocus$1_handler=ss.EventHandler.create(this,this.add_automationLostFocus,this.remove_automationLostFocus));return this.__automationLostFocus$1_handler},__automationLostFocus$1:null,__automationLostFocus$1_handler:null,
add_automationPointerDown:function(a){this.__automationPointerDown$1=ss.Delegate.combine(this.__automationPointerDown$1,a)},remove_automationPointerDown:function(a){this.__automationPointerDown$1=ss.Delegate.remove(this.__automationPointerDown$1,a)},__automationPointerDown$1_handler_get:function(){null==this.__automationPointerDown$1_handler&&(this.__automationPointerDown$1_handler=ss.EventHandler.create(this,this.add_automationPointerDown,this.remove_automationPointerDown));return this.__automationPointerDown$1_handler},
__automationPointerDown$1:null,__automationPointerDown$1_handler:null,add_automationPointerMove:function(a){this.__automationPointerMove$1=ss.Delegate.combine(this.__automationPointerMove$1,a)},remove_automationPointerMove:function(a){this.__automationPointerMove$1=ss.Delegate.remove(this.__automationPointerMove$1,a)},__automationPointerMove$1_handler_get:function(){null==this.__automationPointerMove$1_handler&&(this.__automationPointerMove$1_handler=ss.EventHandler.create(this,this.add_automationPointerMove,
this.remove_automationPointerMove));return this.__automationPointerMove$1_handler},__automationPointerMove$1:null,__automationPointerMove$1_handler:null,add_automationPointerUp:function(a){this.__automationPointerUp$1=ss.Delegate.combine(this.__automationPointerUp$1,a)},remove_automationPointerUp:function(a){this.__automationPointerUp$1=ss.Delegate.remove(this.__automationPointerUp$1,a)},__automationPointerUp$1_handler_get:function(){null==this.__automationPointerUp$1_handler&&(this.__automationPointerUp$1_handler=
ss.EventHandler.create(this,this.add_automationPointerUp,this.remove_automationPointerUp));return this.__automationPointerUp$1_handler},__automationPointerUp$1:null,__automationPointerUp$1_handler:null,add_automationSizeChanged:function(a){this.__automationSizeChanged$1=ss.Delegate.combine(this.__automationSizeChanged$1,a)},remove_automationSizeChanged:function(a){this.__automationSizeChanged$1=ss.Delegate.remove(this.__automationSizeChanged$1,a)},__automationSizeChanged$1_handler_get:function(){null==
this.__automationSizeChanged$1_handler&&(this.__automationSizeChanged$1_handler=ss.EventHandler.create(this,this.add_automationSizeChanged,this.remove_automationSizeChanged));return this.__automationSizeChanged$1_handler},__automationSizeChanged$1:null,__automationSizeChanged$1_handler:null,_getCurrentSubCell$1:function(){var a=this._getCurrentContainer$1();return null==a?null:a.AttachedSubCell},_getCurrentContainer$1:function(){return null!=this._automationObject$1&&-1!==this._automationContainerIndex$1?
this._automationObject$1.get_containers().get_item(this._automationContainerIndex$1):null},get_automationTransform:function(){var a=this._getCurrentSubCell$1();if(null!=a){var b=this.getItemBounds(a,lt.Controls.ImageViewerItemPart.view),c=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this,a),d=this.getItemImageFloatingPointTransform(a);if(b.get_isEmpty())return this._identityMatrix$1;d.set_offsetX(d.get_offsetX()-b.get_left());d.set_offsetY(d.get_offsetY()-b.get_top());a=a.get_attachedFrame();
null!=a&&(d.rotateAt(a.get_rotateAngle(),(c.get_left()+c.get_right())/2,(c.get_top()+c.get_bottom())/2),d.scale(a.get_reversed()?-1:1,a.get_flipped()?-1:1));return d}return this._identityMatrix$1},add_automationTransformChanged:function(a){this.__automationTransformChanged$1=ss.Delegate.combine(this.__automationTransformChanged$1,a)},remove_automationTransformChanged:function(a){this.__automationTransformChanged$1=ss.Delegate.remove(this.__automationTransformChanged$1,a)},__automationTransformChanged$1_handler_get:function(){null==
this.__automationTransformChanged$1_handler&&(this.__automationTransformChanged$1_handler=ss.EventHandler.create(this,this.add_automationTransformChanged,this.remove_automationTransformChanged));return this.__automationTransformChanged$1_handler},__automationTransformChanged$1:null,__automationTransformChanged$1_handler:null,get_automationUseDpi:function(){return!1},add_automationUseDpiChanged:function(a){this.__automationUseDpiChanged$1=ss.Delegate.combine(this.__automationUseDpiChanged$1,a)},remove_automationUseDpiChanged:function(a){this.__automationUseDpiChanged$1=
ss.Delegate.remove(this.__automationUseDpiChanged$1,a)},__automationUseDpiChanged$1_handler_get:function(){null==this.__automationUseDpiChanged$1_handler&&(this.__automationUseDpiChanged$1_handler=ss.EventHandler.create(this,this.add_automationUseDpiChanged,this.remove_automationUseDpiChanged));return this.__automationUseDpiChanged$1_handler},__automationUseDpiChanged$1:null,__automationUseDpiChanged$1_handler:null,get_automationXResolution:function(){return 150},get_automationYResolution:function(){return 150},
get_renderingEngine:function(){return this._annRenderingEngine$1},set_renderingEngine:function(a){this._annRenderingEngine$1=Type.safeCast(a,lt.Annotations.Rendering.AnnHtml5RenderingEngine);return a},get__isAutomationAttached$1:function(){return this._isAttached$1},onItemChanged:function(a){switch(a.get_reason()){case lt.Controls.ImageViewerItemChangedReason.size:null!=this.__automationSizeChanged$1&&this.__automationSizeChanged$1(this,lt.LeadEventArgs.Empty);this._invalidate1$1(lt.LeadRectD.get_empty());
break;case lt.Controls.ImageViewerItemChangedReason.url:case lt.Controls.ImageViewerItemChangedReason.image:case lt.Controls.ImageViewerItemChangedReason.imageChanged:case lt.Controls.ImageViewerItemChangedReason.transform:this.get__isAutomationAttached$1()&&(null!=this.__automationTransformChanged$1&&this.__automationTransformChanged$1(this,lt.LeadEventArgs.Empty),this._invalidate1$1(lt.LeadRectD.get_empty()))}lt.Controls.Medical.AutomationImageViewer.callBaseMethod(this,"onItemChanged",[a])},onTransformChanged:function(a){lt.Controls.Medical.AutomationImageViewer.callBaseMethod(this,
"onTransformChanged",[a]);this.get__isAutomationAttached$1()&&null!=this.__automationTransformChanged$1&&this.__automationTransformChanged$1(this,lt.LeadEventArgs.Empty);this._onCanvasSizeChanged$1(a)},onAutomationPointerDown:function(a){null!=this.__automationPointerDown$1&&this.__automationPointerDown$1(this,a)},onAutomationPointerMove:function(a){null!=this.__automationPointerMove$1&&this.__automationPointerMove$1(this,a)},onAutomationPointerUp:function(a){null!=this.__automationPointerUp$1&&this.__automationPointerUp$1(this,
a)},onAutomationDoubleClick:function(a){null!=this.__automationDoubleClick$1&&this.__automationDoubleClick$1(this,a)},_dataProvider$1:null,get_automationDataProvider:function(){return this._dataProvider$1},set_automationDataProvider:function(a){return this._dataProvider$1=a},_automationAntiAlias$1:!1,get_automationAntiAlias:function(){return this._automationAntiAlias$1},set_automationAntiAlias:function(a){return this._automationAntiAlias$1=a},_automationContainerIndex$1:0,get_automationContainerIndex:function(){return this._automationContainerIndex$1},
set_automationContainerIndex:function(a){return this._automationContainerIndex$1=a}};Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationScrollOffset",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationScrollOffset,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"customObjects",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_customObjects,set:lt.Controls.Medical.AutomationImageViewer.prototype.set_customObjects,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationObject",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationObject,set:lt.Controls.Medical.AutomationImageViewer.prototype.set_automationObject,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationDoubleClick",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationDoubleClick$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationDpiX",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationDpiX,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationDpiY",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationDpiY,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,
"automationEnabled",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationEnabled,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationEnabledChanged",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationEnabledChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationGetContainersCallback",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationGetContainersCallback,
set:lt.Controls.Medical.AutomationImageViewer.prototype.set_automationGetContainersCallback,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationGotFocus",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationGotFocus$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationLostFocus",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationLostFocus$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationPointerDown",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationPointerDown$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationPointerMove",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationPointerMove$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,
"automationPointerUp",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationPointerUp$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationSizeChanged",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationSizeChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationTransform",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationTransform,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationTransformChanged",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationTransformChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationUseDpi",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationUseDpi,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,
"automationUseDpiChanged",{get:lt.Controls.Medical.AutomationImageViewer.prototype.__automationUseDpiChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationXResolution",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationXResolution,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationYResolution",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationYResolution,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"renderingEngine",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_renderingEngine,set:lt.Controls.Medical.AutomationImageViewer.prototype.set_renderingEngine,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationDataProvider",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationDataProvider,set:lt.Controls.Medical.AutomationImageViewer.prototype.set_automationDataProvider,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationAntiAlias",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationAntiAlias,set:lt.Controls.Medical.AutomationImageViewer.prototype.set_automationAntiAlias,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationImageViewer.prototype,"automationContainerIndex",{get:lt.Controls.Medical.AutomationImageViewer.prototype.get_automationContainerIndex,
set:lt.Controls.Medical.AutomationImageViewer.prototype.set_automationContainerIndex,enumerable:!0,configurable:!0});lt.Controls.Medical.AutomationInteractiveMode=function(){lt.Controls.Medical.AutomationInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item)};lt.Controls.Medical.AutomationInteractiveMode.prototype={_viewer$1:null,get_id:function(){return 100},start:function(a){this._viewer$1=a;
null==this._viewer$1&&lt.Annotations.Core.ExceptionHelper.invalidOperationException("Must me attached to AutomationImageViewer instance");lt.Controls.Medical.AutomationInteractiveMode.callBaseMethod(this,"start",[a]);a=lt.Controls.Medical.AutomationInteractiveMode.callBaseMethod(this,"get_interactiveService");a.set_dragStartsOnDown(!0);a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,
this._service_DragCompleted$1));a.add_doubleTap(ss.Delegate.create(this,this._service_DoubleTap$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.AutomationInteractiveMode.callBaseMethod(this,"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));b.remove_doubleTap(ss.Delegate.create(this,
this._service_DoubleTap$1));this._viewer$1=null;lt.Controls.Medical.AutomationInteractiveMode.callBaseMethod(this,"stop",[a])}},get_name:function(){return"AutomationInteractiveMode"},_getScrollPoints$1:function(a){for(var a=a.get_parentCell().get_div(),b=0,c=0;null!=a;)void 0!=a.scrollLeft&&(b+=a.scrollLeft),void 0!=a.scrollTop&&(c+=a.scrollTop),a=a.parentNode;return lt.LeadPointD.create(b,c)},_scrollPoint$1:null,_service_DragStarted$1:function(a,b){if(this.canStartWork(b)&&null!=this.get_item()){var c=
this.get_item();this._scrollPoint$1=this._getScrollPoints$1(this.get_item());c=c.get_imageViewer().getItemViewBounds(c,lt.Controls.ImageViewerItemPart.view,!1);if(!c.get_isEmpty()&&(c=lt.LeadPointD.create(this._scrollPoint$1.get_x()+b.get_position().get_x()-c.get_left(),this._scrollPoint$1.get_y()+b.get_position().get_y()-c.get_top()),null!=this._viewer$1))switch(this.onWorkStarted(lt.LeadEventArgs.Empty),b.get_mouseButton()){case lt.Controls.MouseButtons.right:this._viewer$1.onAutomationPointerDown(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.right,
lt.LeadPointD.create(c.get_x(),c.get_y())));break;default:this._viewer$1.onAutomationPointerDown(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.left,lt.LeadPointD.create(c.get_x(),c.get_y())))}}},_service_DragDelta$1:function(a,b){if(null!=this._viewer$1&&this.get_isWorking()){var c=this.get_item(),c=c.get_imageViewer().getItemViewBounds(c,lt.Controls.ImageViewerItemPart.view,!1);c.get_isEmpty()||(c=lt.LeadPointD.create(this._scrollPoint$1.get_x()+b.get_position().get_x()-
c.get_left(),this._scrollPoint$1.get_y()+b.get_position().get_y()-c.get_top()),this._viewer$1.onAutomationPointerMove(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.left,lt.LeadPointD.create(c.get_x(),c.get_y()))),b.set_isHandled(!0))}},_service_DragCompleted$1:function(a,b){if(null!=this._viewer$1&&this.get_isWorking()){var c=this.get_item(),c=c.get_imageViewer().getItemViewBounds(c,lt.Controls.ImageViewerItemPart.view,!1);c.get_isEmpty()||(c=lt.LeadPointD.create(this._scrollPoint$1.get_x()+
b.get_position().get_x()-c.get_left(),this._scrollPoint$1.get_y()+b.get_position().get_y()-c.get_top()),this._viewer$1.onAutomationPointerUp(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.left,lt.LeadPointD.create(c.get_x(),c.get_y()))),this.onWorkCompleted(lt.LeadEventArgs.Empty),b.set_isHandled(!0))}},_service_DoubleTap$1:function(a,b){null!=this._viewer$1&&this.canStartWork(b)&&(this.onWorkStarted(lt.LeadEventArgs.Empty),this._viewer$1.onAutomationDoubleClick(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.left,
lt.LeadPointD.get_empty())),this.onWorkCompleted(lt.LeadEventArgs.Empty),b.set_isHandled(!0))}};Object.defineProperty(lt.Controls.Medical.AutomationInteractiveMode.prototype,"id",{get:lt.Controls.Medical.AutomationInteractiveMode.prototype.get_id,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.AutomationInteractiveMode.prototype,"name",{get:lt.Controls.Medical.AutomationInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});lt.Controls.Medical._imageDataStreamer=
function(a,b,c){this._numberOfRows=Math.max(1,Math.floor(b/(4*a.width))+c>>1);this._canvas=a;this._dim=c};lt.Controls.Medical._imageDataStreamer.prototype={_canvas:null,_isEOF:!1,_numberOfRows:0,_dim:0,_currentRow:0,beginStream:function(){this._currentRow=0;this._isEOF=!1},get_isEOF:function(){return this._isEOF},getNextChunk:function(){var a=this._canvas.getContext("2d"),b=this._canvas.height,c=Math.min(b-this._currentRow,this._numberOfRows),a=a.getImageData(0,this._currentRow,this._canvas.width,
c);this._currentRow+=this._numberOfRows;this._currentRow>=b&&(this._isEOF=!0);return a},setNextChunk:function(a){var b=this._canvas.getContext("2d"),c=this._canvas.height,d=Math.min(c,this._currentRow+this._numberOfRows);b.putImageData(a,0,this._currentRow);this._currentRow+=this._numberOfRows;d===c&&(this._isEOF=!0)}};lt.Controls.Medical.DICOMImageInformation=function(){this.set_minValue(0);this.set_maxValue(0);this.set_signed(!1);this.set_modalitySlope(1);this.set_autoScaleSlope(1)};lt.Controls.Medical.DICOMImageInformation._updateImageData=
function(a,b,c,d,e,f){for(var g=Math.min(b.length-c,1E6),h=c;h<c+g;h++)b[h]=a[d+1]<<8|a[d],d+=2;c+g>=b.length?e(b,f):setTimeout(function(){lt.Controls.Medical.DICOMImageInformation._updateImageData(a,b,c+g,d,e,f)},1)};lt.Controls.Medical.DICOMImageInformation.prototype={_autoScaleIntercept:0,get_autoScaleIntercept:function(){return this._autoScaleIntercept},set_autoScaleIntercept:function(a){return this._autoScaleIntercept=a},_autoScaleSlope:0,get_autoScaleSlope:function(){return this._autoScaleSlope},
set_autoScaleSlope:function(a){return this._autoScaleSlope=a},_image:null,get_image:function(){return this._image},set_image:function(a){return this._image=a},_canvas:null,get_canvas:function(){return this._canvas},set_canvas:function(a){return this._canvas=a},_Width:0,get_width:function(){return this._Width},set_width:function(a){return this._Width=a},_Height:0,get_height:function(){return this._Height},set_height:function(a){return this._Height=a},_BitsPerPixel:0,get_bitsPerPixel:function(){return this._BitsPerPixel},
set_bitsPerPixel:function(a){return this._BitsPerPixel=a},_MinValue:0,get_minValue:function(){return this._MinValue},set_minValue:function(a){return this._MinValue=a},_MaxValue:0,get_maxValue:function(){return this._MaxValue},set_maxValue:function(a){return this._MaxValue=a},_originalLUT:null,_LUT32:null,get_luT32:function(){return this._LUT32},set_luT32:function(a){return this._LUT32=a},_LUT2:null,get_luT2:function(){return this._LUT2},set_luT2:function(a){return this._LUT2=a},_Data32:null,get_data32:function(){return this._Data32},
set_data32:function(a){return this._Data32=a},_windowWidth:0,get_windowWidth:function(){return this._windowWidth},set_windowWidth:function(a){return this._windowWidth=a},_windowCenter:0,get_windowCenter:function(){return this._windowCenter},set_windowCenter:function(a){return this._windowCenter=a},_LowBit:0,get_lowBit:function(){return this._LowBit},set_lowBit:function(a){return this._LowBit=a},_HighBit:0,get_highBit:function(){return this._HighBit},set_highBit:function(a){return this._HighBit=a},
_ModalityIntercept:0,get_modalityIntercept:function(){return this._ModalityIntercept},set_modalityIntercept:function(a){return this._ModalityIntercept=a},_ModalitySlope:0,get_modalitySlope:function(){return this._ModalitySlope},set_modalitySlope:function(a){return this._ModalitySlope=a},_Signed:!1,get_signed:function(){return this._Signed},set_signed:function(a){return this._Signed=a},_photoMetricInterpretation:null,get_photometricInterpretation:function(){return this._photoMetricInterpretation},
set_photometricInterpretation:function(a){return this._photoMetricInterpretation=a},_LUTDescriptor:null,get_lutDescriptor:function(){return this._LUTDescriptor},set_lutDescriptor:function(a){return this._LUTDescriptor=a},_firstStoredPixelValueMapped:0,get_firstStoredPixelValueMapped:function(){return this._firstStoredPixelValueMapped},set_firstStoredPixelValueMapped:function(a){return this._firstStoredPixelValueMapped=a},_prepareImageData:function(){var a=this.get_data32(),b=this.get_bitsPerPixel(),
c=a.length,d=null,e;switch(b){case 12:case 16:case 48:case 64:d=lt.LTHelper.supportsTypedArray?new Uint32Array(c>>1):Array(c>>1);for(b=e=0;b<c;b++)d[b]=a[e+1]<<8|a[e],e+=2;break;default:d=lt.LTHelper.supportsTypedArray?new Uint32Array(a):a}return d},_onPreparingDataCompleted:function(a,b){this._Data32=a;b()},_setAndPrepareImageDataAsync:function(a,b){var c=this.get_bitsPerPixel(),d=a.length,e=null;switch(c){case 12:case 16:case 48:case 64:e=lt.LTHelper.supportsTypedArray?new Uint32Array(d>>1):Array(d>>
1);lt.Controls.Medical.DICOMImageInformation._updateImageData(a,e,0,0,ss.Delegate.create(this,this._onPreparingDataCompleted),b);break;default:e=lt.LTHelper.supportsTypedArray?new Uint32Array(a):a,this._onPreparingDataCompleted(e,b)}},_restoreImageData:function(a,b){var c=this.get_bitsPerPixel(),d=a.data.length,e=0;switch(c){case 12:case 16:case 48:case 64:for(var c=0,f=a.data;e<d;e+=4)f[e+1]=b[c]>>8,f[e+2]=b[c]&255,f[e+3]=255,c++;break;default:f=a.data;for(c=0;e<d;e+=4)f[e+2]=b[c],f[e+3]=255,c++}},
clone:function(){var a=new lt.Controls.Medical.DICOMImageInformation;a.set_width(this.get_width());a.set_height(this.get_height());a.set_bitsPerPixel(this.get_bitsPerPixel());a.set_minValue(this.get_minValue());a.set_maxValue(this.get_maxValue());a.set_luT32(this.get_luT32());a.set_windowWidth(this.get_windowWidth());a.set_windowCenter(this.get_windowCenter());a.set_signed(this.get_signed());a.set_lowBit(this.get_lowBit());a.set_highBit(this.get_highBit());return a},_prepareDataChunk:function(a){var b=
null,b=this.get_bitsPerPixel(),c=a.data.length>>2,d=0;switch(b){case 12:case 16:case 48:case 64:for(var b=lt.LTHelper.supportsTypedArray?new Uint32Array(c):Array(c),e=0,a=a.data;d<c;d++)b[d]=a[e+1]<<8|a[e+2],e+=4;break;default:b=lt.LTHelper.supportsTypedArray?new Uint32Array(c):Array(c);a=a.data;for(e=0;d<c;d++)b[d]=a[e+2],e+=4}return b},_setAndPrepareCanvasData:function(a){this._canvas=a},resize:function(a){if(1!==a&&2!==a)throw Error("Resize factor must be 1 or 2");var b=this.get_width(),c=this.get_height(),
d=this.get_width(),e=b>>a,c=c>>a,f=e*c,g=null,g=lt.LTHelper.supportsTypedArray?new Uint32Array(f):Array(f),h,i,j,k,l,m=0,n,f=0,r=1<<a,o=65536;null!=this.get_luT32()&&this.get_luT32().length&&(o=this.get_luT32().length);this.get_signed();var t=!this.get_signed()?o:o+1>>1,s=b-(e<<a),q=this.get_data32(),p;null!=this.get_canvas()&&(h=this.get_canvas(),q=this._prepareDataChunk(h.getContext("2d").getImageData(0,0,h.width,h.height)));for(i=0;i<c;i++){n=i<<a;for(h=0;h<e;h++){m=0;j=(h<<a)+n*b;for(k=0;k<r;k++){for(l=
0;l<r;l++)p=q[j+l],p>=t&&(p-=o),m+=p;j+=d+s}0>m?(m=-m,j=m>>r,j=o-1-j):j=m>>r;g[f]=j;f++}}a=document.createElement("canvas");a.width=e;a.height=c;b=a.getContext("2d");d=b.getImageData(0,0,a.width,a.height);this._restoreImageData(d,g);b.putImageData(d,0,0);g=new lt.Controls.Medical.DICOMImageInformation;g.set_width(e);g.set_height(c);g.set_data32(null);g.set_canvas(a);g.set_bitsPerPixel(this.get_bitsPerPixel());g.set_minValue(this.get_minValue());g.set_maxValue(this.get_maxValue());g.set_luT32(this.get_luT32());
g.set_windowWidth(this.get_windowWidth());g.set_windowCenter(this.get_windowCenter());g.set_signed(this.get_signed());g.set_lowBit(this.get_lowBit());g.set_highBit(this.get_highBit());return g}};Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"autoScaleIntercept",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_autoScaleIntercept,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_autoScaleIntercept,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,
"autoScaleSlope",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_autoScaleSlope,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_autoScaleSlope,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"image",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_image,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_image,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,
"canvas",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_canvas,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_canvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"width",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_width,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_width,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"height",
{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_height,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_height,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"bitsPerPixel",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_bitsPerPixel,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_bitsPerPixel,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,
"minValue",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_minValue,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_minValue,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"maxValue",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_maxValue,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_maxValue,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,
"luT32",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_luT32,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_luT32,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"luT2",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_luT2,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_luT2,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"data32",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_data32,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_data32,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"windowWidth",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_windowWidth,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_windowWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"windowCenter",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_windowCenter,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_windowCenter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"lowBit",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_lowBit,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_lowBit,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"highBit",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_highBit,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_highBit,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"modalityIntercept",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_modalityIntercept,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_modalityIntercept,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"modalitySlope",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_modalitySlope,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_modalitySlope,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"signed",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_signed,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_signed,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"photometricInterpretation",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_photometricInterpretation,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_photometricInterpretation,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"lutDescriptor",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_lutDescriptor,set:lt.Controls.Medical.DICOMImageInformation.prototype.set_lutDescriptor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformation.prototype,"firstStoredPixelValueMapped",{get:lt.Controls.Medical.DICOMImageInformation.prototype.get_firstStoredPixelValueMapped,
set:lt.Controls.Medical.DICOMImageInformation.prototype.set_firstStoredPixelValueMapped,enumerable:!0,configurable:!0});lt.Controls.Medical.DICOMImageInformationRenderer=function(a){if(null==a)throw Error("'information' cannot be null");this._info=a;this._windowLevelPaletteType=0;this._updatePalette();(this._useDescriptor=this._doUseDescriptor())&&this._prepareLUTDescriptor();a=!1;null==this._info.get_luT32()&&(a=!0,lt.LTHelper.supportsTypedArray?this._info.set_luT32(new Uint32Array(1<<this._info.get_highBit()+
1)):this._info.set_luT32(Array(1<<this._info.get_highBit()+1)));var b=!1;this._info.get_signed()&&(this._info.set_minValue(32767<this._info.get_minValue()?this._info.get_minValue()-65536:this._info.get_minValue()),this._info.set_maxValue(32767<this._info.get_maxValue()?this._info.get_maxValue()-65536:this._info.get_maxValue()),b=0>this._info.get_minValue()&&0>this._info.get_maxValue());if(!(this._info.get_maxValue()-this._info.get_minValue())||-1===this._info.get_maxValue()||b)8===this._info.get_bitsPerPixel()?
(this._info.set_minValue(0),this._info.set_maxValue(255)):(this._getMinMaxValue(),this._info.set_minValue(this._minValue),this._info.set_maxValue(this._maxValue));this._calculateLUT(a)};lt.Controls.Medical.DICOMImageInformationRenderer.shouldResize=function(a,b){var c=document.createElement("canvas");c.width=51;c.height=51;for(var d=Date.get_now().getTime(),e,f,g=c.getContext("2d"),h=0,i;;){var j=g.getImageData(0,0,c.width,c.height);f=j.data.length;i=j.data;for(e=0;e<f;e++)i[e]=i[e];g.putImageData(j,
0,0);h++;e=Date.get_now().getTime()-d;if(125<e)break}c.width=1;c.height=1;g=c.getContext("2d");g.clearRect(0,0,1,1);delete c;lt.LTHelper.OS===lt.LTOS.iOS?h>>=1:lt.LTHelper.OS===lt.LTOS.android?h=Math.round(h/3):lt.Controls.Medical.DICOMImageInformationRenderer._waitTime=lt.LTHelper.browser===lt.LTBrowser.internetExplorer?0:125*a*b/(h*c.width*c.height);return 100<h?0:1};lt.Controls.Medical.DICOMImageInformationRenderer._stringArrayToIntArray=function(a){if(null==a)return null;var b,c=Array(a.length);
for(b=0;b<a.length;b++)c[b]=parseInt(a[b]);return c};lt.Controls.Medical.DICOMImageInformationRenderer.prototype={dispose:function(){this._info=this._pLUT=this._paletteB=this._paletteG=this._paletteR=this._modifiedDescriptor=this._renderImageData=null},_minValue:0,_maxValue:0,_getMinMaxValue:function(){var a=this._info.get_width(),b=this._info.get_height(),c,d,e,f=this._info.get_data32(),g,h=65536,h=1<<this._info.get_highBit()-this._info.get_lowBit()+1;this._info.get_signed();var i=!this._info.get_signed()?
h:h+1>>1;this._minValue=65536;this._maxValue=-65536;if(null!=this._info.get_canvas()){a=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),4E5,0);for(a.beginStream();!a.get_isEOF();){f=this._info._prepareDataChunk(a.getNextChunk());b=f.length;for(c=0;c<b;c++)g=f[c],g>=i&&(g-=h),this._maxValue=Math.max(this._maxValue,g),this._minValue=Math.min(this._minValue,g)}}else for(d=0;d<b;d++){e=d*a;for(c=0;c<a;c++)g=f[e+c],g>=i&&(g-=h),this._maxValue=Math.max(this._maxValue,g),this._minValue=
Math.min(this._minValue,g)}},_doUseDescriptor:function(){var a=null!=this._info.get_lutDescriptor()&&!this._info.get_windowWidth();this._info.get_modalityIntercept()&&this._info.get_modalitySlope()&&1!==this._info.get_modalitySlope()&&(a=!1);return a},_updateRenderer:function(){(this._useDescriptor=this._doUseDescriptor())&&this._prepareLUTDescriptor()},_calculateLUT:function(a){this._getLUTValues(a);this._info.get_windowWidth()?(this._windowLevelWidth=this._info.get_windowWidth(),this._windowLevelCenter=
this._info.get_windowCenter(),this._originalWindowLevelWidth=this._info.get_windowWidth(),this._originalWindowLevelCenter=this._info.get_windowCenter()):(this._originalWindowLevelWidth=this._windowLevelWidth,this._originalWindowLevelCenter=this._windowLevelCenter);this.updateWindowLevelLUT(this._originalWindowLevelWidth,this._originalWindowLevelCenter);this._isLUTCalculated=!0},_isLUTCalculated:!1,get__isLUTCalculated:function(){return this._isLUTCalculated},_info:null,get_information:function(){return this._info},
_from:0,_to:0,_previous1:0,_previous2:65535,_minimumWindowLevelWidth:0,get_minimumWindowLevelWidth:function(){return this._minimumWindowLevelWidth},_maximumWindowLevelWidth:0,get_maximumWindowLevelWidth:function(){return this._maximumWindowLevelWidth},_minimumWindowLevelCenter:0,get_minimumWindowLevelCenter:function(){return this._minimumWindowLevelCenter},_maximumWindowLevelCenter:0,get_maximumWindowLevelCenter:function(){return this._maximumWindowLevelCenter},_originalWindowLevelWidth:0,get_originalWindowLevelWidth:function(){return this._originalWindowLevelWidth},
_originalWindowLevelCenter:0,get_originalWindowLevelCenter:function(){return this._originalWindowLevelCenter},_windowLevelWidth:0,get_windowLevelWidth:function(){return this._windowLevelWidth},_windowLevelCenter:0,get_windowLevelCenter:function(){return this._windowLevelCenter},_attachedRenderer:null,reset:function(){this.updateWindowLevelLUT(this._originalWindowLevelWidth,this._originalWindowLevelCenter)},updateWindowLevelLUT:function(a,b){this._applyWindowLevelLUT(a,b,8)},add_changed:function(a){this.__changed=
ss.Delegate.combine(this.__changed,a)},remove_changed:function(a){this.__changed=ss.Delegate.remove(this.__changed,a)},__changed_handler_get:function(){null==this.__changed_handler&&(this.__changed_handler=ss.EventHandler.create(this,this.add_changed,this.remove_changed));return this.__changed_handler},__changed:null,__changed_handler:null,onChanged:function(a){null!=this.__changed&&this.__changed(this,a)},_useDescriptor:!1,_getLUTValues:function(a){var b=0,c=0;if(this._useDescriptor)b=this._info.get_firstStoredPixelValueMapped(),
c=b+this._info.get_lutDescriptor().length;else if(a)-1===this._info.get_maxValue()&&this._info.set_maxValue((1<<this._info.get_bitsPerPixel())-1),b=this._info.get_minValue(),c=this._info.get_maxValue();else{var a=this._info.get_luT32()[0],d=this._info.get_luT32()[this._info.get_luT32().length-1],e;for(e=0;e<this._info.get_luT32().length;e++)if(this._info.get_luT32()[e]!==a){b=e;break}for(e=this._info.get_luT32().length-1;0<e;e--)if(this._info.get_luT32()[e]!==d){c=e;break}}this._from=c-b;this._to=
c+b>>1;this._windowLevelWidth=this._from;this._windowLevelCenter=this._to;this._minimumWindowLevelWidth=1;this._maximumWindowLevelWidth=((1<<(12===this._info.get_bitsPerPixel()?16:this._info.get_bitsPerPixel()))-1)*this._info.get_modalitySlope()+this._info.get_modalityIntercept();this._minimumWindowLevelCenter=-this._maximumWindowLevelWidth;this._maximumWindowLevelCenter=this._maximumWindowLevelWidth},_renderImageData:null,_renderLineOnCanvas:function(a,b,c,d,e){var f=e.getContext("2d"),g=a.getContext("2d");
if(-1!==c)if(null!=this._info.get_canvas())f.drawImage(this._info.get_canvas(),0,b,this._info.get_canvas().width,1,0,0,this._info.get_canvas().width,1);else{if(null!=this._info.get_image()){var h=this._info.get_image();f.drawImage(h,0,b,h.naturalWidth,1,0,0,h.naturalWidth,1)}}else-1!==d&&(null!=this._info.get_canvas()?f.drawImage(this._info.get_canvas(),b,0,1,this._info.get_canvas().height,0,0,1,this._info.get_canvas().height):null!=this._info.get_image()&&(h=this._info.get_image(),f.drawImage(h,
b,0,1,h.naturalHeight,0,0,1,h.naturalHeight)));b=f.getImageData(0,0,e.width,e.height);h=this._info._prepareDataChunk(b);this._windowLevel(this._info._originalLUT,b.data,h,0,h.length<<2,!0);f.putImageData(b,0,0);-1===d?g.drawImage(e,0,0,e.width,e.height,0,c,a.width,1):g.drawImage(e,0,0,e.width,e.height,d,0,1,a.height)},_renderUsingCanvasInternal:function(a,b){var c=null;if(null!=this._info.get_image()){var d=this._info.get_image();null==this._info.get_canvas()&&(c=document.createElement("canvas"),
c.width=d.naturalWidth,c.height=d.naturalHeight,c.getContext("2d").drawImage(d,0,0,c.width,c.height),this._info.set_canvas(c))}this._renderImageData=null;b?this._firstRender(a,this._renderImageData):this._updateRender(a,this._renderImageData);this.onUpdateImageData(lt.LeadEventArgs.Empty)},_freeInfoCanvas:function(){null!=this._info.get_image()&&null!=this._info.get_canvas()&&(lt.Controls.Medical.Tools._disposeCanvas(this._info.get_canvas()),this._info.set_canvas(null))},renderUsingCanvas:function(a,
b){this._renderUsingCanvasInternal(a,b);this._freeInfoCanvas()},renderInPlace:function(a){var b=a.canvas.getContext("2d"),a=b.getImageData(0,0,a.canvas.width,a.canvas.height);this._windowLevel2(this._info.get_luT32(),a.data);b.putImageData(a,0,0)},render:function(a){var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height);this._windowLevel2(this._info.get_luT32(),a.data);b.putImageData(a,0,0)},add_updateImageData:function(a){this.__updateImageData=ss.Delegate.combine(this.__updateImageData,
a)},remove_updateImageData:function(a){this.__updateImageData=ss.Delegate.remove(this.__updateImageData,a)},__updateImageData_handler_get:function(){null==this.__updateImageData_handler&&(this.__updateImageData_handler=ss.EventHandler.create(this,this.add_updateImageData,this.remove_updateImageData));return this.__updateImageData_handler},__updateImageData:null,__updateImageData_handler:null,onUpdateImageData:function(a){null!=this.__updateImageData&&this.__updateImageData(this,a)},_firstRender:function(a,
b){if(null==b){var c=null;this._info.get_luT32();var d=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),2E6,0),e=new lt.Controls.Medical._imageDataStreamer(a,2E6,0);e.beginStream();for(d.beginStream();!d.get_isEOF();){var f=d.getNextChunk(),c=this._info._prepareDataChunk(f),g=c.length<<2;this._windowLevel(this._info.get_luT32(),f.data,c,0,g,!0);e.setNextChunk(f)}}else if(null==this._info.get_data32()){e=b.data;this._info.get_data32();this._info.get_luT32();d=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),
2E6,0);d.beginStream();for(var h=0;!d.get_isEOF();)f=d.getNextChunk(),c=this._info._prepareDataChunk(f),g=h+(c.length<<2),h=this._windowLevel(this._info.get_luT32(),e,c,h,g,!0)}else e=b.data,c=this._info.get_data32(),g=this._info.get_data32().length<<2,this._info.get_luT32(),this._windowLevel(this._info.get_luT32(),e,c,0,g,!0)},_updateRender:function(a,b){if(null==b){var c=null;this._info.get_luT32();var d=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),2E6,0),e=new lt.Controls.Medical._imageDataStreamer(a,
2E6,0);e.beginStream();for(d.beginStream();!d.get_isEOF();){var f=d.getNextChunk(),c=this._info._prepareDataChunk(f),g=c.length<<2;this._windowLevel(this._info.get_luT32(),f.data,c,0,g,!1);e.setNextChunk(f)}}else if(null==this._info.get_data32()){e=b.data;this._info.get_data32();this._info.get_luT32();d=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),2E6,0);d.beginStream();for(var h=0;!d.get_isEOF();)f=d.getNextChunk(),c=this._info._prepareDataChunk(f),g=h+(c.length<<2),h=this._windowLevel(this._info.get_luT32(),
e,c,h,g,!1)}else e=b.data,c=this._info.get_data32(),g=this._info.get_data32().length<<2,this._info.get_luT32(),this._windowLevel(this._info.get_luT32(),e,c,0,g,!1)},_beginResize:function(a){if(null==a)throw Error("'resizeRenderer' must not be null");a._from=this._from;a._to=this._to;a._previous1=this._previous1;a._previous2=this._previous2;a._minimumWindowLevelWidth=this._minimumWindowLevelWidth;a._maximumWindowLevelWidth=this._maximumWindowLevelWidth;a._minimumWindowLevelCenter=this._minimumWindowLevelCenter;
a._maximumWindowLevelCenter=this._maximumWindowLevelCenter;a._originalWindowLevelWidth=this._originalWindowLevelWidth;a._originalWindowLevelCenter=this._originalWindowLevelCenter;a._windowLevelWidth=this._windowLevelWidth;a._windowLevelCenter=this._windowLevelCenter;a._attachedRenderer=this;this._attachedRenderer=a},_endResize:function(){null!=this._attachedRenderer&&(this._attachedRenderer=this._attachedRenderer._attachedRenderer=null)},_modifiedDescriptor:null,_prepareLUTDescriptor:function(){var a=
this._info.get_lutDescriptor().length,b=this._info.get_lutDescriptor(),c,d=!1;"MONOCHROME1"===this._info.get_photometricInterpretation()&&(d=!0);this._getMinMaxLUTValues(b,a);this._modifiedDescriptor=Array(a);for(c=0;c<a;c++)this._modifiedDescriptor[c]=d?255-255*b[c]/this._maxValueApplyVOI:255*b[c]/this._maxValueApplyVOI},_getMinMaxLUTValues:function(a,b){var c,d;c=d=a[0];for(var e=1;e<b;e++)c>a[e]&&(c=a[e]),d<a[e]&&(d=a[e]);this._minValueApplyVOI=c;this._maxValueApplyVOI=d},_applyWindowLevelLUTUsingDescriptor:function(a,
b){var c=this._info.get_lutDescriptor().length-1,d=c<<8|255,e=8,e=8,f,g,h=65536;null!=this._info.get_luT32()&&this._info.get_luT32().length&&(h=this._info.get_luT32().length);f=!this._info.get_signed()?0:-(h+1>>1);g=!this._info.get_signed()?h:h+1>>1;var i=this._info.get_luT32(),j=lt.LeadPointD.create(b-(a+1>>1),0),k=lt.LeadPointD.create(b+(a>>1),c),l=parseInt(j.get_x()),m=0,d=d/parseInt(k.get_x()-j.get_x()),n=Math.min(j.get_x(),0);for(j.get_x()<f&&(m=-(l-f)*d);f<n;f++)l=h+f,i[l]=0;for(n=Math.min(0,
k.get_x());f<n;f++)l=h+f,i[l]=m>>e,m+=d;for(;0>f;f++)l=h+f,i[l]=c;for(;f<j.get_x();f++)i[f]=0;for(n=Math.min(g,k.get_x());f<n;f++)i[f]=m>>e,m+=d;for(;f<g;f++)i[f]=c;i=this._info.get_luT32();c=i.length;for(f=0;f<c;f++)i[f]=this._modifiedDescriptor[i[f]]},_applyWindowLevelLUT:function(a,b,c){a<this._minimumWindowLevelWidth&&(a=this._minimumWindowLevelWidth);a>this._maximumWindowLevelWidth&&(a=this._maximumWindowLevelWidth);b<this._minimumWindowLevelCenter&&(b=this._minimumWindowLevelCenter);b>this._maximumWindowLevelCenter&&
(b=this._maximumWindowLevelCenter);var d=b,e=a,a=a<<this._info.get_lowBit(),b=b<<this._info.get_lowBit(),a=Math.round(a*this._info.get_autoScaleSlope()),b=Math.round(b*this._info.get_autoScaleSlope()+this._info.get_autoScaleIntercept());if(this._useDescriptor)this._applyWindowLevelLUTUsingDescriptor(a,b,c);else{var f=0,g=255,h=8;16===c?(f*=257,g*=257,h=8):h=16;var i=8===this._info.get_bitsPerPixel()?255:65535,j,k=65536;null!=this._info.get_luT32()&&this._info.get_luT32().length&&(k=this._info.get_luT32().length);
j=!this._info.get_signed()?0:-(k+1>>1);var c=!this._info.get_signed()?k:k+1>>1,l=this._info.get_luT32(),m=lt.LeadPointD.create(b-(a+1>>1),0),a=lt.LeadPointD.create(b+(a>>1),i),n=parseInt(m.get_x()),i=0,b=16777215/parseInt(a.get_x()-m.get_x());"MONOCHROME1"===this._info.get_photometricInterpretation()&&(i=f,f=g,g=i,n=parseInt(a.get_x()),b=-b,i=16777215);var r=Math.min(m.get_x(),0);for(m.get_x()<j&&(i=-(n-j)*b);j<r;j++)n=k+j,l[n]=f;for(r=Math.min(0,a.get_x());j<r;j++)n=k+j,l[n]=i>>h,i+=b;for(;0>j;j++)n=
k+j,l[n]=g;for(;j<m.get_x();j++)l[j]=f;for(r=Math.min(c,a.get_x());j<r;j++)l[j]=i>>h,i+=b;for(;j<c;j++)l[j]=g}try{var o,t,s,q,p=this._info.get_luT32();null==this._info.get_luT2()&&this._info.set_luT2(Array(parseInt(p.length/256)+1));o=0;for(k=256;o<k;o++){lt.LTHelper.supportsTypedArray?this._info.get_luT2()[o]=new Uint32Array(256):this._info.get_luT2()[o]=Array(256);q=this._info.get_luT2()[o];f=0;t=256*o;for(s=256*(o+1);t<s;t++)t>=p.length?o=k:q[f]=p[t],f++}null==this._info._originalLUT&&(this._info._originalLUT=
lt.LTHelper.supportsTypedArray?new Uint32Array(this._info.get_luT32()):this._info.get_luT32().slice(0))}catch(u){}if(this._windowLevelWidth!==e||this._windowLevelCenter!==d)this._windowLevelWidth=e,this._windowLevelCenter=d,this.onChanged(lt.LeadEventArgs.Empty)},_paletteR:null,_paletteG:null,_paletteB:null,_paletteData:null,loadPaletteData:function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);a=lt.LTHelper.requestCustomHeaders;if(0<Object.getKeyCount(a))for(var c=ss.IEnumerator.getEnumerator(Object.keys(a));c.moveNext();){var d=
c.current;b.setRequestHeader(d,a[d])}b.send();this._paletteData=b.responseText},_getPaletteName:function(a){var b="None";switch(a){case 0:b="None";break;case 1:b="Cool";break;case 2:b="CyanHot";break;case 3:b="Fire";break;case 4:b="ICA2";break;case 5:b="Ice";break;case 6:b="OrangeHot";break;case 7:b="RainbowRGB";break;case 8:b="RedHot";break;case 9:b="Spectrum";break;default:b="Spectrum"}return b},_loadPalette:function(a){for(var b=(new DOMParser).parseFromString(this._paletteData,"text/xml"),a=this._getPaletteName(a),
b=b.getElementsByTagName(a),b=lt.Controls.Medical.DICOMImageInformationRenderer._stringArrayToIntArray(b[0].textContent.split(",")),a=b.length,c=0,d=0;c<a;c+=3)this._paletteR[d]=b[c],this._paletteG[d]=b[c+1],this._paletteB[d]=b[c+2],++d},_updatePalette:function(){this._windowLevelPaletteType&&(null==this._paletteR&&(this._paletteR=Array(256)),null==this._paletteG&&(this._paletteG=Array(256)),null==this._paletteB&&(this._paletteB=Array(256)),this._loadPalette(this._windowLevelPaletteType),this.updateWindowLevelLUT(this._windowLevelWidth,
this._windowLevelCenter))},_windowLevelPaletteType:0,get_paletteType:function(){return this._windowLevelPaletteType},set_paletteType:function(a){this._windowLevelPaletteType=a;this._updatePalette();return a},_windowLevel:function(a,b,c,d,e,f){var g=0;if(this._windowLevelPaletteType)if(f)for(;d<e;d+=4,g++)f=a[c[g]],b[d]=this._paletteR[f],b[d+1]=this._paletteG[f],b[d+2]=this._paletteB[f],b[d+3]=255;else for(;d<e;d+=4,g++)f=a[c[g]],b[d]=this._paletteR[f],b[d+1]=this._paletteG[f],b[d+2]=this._paletteB[f];
else if(f)for(;d<e;d+=4,g++)b[d]=b[d+1]=b[d+2]=a[c[g]],b[d+3]=255;else for(;d<e;d+=4,g++)b[d]=b[d+1]=b[d+2]=a[c[g]];return d},_windowLevel2:function(a,b){var c=this._info.get_luT2(),d=0,e=b.length,f=c.length-1;if(12<=this._info.get_bitsPerPixel())if(this._windowLevelPaletteType)for(;d<e;d+=4)c=a[b[d]<<8|b[d+1]],b[d]=this._paletteR[c],b[d+1]=this._paletteG[c],b[d+2]=this._paletteB[c];else for(;d<e;d+=4)b[d]=b[d+1]=b[d+2]=c[Math.min(f,b[d+1])][b[d+2]];else if(this._windowLevelPaletteType)for(;d<e;d+=
4)c=a[b[d]],b[d]=this._paletteR[c],b[d+1]=this._paletteG[c],b[d+2]=this._paletteB[c];else for(;d<e;d+=4)b[d]=b[d+1]=b[d+2]=a[b[d]];return d},_isSignedBetter:function(a,b,c,d){var e=0,f=0,g=0,h=0,i=h=0,j=0,k=0,l=0;this._pExpandBitsInternallyOnly=!1;this._pBitsTrimmed=0;g=this._info.get_highBit()-this._info.get_lowBit()+1;h=(1<<g-1)-1;l=this._info.get_bitsPerPixel()-g;0>l&&(l=0);e=parseInt(c*b+a);f=parseInt(d*b+a);a=e;e=Math.min(e,f);f=Math.max(a,f);if(0<l&&0>e&&0<f){a=Math.max(f,-e-1);for(d=b=1;d<
a;)b++,d=2*d+1;b++;this._pBitsTrimmed=b-g;0>this._pBitsTrimmed&&(this._pBitsTrimmed=0);if(!this._pBitsTrimmed&&(c=e-c,0>c&&(c*=-1),c=Math.floor(c/h),0<c&&(this._pBitsTrimmed+=c),this._pExpandBitsInternallyOnly&&0<this._pBitsTrimmed))this._pExpandBitsInternallyOnly=!0;if(this._pBitsTrimmed<l)return this._pbSignedBetter=!0,1;this._pBitsTrimmed=0}this._pbSignedBetter=!1;this._pbSignedBetter=0<e&&0<f?!1:-e>f-h?!0:!1;k=j=this._pBitsTrimmed=0;if(0<l){this._pbSignedBetter?(h=-(1<<g-1),i=(1<<g-1)-1):(h=0,
i=(1<<g)-1);if(e<h-1)for(;e<h-1;){j+=1;if(j>l)break;h=-(1<<g-1+j)}if(f>i+1)for(;f>i+1;){k+=1;if(k>l)break;i=(1<<g+k)-1}this._pBitsTrimmed=Math.max(j,k)}return 1},_allocAndFillLUT:function(a,b,c,d,e,f,g,h){var i,j=(1<<a)-1,a=d[0];h&this._m_LUT_SIGNED&&32767<a&&(a-=65536);i=b+c-1;c=d[c-1];h&this._m_LUT_SIGNED&&32767<c&&(c-=65536);this._allocMinVal=Math.min(a,c);this._allocMaxVal=Math.max(a,c);this._pLUT16=Array(65536);if(null!=this._pLUT16)if(f)for(f=-32768;32767>=f;f++)h=f*e/65535,h=h<=b?a:h>=i?c:
d[h-b],this._pLUT16[f]=65535*(65535&h)/j;else for(f=0;65535>=f;f++)h=parseInt((f*e+32767)/65535),h=h<=b?a:h>=i?c:d[h-b],j=h<<16-g,0>j&&(j+=65536),j&=65535,this._pLUT16[f]=j},_minValueApplyVOI:0,_maxValueApplyVOI:0,_remainingBitOriginal:0,_pbSignedBetter:!1,_pExpandBitsInternallyOnly:!1,_pBitsTrimmed:0,_uMask16Get:0,_allocMinVal:0,_allocMaxVal:0,_pLUT16:null,_m_LUT_SIGNED:1,_m_LUT_UPDATE_MIN_MAX:2,_m_LUT_USE_FULL_RANGE:4,_m_LUT_ALLOW_RANGE_EXPANSION:8,_voI_LUT_UPDATE_MIN_MAX:1,_voI_LUT_REVERSE_ORDER:2,
_pNewLowBit:0,_pNewHighBit:0,_pLUT:null,_applyLUTBitmap8:function(a,b,c,d){var e,f,a=this._pLUT[0];d&this._m_LUT_SIGNED&&32767<a&&(a-=65536);e=b+c-1;c=this._pLUT[c-1];d&this._m_LUT_SIGNED&&32767<c&&(c-=65536);this._allocMinVal=Math.min(a,c);this._allocMaxVal=Math.max(a,c);d=Array(256);if(null==d)return-1;for(f=0;255>=f;f++)d[f]=f<=b?a:f>=e?c:this._pLUT[f];b=this._info.get_width();a=this._info.get_height();a*=b;b=0;if(null!=this._info.get_canvas()){a=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),
4E5,0);e=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),4E5,0);a.beginStream();for(e.beginStream();!a.get_isEOF();){c=a.getNextChunk();f=this._info._prepareDataChunk(c);for(var g=f.length,b=0;b<g;b++)f[b]=d[f[b]&255];this._info._restoreImageData(c,f);e.setNextChunk(c)}}else for(;b<a;b++)this._info.get_data32()[b]=d[this._info.get_data32()[b]&255];return 1},_getNewLowHighBits:function(a,b,c,d){var e;if(b>c||c>=a||0>b)return-13;this._pNewHighBit=c;this._pNewLowBit=b;if(!d)return 1;
b&&(e=Math.min(b-0,d),0<e&&(this._pNewLowBit=b-e,d-=e));c&&d&&(e=Math.min(a-c-1,d),0<e&&(this._pNewHighBit=c+e,d-=e));0<d&&(this._pNewHighBit=c,this._pNewLowBit=b);return 1},_l_ApplyModalityLUT:function(a,b,c,d){var e=0,f=0,g=0,h;h=this._info.get_highBit()-this._info.get_lowBit()+1;if(8===this._info.get_bitsPerPixel())return this._applyLUTBitmap8(a,b,c,d);if(!c)return-1;d&this._m_LUT_USE_FULL_RANGE&&(e=this._info.get_lowBit(),f=this._info.get_highBit(),this._info.set_lowBit(0),this._info.set_highBit(15));
g=a-(this._info.get_highBit()-this._info.get_lowBit()+1);0>g&&(g=0);var i=0,j=0;d&this._m_LUT_ALLOW_RANGE_EXPANSION&&g&&(this._getNewLowHighBits(this._info.get_bitsPerPixel(),this._info.get_lowBit(),this._info.get_highBit(),g),i=this._pNewLowBit,j=this._pNewHighBit,h=j-i+1,this._remainingBitOriginal=this._info.get_bitsPerPixel()-h);this._allocAndFillLUT(a,b,c,this._pLUT,this._uMask16Get,this._info.get_signed(),h,d);a=this._info.get_data32();h=this._info.get_highBit()-this._info.get_lowBit()+1;h=this._info.get_bitsPerPixel()-
h;c=this._info.get_width()*this._info.get_height();if(null!=this._info.get_canvas()){c=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),4E5,0);a=new lt.Controls.Medical._imageDataStreamer(this._info.get_canvas(),4E5,0);c.beginStream();for(a.beginStream();!c.get_isEOF();){for(var k=c.getNextChunk(),a=this._info._prepareDataChunk(k),l=a.length,b=0;b<l;b++)a[b]=this._pLUT16[a[b]<<h]>>this._remainingBitOriginal;this._info._restoreImageData(k,a)}}else for(b=0;b<c;b++)a[b]=this._pLUT16[a[b]<<
h]>>this._remainingBitOriginal;this._info.set_signed(!!(d&this._m_LUT_SIGNED));d&this._m_LUT_ALLOW_RANGE_EXPANSION&&g&&(this._info.set_lowBit(i),this._info.set_highBit(j));d&this._m_LUT_USE_FULL_RANGE&&(this._info.set_lowBit(e),this._info.set_highBit(f));d&this._m_LUT_UPDATE_MIN_MAX&&(this._getMinMaxValue(),this._info.set_minValue(this._minValue),this._info.set_maxValue(this._maxValue));return 1},_l_ApplyLinearModalityLUT:function(a,b,c){var d=0,e=0,f=0,g=0,h;h=0;var i,j,k=0,l=0,e=0,m,n;if(1===b&&
!a||!b&&!a)return 1;var r=!1;-1===this._info.get_highBit()&&this._info.set_highBit(this._info.get_bitsPerPixel()-1);m=this._info.get_lowBit();n=this._info.get_highBit();this._getMinMaxValue();h=this._minValue;j=this._maxValue;this._isSignedBetter(a,b,h,j);i=this._pbSignedBetter;k=this._pBitsTrimmed;r=this._pExpandBitsInternallyOnly;this._remainingBitOriginal=l=this._info.get_bitsPerPixel()-(this._info.get_highBit()-this._info.get_lowBit()+1);this._uMask16Get=(1<<this._info.get_highBit()-this._info.get_lowBit()+
1)-1;d=this._info.get_lowBit();f=this._info.get_highBit();if(c&this._m_LUT_ALLOW_RANGE_EXPANSION&&k&&l&&(g=this._info.get_highBit(),e=this._info.get_lowBit(),k=Math.min(k,l),0>k&&(k=0),this._getNewLowHighBits(this._info.get_bitsPerPixel(),this._info.get_lowBit(),this._info.get_highBit(),k),d=this._pNewLowBit,f=this._pNewHighBit,this._info.set_lowBit(d),this._info.set_highBit(f),h=this._isSignedBetter(a,b,h,j),i=this._pbSignedBetter,this._info.set_highBit(g),this._info.set_lowBit(e),1!==h))return h;
f=f-d+1;g=1<<f;this._info.get_signed()?(d=-(1<<f-1),e=(1<<f-1)-1):(d=0,e=(1<<f)-1);this._pLUT=null;this._pLUT=Array(g);if(null==this._pLUT)return-13;for(h=d;h<=e;h++)j=h*b+a>>0,0>j&&(j+=65536),this._pLUT[h-d]=j;e=0;i&&(e|=this._m_LUT_SIGNED);c&this._m_LUT_ALLOW_RANGE_EXPANSION&&(e|=this._m_LUT_ALLOW_RANGE_EXPANSION);h=this._l_ApplyModalityLUT(f,d,g,e);if(1!==h)return h;r&&(this._info.set_lowBit(m),this._info.set_highBit(n));c&this._m_LUT_UPDATE_MIN_MAX&&(this._getMinMaxValue(),this._info.set_minValue(this._minValue),
this._info.set_maxValue(this._maxValue));return 1},_l_ApplyLinearVOILUT:function(a,b,c){var d=0,e=0,f,g,h,i,j;if(1>b)return-13;this._info.get_minValue();this._info.get_maxValue();g=-1===this._info.get_highBit()?this._info.get_bitsPerPixel():this._info.get_highBit();f=this._info.get_lowBit();e=this._info.get_signed();0>f&&(f=0);h=g-f+1;g=1<<h;f=Array(g);if(null==f)return-1;j=!!(c&this._voI_LUT_REVERSE_ORDER);i=!!(c&this._voI_LUT_UPDATE_MIN_MAX);e?(d=-(1<<h-1),e=(1<<h-1)-1):(d=0,e=(1<<h)-1);c=parseInt(a-
0.5-(b-1)/2);h=parseInt(a-0.5+(b-1)/2);if(i){var k;i=Math.max(c,d);i=Math.min(i,e);k=Math.max(h,d);k=Math.min(k,e);this._info.set_minValue(i);this._info.set_maxValue(k)}for(k=d;k<=e;k++)k<=c?i=0:k>h?i=255:(i=parseInt(255*((k-(a-0.5))/(b-1)+0.5)),255<i&&(i=255)),j&&(i=255-i),d=k,0>k&&(d+=g),f[d]=i;this._applyWindowLevelLUT(parseInt(b+0.5),parseInt(a+0.5),16);return 1},_l_ApplyVOILUT:function(a,b,c,d,e,f,g){var h,i=h=d=0;h=0;var j,k,l,m;h=this._info.get_highBit();d=this._info.get_lowBit();0>d&&(d=0);
0>h&&(h=this._info.get_bitsPerPixel()-1);b=b-(a>>1)+1;a=b+a;this._getMinMaxLUTValues(c,f);e=this._minValueApplyVOI;m=this._maxValueApplyVOI;h=h-d+1;d=1<<h;for(l=1;l<m;)l=l+l+1;this._info.get_signed()?(i=-(1<<h-1),h=(1<<h-1)-1):(i=0,h=(1<<h)-1);j=8<this._info.get_bitsPerPixel()?65535:255;var n=this._info.get_luT32(),r="MONOCHROME1"===this._info.get_photometricInterpretation(),o=l/2;for(k=i;k<=h;k++){i=k<=b?c[0]:k>=a?c[f-1]:c[k-b];i=(i*j+o)/l>>0;r&&(i=j-i);var t=k&d-1;0>t&&(t+=65536);n[t]=i>>8}g&this._voI_LUT_UPDATE_MIN_MAX&&
(this._minValue=e,this._maxValue=m);return 1}};Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"information",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_information,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"minimumWindowLevelWidth",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_minimumWindowLevelWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,
"maximumWindowLevelWidth",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_maximumWindowLevelWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"minimumWindowLevelCenter",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_minimumWindowLevelCenter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"maximumWindowLevelCenter",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_maximumWindowLevelCenter,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"originalWindowLevelWidth",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_originalWindowLevelWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"originalWindowLevelCenter",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_originalWindowLevelCenter,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"windowLevelWidth",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_windowLevelWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"windowLevelCenter",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_windowLevelCenter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,
"changed",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.__changed_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"updateImageData",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.__updateImageData_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.DICOMImageInformationRenderer.prototype,"paletteType",{get:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.get_paletteType,
set:lt.Controls.Medical.DICOMImageInformationRenderer.prototype.set_paletteType,enumerable:!0,configurable:!0});lt.Controls.Medical._layerInfo=function(a,b){this._resolution=a;this._topLeft=b};lt.Controls.Medical._layerInfo.prototype={_resolution:null,_topLeft:null};lt.Controls.Medical.ImageProcessing=function(){};lt.Controls.Medical.ImageProcessing._calculateGrayValue=function(a,b,c){return(a<<1)+5*b+c+4>>3};lt.Controls.Medical.ImageProcessing._stretchHistogramData=function(a,b){var c,d,e=a.length;
for(c=0;c<e&&!(a[c]>b);c++);for(d=e-1;0<=d&&!(a[d]>b);d--);if(d<=c)return null;var f=lt.Controls.Medical.Tools._l_AllocateUint32ArrayInit(a.length);d-=c;for(var g=0,h=e-1,i=0,g=0;g<e;g++)i=parseInt((g-c)*h/d+0.5),f[g]=Math.max(0,Math.min(255,i));return f};lt.Controls.Medical.ImageProcessing._stretchHistogramDataLowHigh=function(a,b,c){for(var d=a.length,a=lt.Controls.Medical.Tools._l_AllocateUint32ArrayInit(a.length),c=c-b,e=0,f=d-1,g=0,e=0;e<d;e++)g=parseInt((e-b)*f/c+0.5),a[e]=Math.max(0,Math.min(255,
g));return a};lt.Controls.Medical.ImageProcessing.getHistogramPoint=function(a,b){var c=a.data,d=c.length,c=lt.Controls.Medical.ImageProcessing._getHistogram(c),e;for(e=0;e<d&&!(c[e]>b);e++);for(d-=1;0<=d&&!(c[d]>b);d--);return lt.LeadPointD.create(e,d)};lt.Controls.Medical.ImageProcessing.levelIntensity=function(a,b,c){var a=a.data,d=a.length,e=0,e=lt.Controls.Medical.ImageProcessing._getHistogram(a),b=lt.Controls.Medical.ImageProcessing._stretchHistogramDataLowHigh(e,b,c);if(null!=b)for(e=0;e<d;e+=
4)a[e]=b[a[e]],a[e+1]=b[a[e+1]],a[e+2]=b[a[e+2]],a[e+3]=255};lt.Controls.Medical.ImageProcessing.stretchIntensity=function(a,b){var c=a.data,d=c.length,e=0,e=lt.Controls.Medical.ImageProcessing._getHistogram(c),f=lt.Controls.Medical.ImageProcessing._stretchHistogramData(e,b);if(null!=f)for(e=0;e<d;e+=4)c[e]=f[c[e]],c[e+1]=f[c[e+1]],c[e+2]=f[c[e+2]],c[e+3]=255};lt.Controls.Medical.ImageProcessing._getHistogram=function(a){for(var b=a.length,c=0,d=lt.Controls.Medical.Tools._l_AllocateUint32ArrayInit(256),
c=0;c<b;c+=4)d[(a[c]<<1)+5*a[c+1]+a[c+2]+4>>3]++;return d};lt.Controls.Medical._seriesReferenceLines=function(){this.show=!1;this.frames=null;this.frames=[]};lt.Controls.Medical._seriesReferenceLines.prototype={show:!1,frames:null};lt.Controls.Medical._referenceLineInformation=function(){this.line=new lt.Controls.Medical.LeadLine(0,0,0,0);this.text=""};lt.Controls.Medical._referenceLineInformation.prototype={line:null,text:null};lt.Controls.Medical._frameReferenceLines=function(){this.firstAndLastLineCaluclated=
!1;this.line=new lt.Controls.Medical._referenceLineInformation;this.firstLine=new lt.Controls.Medical._referenceLineInformation;this.lastLine=new lt.Controls.Medical._referenceLineInformation};lt.Controls.Medical._frameReferenceLines.prototype={firstAndLastLineCaluclated:!1,line:null,firstLine:null,lastLine:null};lt.Controls.Medical.LayoutManagerItem=function(){this._div=document.createElement("div")};lt.Controls.Medical.LayoutManagerItem.prototype={_parent:null,_bounds:null,_selected:!1,_displayRectangle:null,
_div:null,_divID:null,_userData:null,get_userData:function(){return this._userData},set_userData:function(a){return this._userData=a},get_div:function(){return this._div},get_divID:function(){return this._divID},set_divID:function(a){this._divID=a;null!=this._div&&(this._div.id=a);return a},get_parent:function(){return this._parent},set_parent:function(a){return this._parent=a},get_displayRectangle:function(){return this._displayRectangle},set_displayRectangle:function(a){return this._displayRectangle=
a},get_bounds:function(){return this._bounds},set_bounds:function(a){return this._bounds=a},get_selected:function(){return this._selected},set_selected:function(a){if(this._selected!==a)return this._selected=a,null!=this._parent&&this._parent.selectItem(this,a),a},onSizeChanged:function(){var a,b=this._parent.get_div().clientWidth,c=this._parent.get_div().clientHeight;a=this.get_bounds();this.set_displayRectangle(lt.LeadRectD.create(a.get_left()*b,a.get_top()*c,a.get_width()*b,a.get_height()*c));
this.get_div().style.left=this.get_displayRectangle().get_left().toString()+"px";this.get_div().style.top=this.get_displayRectangle().get_top().toString()+"px";this.get_div().style.width=this.get_displayRectangle().get_width().toString()+"px";this.get_div().style.height=this.get_displayRectangle().get_height().toString()+"px";this.get_div().style.position="absolute"}};Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"userData",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_userData,
set:lt.Controls.Medical.LayoutManagerItem.prototype.set_userData,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"div",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_div,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"divID",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_divID,set:lt.Controls.Medical.LayoutManagerItem.prototype.set_divID,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"parent",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_parent,set:lt.Controls.Medical.LayoutManagerItem.prototype.set_parent,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"displayRectangle",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_displayRectangle,set:lt.Controls.Medical.LayoutManagerItem.prototype.set_displayRectangle,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"bounds",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_bounds,set:lt.Controls.Medical.LayoutManagerItem.prototype.set_bounds,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManagerItem.prototype,"selected",{get:lt.Controls.Medical.LayoutManagerItem.prototype.get_selected,set:lt.Controls.Medical.LayoutManagerItem.prototype.set_selected,enumerable:!0,configurable:!0});lt.Controls.Medical._rightClickMenuItem=
function(a,b){this.name=a;this.itemCell=b};lt.Controls.Medical._rightClickMenuItem.prototype={name:null,itemCell:null};lt.Controls.Medical.LayoutManager=function(a){if(null==a)throw Error("divParent cannot be null");this._divElement=a;this._selectedItems=new lt.Controls.Medical.LeadCollection;this._items=new lt.Controls.Medical.LeadCollection};lt.Controls.Medical.LayoutManager.prototype={_divElement:null,_newWidth:0,_newHeight:0,_beginUpdate:!1,_beginUpdateCounter:0,_selectedItems:null,_items:null,
get_items:function(){return this._items},get_selectedItems:function(){return this._selectedItems},get_selectedItem:function(){return this._selectedItems.get_item(0)},set_selectedItem:function(a){null==this._selectedItems?(this._selectedItems=new lt.Controls.Medical.LeadCollection,this._selectedItems.add(a)):this._selectedItems.get_count()?this._selectedItems.set_item(0,a):this._selectedItems.add(a);return a},selectItem:function(a,b){if(b)if(-1!==this._items.indexOf(a))-1===this._selectedItems.indexOf(a)&&
this._selectedItems.add(a);else throw Error("You must add 'item' to the LayoutManager first before selecting it");else-1!==this._selectedItems.indexOf(a)&&this._selectedItems.remove(a)},get_div:function(){return this._divElement},onSizeChanged:function(){null!=this._divElement&&(this._newWidth=this._divElement.clientWidth,this._newHeight=this._divElement.clientHeight,this._onLayout())},beginUpdate:function(){this._beginUpdate=!0;this._beginUpdateCounter++},canUpdate:function(){return!this._beginUpdate},
endUpdate:function(){this._beginUpdateCounter--;this._beginUpdateCounter||(this._beginUpdate=!1,this.onSizeChanged())},_onLayout:function(){var a,b=this._items.get_count(),c;for(a=0;a<b;a++)c=this._items.get_item(a),c.onSizeChanged()}};Object.defineProperty(lt.Controls.Medical.LayoutManager.prototype,"items",{get:lt.Controls.Medical.LayoutManager.prototype.get_items,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManager.prototype,"selectedItems",{get:lt.Controls.Medical.LayoutManager.prototype.get_selectedItems,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManager.prototype,"selectedItem",{get:lt.Controls.Medical.LayoutManager.prototype.get_selectedItem,set:lt.Controls.Medical.LayoutManager.prototype.set_selectedItem,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LayoutManager.prototype,"div",{get:lt.Controls.Medical.LayoutManager.prototype.get_div,enumerable:!0,configurable:!0});lt.Controls.Medical.GridLayout=function(a,b,c){this._rows=b;this._columns=
c;this._viewer=a;this._splitterSize=3;this._horizontalSplitters=[];this._verticalSplitters=[]};lt.Controls.Medical.GridLayout.prototype={_horizontalSplitters:null,_verticalSplitters:null,_splittersMovable:!1,_viewer:null,_rows:0,_columns:0,_splitterSize:0,_updateSplittersPosition:function(a,b){var c=this.get_horizontalSplitters(),d=this.get_verticalSplitters();document.getElementById(this._viewer.get_divId());for(var e=1;e<a;e++)c[e-1]=e/a;for(e=1;e<b;e++)d[e-1]=e/b;for(var f=a-1,g=c.length,e=a;e<=
g;e++)c.removeAt(f);f=b-1;g=d.length;for(e=b;e<=g;e++)d.removeAt(f)},_layout:function(){this._viewer.layoutCells();this._viewer.renderViewer()},_update:function(){this._updateSplittersPosition(this._rows,this._columns);this._layout()},get_splitterSize:function(){return this._splitterSize},set_splitterSize:function(a){this._splitterSize=a;this._layout();return a},get_rows:function(){return this._rows},set_rows:function(a){this._rows=a;this._update();return a},get_columns:function(){return this._columns},
set_columns:function(a){this._columns=a;this._update();return a},get_horizontalSplitters:function(){return this._horizontalSplitters},get_verticalSplitters:function(){return this._verticalSplitters},get_splittersMovable:function(){return this._splittersMovable},set_splittersMovable:function(a){return this._splittersMovable=a}};Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,"splitterSize",{get:lt.Controls.Medical.GridLayout.prototype.get_splitterSize,set:lt.Controls.Medical.GridLayout.prototype.set_splitterSize,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,"rows",{get:lt.Controls.Medical.GridLayout.prototype.get_rows,set:lt.Controls.Medical.GridLayout.prototype.set_rows,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,"columns",{get:lt.Controls.Medical.GridLayout.prototype.get_columns,set:lt.Controls.Medical.GridLayout.prototype.set_columns,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,
"horizontalSplitters",{get:lt.Controls.Medical.GridLayout.prototype.get_horizontalSplitters,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,"verticalSplitters",{get:lt.Controls.Medical.GridLayout.prototype.get_verticalSplitters,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.GridLayout.prototype,"splittersMovable",{get:lt.Controls.Medical.GridLayout.prototype.get_splittersMovable,set:lt.Controls.Medical.GridLayout.prototype.set_splittersMovable,
enumerable:!0,configurable:!0});lt.Controls.Medical.MedicalViewer=function(a,b,c){lt.Controls.Medical.MedicalViewer.initializeBase(this);this._initialize$1(a,b,c);this.renderViewer();this.onSizeChanged()};lt.Controls.Medical.MedicalViewer.prototype={_cellsArrangment$1:0,_gridLayout$1:null,_horizontalSplitterShadow$1:null,_verticalSplitterShadow$1:null,_viewerDivElement$1:null,_viewerCanvasElement$1:null,_parentDiv$1:null,_emptyCellColor$1:null,_selectedSeries$1:null,_activeSeries$1:null,_showReferenceLine$1:!1,
_showFirstAndLastReferenceLine$1:!1,_enableSynchronization$1:!1,_exploded$1:!1,_explodedCell$1:null,_dictionary$1:null,_rightClickMenu$1:null,_emptyDivLayout$1:null,_emptyDivs$1:null,_menuItemSelected$1:null,_mouseOverMenu$1:null,_mouseLeaveMenu$1:null,_totalCells$1:0,layout:null,refreshReferenceLine:function(){this._recalculate()},_recalculate:function(){var a=this.layout.get_selectedItem();null!=a&&(this._findReferenceLine$1(a,!0),this._invalidateReferenceLine$1(a))},_createDropDown$1:function(){this._menuItemSelected$1=
ss.Delegate.create(this,this._menuItemSelected_Clicked$1);this._mouseOverMenu$1=ss.Delegate.create(this,this._mouseOverMenuItem$1);this._mouseLeaveMenu$1=ss.Delegate.create(this,this._mouseLeaveMenuItem$1);var a=document.getElementById(this.get_divId()),b=document.getElementById("menuList");null==b&&(b=document.createElement("div"),b.id="dropDownMenu",b.className="dropdown",b.style.visibility="hidden",a.appendChild(b),a=document.createElement("div"),a.style.cssText="background: #101010; padding: 0px 0 5px;",
b.appendChild(a),b=document.createElement("span"),b.style.cssText="background: #707070; color: #010101; display: block; font-family: arial; font-weight: bold;    padding: 6px 15px;    cursor: pointer; text-decoration:none;",b.innerText="Select Series",a.appendChild(b),b=document.createElement("ul"),b.id="menuList",a.appendChild(b));b.style.listStyle="none";b.style.margin="0px";b.style.padding="0px";b.style.fontSize="11px";b.style.padding="11px 0 0 0px";b.style.borderTop="1px solid #dedede"},_showDropDown$1:function(a,
b){var c=document.getElementById(this.get_divId()),d=document.getElementById("dropDownMenu");c.removeChild(d);c.appendChild(d);var d=document.getElementById("menuList"),c=document.getElementById("dropDownMenu"),e=this._emptyDivLayout$1.get_selectedItem(),a=a+e.get_div().offsetLeft,b=b+e.get_div().offsetTop;c.style.left=a.toString()+"px";c.style.top=b.toString()+"px";var e=Object.getKeyCount(this._rightClickMenu$1),f=0,g;for(d.innerHTML="";f<e;f++)g=this._rightClickMenu$1[Object.keys(this._rightClickMenu$1)[f]].name,
d.innerHTML+="<li><a id='dropdownmenuitem"+f+"' style='color: #555555;       display: block;       font-family: arial;       font-weight: bold;       padding: 6px 15px;       cursor: pointer;       text-decoration:none;'>"+g+"</a> </li>";for(f=0;f<e;f++)d=document.getElementById("dropdownmenuitem"+f.toString()),d.setAttribute("itemIndex",f),d.addEventListener("touchstart",this._menuItemSelected$1,!1),d.addEventListener(lt.Controls.Medical.Tools._pointerdown,this._menuItemSelected$1,!1),d.addEventListener("mousedown",
this._menuItemSelected$1,!1),d.addEventListener("mouseover",this._mouseOverMenu$1,!1),d.addEventListener("mouseleave",this._mouseLeaveMenu$1,!1);c.style.visibility="visible"},_swapEmptyWithCell$1:function(a,b){var c;this.layout.beginUpdate();this._emptyDivLayout$1.beginUpdate();c=a.get_rowPosition();a.set_rowPosition(b.get_rowPosition());b.set_rowPosition(c);c=a.get_position();a.set_position(b.get_position());b.set_position(c);c=a.get_columnsPosition();a.set_columnsPosition(b.get_columnsPosition());
b.set_columnsPosition(c);c=a.get_bounds();a.set_bounds(b.get_bounds());b.set_bounds(c);this._emptyDivLayout$1.endUpdate();this.layout.endUpdate()},_menuItemSelected_Clicked$1:function(a){if(this._dropDownVisible$1()){this._hideDropDown$1();a=a.currentTarget.getAttribute("itemIndex");this.layout.get_items().get_count();var a=this._rightClickMenu$1[Object.keys(this._rightClickMenu$1)[a]].itemCell,b=this._emptyDivLayout$1.get_selectedItem();this._swapEmptyWithCell$1(a,b);a.onSizeChanged();this.layout.get_selectedItems().add(a);
this._emptyDivLayout$1.get_selectedItems().remove(b);this.layoutCells()}},_layoutEmptyDiv$1:function(){for(var a=0,b=this._emptyDivs$1.get_count();a<b;a++){var c=this._emptyDivs$1.get_item(a);c.set_divID(this._divId$1+"_emptyDiv_"+(a+1).toString());c.onSizeChanged()}},_mouseOverMenuItem$1:function(){},_mouseLeaveMenuItem$1:function(){},_dropDownVisible$1:function(){return"visible"===document.getElementById("dropDownMenu").style.visibility},_hideDropDown$1:function(){document.getElementById("dropDownMenu").style.visibility=
"hidden"},_createRightClickMenu$1:function(){var a=document.createElement("div");a.id="dropDownMenu";a.className="dropdown";a.style.display="none";a.style.zIndex=100;a.style.textDecoration="none";a=document.createElement("div");a.id="submenu";a.style.display="none";a=document.createElement("span");a.id="dropDownMenuTitle";a.innerText="Select Series";a=document.createElement("ul");a.style.listStyle="none";a.style.margin="0px";a.style.padding="0px";a.style.fontSize="11px";a.style.padding="11px 0 0 0px";
a.style.borderTop="1px solid #dedede"},_showSeriesDropDown:function(a,b){this._showDropDown$1(a,b)},_hideSeriesDropDown:function(){this._hideDropDown$1()},get_totalCells:function(){return this._totalCells$1},set_totalCells:function(a){this._totalCells$1=a;this.layout.canUpdate()&&1===this.get_cellsArrangment()?this.layoutCells():this._updateEmptyDiv$1();return a},_alignSeries$1:function(a,b){var c=a.get_frames().get_item(a.get__activeFrameIndex()),c=lt.Controls.Medical.StackSynchronization.alignFrames(c,
b);-1!==c&&b.set_currentOffset(c)},_alignTwoCell$1:function(a,b){var c=a.get_frames().get_item(a.get__activeFrameIndex()),c=lt.Controls.Medical.StackSynchronization.alignFrames(c,b);-1!==c&&b.set_currentOffset(c);return!1},synchronizeSeries:function(a){this._enumerateMatchedSeries$1(a,ss.Delegate.create(this,this._alignTwoCell$1))},get_emptyDivs:function(){return this._emptyDivLayout$1},_createEmptyDiv$1:function(a,b,c){this._emptyDivs$1=this._emptyDivLayout$1.get_items();this._emptyDivs$1.get_count()>
a?(a=this._emptyDivs$1.get_item(a),a.set_rowPosition(b),a.set_columnsPosition(c)):this._emptyDivs$1.add(new lt.Controls.Medical.EmptyCell(this._emptyDivLayout$1,this,"emptyCell_div "+(a+1),b,c))},_getCellsMatrix$1:function(a){var b=0,c=0,d=0,e=this.layout.get_items().get_count(),f;if(a){c=this._gridLayout$1.get_rows()-1;for(d=this._gridLayout$1.get_columns()-1;b<e;b++)f=this.layout.get_items().get_item(b),f.get_rowPosition()>c&&(c=f.get_rowPosition()),f.get_columnsPosition()>d&&(d=f.get_columnsPosition());
c+=1;d+=1}else c=this._gridLayout$1.get_rows(),d=this._gridLayout$1.get_columns();a=Array(c);for(b=0;b<c;b++)a[b]=Array(d);for(b=0;b<c;b++)for(f=0;f<d;f++)a[b][f]=!1;for(b=0;b<e;b++)f=this.layout.get_items().get_item(b),0<=f.get_rowPosition()&&f.get_rowPosition()<c&&0<=f.get_columnsPosition()&&f.get_columnsPosition()<d&&(a[f.get_rowPosition()][f.get_columnsPosition()]=!0);return a},_updateEmptyDiv$1:function(){var a=0,b=0;if(this._cellsArrangment$1){var c=this._getArrangedCells$1(),a=0,b=c.length,
d=0,e=0,f=0,g=0;for(this._emptyDivs$1=this._emptyDivLayout$1.get_items();a<b;a++){e=c[a].get_position();for(f=d;f<e;f++)g>=this._emptyDivs$1.get_count()&&this._emptyDivs$1.add(new lt.Controls.Medical.EmptyCell(this._emptyDivLayout$1,this,"emptyCell_div "+g.toString(),0,0)),this._emptyDivs$1.get_item(g).set_position(f),g++;d=e+1}for(a=d;a<this._totalCells$1;a++)g>=this._emptyDivs$1.get_count()&&this._emptyDivs$1.add(new lt.Controls.Medical.EmptyCell(this._emptyDivLayout$1,this,"emptyCell_div "+g.toString(),
0,0)),this._emptyDivs$1.get_item(g).set_position(d),g++,d++;for(b=this._emptyDivs$1.get_count()-1;b>=g;b--)c=this._emptyDivs$1.get_item(g),this._emptyDivs$1.removeAt(g),c.dispose()}else{g=this._getCellsMatrix$1(!1);c=b=0;b=this._gridLayout$1.get_rows();c=this._gridLayout$1.get_columns();for(d=a=0;d<b;d++)for(e=0;e<c;e++)g[d][e]||(this._createEmptyDiv$1(a,d,e),a++);this._emptyDivs$1=this._emptyDivLayout$1.get_items();for(b=this._emptyDivs$1.get_count()-1;b>=a;b--)c=this._emptyDivs$1.get_item(a),this._emptyDivs$1.removeAt(a),
c.dispose()}this._emptyDivs$1=this._emptyDivLayout$1.get_items();a=0;for(b=this._emptyDivs$1.get_count();a<b;a++)g=this._emptyDivs$1.get_item(a),g.set_divID("emptydiv_div"+(a+1).toString())},_getArrangedCells$1:function(){for(var a=this.layout.get_items().get_count(),b=0,c=[];b<a;b++)c.add(this.layout.get_items().get_item(b));for(var d=[];c.length;){for(var e=1E6,f=-1,b=0,a=c.length;b<a;b++)c[b].get_position()<e&&(e=c[b].get_position(),f=b);d.add(c[f]);c.removeAt(f)}return d},_synchronizeAllSeries$1:function(){for(var a=
0,b,c=this.layout.get_selectedItems().get_count();a<c;a++)b=this.layout.get_selectedItems().get_item(a),this.synchronizeSeries(b)},_addSeriesToMenu:function(a){var b=new lt.Controls.Medical._rightClickMenuItem(a.get_patientName()+"( "+a.get_seriesNumber().toString()+" )",a);this._rightClickMenu$1[a.get_divID()]=b},_addSeriesToDictionary:function(a){if(null!=a.get_frames()&&a.get_frames().get_count()){a.get_frames().get_item(0);var b=a.get_frameOfReferenceUID();b||(b="nil");if(Object.keyExists(this._dictionary$1,
b))c=this._dictionary$1[b],c.add(a);else{var c=[];c.add(a);this._dictionary$1[b]=c}a.get_selected()&&(this._findReferenceLine$1(a,!0),this._invalidateReferenceLine$1(a))}},invalidate:function(){for(var a=0,b=this.layout.get_items().get_count(),c;a<b;a++)c=this.layout.get_items().get_item(a),c.invalidate()},_invalidateSeries$1:function(a,b){b._isPresentationInformationReady()&&b.invalidate();return!1},_invalidateReferenceLine$1:function(a){this._enumerateMatchedSeries$1(a,ss.Delegate.create(this,this._invalidateSeries$1))},
_findRLSeries$1:function(a,b){this._findReferenceLineForSeries$1(a,b,this._showFirstAndLastReferenceLine$1);return!1},_findReferenceLine$1:function(a){this._enumerateMatchedSeries$1(a,ss.Delegate.create(this,this._findRLSeries$1))},_getReferenceLineValue$1:function(a,b){return lt.Controls.Medical.ReferenceLine.find(a.get_imageOrientation(),a.get_imagePosition(),lt.LeadPointD.create(a.get_columnSpacing(),a.get_rowSpacing()),a.get_width(),a.get_height(),b.get_imageOrientation(),b.get_imagePosition(),
lt.LeadPointD.create(b.get_columnSpacing(),b.get_rowSpacing()),b.get_width(),b.get_height())},_enumerateSubCellsImages$1:function(a,b,c){if(null!=a)for(var d=0,b=Math.min(b,a.get_imageViewer().get_items().get_count()),e,d=0;d<b;d++)e=a.get_imageViewer().get_items().get_item(d),c(e,d)},_enumerateFrames$1:function(a,b){if(!(null==a||null==b)){var c=a.get_frames();if(null!=c)for(var d=0,e=c.get_count(),d=0;d<e;d++)b(c.get_item(d),d)}},_findFrameReferenceLine$1:function(a,b,c,d){var e,f,g=a.get__activeFrameIndex();
e=a.get_frames().get_item(g);f=b.get_frames().get_item(b.get_currentOffset()+c);b=b.get__cellReferenceLine().frames[c];b.line.line=this._getReferenceLineValue$1(e,f);b.line.text=(g+1).toString();e=a.get_frames().get_count();if((d||!b.firstAndLastLineCaluclated)&&1<e)d=a.get_frames().get_item(0),b.firstLine.line=this._getReferenceLineValue$1(d,f),b.firstLine.text="1",a=a.get_frames().get_item(a.get_frames().get_count()-1),b.lastLine.line=this._getReferenceLineValue$1(a,f),b.lastLine.text=e.toString(),
b.firstAndLastLineCaluclated=!0;return!1},_findReferenceLineForSeries$1:function(a,b,c){if(b._isPresentationInformationReady()){b.get_currentOffset();a.get_currentOffset();b.get__cellReferenceLine().show=!0;for(var d=0,e=Math.min(b.get_frames().get_count(),b.get_imageViewer().get_items().get_count()),d=0;d<e;d++)this._findFrameReferenceLine$1(a,b,d,c)}},_enumerateSubCells$1:function(a,b){if(null!=a)for(var c=0,d=a.get_imageViewer().get_items().get_count(),e,c=0;c<d;c++)e=a.get_imageViewer().get_items().get_item(c),
b(e,c)},_enumerateMatchedSeries$1:function(a,b){if(null==a.get_frames()||null==a.get_frames().get_item(0))return!1;var c=a.get_frameOfReferenceUID();if(null==c||!c)return!1;c=this._dictionary$1[c];if(null==c)return!1;for(var d=0,e=c.length,f;d<e;d++)if(f=c[d],f!==a&&(f=b(a,f)))return f;return!1},_isMatchedSeriesSelected$1:function(a){return a._isPresentationInformationReady()&&a.get_selected()?!0:!1},get_emptyCellColor:function(){return this._emptyCellColor$1},set_emptyCellColor:function(a){this._emptyCellColor$1=
a;this.renderViewer();return a},get_selectedSeries:function(){return this._selectedSeries$1},get_activeSeries:function(){return this._activeSeries$1},set_activeSeries:function(a){this._activeSeries$1!==a&&(this._activeSeries$1=a,a.invalidate(),this._activeSeries$1.invalidate());return a},_repaintCells$1:function(){},get_showReferenceLine:function(){return this._showReferenceLine$1},set_showReferenceLine:function(a){this._showReferenceLine$1!==a&&((this._showReferenceLine$1=a)&&this._recalculate(),
this._repaintCells$1());return a},get_showFirstAndLastReferenceLine:function(){return this._showFirstAndLastReferenceLine$1},set_showFirstAndLastReferenceLine:function(a){this._showFirstAndLastReferenceLine$1!==a&&(this._showFirstAndLastReferenceLine$1=a,this._repaintCells$1());return a},get_enableSynchronization:function(){return this._enableSynchronization$1},set_enableSynchronization:function(a){(this._enableSynchronization$1=a)&&this._synchronizeAllSeries$1();return a},_oldArrangment$1:0,_oldRow$1:0,
_oldCol$1:0,_bounds$1:null,_oldVisiblity$1:!1,_previousSubCellIndex$1:0,_saveBounds$1:function(a){var a=a.get_imageViewer().get_items(),b=0,c=a.get_count(),d;null==this._bounds$1?this._bounds$1=new lt.Controls.Medical.LeadCollection:this._bounds$1.clear();for(b=0;b<c;b++)d=a.get_item(b),this._bounds$1.add(d.get_bounds())},_restoreBounds$1:function(a){var b=a.get_imageViewer().get_items(),c=0,d=this._bounds$1.get_count();a.updateSubCellCount(d);for(c=0;c<d;c++)a=b.get_item(c),a.set_bounds(this._bounds$1.get_item(c))},
explode:function(a,b){if(this._exploded$1!==b){this._exploded$1=b;this._explodedCell$1=a;this._explodedCell$1.beginUpdate();this.onBeforeCellExploded(a);if(this._exploded$1){this._oldBounds$1=this._explodedCell$1.get_bounds();this._oldArrangment$1=this._explodedCell$1.get_arrangment();this._oldRow$1=this._explodedCell$1.get_gridLayout().get_rows();this._oldCol$1=this._explodedCell$1.get_gridLayout().get_columns();this._explodedCell$1.set_bounds(lt.LeadRectD.create(0,0,1,1));this._saveBounds$1(this._explodedCell$1);
var c=this._explodedCell$1.get_imageViewer().get_items().indexOf(this._explodedCell$1.get_selectedItem());this._explodedCell$1.set_arrangment(0);this._explodedCell$1.get_gridLayout().set_rows(1);this._explodedCell$1.get_gridLayout().set_columns(1);(this._previousSubCellIndex$1=c)&&this._explodedCell$1.set_currentOffset(this._explodedCell$1.get_currentOffset()+c)}else this._explodedCell$1.set_currentOffset(Math.min(Math.max(0,this._explodedCell$1.get_currentOffset()-this._previousSubCellIndex$1),Math.max(0,
this._explodedCell$1.get_frames().get_count()-this._bounds$1.get_count()-this._previousSubCellIndex$1))),this._restoreBounds$1(this._explodedCell$1),this._explodedCell$1.set_arrangment(this._oldArrangment$1),this._explodedCell$1.get_gridLayout().set_rows(this._oldRow$1),this._explodedCell$1.get_gridLayout().set_columns(this._oldCol$1),this._explodedCell$1.set_bounds(this._oldBounds$1),this._explodedCell$1.set_selectedItem(this._explodedCell$1.get_imageViewer().get_items().get_item(this._previousSubCellIndex$1));
this.onAfterCellExploded(a);this._switchCellsVisibilty$1();this.renderViewer();this.layoutCells();this._explodedCell$1.endUpdate()}},_switchCellsVisibilty$1:function(){for(var a=0,b=this.layout.get_items().get_count(),c=null;a<b;a++)c=this.layout.get_items().get_item(a),c.get_div().clientWidth&&c.get_div().clientHeight&&c!==this._explodedCell$1&&(this._exploded$1?(c.get_div().style.visibility="hidden",this._oldVisiblity$1=c.get_overlayTextVisible(),c.set_overlayTextVisible(!1)):(c.get_div().style.visibility=
"visible",c.set_overlayTextVisible(this._oldVisiblity$1)))},get_exploded:function(){return this._exploded$1},get_explodedCell:function(){return this._explodedCell$1},selectedCellChanged:null,emptyCellClicked:null,add_beforeCellExploded:function(a){this.__beforeCellExploded$1=ss.Delegate.combine(this.__beforeCellExploded$1,a)},remove_beforeCellExploded:function(a){this.__beforeCellExploded$1=ss.Delegate.remove(this.__beforeCellExploded$1,a)},__beforeCellExploded$1_handler_get:function(){null==this.__beforeCellExploded$1_handler&&
(this.__beforeCellExploded$1_handler=ss.EventHandler.create(this,this.add_beforeCellExploded,this.remove_beforeCellExploded));return this.__beforeCellExploded$1_handler},__beforeCellExploded$1:null,__beforeCellExploded$1_handler:null,add_afterCellExploded:function(a){this.__afterCellExploded$1=ss.Delegate.combine(this.__afterCellExploded$1,a)},remove_afterCellExploded:function(a){this.__afterCellExploded$1=ss.Delegate.remove(this.__afterCellExploded$1,a)},__afterCellExploded$1_handler_get:function(){null==
this.__afterCellExploded$1_handler&&(this.__afterCellExploded$1_handler=ss.EventHandler.create(this,this.add_afterCellExploded,this.remove_afterCellExploded));return this.__afterCellExploded$1_handler},__afterCellExploded$1:null,__afterCellExploded$1_handler:null,onAfterCellExploded:function(a){null!=this.__afterCellExploded$1&&this.__afterCellExploded$1(this,new lt.Controls.Medical.CellExplodedEventArgs(a))},onBeforeCellExploded:function(a){null!=this.__beforeCellExploded$1&&this.__beforeCellExploded$1(this,
new lt.Controls.Medical.CellExplodedEventArgs(a))},_createCanvas$1:function(){var a=document.createElement("canvas"),b=this._viewerDivElement$1.parentNode;a.style.zIndex=3;a.style.backgroundColor="rgba(200, 200, 200, 0.5)";a.style.left="100px";a.style.top="0px";a.style.width="400px";a.style.height="100px";a.style.position="absolute";a.style.visibility="hidden";b.appendChild(a);return a},_divId$1:null,get_divId:function(){return this._divId$1},get_cellsArrangment:function(){return this._cellsArrangment$1},
set_cellsArrangment:function(a){this._cellsArrangment$1=a;this.layoutCells();this.renderViewer();return a},get_gridLayout:function(){return this._gridLayout$1},_getUpperBound$1:function(a,b,c,d){return b>=a.length-1?parseInt(d)-this._lightPart$1:parseInt(a[b+1]*d)-this._gridLayout$1.get_splitterSize()},_getLowerBound$1:function(a,b,c,d){return!b?this._shadowPart$1:parseInt(a[b-1]*d)+this._gridLayout$1.get_splitterSize()},_xPosition$1:0,_yPosition$1:0,_drawShadowCanvas$1:function(a,b,c,d,e){a.style.left=
b.toString()+"px";a.style.top=c.toString()+"px";a.style.width=(d-b).toString()+"px";a.style.height=(e-c).toString()+"px"},_findSplitterInPosition$1:function(a,b,c){for(var d=a.length,e,f=3*this._shadowPart$1/2,g=0;g<d;g++)if(e=parseInt(a[g]*c),Math.abs(e-b)<=f)return g;return-1},_horizontalIndex$1:0,_verticalIndex$1:0,_checkSplitter$1:function(a,b){var c=this._viewerCanvasElement$1,d=this.get_gridLayout().get_horizontalSplitters(),e=this.get_gridLayout().get_verticalSplitters();if(this._cellsArrangment$1)return this._verticalIndex$1=
this._horizontalIndex$1=-1,!1;null!=e&&(this._verticalIndex$1=this._findSplitterInPosition$1(e,a,c.width));null!=d&&(this._horizontalIndex$1=this._findSplitterInPosition$1(d,b,c.height));return!1},_isStarted$1:!1,_updateSplittersPosition$1:function(a,b){for(var c=this.get_gridLayout().get_horizontalSplitters(),d=this.get_gridLayout().get_verticalSplitters(),e=1;e<a;e++)c[e-1]=e/a;for(e=1;e<b;e++)d[e-1]=e/b},onDragStarted:function(a){lt.Controls.Medical.MedicalViewer.callBaseMethod(this,"onDragStarted",
[a]);this._checkSplitter$1(parseInt(a.get_position().get_x()),parseInt(a.get_position().get_y()));this._isStarted$1=!1;if(-1!==this._horizontalIndex$1||-1!==this._verticalIndex$1){this._isStarted$1=!0;var a=this._viewerDivElement$1.clientWidth,b=this._viewerDivElement$1.clientHeight,c=this.get_gridLayout().get_horizontalSplitters(),d=this.get_gridLayout().get_verticalSplitters();this._yPosition$1=parseInt(c[this._horizontalIndex$1]*b);this._xPosition$1=parseInt(d[this._verticalIndex$1]*a);-1!==this._horizontalIndex$1&&
this._drawShadowCanvas$1(this._horizontalSplitterShadow$1,0,this._yPosition$1-this._lightPart$1,a,this._yPosition$1+this._shadowPart$1);-1!==this._verticalIndex$1&&this._drawShadowCanvas$1(this._verticalSplitterShadow$1,this._xPosition$1-this._lightPart$1,0,this._xPosition$1+this._shadowPart$1,b);this._horizontalSplitterShadow$1.style.visibility=-1!==this._horizontalIndex$1?"visible":"hidden";this._verticalSplitterShadow$1.style.visibility=-1!==this._verticalIndex$1?"visible":"hidden"}},onDragDelta:function(a){lt.Controls.Medical.MedicalViewer.callBaseMethod(this,
"onDragDelta",[a]);if(this._isStarted$1){var b=this._viewerDivElement$1.clientWidth,c=this._viewerDivElement$1.clientHeight,d=this.get_gridLayout().get_horizontalSplitters(),e=this.get_gridLayout().get_verticalSplitters();if(-1!==this._horizontalIndex$1){var f=this._getUpperBound$1(d,this._horizontalIndex$1,a.get_position().get_y(),c),g=this._getLowerBound$1(d,this._horizontalIndex$1,a.get_position().get_y(),c);this._yPosition$1=Math.max(Math.min(a.get_position().get_y(),f),g);this._drawShadowCanvas$1(this._horizontalSplitterShadow$1,
0,this._yPosition$1-4,b,this._yPosition$1+this._shadowPart$1);d[this._horizontalIndex$1]=this._yPosition$1/c}-1!==this._verticalIndex$1&&(f=this._getUpperBound$1(e,this._verticalIndex$1,a.get_position().get_x(),b),g=this._getLowerBound$1(e,this._verticalIndex$1,a.get_position().get_x(),b),this._xPosition$1=Math.max(Math.min(a.get_position().get_x(),f),g),this._drawShadowCanvas$1(this._verticalSplitterShadow$1,this._xPosition$1-4,0,this._xPosition$1+this._shadowPart$1,c),e[this._verticalIndex$1]=this._xPosition$1/
b)}},onDragCompleted:function(a){lt.Controls.Medical.MedicalViewer.callBaseMethod(this,"onDragCompleted",[a]);if(this._isStarted$1){this._isStarted$1=!1;var a=this._viewerDivElement$1.clientWidth,b=this._viewerDivElement$1.clientHeight,c=this.get_gridLayout().get_horizontalSplitters(),d=this.get_gridLayout().get_verticalSplitters();-1!==this._horizontalIndex$1&&(c[this._horizontalIndex$1]=this._yPosition$1/b);-1!==this._verticalIndex$1&&(d[this._verticalIndex$1]=this._xPosition$1/a);this._horizontalSplitterShadow$1.style.visibility=
"hidden";this._verticalSplitterShadow$1.style.visibility="hidden";this.renderViewer();this.layoutCells()}},_setBestPosition$1:function(a){var b=this._getCellsMatrix$1(!0),c,d,e=b.length,f=b[0].length;for(c=0;c<e;c++)for(d=0;d<f;d++)if(!b[c][d]){a.set_rowPosition(c);a.set_columnsPosition(d);return}a.set_rowPosition(e+1);a.set_columnsPosition(0)},_items_CollectionChanged$1:function(a,b){for(var c=0,d=b.newItems.length;c<d;c++){var e=b.newItems[c];if(1===b.get_action()||5===b.get_action()){e.set_parent(this.layout);
this._emptyDivs$1=this._emptyDivLayout$1.get_items();-1===e.get_position()&&e.set_position(this.layout.get_items().indexOf(e));if(-1===e.get_rowPosition()||-1===e.get_columnsPosition())if(this._cellsArrangment$1){var f=this._emptyDivs$1.get_item(0).get_position(),g,h=0;for(g=1;g<this._emptyDivs$1.get_count();g++)f>this._emptyDivs$1.get_item(g).get_position()&&(f=this._emptyDivs$1.get_item(g).get_position(),h=g);f=this._emptyDivs$1.get_item(h);e.set_rowPosition(f.get_rowPosition());e.set_columnsPosition(f.get_columnsPosition());
e.set_position(f.get_position());e.set_bounds(f.get_bounds());this._emptyDivs$1.removeAt(h)}else this._setBestPosition$1(e);this._updateEmptyDiv$1();null!=e.get_frameOfReferenceUID()&&this._addSeriesToDictionary(e);null!=e.get_seriesInstanceUID()&&this._addSeriesToMenu(e);e.get_selected()&&this.layout.selectItem(e,!0);this._viewerDivElement$1.appendChild(e.get_div());this.layoutCells()}else 3===b.get_action()&&(this._deleteSeriesFromLoadedArray$1(e),this._deleteSeriesFromDictionary$1(e),e.get_selected()&&
this.layout.selectItem(e,!1),this._exploded$1&&this._explodedCell$1===e&&(this._explodedCell$1.set_bounds(this._oldBounds$1),this._explodedCell$1=null,this._exploded$1=!1),this._substituteWithEmptyDiv$1(e),this._emptyDivLayout$1.onSizeChanged())}},_substituteWithEmptyDiv$1:function(a){var b=new lt.Controls.Medical.EmptyCell(this._emptyDivLayout$1,this,"myEmptyDiv",0,0);b.set_position(a.get_position());b.set_rowPosition(a.get_rowPosition());b.set_columnsPosition(a.get_columnsPosition());b.set_bounds(a.get_bounds());
for(var a=0,c=this._emptyDivs$1.get_count(),a=0;a<c;a++)if(this._emptyDivs$1.get_item(a).get_position()>b.get_position()){this._emptyDivs$1.insert(b,a);return}this._emptyDivs$1.add(b)},_deleteSeriesFromDictionary$1:function(a){var b=a.get_frameOfReferenceUID();if(b&&null!=this._dictionary$1[b])for(var b=this._dictionary$1[b],c=0,d=b.length;c<d;c++)if(b[c]===a){b.removeAt(c);break}},_deleteSeriesFromLoadedArray$1:function(a){a.get_divID();delete this._rightClickMenu$1[a.get_divID()]},_initialize$1:function(a,
b,c){this._gridLayout$1=new lt.Controls.Medical.GridLayout(this,b,c);this._dictionary$1={};this._rightClickMenu$1={};this.layout=new lt.Controls.Medical.LayoutManager(a);this._emptyDivLayout$1=new lt.Controls.Medical.LayoutManager(a);this.layout.get_items().add_collectionChanged(ss.Delegate.create(this,this._items_CollectionChanged$1));this.layout.get_selectedItems().add_collectionChanged(ss.Delegate.create(this,this._selectedItems_CollectionChanged$1));this._emptyDivLayout$1.get_selectedItems().add_collectionChanged(ss.Delegate.create(this,
this._emptySelectedItems_CollectionChanged$1));this._viewerDivElement$1=document.createElement("div");this._divId$1=a.id+"_MedicalViewer";this._viewerDivElement$1.id=this._divId$1;this._viewerCanvasElement$1=document.createElement("canvas");a.appendChild(this._viewerDivElement$1);this._viewerDivElement$1.appendChild(this._viewerCanvasElement$1);lt.Controls.Medical.MedicalViewer.callBaseMethod(this,"createControl",[this._viewerDivElement$1,this._viewerDivElement$1.parentNode,this._viewerCanvasElement$1]);
lt.Controls.Medical.MedicalViewer.callBaseMethod(this,"startListening");this._horizontalSplitterShadow$1=this._createCanvas$1();this._verticalSplitterShadow$1=this._createCanvas$1();this.onSizeChanged();this._updateSplittersPosition$1(b,c);this._createDropDown$1()},_clearReferenceLineData$1:function(a,b){b.get__cellReferenceLine().show=!1;b.invalidate();return!1},_clearReferenceLine$1:function(a){this._enumerateMatchedSeries$1(a,ss.Delegate.create(this,this._clearReferenceLineData$1))},_emptySelectedItems_CollectionChanged$1:function(a,
b){for(var c=ss.IEnumerator.getEnumerator(b.newItems);c.moveNext();){var d=c.current;if(1===b.get_action())d.get_div().style.backgroundColor="rgba(128, 128, 128, 0.5)";else if(3===b.get_action()||!b.get_action())d.get_div().style.backgroundColor="rgba(0, 0, 0, 0)"}},_selectedItems_CollectionChanged$1:function(a,b){if(3===b.get_action()||!b.get_action())for(var c=ss.IEnumerator.getEnumerator(b.newItems);c.moveNext();){var d=c.current;d.set_selected(!1);this._clearReferenceLine$1(d);d.invalidate()}else if(1===
b.get_action()){this._findReferenceLine$1(this.layout.get_selectedItem(),!0);this._invalidateReferenceLine$1(this.layout.get_selectedItem());for(c=ss.IEnumerator.getEnumerator(b.newItems);c.moveNext();)d=c.current,d.set_selected(!0),1>d.get_selectedItems().get_count()&&d.get_selectedItems().add(d.get_imageViewer().get_items().get_item(0)),d.invalidate()}},onSizeChanged:function(){lt.Controls.Medical.MedicalViewer.callBaseMethod(this,"onSizeChanged");this._parentDiv$1=this._viewerDivElement$1.parentNode;
this._viewerDivElement$1.style.left="0px";this._viewerDivElement$1.style.top="0px";this._viewerDivElement$1.style.width=this._parentDiv$1.clientWidth+"px";this._viewerDivElement$1.style.height=this._parentDiv$1.clientHeight+"px";this._viewerDivElement$1.style.position="relative";this._viewerCanvasElement$1.width=this._parentDiv$1.clientWidth;this._viewerCanvasElement$1.height=this._parentDiv$1.clientHeight;this._viewerCanvasElement$1.style.position="relative";this.layoutCells();this.layout.onSizeChanged();
this._emptyDivLayout$1.onSizeChanged();this.renderViewer()},_medicalViewer_CanvasSizeChanged$1:function(){this.renderViewer()},_drawVerticalSplitter$1:function(a,b,c){var d=a.getContext("2d"),a=a.height;d.beginPath();d.lineWidth=2;d.strokeStyle="#ffffff";d.moveTo(b-this._lightPart$1+1,0);d.lineTo(b-this._lightPart$1+1,a);d.stroke();d.beginPath();d.lineWidth=c-1;d.strokeStyle="#e7e7e7";d.moveTo(b-1,0);d.lineTo(b-1,a);d.stroke();d.beginPath();d.lineWidth=2;d.strokeStyle="#a0a0a0";d.moveTo(b+this._shadowPart$1-
2,0);d.lineTo(b+this._shadowPart$1-2,a);d.stroke();d.beginPath();d.lineWidth=1;d.strokeStyle="#696969";d.moveTo(b+this._shadowPart$1-1,0);d.lineTo(b+this._shadowPart$1-1,a);d.stroke()},_drawHorizontalSplitter$1:function(a,b,c){var d=a.getContext("2d"),a=a.width;d.beginPath();d.lineWidth=2;d.strokeStyle="#ffffff";d.moveTo(0,b-this._lightPart$1+1);d.lineTo(a,b-this._lightPart$1+1);d.stroke();d.beginPath();d.lineWidth=c-1;d.strokeStyle="#e7e7e7";d.moveTo(0,b-1);d.lineTo(a,b-1);d.stroke();d.beginPath();
d.lineWidth=2;d.strokeStyle="#a0a0a0";d.moveTo(0,b+this._shadowPart$1-2);d.lineTo(a,b+this._shadowPart$1-2);d.stroke();d.beginPath();d.lineWidth=1;d.strokeStyle="#696969";d.moveTo(0,b+this._shadowPart$1-1);d.lineTo(a,b+this._shadowPart$1-1);d.stroke()},renderViewer:function(){var a=this.get_gridLayout().get_horizontalSplitters(),b=this.get_gridLayout().get_verticalSplitters(),c=this._gridLayout$1.get_splitterSize(),d=this._viewerCanvasElement$1,e=this._viewerDivElement$1.clientWidth,f=this._viewerDivElement$1.clientHeight,
g=d.getContext("2d");g.setTransform(1,0,0,1,0,0);g.fillStyle=this._emptyCellColor$1;g.clearRect(0,0,d.width,d.height);if(!(1===this.get_cellsArrangment()||this._exploded$1||1===this.get_cellsArrangment())){for(var h=a,i=h.length,j=0;j<i;j++)this._drawHorizontalSplitter$1(d,parseInt(h[j]*f),this.get_gridLayout().get_splitterSize());for(var h=b,b=h.length,k,j=0;j<b;j++)k=parseInt(h[j]*e),this._drawVerticalSplitter$1(d,k,this.get_gridLayout().get_splitterSize());g.fillStyle="#e7e7e7";for(j=0;j<b;j++){k=
parseInt(h[j]*e);for(var l=0;l<i;l++)d=parseInt(a[l]*f),g.fillRect(k-this._lightPart$1,d-this._lightPart$1,c,c-1)}}},_setGridRowColumnNormalized$1:function(a,b){var c=this.get_gridLayout().get_horizontalSplitters(),d=this.get_gridLayout().get_verticalSplitters(),e=this._viewerCanvasElement$1;if(a>c.length||b>d.length)return lt.LeadRectD.create(0,0,0,0);var f=1/e.height,g=1/e.width,e=b?d[b-1]+g*this._shadowPart$1:0,g=b===d.length?1-g:d[b]-g*this._lightPart$1,d=a?c[a-1]+f*this._shadowPart$1:0,c=a===
c.length?1-f:c[a]-f*this._lightPart$1;return lt.LeadRectD.create(e,d,Math.max(0,g-e),Math.max(0,c-d))},_setSequantialGridLowBoundaries$1:function(a,b,c){a=parseInt(c/b>>0);return this._setGridRowColumnNormalized$1(a,c-a*b)},_layoutCellInGrid$1:function(a,b){return this._setGridRowColumnNormalized$1(a,b)},_layoutGridSequentialCells$1:function(){var a=0,b=this.layout.get_items().get_count();this.layout.beginUpdate();for(a=0;a<b;a++){var c=this.layout.get_items().get_item(a),d=this._layoutCellInGrid$1(c.get_rowPosition(),
c.get_columnsPosition());c.set_bounds(lt.LeadRectD.create(d.get_left(),d.get_top(),d.get_width(),d.get_height()))}this.layout.endUpdate();this._emptyDivLayout$1.beginUpdate();this._emptyDivs$1=this._emptyDivLayout$1.get_items();a=0;for(b=this._emptyDivs$1.get_count();a<b;a++)c=this._emptyDivs$1.get_item(a),d=this._layoutCellInGrid$1(c.get_rowPosition(),c.get_columnsPosition()),c.set_bounds(lt.LeadRectD.create(d.get_left(),d.get_top(),d.get_width(),d.get_height()));this._emptyDivLayout$1.endUpdate()},
_lightPart$1:0,_shadowPart$1:0,_oldBounds$1:null,_layoutExplodedCell$1:function(a){var b=this._viewerCanvasElement$1.width,c=this._viewerCanvasElement$1.height;this._explodedCell$1.set_displayRectangle(lt.LeadRectD.create(a.get_left()*b,a.get_top()*c,a.get_width()*b,a.get_height()*c));this._explodedCell$1.onSizeChanged()},layoutCells:function(){this._updateEmptyDiv$1();var a=this._gridLayout$1.get_splitterSize();this._lightPart$1=(a>>1)+1;this._shadowPart$1=a-this._lightPart$1+1;if(this._exploded$1)this._layoutExplodedCell$1(this._explodedCell$1.get_bounds());
else switch(this._cellsArrangment$1){case 0:this._layoutGridSequentialCells$1()}}};Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"totalCells",{get:lt.Controls.Medical.MedicalViewer.prototype.get_totalCells,set:lt.Controls.Medical.MedicalViewer.prototype.set_totalCells,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"emptyDivs",{get:lt.Controls.Medical.MedicalViewer.prototype.get_emptyDivs,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,
"emptyCellColor",{get:lt.Controls.Medical.MedicalViewer.prototype.get_emptyCellColor,set:lt.Controls.Medical.MedicalViewer.prototype.set_emptyCellColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"selectedSeries",{get:lt.Controls.Medical.MedicalViewer.prototype.get_selectedSeries,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"activeSeries",{get:lt.Controls.Medical.MedicalViewer.prototype.get_activeSeries,
set:lt.Controls.Medical.MedicalViewer.prototype.set_activeSeries,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"showReferenceLine",{get:lt.Controls.Medical.MedicalViewer.prototype.get_showReferenceLine,set:lt.Controls.Medical.MedicalViewer.prototype.set_showReferenceLine,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"showFirstAndLastReferenceLine",{get:lt.Controls.Medical.MedicalViewer.prototype.get_showFirstAndLastReferenceLine,
set:lt.Controls.Medical.MedicalViewer.prototype.set_showFirstAndLastReferenceLine,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"enableSynchronization",{get:lt.Controls.Medical.MedicalViewer.prototype.get_enableSynchronization,set:lt.Controls.Medical.MedicalViewer.prototype.set_enableSynchronization,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"exploded",{get:lt.Controls.Medical.MedicalViewer.prototype.get_exploded,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"explodedCell",{get:lt.Controls.Medical.MedicalViewer.prototype.get_explodedCell,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"beforeCellExploded",{get:lt.Controls.Medical.MedicalViewer.prototype.__beforeCellExploded$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"afterCellExploded",{get:lt.Controls.Medical.MedicalViewer.prototype.__afterCellExploded$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"divId",{get:lt.Controls.Medical.MedicalViewer.prototype.get_divId,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,"cellsArrangment",{get:lt.Controls.Medical.MedicalViewer.prototype.get_cellsArrangment,set:lt.Controls.Medical.MedicalViewer.prototype.set_cellsArrangment,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalViewer.prototype,
"gridLayout",{get:lt.Controls.Medical.MedicalViewer.prototype.get_gridLayout,enumerable:!0,configurable:!0});lt.Controls.Medical.CellGridLayout=function(a,b,c){this._value1=1;this._value4=this._value3=this._value2=0;this._rows=b;this._columns=c;this._cell=a};lt.Controls.Medical.CellGridLayout.prototype={_rows:0,_columns:0,_value1:0,_value2:0,_value3:0,_value4:0,_cell:null,get_value1:function(){return this._value1},set_value1:function(a){this._value1=a;if(2===this._cell.get_arrangment()||3===this._cell.get_arrangment())this._cell.updateSubCellCount(this._value1+
this._value2+this._value3+this._value4),this._cell.get_viewer().onSizeChanged();return a},get_value2:function(){return this._value2},set_value2:function(a){this._value2=a;if(2===this._cell.get_arrangment()||3===this._cell.get_arrangment())this._cell.updateSubCellCount(this._value1+this._value2+this._value3+this._value4),this._cell.get_viewer().onSizeChanged();return a},get_value3:function(){return this._value3},set_value3:function(a){this._value3=a;if(2===this._cell.get_arrangment()||3===this._cell.get_arrangment())this._cell.updateSubCellCount(this._value1+
this._value2+this._value3+this._value4),this._cell.get_viewer().onSizeChanged();return a},get_value4:function(){return this._value4},set_value4:function(a){this._value4=a;if(2===this._cell.get_arrangment()||3===this._cell.get_arrangment())this._cell.updateSubCellCount(this._value1+this._value2+this._value3+this._value4),this._cell.get_viewer().onSizeChanged();return a},get_rows:function(){return this._rows},set_rows:function(a){if(Type.canCast(this,lt.Controls.Medical.MPRCell))throw Error("You can't change the rows of the MPR Cell");
this._rows=a;this._cell.get_arrangment()||(this._cell.updateSubCellCount(this._rows*this._columns),this._cell.onSizeChanged());return a},get_columns:function(){return this._columns},set_columns:function(a){if(Type.canCast(this,lt.Controls.Medical.MPRCell))throw Error("You can't change the columns of the MPR Cell");this._columns=a;this._cell.get_arrangment()||(this._cell.updateSubCellCount(this._rows*this._columns),this._cell.onSizeChanged());return a}};Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,
"value1",{get:lt.Controls.Medical.CellGridLayout.prototype.get_value1,set:lt.Controls.Medical.CellGridLayout.prototype.set_value1,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,"value2",{get:lt.Controls.Medical.CellGridLayout.prototype.get_value2,set:lt.Controls.Medical.CellGridLayout.prototype.set_value2,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,"value3",{get:lt.Controls.Medical.CellGridLayout.prototype.get_value3,
set:lt.Controls.Medical.CellGridLayout.prototype.set_value3,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,"value4",{get:lt.Controls.Medical.CellGridLayout.prototype.get_value4,set:lt.Controls.Medical.CellGridLayout.prototype.set_value4,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,"rows",{get:lt.Controls.Medical.CellGridLayout.prototype.get_rows,set:lt.Controls.Medical.CellGridLayout.prototype.set_rows,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CellGridLayout.prototype,"columns",{get:lt.Controls.Medical.CellGridLayout.prototype.get_columns,set:lt.Controls.Medical.CellGridLayout.prototype.set_columns,enumerable:!0,configurable:!0});lt.Controls.Medical.EmptyCell=function(a,b,c,d,e){lt.Controls.Medical.EmptyCell.initializeBase(this);this.set_parent(a);this._viewer$1=b;this._rowPosition$1=d;this._columnsPosition$1=e;this.get_div().id=c;this.get_div().style.backgroundColor=
"rgba(255, 255, 255, 0)";this._emptyCellClicked$1=ss.Delegate.create(this,this._emptyCell_Clicked$1);this._divContextMenu$1=ss.Delegate.create(this,this._divContext_Show$1);this._emptyDivLostfocus$1=ss.Delegate.create(this,this._emptyCell_LostFocus$1);this.get_div().addEventListener("blur",this._emptyDivLostfocus$1,!1);this.get_div().addEventListener("contextmenu",this._divContextMenu$1,!1);this.get_div().addEventListener("touchstart",this._emptyCellClicked$1,!1);this.get_div().addEventListener(lt.Controls.Medical.Tools._pointerdown,
this._emptyCellClicked$1,!1);this.get_div().addEventListener("mousedown",this._emptyCellClicked$1,!1);document.getElementById(this._viewer$1.get_divId()).appendChild(this.get_div())};lt.Controls.Medical.EmptyCell.prototype={_columnsPosition$1:0,_rowPosition$1:0,_position$1:0,_viewer$1:null,_emptyCellClicked$1:null,_divContextMenu$1:null,_emptyDivLostfocus$1:null,_emptyCell_Clicked$1:function(a){this._viewer$1.layout.get_selectedItems().clear();this._viewer$1.get_emptyDivs().get_selectedItems().clear();
this._viewer$1.get_emptyDivs().set_selectedItem(this);a.button===lt.Controls.MouseButtons.right?this._viewer$1._showSeriesDropDown(a.offsetX,a.offsetY):this._viewer$1._hideSeriesDropDown()},dispose:function(){document.getElementById(this._viewer$1.get_divId()).removeChild(this.get_div());this.get_div().id=""},_divContext_Show$1:function(a){a.preventDefault();a.stopImmediatePropagation()},_emptyCell_LostFocus$1:function(){this._viewer$1.get_emptyDivs().get_selectedItems().get_count()||this._viewer$1._hideSeriesDropDown()},
get_position:function(){return this._position$1},set_position:function(a){return this._position$1=a},get_rowPosition:function(){return this._rowPosition$1},set_rowPosition:function(a){return this._rowPosition$1=a},get_columnsPosition:function(){return this._columnsPosition$1},set_columnsPosition:function(a){return this._columnsPosition$1=a}};Object.defineProperty(lt.Controls.Medical.EmptyCell.prototype,"position",{get:lt.Controls.Medical.EmptyCell.prototype.get_position,set:lt.Controls.Medical.EmptyCell.prototype.set_position,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.EmptyCell.prototype,"rowPosition",{get:lt.Controls.Medical.EmptyCell.prototype.get_rowPosition,set:lt.Controls.Medical.EmptyCell.prototype.set_rowPosition,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.EmptyCell.prototype,"columnsPosition",{get:lt.Controls.Medical.EmptyCell.prototype.get_columnsPosition,set:lt.Controls.Medical.EmptyCell.prototype.set_columnsPosition,enumerable:!0,configurable:!0});
lt.Controls.Medical.ImageURLChangedEventArgs=function(a){lt.Controls.Medical.ImageURLChangedEventArgs.initializeBase(this,[a])};lt.Controls.Medical.ImageProcessingReadyEventArgs=function(a,b){lt.Controls.Medical.ImageProcessingReadyEventArgs.initializeBase(this);this._frame$1=a;this._imageProcessing$1=b};lt.Controls.Medical.ImageProcessingReadyEventArgs.prototype={_imageProcessing$1:null,_frame$1:null,get_imageProcessing:function(){return this._imageProcessing$1},get_frame:function(){return this._frame$1}};
Object.defineProperty(lt.Controls.Medical.ImageProcessingReadyEventArgs.prototype,"imageProcessing",{get:lt.Controls.Medical.ImageProcessingReadyEventArgs.prototype.get_imageProcessing,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ImageProcessingReadyEventArgs.prototype,"frame",{get:lt.Controls.Medical.ImageProcessingReadyEventArgs.prototype.get_frame,enumerable:!0,configurable:!0});lt.Controls.Medical.CellEventArgs=function(a){lt.Controls.Medical.CellEventArgs.initializeBase(this);
this._frame$1=a};lt.Controls.Medical.CellEventArgs.prototype={_frame$1:null,get_frame:function(){return this._frame$1}};Object.defineProperty(lt.Controls.Medical.CellEventArgs.prototype,"frame",{get:lt.Controls.Medical.CellEventArgs.prototype.get_frame,enumerable:!0,configurable:!0});lt.Controls.Medical.CellExplodedEventArgs=function(a){lt.Controls.Medical.CellExplodedEventArgs.initializeBase(this);this._Cell$1=a};lt.Controls.Medical.CellExplodedEventArgs.prototype={_Cell$1:null,get_cell:function(){return this._Cell$1}};
Object.defineProperty(lt.Controls.Medical.CellExplodedEventArgs.prototype,"cell",{get:lt.Controls.Medical.CellExplodedEventArgs.prototype.get_cell,enumerable:!0,configurable:!0});lt.Controls.Medical.FrameAttachedEventArgs=function(a,b){lt.Controls.Medical.FrameAttachedEventArgs.initializeBase(this);this._SubCell$1=a;this._Frame$1=b};lt.Controls.Medical.FrameAttachedEventArgs.prototype={_SubCell$1:null,get_subCell:function(){return this._SubCell$1},_Frame$1:null,get_frame:function(){return this._Frame$1}};
Object.defineProperty(lt.Controls.Medical.FrameAttachedEventArgs.prototype,"subCell",{get:lt.Controls.Medical.FrameAttachedEventArgs.prototype.get_subCell,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.FrameAttachedEventArgs.prototype,"frame",{get:lt.Controls.Medical.FrameAttachedEventArgs.prototype.get_frame,enumerable:!0,configurable:!0});lt.Controls.Medical.MPRCell=function(a,b,c){lt.Controls.Medical.MPRCell.initializeBase(this,[a.get_viewer(),c,1,1]);this._generator$2=
a;this._generator$2.add_dispoing(ss.Delegate.create(this,this._generator_Dispose$2));this.add_dispoing(ss.Delegate.create(this,this._mprCell_Dispose$2));this.set_mprType(b?1:2);this._originalMPRType$2=0;this.add_scrollChanged(ss.Delegate.create(this,this._cell_scrollChanged$2));this._initializeMPRCell$2();this.get_progress().set_progressPercent(100);this._generator$2.get_children().add(this);lt.Controls.Medical.CrossHairInteractiveMode.scrollCrossHair(this._generator$2,this._generator$2.get__crossHairPosition().get_x(),
this._generator$2.get__crossHairPosition().get_y())};lt.Controls.Medical.MPRCell.canDoMPR=function(a){if(Type.canCast(a,lt.Controls.Medical.MPRCell))return 8;if(3>a.get_frames().get_count())return-1;var b=a.get_frames().get_item(0),c=a.get_frames().get_item(1);if(null==b.get_imagePosition()||null==c.get_imagePosition())return 2;for(var b=0,c=a.get_frames().get_count(),d;b<c;b++)if(d=a.get_frames().get_item(b),null==d.lowResImage)return 4;return 0};lt.Controls.Medical.MPRCell.prototype={_originalMPRType$2:0,
_generator$2:null,get_generator:function(){return this._generator$2},_generator_Dispose$2:function(){this.dispose()},_mprCell_Dispose$2:function(){this._generator$2.remove_dispoing(ss.Delegate.create(this,this._generator_Dispose$2));this._generator$2.get_children().remove(this);this.remove_dispoing(ss.Delegate.create(this,this._mprCell_Dispose$2));this.remove_scrollChanged(ss.Delegate.create(this,this._cell_scrollChanged$2))},_cell_scrollChanged$2:function(a,b){b.get_previousScrollOffset()!==b.get_scrollOffset()&&
(this.get_frames().get_item(b.get_previousScrollOffset()),this.get_frames().get_item(b.get_scrollOffset()),this._generateMPRFrame$2(b.get_scrollOffset(),b.get_scrollOffset()))},reloadMPR:function(){this.get_frames().clear();switch(this.get_mprType()){case 2:switch(this._originalMPRType$2){case 0:this._initializeMPRCell$2()}break;case 1:switch(this._originalMPRType$2){case 0:this._initializeMPRCell$2()}}},_getOneImage$2:function(){for(var a=0,b=this._generator$2.get_frames().get_count(),c;a<b;a++)if(c=
this._generator$2.get_frames().get_item(a),null!=c.lowResImage._image&&c.lowResImage._image.naturalWidth)return c.lowResImage._image;return null},_originalFrameWidth$2:0,_originalFrameHeight$2:0,_frameWidth$2:0,_frameHeight$2:0,_copyFrameInformation$2:function(a,b){b.get_information();a.set_width(this._frameWidth$2);a.set_height(this._frameHeight$2);a.set_bitPerpixel(b.get_bitPerpixel());a.set_information(b.get_information().clone());a.get_information().set_photometricInterpretation("");a.set_imagePosition(b.get_imagePosition());
a.set_imageOrientation(b.get_imageOrientation());a.set_rowSpacing(b.get_rowSpacing());a.set_columnSpacing(b.get_columnSpacing());a.get_information().set_width(this._frameWidth$2);a.get_information().set_height(this._frameHeight$2);this.set_seriesInstanceUID(this._generator$2.get_seriesInstanceUID()+"_Sagittal")},_rescaleValue$2:0,_widthRescaleValue$2:0,_getRescaleValue$2:function(){var a=this._generator$2.get_frames().get_item(0).get_imagePosition(),b=this._generator$2.get_frames().get_item(1).get_imagePosition();
return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))},_getMPRInfo$2:function(a,b){var c=a.get_frames().get_item(0),d=a.get_frames().get_item(0).get_imagePosition(),e=a.get_frames().get_item(1).get_imagePosition(),d=lt.Controls.Medical.ReferenceLine._set3OrthogonalOrientation(c.get_imageOrientation(),new lt.Controls.Medical._d3DXVECTOR3(d[0],d[1],d[2]),new lt.Controls.Medical._d3DXVECTOR3(e[0],e[1],e[2]),this.get_mprType()),e=0;switch(this.get_mprType()){case 0:e=d.axial_DICOMTage.map3DOrthMPRToItsConventionalNames[4];
break;case 1:e=d.axial_DICOMTage.map3DOrthMPRToItsConventionalNames[2];break;case 2:e=d.axial_DICOMTage.map3DOrthMPRToItsConventionalNames[1]}c=null;switch(e){case 1:this.set_mprType(2);c=d.coro_DICOMTage;break;case 2:this.set_mprType(1);c=d.sag_DICOMTage;break;case 4:this.set_mprType(0),c=d.axial_DICOMTage}d=Array(6);d[0]=c.xOrientation[0];d[1]=c.xOrientation[1];d[2]=c.xOrientation[2];d[3]=c.yOrientation[0];d[4]=c.yOrientation[1];d[5]=c.yOrientation[2];e=new lt.Controls.Medical._mprOrientationInfo;
e.mprType=b;e.orientation=d;e.transform=c.flip;return e},mprImage:null,_mprTransform$2:null,_updateMPRCanvas$2:function(){null==this.mprImage&&(this.mprImage=document.createElement("canvas"));this.mprImage.width!==this._frameWidth$2&&(this.mprImage.width=this._frameWidth$2);this.mprImage.height!==this._frameHeight$2&&(this.mprImage.height=this._frameHeight$2);this.get_imageViewer().get_items().get_item(0).set_imageSize(lt.LeadSizeD.create(this.mprImage.width,this.mprImage.height))},_mprDicomInfo$2:null,
_initializeMPRCell$2:function(){this._rescaleValue$2=this._getRescaleValue$2();var a=this._getMPRInfo$2(this._generator$2,this.get_mprType());this.set_mprType(a.mprType);this._mprTransform$2=a.transform;this._MPRReverse$2=-1!==a.transform.indexOf(3);this._MPRFlip$2=-1!==a.transform.indexOf(2);var b=this._getOneImage$2();this._originalFrameWidth$2=b.naturalHeight;this._originalFrameHeight$2=this._generator$2.get_frames().get_count();var c=null,c=this._generator$2.get_frames().get_item(0),d=parseInt(c.get_width().toString());
this._widthRescaleValue$2=d?d/this._originalFrameWidth$2:1;this._frameWidth$2=Math.floor(this._originalFrameWidth$2*this._widthRescaleValue$2*(1===this.get_mprType()?c.get_columnSpacing():c.get_rowSpacing())+0.5);this._frameHeight$2=Math.floor(this._originalFrameHeight$2*this._rescaleValue$2+0.5);b=b.naturalWidth;this._mprDicomInfo$2=new lt.Controls.Medical.DICOMImageInformation;Date.get_now().getTime();var e=0,f=this._generator$2.get_frames().get_count();this._generator$2.get_frames().get_item(0);
for(e=0;e<b;e++)c=new lt.Controls.Medical.Frame(this),this._copyFrameInformation$2(c,this._generator$2.get_frames().get_item(0)),e<f&&(d=this._generator$2.get_frames().get_item(e),this._mprDicomInfo$2.get_maxValue()-this._mprDicomInfo$2.get_minValue()<d.get_information().get_maxValue()-d.get_information().get_minValue()&&(this._mprDicomInfo$2.set_minValue(c.get_information().get_minValue()),this._mprDicomInfo$2.set_maxValue(c.get_information().get_maxValue()),this._mprDicomInfo$2.set_lowBit(c.get_information().get_lowBit()),
this._mprDicomInfo$2.set_highBit(c.get_information().get_highBit()),this._mprDicomInfo$2.set_highBit(c.get_information().get_highBit()),this._mprDicomInfo$2.set_bitsPerPixel(c.get_information().get_bitsPerPixel()),this._mprDicomInfo$2.set_signed(c.get_information().get_signed()))),c.set_imageOrientation(a.orientation),c.set_width(this._frameWidth$2),c.set_height(this._frameHeight$2),this.get_frames().add(c);Date.get_now().getTime();this._updateMPRCanvas$2();this.set_currentOffset(this.get_frames().get_count()/
2)},_getRenderCanvas$2:function(a){this.get_frames().get_item(a);this._updateMPRCanvas$2();a=document.createElement("canvas");2===this.get_mprType()?(a.width=this._originalFrameWidth$2,a.height=this._originalFrameHeight$2):(a.width=this._originalFrameHeight$2,a.height=this._originalFrameWidth$2);a.style.position="absolute";a.style.width=a.width+"px";a.style.height=a.height+"px";a.style.left="0px";a.style.top="0px";return a},_MPRReverse$2:!1,_MPRFlip$2:!1,_mprRenderer$2:null,_generateMPRFrame$2:function(a,
b){var c=this._getRenderCanvas$2(b),d=c.getContext("2d"),e=null;this._generator$2.get_frames().get_item(0);Date.get_now().getTime();var f=0,g=this.get_frames().get_item(b),h=this.mprImage.getContext("2d");if(2===this.get_mprType()){var i=document.createElement("canvas");i.width=this._originalFrameWidth$2;i.height=1;for(var j=null,f=0;f<this._originalFrameHeight$2;f++)if(e=this._generator$2.get_frames().get_item(f),null!=e.lowResImage?j=e.lowResImage._image:null!=e.thumbnailImage&&(j=e.thumbnailImage._image),
null!=j)e=j.naturalWidth,d.drawImage(j,0,a,e,1,0,f,e,1);null==this._mprRenderer$2&&(this._mprRenderer$2=new lt.Controls.Medical.DICOMImageInformationRenderer(this._mprDicomInfo$2));this._mprRenderer$2.render(c);this._MPRFlip$2&&(h.translate(0,this.mprImage.height),h.scale(1,-1));this._MPRReverse$2&&(h.translate(this.mprImage.width,0),h.scale(-1,1));h.drawImage(c,0,0,this.mprImage.width,this.mprImage.height)}else{i=document.createElement("canvas");i.width=1;i.height=this._originalFrameWidth$2;j=null;
for(f=0;f<this._originalFrameHeight$2;f++)e=this._generator$2.get_frames().get_item(f),null!=e.lowResImage?j=e.lowResImage._image:null!=e.thumbnailImage&&(j=e.thumbnailImage._image),d.drawImage(j,a,0,1,j.naturalHeight,f,0,1,j.naturalHeight);null==this._mprRenderer$2&&(this._mprRenderer$2=new lt.Controls.Medical.DICOMImageInformationRenderer(this._mprDicomInfo$2));this._mprRenderer$2.render(c);h.save();h.translate(c.height,0);h.rotate(Math.PI/2);h.translate(0,c.height);h.scale(1,-1);this._MPRFlip$2&&
(h.translate(this.mprImage.height,0),h.scale(-1,1));this._MPRReverse$2&&(h.translate(0,c.height),h.scale(1,-1));h.drawImage(c,0,0,this.mprImage.height,this.mprImage.width);h.restore()}lt.Controls.Medical.Tools._disposeCanvas(i);lt.Controls.Medical.Tools._disposeCanvas(c);Date.get_now().getTime();g._drawImage()}};Object.defineProperty(lt.Controls.Medical.MPRCell.prototype,"generator",{get:lt.Controls.Medical.MPRCell.prototype.get_generator,enumerable:!0,configurable:!0});lt.Controls.Medical.ScrollChangedEventArgs=
function(a,b){lt.Controls.Medical.ScrollChangedEventArgs.initializeBase(this);this._previousScrollOffset$1=a;this._scrollOffset$1=b};lt.Controls.Medical.ScrollChangedEventArgs.prototype={_previousScrollOffset$1:0,_scrollOffset$1:0,get_scrollOffset:function(){return this._scrollOffset$1},get_previousScrollOffset:function(){return this._previousScrollOffset$1}};Object.defineProperty(lt.Controls.Medical.ScrollChangedEventArgs.prototype,"scrollOffset",{get:lt.Controls.Medical.ScrollChangedEventArgs.prototype.get_scrollOffset,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ScrollChangedEventArgs.prototype,"previousScrollOffset",{get:lt.Controls.Medical.ScrollChangedEventArgs.prototype.get_previousScrollOffset,enumerable:!0,configurable:!0});lt.Controls.Medical.Cell=function(a,b,c,d){this._arrangment$1=0;lt.Controls.Medical.Cell.initializeBase(this);var e=a.get_divId();null!=a&&this.set_parent(a.layout);this._gridLayout$1=new lt.Controls.Medical.CellGridLayout(this,c,d);this._commandDictionary$1=
{};this._progress$1=new lt.Controls.Medical.ProgressLoading(this);this._children$1=new lt.Controls.Medical.LeadCollection;this._selectedItems$1=new lt.Controls.Medical.LeadCollection;document.getElementById(a.get_divId());this._tagVisiblity$1=!0;this._position$1=this._columnsPosition$1=this._rowPosition$1=-1;this._medicalViewer$1=a;this._initialize$1(e,b,c,d);a=this.get_div();this._subCellClickedFunction$1=ss.Delegate.create(this,this._subCell_Clicked$1);this._doubleClickFunction$1=ss.Delegate.create(this,
this._subCell_DoubleClicked$1);lt.LTHelper.supportsTouch&&!lt.LTHelper.msPointerEnabled&&a.addEventListener("touchstart",this._subCellClickedFunction$1,!1);lt.LTHelper.msPointerEnabled?a.addEventListener(lt.Controls.Medical.Tools._pointerdown,this._subCellClickedFunction$1,!1):a.addEventListener("mousedown",this._subCellClickedFunction$1,!1);lt.LTHelper.supportsMouse&&a.addEventListener("dblclick",this._doubleClickFunction$1,!1)};lt.Controls.Medical.Cell.prototype={_commandDictionary$1:null,_progress$1:null,
_gridLayout$1:null,_seriesInstanceUID$1:null,_patientName$1:null,_frameOfReferenceUID$1:null,_seriesNumber$1:0,_currentActiveCommand$1:null,_selectedBorderColor$1:"#bfbf00",_unselectedBorderColor$1:"#ffffff",_selectedSubCellBorderColor$1:"#7f7f00",_highlightedSubCellBorderColor$1:"#ffff00",_beginUpdate$1:!1,_beginUpdateCounter$1:0,add_outOfBounds:function(a){this.__outOfBounds$1=ss.Delegate.combine(this.__outOfBounds$1,a)},remove_outOfBounds:function(a){this.__outOfBounds$1=ss.Delegate.remove(this.__outOfBounds$1,
a)},__outOfBounds$1_handler_get:function(){null==this.__outOfBounds$1_handler&&(this.__outOfBounds$1_handler=ss.EventHandler.create(this,this.add_outOfBounds,this.remove_outOfBounds));return this.__outOfBounds$1_handler},__outOfBounds$1:null,__outOfBounds$1_handler:null,add_currentOffsetChanged:function(a){this.__currentOffsetChanged$1=ss.Delegate.combine(this.__currentOffsetChanged$1,a)},remove_currentOffsetChanged:function(a){this.__currentOffsetChanged$1=ss.Delegate.remove(this.__currentOffsetChanged$1,
a)},__currentOffsetChanged$1_handler_get:function(){null==this.__currentOffsetChanged$1_handler&&(this.__currentOffsetChanged$1_handler=ss.EventHandler.create(this,this.add_currentOffsetChanged,this.remove_currentOffsetChanged));return this.__currentOffsetChanged$1_handler},__currentOffsetChanged$1:null,__currentOffsetChanged$1_handler:null,add_cellClicked:function(a){this.__cellClicked$1=ss.Delegate.combine(this.__cellClicked$1,a)},remove_cellClicked:function(a){this.__cellClicked$1=ss.Delegate.remove(this.__cellClicked$1,
a)},__cellClicked$1_handler_get:function(){null==this.__cellClicked$1_handler&&(this.__cellClicked$1_handler=ss.EventHandler.create(this,this.add_cellClicked,this.remove_cellClicked));return this.__cellClicked$1_handler},__cellClicked$1:null,__cellClicked$1_handler:null,add_imageURLChanged:function(a){this.__imageURLChanged$1=ss.Delegate.combine(this.__imageURLChanged$1,a)},remove_imageURLChanged:function(a){this.__imageURLChanged$1=ss.Delegate.remove(this.__imageURLChanged$1,a)},__imageURLChanged$1_handler_get:function(){null==
this.__imageURLChanged$1_handler&&(this.__imageURLChanged$1_handler=ss.EventHandler.create(this,this.add_imageURLChanged,this.remove_imageURLChanged));return this.__imageURLChanged$1_handler},__imageURLChanged$1:null,__imageURLChanged$1_handler:null,add_postRender:function(a){this.__postRender$1=ss.Delegate.combine(this.__postRender$1,a)},remove_postRender:function(a){this.__postRender$1=ss.Delegate.remove(this.__postRender$1,a)},__postRender$1_handler_get:function(){null==this.__postRender$1_handler&&
(this.__postRender$1_handler=ss.EventHandler.create(this,this.add_postRender,this.remove_postRender));return this.__postRender$1_handler},__postRender$1:null,__postRender$1_handler:null,add_sizeChanged:function(a){this.__sizeChanged$1=ss.Delegate.combine(this.__sizeChanged$1,a)},remove_sizeChanged:function(a){this.__sizeChanged$1=ss.Delegate.remove(this.__sizeChanged$1,a)},__sizeChanged$1_handler_get:function(){null==this.__sizeChanged$1_handler&&(this.__sizeChanged$1_handler=ss.EventHandler.create(this,
this.add_sizeChanged,this.remove_sizeChanged));return this.__sizeChanged$1_handler},__sizeChanged$1:null,__sizeChanged$1_handler:null,add_scrollChanged:function(a){this.__scrollChanged$1=ss.Delegate.combine(this.__scrollChanged$1,a)},remove_scrollChanged:function(a){this.__scrollChanged$1=ss.Delegate.remove(this.__scrollChanged$1,a)},__scrollChanged$1_handler_get:function(){null==this.__scrollChanged$1_handler&&(this.__scrollChanged$1_handler=ss.EventHandler.create(this,this.add_scrollChanged,this.remove_scrollChanged));
return this.__scrollChanged$1_handler},__scrollChanged$1:null,__scrollChanged$1_handler:null,add_progressCompleted:function(a){this.__progressCompleted$1=ss.Delegate.combine(this.__progressCompleted$1,a)},remove_progressCompleted:function(a){this.__progressCompleted$1=ss.Delegate.remove(this.__progressCompleted$1,a)},__progressCompleted$1_handler_get:function(){null==this.__progressCompleted$1_handler&&(this.__progressCompleted$1_handler=ss.EventHandler.create(this,this.add_progressCompleted,this.remove_progressCompleted));
return this.__progressCompleted$1_handler},__progressCompleted$1:null,__progressCompleted$1_handler:null,add_imageProcessingReady:function(a){this.__imageProcessingReady$1=ss.Delegate.combine(this.__imageProcessingReady$1,a)},remove_imageProcessingReady:function(a){this.__imageProcessingReady$1=ss.Delegate.remove(this.__imageProcessingReady$1,a)},__imageProcessingReady$1_handler_get:function(){null==this.__imageProcessingReady$1_handler&&(this.__imageProcessingReady$1_handler=ss.EventHandler.create(this,
this.add_imageProcessingReady,this.remove_imageProcessingReady));return this.__imageProcessingReady$1_handler},__imageProcessingReady$1:null,__imageProcessingReady$1_handler:null,_children$1:null,_mprType$1:0,_referenceLines$1:null,_medicalViewer$1:null,_showFrameBorder$1:!0,_currentOffset$1:0,_frames$1:null,_preview$1:null,_overlays$1:null,_parentDivID$1:null,_linked$1:!1,_columnsPosition$1:0,_rowPosition$1:0,_position$1:0,_automation$1:null,_automationManager$1:null,_selectedItems$1:null,_suspednedCalculation$1:!1,
_tagVisiblity$1:!1,_useBackCanvas$1:!1,get_mprType:function(){return this._mprType$1},set_mprType:function(a){return this._mprType$1=a},get_children:function(){return this._children$1},beginUpdate:function(){this._beginUpdate$1=!0;this._beginUpdateCounter$1++},_canUpdate:function(){return!this._beginUpdate$1},endUpdate:function(){this._beginUpdateCounter$1--;this._beginUpdateCounter$1||(this._beginUpdate$1=!1,this.onSizeChanged())},get_selectedItems:function(){return this._selectedItems$1},set_selectedItems:function(a){return this._selectedItems$1=
a},get_selectedItem:function(){return this._selectedItems$1.get_item(0)},set_selectedItem:function(a){null==this._selectedItems$1?(this._selectedItems$1=new lt.Controls.Medical.LeadCollection,this._selectedItems$1.add(a)):this._selectedItems$1.get_count()?this._selectedItems$1.set_item(0,a):this._selectedItems$1.add(a);return a},get_automationManager:function(){return this._automationManager$1},get_automation:function(){return this._automation$1},get_selectedBorderColor:function(){return this._selectedBorderColor$1},
set_selectedBorderColor:function(a){return this._selectedBorderColor$1=a},get_unselectedBorderColor:function(){return this._unselectedBorderColor$1},set_unselectedBorderColor:function(a){this._unselectedBorderColor$1!==a&&(this._unselectedBorderColor$1=a,this.invalidate());return a},get_selectedSubCellBorderColor:function(){return this._selectedSubCellBorderColor$1},set_selectedSubCellBorderColor:function(a){this._selectedSubCellBorderColor$1!==a&&(this._selectedSubCellBorderColor$1=a,this.invalidate());
return a},get_highlightedSubCellBorderColor:function(){return this._highlightedSubCellBorderColor$1},set_highlightedSubCellBorderColor:function(a){this._highlightedSubCellBorderColor$1!==a&&(this._highlightedSubCellBorderColor$1=a,this.invalidate());return a},_subCellsEnumeration$1:function(){return!1},get_useBackCanvas:function(){return this._useBackCanvas$1},set_useBackCanvas:function(a){this._useBackCanvas$1=a;this._enumerateSubCells$1(this,ss.Delegate.create(this,this._subCellsEnumeration$1));
return a},get__activeFrameIndex:function(){var a=this._imageViewer$1.get_items().indexOf(this.get_selectedItem());0>a&&(a=0);return this.get_currentOffset()+a},get_overlayTextVisible:function(){return this._tagVisiblity$1},set_overlayTextVisible:function(a){this._tagVisiblity$1=a;for(var b,c=0,d=this._imageViewer$1.get_items().get_count();c<d;c++)b=this._imageViewer$1.get_items().get_item(c),b.get_overlayCanvas().style.visibility=this._tagVisiblity$1?"visible":"hidden";return a},suspendCalculation:function(){this._suspednedCalculation$1=
!0},resumeCalcuation:function(){this._suspednedCalculation$1=!1;this._medicalViewer$1._recalculate()},_windowLevelAction$1:null,setCommand:function(a,b){Type.canCast(b,lt.Controls.Medical.WindowLevelAction)&&(this._windowLevelAction$1=b);b.set_viewer(this._imageViewer$1);b.set_parent(this);var c=b.init();this._commandDictionary$1[a]=new lt.Controls.Medical._actionInfo(b,c);null!=c&&(c.SubCellAttached=this)},stopCommand:function(a){a=this._commandDictionary$1[a];a.action.set_isStarted(!1);Type.canCast(a.actionObject,
lt.Controls.ImageViewerInteractiveMode)&&a.actionObject.set_isEnabled(!1)},getCommand:function(a){return this._commandDictionary$1[a].actionObject},runCommand:function(a){var b=this._commandDictionary$1[a];this._currentActiveCommand$1=b;b.action.set_isStarted(!0);this._commandDictionary$1[a].action.start(this._commandDictionary$1[a].actionObject)},get_seriesNumber:function(){return this._seriesNumber$1},set_seriesNumber:function(a){this._seriesNumber$1=a;this._medicalViewer$1._addSeriesToMenu(this);
return a},get_patientName:function(){return this._patientName$1},set_patientName:function(a){this._patientName$1=a;this._medicalViewer$1._addSeriesToMenu(this);return a},get_seriesInstanceUID:function(){return this._seriesInstanceUID$1},set_seriesInstanceUID:function(a){this._seriesInstanceUID$1=a;this._medicalViewer$1._addSeriesToMenu(this);return a},get_frameOfReferenceUID:function(){return this._frameOfReferenceUID$1},set_frameOfReferenceUID:function(a){this._frameOfReferenceUID$1=a;this._medicalViewer$1._addSeriesToDictionary(this);
return a},_fireEvent:function(a,b,c){switch(b){case 0:null!=this.__imageURLChanged$1&&this.__imageURLChanged$1(this,new lt.Controls.Medical.ImageURLChangedEventArgs(a));break;case 1:null!=this.__cellClicked$1&&this.__cellClicked$1(this,lt.LeadEventArgs.Empty);break;case 2:null!=this.__progressCompleted$1&&this.__progressCompleted$1(this,lt.LeadEventArgs.Empty);break;case 3:null!=this.__imageProcessingReady$1&&this.__imageProcessingReady$1(this,c)}},get_position:function(){return this._position$1},
set_position:function(a){this._position$1=a;this._medicalViewer$1.layout.canUpdate()&&1===this._medicalViewer$1.get_cellsArrangment()&&this._medicalViewer$1.layoutCells();return a},get_rowPosition:function(){return this._rowPosition$1},set_rowPosition:function(a){this._rowPosition$1=a;this._medicalViewer$1.layout.canUpdate()&&!this._medicalViewer$1.get_cellsArrangment()&&this._medicalViewer$1.layoutCells();return a},get_columnsPosition:function(){return this._columnsPosition$1},set_columnsPosition:function(a){this._columnsPosition$1=
a;this._medicalViewer$1.layout.canUpdate()&&!this._medicalViewer$1.get_cellsArrangment()&&this._medicalViewer$1.layoutCells();return a},get__cellReferenceLine:function(){return this._referenceLines$1},_getActiveSubCellIndex:function(){return this.get_currentOffset()+this._imageViewer$1.get_items().indexOf(this.get_selectedItem())},get_linked:function(){return this._linked$1},set_linked:function(a){return this._linked$1=a},_calculateOffset$1:function(a){return a.get_scrollOffset()},_getScaleFactor$1:function(a){return a.get_transform().get_m11()},
_calculateZoom$1:function(a,b){var c=0;switch(b){case lt.Controls.ControlSizeMode.fit:case lt.Controls.ControlSizeMode.fitAlways:case lt.Controls.ControlSizeMode.fitWidth:case lt.Controls.ControlSizeMode.fitHeight:c=this._getScaleFactor$1(a);break;case lt.Controls.ControlSizeMode.actualSize:c=this._getScaleFactor$1(a)}return c},_isPresentationInformationReady:function(){return!0},_enumerateSubCellsImages$1:function(a,b,c){if(null!=a)for(var d=0,b=Math.min(b,a.get_imageViewer().get_items().get_count()),
e,d=0;d<b;d++)e=a.get_imageViewer().get_items().get_item(d),c(e,d)},_enumerateFrames$1:function(a,b){if(!(null==a||null==b)){var c=a.get_frames();if(null!=c)for(var d=0,e=c.get_count(),d=0;d<e;d++)b(c.get_item(d),d)}},_enumerateSubCells$1:function(a,b){if(null!=a)for(var c=0,d=a.get_imageViewer().get_items().get_count(),e,c=0;c<d;c++)e=a.get_imageViewer().get_items().get_item(c).get_userData(),b(e,c)},_findSelectedCell$1:function(a){for(var b=0,c=a.length;b<c;b++)if(a[b].get_selected())return b;return-1},
_synchronizeAllSeries$1:function(){for(var a={},b=-1,c,d=ss.IEnumerator.getEnumerator(Object.keys(a));d.moveNext();)c=a[d.current],1<c.length&&(b=this._findSelectedCell$1(c),-1!==b?this._medicalViewer$1.synchronizeSeries(c[b]):this._medicalViewer$1.synchronizeSeries(c[0]))},withinVisibleRange:function(a){var b=this.get_currentOffset(),c=Math.min(this.get_frames().get_count(),b+this.get_imageViewer().get_items().get_count());if(null!=this._framesMappingIndex){for(var d=0,d=b;d<c;d++)if(this._framesMappingIndex[d]===
a)return!0;return!1}return a>=b&&a<c},_alignSeries$1:function(a,b){a.get_frames().get_item(this.get_currentOffset());b.set_currentOffset(1)},_alignSeriesFunction$1:function(a,b){this._alignSeries$1(this,b);return!1},_registerPinchInteractiveMode$1:function(){if(lt.LTHelper.supportsMultiTouch){var a=new lt.Controls.Medical.PinchAction;this.setCommand(1E4,a);a.set_button(lt.Controls.MouseButtons.left);this.runCommand(1E4)}},_annRenderingEngine$1:null,_automation_Draw$1:function(a,b){Type.canCast(b.get_object(),
lt.Annotations.Core.AnnPolyRulerObject)&&b.get_object().set_measurementUnit(lt.Annotations.Core.AnnUnit.centimeter);b.get_object().set_fixedStateOperations(b.get_object().get_fixedStateOperations()|lt.Annotations.Core.AnnFixedStateOperations.strokeWidth)},_initialize$1:function(a,b,c,d){var e=new lt.Controls.ImageViewerCreateOptions(this.get_div()),f=new lt.Controls.Medical._imageViewerGridViewLayout(this);e.set_viewLayout(f);this._imageViewer$1=new lt.Controls.Medical.AutomationImageViewer(e,b);
this._imageViewer$1.add_itemChanged(ss.Delegate.create(this,this._imageViewer_ItemChanged$1));this._imageViewer$1.set_resizeOnTransform(!1);this._imageViewer$1.set_imageHorizontalAlignment(lt.Controls.ControlAlignment.near);this._imageViewer$1.set_imageVerticalAlignment(lt.Controls.ControlAlignment.near);this._imageViewer$1.add_postRenderItem(ss.Delegate.create(this,this._imageViewer_PostRender$1));this._imageViewer$1.add_preRenderItem(ss.Delegate.create(this,this._imageViewer_PreRenderItem$1));if(null==
this._automationManager$1){this._annRenderingEngine$1=new lt.Annotations.Rendering.AnnHtml5RenderingEngine;this._annRenderingEngine$1.add_loadPicture(ss.Delegate.create(this,this._annRenderingEngine_LoadPicture$1));this._automationManager$1=lt.Annotations.Automation.AnnAutomationManager.create(this._annRenderingEngine$1);this._automationManager$1.createDefaultObjects();this._automationManager$1.findObjectById(lt.Annotations.Core.AnnObject.textObjectId).get_objectTemplate().set_fixedStateOperations(lt.Annotations.Core.AnnFixedStateOperations.fontSize);
this._automationManager$1.findObjectById(lt.Annotations.Core.AnnObject.polyRulerObjectId).get_objectTemplate().set_measurementUnit(lt.Annotations.Core.AnnUnit.millimeter);e=this._automationManager$1.findObjectById(lt.Annotations.Core.AnnObject.protractorObjectId).get_objectTemplate();e.set_measurementUnit(lt.Annotations.Core.AnnUnit.millimeter);e.set_showTickMarks(!1);e.set_showGauge(!1);this._automation$1=new lt.Annotations.Automation.AnnAutomation(this._automationManager$1,this._imageViewer$1);
this._automation$1.set_active(!0);this._automation$1.add_draw(ss.Delegate.create(this,this._automation_Draw$1));this._automation$1.get_containers().clear();this._imageViewer$1.set_scrollMode(lt.Controls.ControlScrollMode.hidden);this._referenceLines$1=new lt.Controls.Medical._seriesReferenceLines;this.set_divID(b);this._imageViewer$1.get_items().add_collectionChanged(ss.Delegate.create(this,this._items_CollectionChanged$1));this._frames$1=new lt.Controls.Medical.LeadCollection;this._frames$1.add_collectionChanged(ss.Delegate.create(this,
this._frames_CollectionChanged$1));this._preview$1=[];this._overlays$1=new lt.Controls.Medical.LeadCollection;this._overlays$1.add_collectionChanged(ss.Delegate.create(this,this._overlays_CollectionChanged$1));this._parentDivID$1=a;a=document.getElementById(this._parentDivID$1);null!=a&&a.appendChild(this.get_div());if(c&&d){a=0;b=c*d;this._imageViewer$1.beginUpdate();this._imageViewer$1.beginRender();for(a=0;a<b;a++)e=this._setGridNormalized$1(c,d,a),this._addSubCell$1(e.get_left(),e.get_top(),e.get_width(),
e.get_height());this._imageViewer$1.endUpdate();this._imageViewer$1.endRender()}this._imageViewer$1.beginUpdate();for(c=ss.IEnumerator.getEnumerator(this._imageViewer$1.get_items());c.moveNext();)c.current.onSizeChanged();this._imageViewer$1.endUpdate();this._registerPinchInteractiveMode$1();this._ipadWorkAround$1()}},_annRenderingEngine_LoadPicture$1:function(){this._automation$1.invalidate(lt.LeadRectD.get_empty())},_imageViewer_ItemChanged$1:function(a,b){switch(b.get_reason()){case lt.Controls.ImageViewerItemChangedReason.url:var c=
b.get_item();c._imageURLCompleted(c,lt.LeadEventArgs.Empty);break;case lt.Controls.ImageViewerItemChangedReason.transform:Type.canCast(b.get_item(),lt.Controls.Medical.MRTISubCell)&&(c=b.get_item(),c._onTransformChanged())}},_imageViewer_PreRenderItem$1:function(a,b){var c=b.get_item(),d=this._imageViewer$1.getItemViewBounds(c,lt.Controls.ImageViewerItemPart.view,!1);d.get_isEmpty()||(b.get_context().save(),b.get_context().fillStyle=c.get_backColor(),b.get_context().fillRect(d.get_left(),d.get_top(),
d.get_width(),d.get_height()),b.get_context().restore())},_overlays_CollectionChanged$1:function(){for(var a=0,b=this._imageViewer$1.get_items().get_count(),a=0;a<b;a++){var c=this._imageViewer$1.get_items().get_item(a);c.onSizeChanged();c._reRenderOverlay()}},_frames_CollectionChanged$1:function(a,b){if(1===b.get_action()){for(var c=0,d=b.newItems.length,e,f,g;c<d;c++)f=b.newItems[c],e=this._frames$1.indexOf(f),g=null==this._framesMappingIndex?e:this._framesMappingIndex[e],this.withinVisibleRange(e)&&
(e=this._imageViewer$1.get_items().get_item(g-this._currentOffset$1),f._attach(e));null!=this._progress$1&&this._progress$1.set_totalFrames(this._frames$1.get_count());for(c=c=0;c<this._imageViewer$1.get_items().get_count();c++)d=this._imageViewer$1.get_items().get_item(c),d._updateTag(4)}else if(3===b.get_action()||!b.get_action()){c=0;for(d=b.newItems.length;c<d;c++)f=b.newItems[c],f._attach(null),f.dispose();null!=this._progress$1&&this._progress$1.set_totalFrames(this._frames$1.get_count());for(c=
0;c<this._imageViewer$1.get_items().get_count();c++)d=this._imageViewer$1.get_items().get_item(c),d._updateTag(4)}},_layoutGrid$1:function(){for(var a=0,b=this._imageViewer$1.get_items().get_count(),a=0;a<b;a++){var c=this._setGridNormalized$1(this._gridLayout$1.get_rows(),this._gridLayout$1.get_columns(),a);this._imageViewer$1.get_items().get_item(a).set__internalBounds(c)}},_fromLRTB$1:function(a,b,c,d){return lt.LeadRectD.create(a,b,c-a,d-b)},_createCustomLayout$1:function(a){this._imageViewer$1.beginUpdate();
var b=[];this._gridLayout$1.get_value1()&&b.add(this._gridLayout$1.get_value1());this._gridLayout$1.get_value2()&&b.add(this._gridLayout$1.get_value2());this._gridLayout$1.get_value3()&&b.add(this._gridLayout$1.get_value3());this._gridLayout$1.get_value4()&&b.add(this._gridLayout$1.get_value4());for(var c=b.length,d=0,e=0,f=0,g;e<c;e++)for(var h=b[e],d=0;d<h;d++)g=2===a?this._fromLRTB$1(d/h,e/c,(d+1)/h,(e+1)/c):this._fromLRTB$1(e/c,d/h,(e+1)/c,(d+1)/h),this._imageViewer$1.get_items().get_item(f).set__internalBounds(g),
f++;this._imageViewer$1.endUpdate()},_layoutCell:function(a,b){switch(this._arrangment$1){case 0:this._layoutGrid$1();break;case 2:case 3:this._createCustomLayout$1(this._arrangment$1)}for(var c=0,d=this._borderThickness$1+2,c=0;c<this._imageViewer$1.get_items().get_count();c++){var e=this._imageViewer$1.get_items().get_item(c);b[c]=lt.LeadRectD.create(e.get_bounds().get_left()*a.get_width()+d,e.get_bounds().get_top()*a.get_height()+d,e.get_bounds().get_width()*a.get_width()-(d<<1),e.get_bounds().get_height()*
a.get_height()-(d<<1))}},updateSubCellCount:function(a){var b=this._imageViewer$1.get_items().get_count();this._imageViewer$1.beginUpdate();this.set_currentOffset(Math.min(Math.max(0,this.get_currentOffset()),Math.max(0,this.get_frames().get_count()-a)));if(a>b)for(;b<a;b++)this._addSubCell$1(0,0,0,0);else for(;b>a;b--)this._deleteSubCell$1(b-1);if(a)this.get_viewer().onSizeChanged();this._imageViewer$1.endUpdate()},_setGridNormalized$1:function(a,b,c){var d=parseInt(c/b>>0),c=c-d*b,e=c/b,f=d/a,a=
(d+1)/a;return lt.LeadRectD.create(e,f,Math.max(0,(c+1)/b-e),Math.max(0,a-f))},_divElementW$1:null,_dummySubCell$1:null,_ipadOnSizeChanged$1:function(){this._divElementW$1.style.left="0px";this._divElementW$1.style.top="0px";this._divElementW$1.style.width="0px";this._divElementW$1.style.height="0px"===this._divElementW$1.style.height?"1px":"0px";this._divElementW$1.style.position="absolute";this._dummySubCell$1.onSizeChanged()},_ipadWorkAround$1:function(){this._divElementW$1=document.createElement("div");
this.get_div().appendChild(this._divElementW$1);this.get_div().style.zIndex=2;this._divElementW$1.id=this.get_div().id+"_dummy_subCell_Div";this._dummySubCell$1=new lt.Controls.Medical.SubCell(this,"dummySubCell")},_imageViewer$1:null,get_imageViewer:function(){return this._imageViewer$1},set_imageViewer:function(a){return this._imageViewer$1=a},_updateViewerIndexes$1:function(){for(var a=0,b=ss.IEnumerator.getEnumerator(this._imageViewer$1.get_items());b.moveNext();)b.current.get_div().setAttribute("viewerIndex",
a++)},_items_CollectionChanged$1:function(a,b){this._updateViewerIndexes$1();if(b.get_action()===lt.NotifyLeadCollectionChangedAction.add){for(var c=0,d=b.get_newItems().length;c<d;c++){var e=b.get_newItems()[c],f=this._imageViewer$1.get_items().indexOf(e),g=e.get_div();this.get_div().appendChild(g);this._onSubCellAdded$1(e);this._referenceLines$1.frames.add(new lt.Controls.Medical._frameReferenceLines);this._currentOffset$1+f<this._frames$1.get_count()&&(f=this._frames$1.get_item(null==this._framesMappingIndex?
this._currentOffset$1+f:this._framesMappingIndex[this._currentOffset$1+f]),null!=f&&(f._attach(e),f._drawImage()))}this._imageViewer$1.onSizeChanged()}else{c=0;for(d=b.get_newItems().length;c<d;c++)e=b.get_newItems()[c],null!=e.get_attachedFrame()&&e.get_attachedFrame()._attach(null)}},_refresh$1:function(){this.invalidate()},get_viewer:function(){return this._medicalViewer$1},get_gridLayout:function(){return this._gridLayout$1},get_progress:function(){return this._progress$1},set_progress:function(a){return this._progress$1=
a},_windowLevel$1:null,_subCellClickedFunction$1:null,_doubleClickFunction$1:null,_cellOffset$1:null,_hitTestItem$1:function(a,b){for(var c,d=null,e=null,f=lt.LeadPointD.create(a,b),g=0;g<this._imageViewer$1.get_items().get_count();g++)if(d=this._imageViewer$1.get_items().get_item(g),c=this._imageViewer$1.getItemViewBounds(d,lt.Controls.ImageViewerItemPart.view,!1),c.containsPoint(f)){e=d;break}return e},_deselectOthers$1:function(){this.get_parent().get_selectedItems().clear()},_getPosition$1:function(a){var b=
0,c=0;void 0!=a.targetTouches?(b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY):(b=a.clientX,c=a.clientY);return lt.LeadPointD.create(b-this._cellOffset$1.get_x(),c-this._cellOffset$1.get_y())},_touchCount$1:0,_firstClickTime$1:0,_doubleTapInterval$1:400,_mousePosX$1:0,_mousePosY$1:0,_hitTestBuffer$1:50,_checkDoubleTouch$1:function(a,b){var c=1;void 0!=a.touches?c=a.touches.length:void 0!=a.targetTouches&&(c=a.targetTouches.length);if(1===c)if(c=Date.get_now().getTime(),this._touchCount$1++,
1<this._touchCount$1)if(c-this._firstClickTime$1<this._doubleTapInterval$1){var d=c=this._touchCount$1=0,c=Math.abs(this._mousePosX$1-b.get_x()),d=Math.abs(this._mousePosY$1-b.get_y());if(c<this._hitTestBuffer$1&&d<this._hitTestBuffer$1)return this._doubleClicked$1(a),!0}else this._touchCount$1=1,this._firstClickTime$1=c,this._mousePosX$1=parseInt(b.get_x()),this._mousePosY$1=parseInt(b.get_y());else this._touchCount$1++,this._firstClickTime$1=Date.get_now().getTime(),this._mousePosX$1=parseInt(b.get_x()),
this._mousePosY$1=parseInt(b.get_y());return!1},_subCell_TouchUp$1:function(){},_isOverRetakeButton$1:function(a,b){if(null==a)return!1;var c=this._imageViewer$1.getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1),d=Math.max(20,Math.min(c.get_width(),c.get_height())/10);return lt.LeadRectD.create(c.get_width()-d,c.get_height()-d,d,d).containsPoint(b)?!0:!1},_subCell_Clicked$1:function(a){var b=this._getPosition$1(a),c=!1,d=this._hitTestItem$1(parseInt(b.get_x()),parseInt(b.get_y()));d.get_attachedFrame().get_container().set_isEnabled(!0);
if((c=this._isOverRetakeButton$1(d,b))||!this._checkDoubleTouch$1(a,b)){this._medicalViewer$1.get_emptyDivs().get_selectedItems().clear();for(var a=this.get_selectedItem(),b=0,e=this._imageViewer$1.get_items().get_count(),f,b=0;b<e;b++)f=this._imageViewer$1.get_items().get_item(b),f!==d&&null!=f.get_attachedFrame()&&f.get_attachedFrame().get_container().get_isEnabled()&&f.get_attachedFrame().get_container().set_isEnabled(!1);b=!0;a===d&&(b=!1);null!=d&&(null!=this.get_selectedItems()&&this.get_selectedItems().clear(),
this.set_selectedItem(d),a=d.get_attachedFrame(),null!=a&&(this._automation$1.set_activeContainer(d.get_attachedFrame().get_container()),c&&a.set_retakeIndex(a.get_retakeIndex()+1)));this._fireEvent(null,1,null);1<this.get_parent().get_selectedItems().get_count()&&this._deselectOthers$1();-1===this.get_parent().get_selectedItems().indexOf(this)?this.set_selected(!0):b&&this.get_imageViewer().invalidate(lt.LeadRectD.get_empty())}},_subCell_DoubleClicked$1:function(a){a.preventDefault();a.stopImmediatePropagation()},
_doubleClicked$1:function(a){var b=this._getPosition$1(a),a=this._hitTestItem$1(parseInt(b.get_x()),parseInt(b.get_y()));if(null!=a){var c=a.get_attachedFrame();if(null!=c)if(a=this._automation$1.get_currentDesigner(),c=c.get_container(),b=lt.LeadPointD.create(parseInt(b.get_x()),parseInt(b.get_y())),b=c.hitTestPoint(c.get_mapper().pointToContainerCoordinates(b)),(null==b||1>b.length)&&null==a)this._medicalViewer$1.explode(this,!this._medicalViewer$1.get_exploded());else if(lt.LTHelper.supportsTouch&&
!lt.LTHelper.supportsMouse)this.get_imageViewer().onAutomationDoubleClick(lt.Annotations.Core.AnnPointerEventArgs.create(lt.Annotations.Core.AnnMouseButton.left,lt.LeadPointD.get_empty()))}},get_windowLevel:function(){return this._windowLevel$1},set_windowLevel:function(a){return this._windowLevel$1=a},_layoutFrames$1:function(){},_deleteSubCell$1:function(a){var b=this._imageViewer$1.get_items().get_item(a);null!=b.get_attachedFrame()&&b.get_attachedFrame()._attach(null);this._onSubCellDeleted$1(b,
a+this.get_currentOffset());try{this._imageViewer$1.get_items().remove(b)}catch(c){}try{b.dispose()}catch(d){}},_addSubCell$1:function(a,b,c,d){var e=this._imageViewer$1.get_items().get_count(),e=new lt.Controls.Medical.MRTISubCell(this,this.get_div().id+"_div_"+e.toString());e.set_imageHorizontalAlignment(lt.Controls.ControlAlignment.near);e.set_imageVerticalAlignment(lt.Controls.ControlAlignment.near);e.set_resizeOnTransform(!1);e.get_div().setAttribute("draggable",!0);e.get_div().setAttribute("draggable",
!0);e.set_bounds(lt.LeadRectD.create(a,b,c,d));this._imageViewer$1.set_enableRequestAnimationFrame(lt.LTHelper.device!==lt.LTDevice.desktop);this._imageViewer$1.get_items().insert(this._imageViewer$1.get_items().get_count(),e);e.get_overlayCanvas().style.visibility=this._tagVisiblity$1?"visible":"hidden";e.onSizeChanged()},_onSubCellAdded$1:function(){},_onSubCellDeleted$1:function(){},_drawCrossHairLines$1:!0,get_drawCrossHairLines:function(){return this._drawCrossHairLines$1},set_drawCrossHairLines:function(a){return this._drawCrossHairLines$1=
a},_drawVertical$1:function(a,b,c,d,e,f,g){var h=Math.min(a.get_height(),a.get_width())/12,f=(parseInt(f)>>0)*b.get_width()/c.get_width()+b.get_left(),g=(parseInt(g)>>0)*b.get_height()/c.get_height()+b.get_top();d.save();d.beginPath();d.strokeStyle="yellow";d.moveTo(f,e);d.lineTo(f,g-h/2);d.moveTo(f,g+h/2);d.lineTo(f,a.get_bottom());d.stroke();d.restore()},_drawHorizontal$1:function(a,b,c,d,e,f,g){f=(parseInt(f)>>0)*b.get_width()/c.get_width()+b.get_left();g=(parseInt(g)>>0)*b.get_height()/c.get_height()+
b.get_top();b=Math.min(a.get_height(),a.get_width())/12;d.save();d.beginPath();d.strokeStyle="yellow";d.moveTo(e,g);d.lineTo(parseInt(f-b/2)>>0,g);d.moveTo(parseInt(f)+b/2>>0,g);d.lineTo(a.get_width(),g);d.stroke();d.restore()},_drawCrossHair$1:function(a,b){var c=this._imageViewer$1.getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1),d=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this._imageViewer$1,a),e=a.get_attachedFrame();this._drawVertical$1(c,d,e,b,c.get_left(),this._crossHairPosition$1.get_x(),
this._crossHairPosition$1.get_y());this._drawHorizontal$1(c,d,e,b,c.get_left(),this._crossHairPosition$1.get_x(),this._crossHairPosition$1.get_y())},_imageViewer_PostRender$1:function(a,b){var c=b.get_item();if(null!=c){var d=this._imageViewer$1.getItemViewBounds(c,lt.Controls.ImageViewerItemPart.image,!1),e=c.get_imageViewer().get_items().indexOf(c),f=this._imageViewer$1.getItemViewBounds(c,lt.Controls.ImageViewerItemPart.view,!1),g=this._imageViewer$1.getViewBounds(!1,!1),h=b.get_context(),i=this._imageViewer$1.get_items().get_item(e);
if(null!=i){if(Type.canCast(i.get_parentCell(),lt.Controls.Medical.MPRCell)){h.save();var j=i.get_parentCell();h.clearRect(0,0,f.get_width(),f.get_height());h.setTransform(1,0,0,1,0,0);var k=this._imageViewer$1.getItemImageFloatingPointTransform(i);h.transform(k.get_m11(),k.get_m12(),k.get_m21(),k.get_m22(),k.get_offsetX(),k.get_offsetY());h.drawImage(j.mprImage,0,0,j.mprImage.width,j.mprImage.height);h.setTransform(1,0,0,1,0,0);h.restore()}else if(Type.canCast(i,lt.Controls.Medical.MRTISubCell)){Date.get_now().getTime();
h.save();h.rect(f.get_x(),f.get_y(),f.get_width()-1,f.get_height()-1);h.clip();h.translate(f.get_x(),f.get_y());try{i.clearUnnecessaryChunks(),i.paintTiles(h)}catch(l){}h.restore();lt.Controls.Medical.Tools._forDebug&&(h.beginPath(),h.strokeStyle="blue",h.rect((f.get_right()+f.get_left())/2-10,(f.get_bottom()+f.get_top())/2-10,20,20),h.stroke());Date.get_now().getTime()}d.get_isEmpty()||this._drawReferenceLine$1(c,h,f,d,e);(this._showFrameBorder$1||-1!==this.get_selectedItems().indexOf(c))&&this._drawCellBorder$1(c,
h,f,parseInt(f.get_left()),parseInt(f.get_top()));this._drawCrossHairLines$1&&(Type.canCast(this,lt.Controls.Medical.MPRCell)||this.get_children().get_count())&&this._drawCrossHair$1(c,h,parseInt(f.get_left()),parseInt(f.get_top()));(null==i.get_attachedFrame()||i.get_attachedFrame().get_enableDraw())&&null!=this._progress$1&&this._progress$1.draw(h,g);null!=this.__postRender$1&&this.__postRender$1(c,new lt.Controls.ImageViewerRenderEventArgs(h,d))}}},_getBorderColor$1:function(a){var b="",a=this.get_selectedItems().indexOf(a);
return b=this.get_selected()?1<this._imageViewer$1.get_items().get_count()?-1!==a?this._highlightedSubCellBorderColor$1:this._selectedSubCellBorderColor$1:this._selectedBorderColor$1:this._unselectedBorderColor$1},_drawCellBorder$1:function(a,b,c,d,e){a=this._getBorderColor$1(a);b.beginPath();b.strokeStyle=a;b.lineWidth=this._borderThickness$1;b.rect(d-(this._borderThickness$1>>1),e-(this._borderThickness$1>>1),c.get_width()+this._borderThickness$1,c.get_height()+this._borderThickness$1);b.stroke()},
_borderThickness$1:2,get_borderThickness:function(){return this._borderThickness$1},set_borderThickness:function(a){if(1===(a&1))throw Error("the border thickness value must be an even number (2, 4, 6....etc)");return this._borderThickness$1=a},_applyReferenceLineTransformation$1:function(a,b){var c=lt.Controls.Medical.ReferenceLine.rotate(b,parseInt(a.get_rotateAngle()),parseInt(a.get_imageSize().get_width()),parseInt(a.get_imageSize().get_height()));a.get_flip()&&(c=lt.Controls.Medical.ReferenceLine.flip(c,
parseInt(a.get_imageSize().get_width()),parseInt(a.get_imageSize().get_height())));a.get_reverse()&&(c=lt.Controls.Medical.ReferenceLine.reverse(c,parseInt(a.get_imageSize().get_width()),parseInt(a.get_imageSize().get_height())));return c},_createViewLine$1:function(a,b,c,d){return new lt.Controls.Medical.LeadLine(a.point1.get_x()*c+b.get_left(),a.point1.get_y()*d+b.get_top(),a.point2.get_x()*c+b.get_left(),a.point2.get_y()*d+b.get_top())},_doDrawLine$1:function(a,b,c,d,e,f,g,h){if(b.point2.get_x()-
b.point1.get_x()||b.point2.get_y()-b.point1.get_y())a.save(),a.beginPath(),a.lineWidth=2,a.strokeStyle=h,a.font="9pt Arial",a.fillStyle="white",b=this._createViewLine$1(b,e,f,g),lt.Controls.Medical.ReferenceLine.draw(a,d,e,b,c),a.stroke(),a.restore()},_drawReferenceLine$1:function(a,b,c,d,e){if(this._referenceLines$1.show){var e=this._referenceLines$1.frames[e],f=d.get_width()/a.get_imageSize().get_width(),g=d.get_height()/a.get_imageSize().get_height(),h=this._medicalViewer$1.get_showReferenceLine();
if(this._medicalViewer$1.get_showFirstAndLastReferenceLine()){if(e.line.text!==e.firstLine.text||!h){var i=this._applyReferenceLineTransformation$1(a,e.firstLine.line);this._doDrawLine$1(b,i,e.firstLine.text,c,d,f,g,"#0000e7")}if(e.line.text!==e.lastLine.text||!h)i=this._applyReferenceLineTransformation$1(a,e.lastLine.line),this._doDrawLine$1(b,i,e.lastLine.text,c,d,f,g,"#0000e7")}h&&(i=this._applyReferenceLineTransformation$1(a,e.line.line),this._doDrawLine$1(b,i,e.line.text,c,d,f,g,"#e7e7e7"))}},
_scrollToTop$1:function(){$(window).scrollTop(0)},_getCurrentStackIndex$1:function(){return this.get_currentOffset()},_onViewerSizeChanged$1:function(a){a.get_imageViewer().get_items().indexOf(a);a.get_imageViewer().get_foreCanvas();this._scrollToTop$1();this._getCurrentStackIndex$1()},get_arrangment:function(){return this._arrangment$1},set_arrangment:function(a){if(this._arrangment$1!==a)if(this._arrangment$1=a){if(2===this.get_arrangment()||3===this.get_arrangment())this.get_imageViewer().beginUpdate(),
this.updateSubCellCount(this._gridLayout$1.get_value1()+this._gridLayout$1.get_value2()+this._gridLayout$1.get_value3()+this._gridLayout$1.get_value4()),this.get_viewer().onSizeChanged(),this.get_imageViewer().endUpdate()}else this.updateSubCellCount(this._gridLayout$1.get_rows()*this._gridLayout$1.get_columns()),this.get_viewer().onSizeChanged();return a},get_showFrameBorder:function(){return this._showFrameBorder$1},set_showFrameBorder:function(a){this._showFrameBorder$1=a;this._refresh$1();return a},
_crossHairPosition$1:null,get__crossHairPosition:function(){return this._crossHairPosition$1},set__crossHairPosition:function(a){return this._crossHairPosition$1=a},_allowUpdateCrossHair$1:!0,get__allowUpdateCrossHair:function(){return this._allowUpdateCrossHair$1},set__allowUpdateCrossHair:function(a){return this._allowUpdateCrossHair$1=a},_updateCrossHair$1:function(){if(Type.canCast(this,lt.Controls.Medical.MPRCell))this.get_generator();else if(!this.get_children().get_count())return;null!=this._crossHairPosition$1&&
lt.Controls.Medical.CrossHairInteractiveMode.scrollCrossHair(this,this._crossHairPosition$1.get_x(),this._crossHairPosition$1.get_y())},get_currentOffset:function(){return this._currentOffset$1},set_currentOffset:function(a){var b=Math.min(this._maximumAllowed$1(),Math.max(0,a));if(b===a){if(this._currentOffset$1===b)return;var c=this._currentOffset$1;this._currentOffset$1=b;this._updateCrossHair$1();this._updateOffset$1(c)}else this._currentOffset$1=a,null!=this.__outOfBounds$1&&this.__outOfBounds$1(this,
lt.LeadEventArgs.Empty);null!=this.__currentOffsetChanged$1&&this.__currentOffsetChanged$1(this,lt.LeadEventArgs.Empty);return a},_findWindowLevelInteractiveMode$1:function(a){for(var b=0,c=a.get_imageViewer().get_interactiveModes().get_count();b<c;b++)if(Type.canCast(a.get_imageViewer().get_interactiveModes().get_item(b),lt.Controls.Medical.WindowLevelInteractiveMode))return a.get_imageViewer().get_interactiveModes().get_item(b);return null},_maximumAllowed$1:function(){return Math.max(0,this._frames$1.get_count()-
this._imageViewer$1.get_items().get_count())},_scroll$1:function(){for(var a=0,b,c,d=this._imageViewer$1.get_items().get_count(),a=0;a<d;a++)b=this._imageViewer$1.get_items().get_item(a),c=b.get_attachedFrame(),null!=c&&c._attach(null);for(a=0;a<d;a++)b=this._imageViewer$1.get_items().get_item(a),c=null==this._framesMappingIndex?this._currentOffset$1+a:this._framesMappingIndex[this._currentOffset$1+a],c=this._frames$1.get_item(c),null!=c&&this._updateFrameWithSubCell(c,b)},_updateFrameWithSubCell:function(a,
b){b.get_imageViewer().beginTransform();a._attach(b);var c,d,e;null!=a.get__orientationOverlay()?(c=(a.get_rotateAngle()+a.get__orientationOverlay().projectionRrotateAngle)%360,d=1===(a.get_flipped()^a.get__orientationOverlay().projectionIsFlipped),e=1===(a.get_reversed()^a.get__orientationOverlay().projectionIsReversed)):(c=a.get_rotateAngle()%360,d=a.get_flipped(),e=a.get_reversed());null!=a.get__orientationOverlay()&&(a.get__orientationOverlay().set_rotateAngle(c),a.get__orientationOverlay().set_flip(d),
a.get__orientationOverlay().set_reverse(e));this._suspednedCalculation$1||this._medicalViewer$1.get_showReferenceLine()&&this._medicalViewer$1._recalculate();b.updateOverlay();a._drawImage();b.invalidate();a._updateAnnotationContainerSize();this.get_automation().set_activeContainer(a.get_container());b.get_imageViewer().endTransform()},_updateOffset$1:function(a){this._imageViewer$1.get_items().get_count();this._scroll$1(a);this._medicalViewer$1.get_enableSynchronization()&&this._medicalViewer$1.synchronizeSeries(this);
null!=this.__scrollChanged$1&&this.__scrollChanged$1(this,new lt.Controls.Medical.ScrollChangedEventArgs(a,this._currentOffset$1))},_framesMappingIndex:null,get_framesMappingIndex:function(){return this._framesMappingIndex},set_framesMappingIndex:function(a){this._framesMappingIndex=a;this._frames$1.get_count()&&this._scroll$1(0);return a},get_frames:function(){return this._frames$1},get_overlays:function(){return this._overlays$1},invalidate:function(){this._imageViewer$1.invalidate(lt.LeadRectD.get_empty())},
add_dispoing:function(a){this.__dispoing$1=ss.Delegate.combine(this.__dispoing$1,a)},remove_dispoing:function(a){this.__dispoing$1=ss.Delegate.remove(this.__dispoing$1,a)},__dispoing$1_handler_get:function(){null==this.__dispoing$1_handler&&(this.__dispoing$1_handler=ss.EventHandler.create(this,this.add_dispoing,this.remove_dispoing));return this.__dispoing$1_handler},__dispoing$1:null,__dispoing$1_handler:null,dispose:function(){null!=this.__dispoing$1&&this.__dispoing$1(this,lt.LeadEventArgs.Empty);
var a=this.get_div();!lt.LTHelper.supportsMouse&&!lt.LTHelper.msPointerEnabled&&a.removeEventListener("touchstart",this._subCellClickedFunction$1,!1);lt.LTHelper.msPointerEnabled?a.removeEventListener("MSPointerDown",this._subCellClickedFunction$1,!1):a.removeEventListener("mousedown",this._subCellClickedFunction$1,!1);lt.LTHelper.supportsMouse&&a.removeEventListener("dblclick",this._doubleClickFunction$1,!1);try{-1!==this._medicalViewer$1.layout.get_items().indexOf(this)&&this._medicalViewer$1.layout.get_items().remove(this)}catch(b){}this._automationManager$1=
null;this._automation$1.detach();this._automation$1.get_containers().clear();this._automation$1.remove_draw(ss.Delegate.create(this,this._automation_Draw$1));this._frames$1.clear();a=0;for(a=this._imageViewer$1.get_items().get_count()-1;0<=a;a--)this._imageViewer$1.get_items().get_item(a),this._deleteSubCell$1(a);document.getElementById(this.get_divID()).style.visibility="hidden";this._parentDivID$1&&document.getElementById(this._parentDivID$1).removeChild(this.get_div());this.get_div().id="";this._imageViewer$1.get_items().remove_collectionChanged(ss.Delegate.create(this,
this._items_CollectionChanged$1))},_diposeItem$1:function(a){delete a},_getNumberOfViewers:function(){return this._imageViewer$1.get_items().get_count()},_getViewer:function(a){return this._imageViewer$1.get_items().get_item(a)},_clearImage$1:function(){for(var a,b=0,c=this._imageViewer$1.get_items().get_count(),b=0;b<c&&!(a=this._imageViewer$1.get_items().get_item(b),a=a.get_userData(),null!=a&&(a=a.get_imageSize(),0>=a.get_width()||0>=a.get_height()));b++);},_invertCanvas$1:function(a,b,c){for(var d=
a.getImageData(0,0,b,c),e=d.data,b=4*b*c,c=0;c<b;c+=4)e[c]=255-e[c],e[c+1]=255-e[c+1],e[c+2]=255-e[c+2];a.putImageData(d,0,0)},supportWindowLevel:function(a){return null==this._frames$1||0>a||a>=this._frames$1.get_count()?!1:this._frames$1.get_item(a)._supportWindowLevel()},_getUseCanvasData:function(){return!1},onSizeChanged:function(){lt.Controls.Medical.Cell.callBaseMethod(this,"onSizeChanged");if(!this._beginUpdate$1){if(null!=this._imageViewer$1)this._imageViewer$1.onSizeChanged();this._imageViewer$1.beginRender();
this._imageViewer$1.beginUpdate();this._imageViewer$1.endUpdate();this._imageViewer$1.endRender();this._imageViewer$1.beginRender();this._imageViewer$1.beginUpdate();for(var a=ss.IEnumerator.getEnumerator(this._imageViewer$1.get_items());a.moveNext();)a.current.onSizeChanged();this._imageViewer$1.endUpdate();this._imageViewer$1.endRender();this._ipadOnSizeChanged$1();this._cellOffset$1=lt.LTHelper.getPosition(this.get_div(),null);null!=this.__sizeChanged$1&&this.__sizeChanged$1(this,lt.LeadEventArgs.Empty)}}};
Object.defineProperty(lt.Controls.Medical.Cell.prototype,"outOfBounds",{get:lt.Controls.Medical.Cell.prototype.__outOfBounds$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"currentOffsetChanged",{get:lt.Controls.Medical.Cell.prototype.__currentOffsetChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"cellClicked",{get:lt.Controls.Medical.Cell.prototype.__cellClicked$1_handler_get,enumerable:!0,
configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"imageURLChanged",{get:lt.Controls.Medical.Cell.prototype.__imageURLChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"postRender",{get:lt.Controls.Medical.Cell.prototype.__postRender$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"sizeChanged",{get:lt.Controls.Medical.Cell.prototype.__sizeChanged$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"scrollChanged",{get:lt.Controls.Medical.Cell.prototype.__scrollChanged$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"progressCompleted",{get:lt.Controls.Medical.Cell.prototype.__progressCompleted$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"imageProcessingReady",{get:lt.Controls.Medical.Cell.prototype.__imageProcessingReady$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"mprType",{get:lt.Controls.Medical.Cell.prototype.get_mprType,set:lt.Controls.Medical.Cell.prototype.set_mprType,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"children",{get:lt.Controls.Medical.Cell.prototype.get_children,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"selectedItems",{get:lt.Controls.Medical.Cell.prototype.get_selectedItems,
set:lt.Controls.Medical.Cell.prototype.set_selectedItems,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"selectedItem",{get:lt.Controls.Medical.Cell.prototype.get_selectedItem,set:lt.Controls.Medical.Cell.prototype.set_selectedItem,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"automationManager",{get:lt.Controls.Medical.Cell.prototype.get_automationManager,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,
"automation",{get:lt.Controls.Medical.Cell.prototype.get_automation,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"selectedBorderColor",{get:lt.Controls.Medical.Cell.prototype.get_selectedBorderColor,set:lt.Controls.Medical.Cell.prototype.set_selectedBorderColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"unselectedBorderColor",{get:lt.Controls.Medical.Cell.prototype.get_unselectedBorderColor,set:lt.Controls.Medical.Cell.prototype.set_unselectedBorderColor,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"selectedSubCellBorderColor",{get:lt.Controls.Medical.Cell.prototype.get_selectedSubCellBorderColor,set:lt.Controls.Medical.Cell.prototype.set_selectedSubCellBorderColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"highlightedSubCellBorderColor",{get:lt.Controls.Medical.Cell.prototype.get_highlightedSubCellBorderColor,set:lt.Controls.Medical.Cell.prototype.set_highlightedSubCellBorderColor,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"useBackCanvas",{get:lt.Controls.Medical.Cell.prototype.get_useBackCanvas,set:lt.Controls.Medical.Cell.prototype.set_useBackCanvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"overlayTextVisible",{get:lt.Controls.Medical.Cell.prototype.get_overlayTextVisible,set:lt.Controls.Medical.Cell.prototype.set_overlayTextVisible,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,
"seriesNumber",{get:lt.Controls.Medical.Cell.prototype.get_seriesNumber,set:lt.Controls.Medical.Cell.prototype.set_seriesNumber,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"patientName",{get:lt.Controls.Medical.Cell.prototype.get_patientName,set:lt.Controls.Medical.Cell.prototype.set_patientName,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"seriesInstanceUID",{get:lt.Controls.Medical.Cell.prototype.get_seriesInstanceUID,
set:lt.Controls.Medical.Cell.prototype.set_seriesInstanceUID,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"frameOfReferenceUID",{get:lt.Controls.Medical.Cell.prototype.get_frameOfReferenceUID,set:lt.Controls.Medical.Cell.prototype.set_frameOfReferenceUID,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"position",{get:lt.Controls.Medical.Cell.prototype.get_position,set:lt.Controls.Medical.Cell.prototype.set_position,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"rowPosition",{get:lt.Controls.Medical.Cell.prototype.get_rowPosition,set:lt.Controls.Medical.Cell.prototype.set_rowPosition,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"columnsPosition",{get:lt.Controls.Medical.Cell.prototype.get_columnsPosition,set:lt.Controls.Medical.Cell.prototype.set_columnsPosition,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,
"linked",{get:lt.Controls.Medical.Cell.prototype.get_linked,set:lt.Controls.Medical.Cell.prototype.set_linked,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"imageViewer",{get:lt.Controls.Medical.Cell.prototype.get_imageViewer,set:lt.Controls.Medical.Cell.prototype.set_imageViewer,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"viewer",{get:lt.Controls.Medical.Cell.prototype.get_viewer,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.Cell.prototype,"gridLayout",{get:lt.Controls.Medical.Cell.prototype.get_gridLayout,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"progress",{get:lt.Controls.Medical.Cell.prototype.get_progress,set:lt.Controls.Medical.Cell.prototype.set_progress,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"windowLevel",{get:lt.Controls.Medical.Cell.prototype.get_windowLevel,set:lt.Controls.Medical.Cell.prototype.set_windowLevel,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"drawCrossHairLines",{get:lt.Controls.Medical.Cell.prototype.get_drawCrossHairLines,set:lt.Controls.Medical.Cell.prototype.set_drawCrossHairLines,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"borderThickness",{get:lt.Controls.Medical.Cell.prototype.get_borderThickness,set:lt.Controls.Medical.Cell.prototype.set_borderThickness,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,
"arrangment",{get:lt.Controls.Medical.Cell.prototype.get_arrangment,set:lt.Controls.Medical.Cell.prototype.set_arrangment,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"showFrameBorder",{get:lt.Controls.Medical.Cell.prototype.get_showFrameBorder,set:lt.Controls.Medical.Cell.prototype.set_showFrameBorder,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"currentOffset",{get:lt.Controls.Medical.Cell.prototype.get_currentOffset,
set:lt.Controls.Medical.Cell.prototype.set_currentOffset,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"framesMappingIndex",{get:lt.Controls.Medical.Cell.prototype.get_framesMappingIndex,set:lt.Controls.Medical.Cell.prototype.set_framesMappingIndex,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"frames",{get:lt.Controls.Medical.Cell.prototype.get_frames,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,
"overlays",{get:lt.Controls.Medical.Cell.prototype.get_overlays,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Cell.prototype,"dispoing",{get:lt.Controls.Medical.Cell.prototype.__dispoing$1_handler_get,enumerable:!0,configurable:!0});lt.Controls.Medical._overlayInfo=function(a,b,c){this.alignment=a;this.rect=b;this.weight=c;this.visible=!0};lt.Controls.Medical._overlayInfo.prototype={alignment:0,rect:null,weight:0,visible:!1};lt.Controls.Medical._actionInfo=function(a,b){this.action=
a;this.actionObject=b};lt.Controls.Medical._actionInfo.prototype={action:null,actionObject:null};lt.Controls.Medical.SubCell=function(a,b){lt.Controls.Medical.SubCell.initializeBase(this);this._cell$1=a;this._parentDivId$1=a.get_divID();this._div$1=document.createElement("div");this._div$1.style.backgroundColor="#FFFFFF";this.set_divID(b);this._commandDictionary$1={};this._prepareImageViewer$1();this._prepareOverlayCanvas$1();this._initializeAnnotationCanvas$1(this._cell$1.get_imageViewer(),b)};lt.Controls.Medical.SubCell.prototype=
{_parentDivId$1:null,_cell$1:null,_overlayCanvas$1:null,_frame:null,_info$1:null,_commandDictionary$1:null,_backColor$1:"#0",get_backColor:function(){return this._backColor$1},set_backColor:function(a){this._backColor$1=a;this.invalidate();return a},_bounds$1:null,_selected$1:!1,_div$1:null,_divID$1:null,get__internalBounds:function(){return this._bounds$1},set__internalBounds:function(a){return this._bounds$1=a},get_bounds:function(){return this._bounds$1},set_bounds:function(a){this._bounds$1=a;
this.onSizeChanged();return a},get_selected:function(){return this._selected$1},set_selected:function(a){if(this._selected$1!==a)return this._selected$1=a},get_div:function(){return this._div$1},get_divID:function(){null!=this._div$1&&(this._divID$1=this._div$1.id);return this._divID$1},set_divID:function(a){this._divID$1=a;null!=this._div$1&&(this._div$1.id=a);return a},get_overlayCanvas:function(){return this._overlayCanvas$1},get_parentCell:function(){return this._cell$1},_forecolor$1:"#FFFFFF",
_overlayPadding$1:0,_clearOffset$1:0,_fontSize$1:0,_clearAttachedCanvases$1:function(){this._clearCanvas$1(this._overlayCanvas$1);this._clearCanvas$1(this._annotationCanvas$1)},_clearCanvas$1:function(a){a=a.getContext("2d");a.scale(1,1);a.clearRect(0,0,this._overlayCanvas$1.width,this._overlayCanvas$1.height)},get_foreColor:function(){return this._forecolor$1},set_foreColor:function(a){this._forecolor$1=a;this._renderOverlay$1();return a},add_frameAttached:function(a){this.__frameAttached$1=ss.Delegate.combine(this.__frameAttached$1,
a)},remove_frameAttached:function(a){this.__frameAttached$1=ss.Delegate.remove(this.__frameAttached$1,a)},__frameAttached$1_handler_get:function(){null==this.__frameAttached$1_handler&&(this.__frameAttached$1_handler=ss.EventHandler.create(this,this.add_frameAttached,this.remove_frameAttached));return this.__frameAttached$1_handler},__frameAttached$1:null,__frameAttached$1_handler:null,_onFrameAttached:function(a,b){var c=this.__frameAttached$1;null!=c&&c(this,new lt.Controls.Medical.FrameAttachedEventArgs(a,
b))},_reRenderOverlay:function(){this._clearCanvas$1(this._overlayCanvas$1);this._renderOverlay$1()},invalidate:function(){if(null!=this.get_imageViewer()){Type.canCast(this,lt.Controls.Medical.MRTISubCell)&&this._isPaintScheduled()&&this._cancelPaintSchedule();var a=this.get_imageViewer().getItemViewBounds(this,lt.Controls.ImageViewerItemPart.view,!1);this.get_imageViewer().invalidate(a)}},_updateOverlaySize$1:function(a,b){this._overlayCanvas$1.width=a;this._overlayCanvas$1.height=b;this._calculateOverlayTextSize$1(a,
b);this._findOverlayRectangles$1();this._renderOverlay$1()},_getOpposite$1:function(a){switch(a){case 0:return 2;case 1:return 3;case 2:return 0;case 3:return 1;default:return-1}},_overlappedOverlayTags$1:function(a,b,c){b=a[b].rect;a=a[c].rect;return b.get_top()>=a.get_top()&&b.get_top()<=a.get_bottom()||a.get_top()>=b.get_top()&&a.get_top()<=b.get_bottom()?!0:!1},_hideOverlappedTags$1:function(a,b,c){b=a[b];a=a[c];b.weight>a.weight?a.visible=!1:b.weight<a.weight?b.visible=!1:a.visible=!1},_findOverlayTag$1:function(){var a=
this._cell$1.get_overlays().get_count(),b,c;for(b=0;b<a;b++)if(c=this._cell$1.get_overlays().get_item(b),5===c.get_alignment())return c;return null},_findOverlayRectangles$1:function(){var a=this._cell$1.get_overlays().get_count(),b=this._findOverlayTag$1(5);this._info$1=Array(a);var c,d,e;for(c=0;c<a;c++)e=this._cell$1.get_overlays().get_item(c),this._info$1[c]=new lt.Controls.Medical._overlayInfo(e.get_alignment(),this._calculateRect$1(e,b),e.get_weight());e=!1;for(c=0;c<a;c++)if(d=this._info$1[c],
b=this._getOpposite$1(d.alignment),d.visible)for(d=0;d<a;d++)c!==d&&this._info$1[d].visible&&this._info$1[d].alignment===b&&this._overlappedOverlayTags$1(this._info$1,c,d)&&(this._hideOverlappedTags$1(this._info$1,c,d,e),e=!e)},_jumpOverCenter$1:function(a,b,c,d){if(null!=d)switch(a=this._getOverlayPosition$1(a,d,0),c.get_alignment()){case 0:case 1:b.get_y()+this._overlayPadding$1>=a.get_y()&&b.set_y(b.get_y()+(this._overlayPadding$1<<1));break;case 2:case 3:b.get_y()<=a.get_y()+this._overlayPadding$1&&
b.set_y(b.get_y()-(this._overlayPadding$1<<1))}return b},_calculateRect$1:function(a,b){var c=this._overlayCanvas$1.getContext("2d"),d=this._getOverlayPosition$1(c,a,0),d=this._jumpOverCenter$1(c,d,a,b);return lt.LeadRectD.create(d.get_x(),d.get_y(),0,this._overlayPadding$1)},_calculateOverlayTextSize$1:function(a,b){var c=Math.min(a,b<<1);this._overlayPadding$1=Math.min(24,Math.max(12,c/25));this._clearOffset$1=Math.min(5,Math.max(1,c/133));this._fontSize$1=Math.min(14,Math.max(6,c/45))},_cellMargin$1:8,
_getOverlayPosition$1:function(a,b,c){var d=this._cellMargin$1,e=this._cellMargin$1,f=this._overlayCanvas$1.width-d,g=this._overlayCanvas$1.height-e,c=c+b.get_positionIndex();switch(b.get_alignment()){case 0:e=this._cellMargin$1+c*this._overlayPadding$1;a.textAlign="left";a.textBaseline="top";break;case 1:d=f;e=this._cellMargin$1+c*this._overlayPadding$1;a.textAlign="right";a.textBaseline="top";break;case 2:e=g-(c+1)*this._overlayPadding$1;a.textAlign="left";a.textBaseline="top";break;case 3:d=f;
e=g-(c+1)*this._overlayPadding$1;a.textAlign="right";a.textBaseline="top";break;case 4:d=(f+d)/2;a.textAlign="center";a.textBaseline="top";break;case 5:e=(g+e-this._overlayPadding$1)/2;a.textAlign="left";a.textBaseline="top";break;case 6:d=f;e=(g+e-this._overlayPadding$1)/2;a.textAlign="right";a.textBaseline="top";break;case 7:d=(f+d)/2,e=g-this._overlayPadding$1,a.textAlign="center",a.textBaseline="top"}return lt.LeadPointD.create(d,e)},_canDisplayOrientation$1:function(){return null!=this._frame.get__orientationOverlay()&&
!this._frame.get_isWaveForm()},_prepareOverlayText$1:function(a){if(null!=this._frame){var b=this._cell$1.get_frames().indexOf(this._frame),c=a.get_text();switch(a.get_type()){case 10:0<this._frame.get_retakes().get_count()?-1===this._frame.get_retakeIndex()?c=" N ":(c=String.format("O"),1<this._frame.get_retakes().get_count()&&(c+=(this._frame.get_retakeIndex()+1).toString())):c="";break;case 0:c=this._frame.get_isDataReady()?String.format("W: {0} L: {1}",this._frame.get_windowWidth(),this._frame.get_windowCenter()):
"";break;case 4:c=String.format("{0} / {1}",b+1,this._cell$1.get_frames().get_count());break;case 1:c=String.format("Instance: {0}",this._frame.get_instanceNumber());break;case 3:c=this._frame.get_imageQuality()?this._frame.get_imageQuality():"";break;case 5:c=this._canDisplayOrientation$1()?this._frame.get__orientationOverlay().getLeft():"";break;case 6:c=this._canDisplayOrientation$1()?this._frame.get__orientationOverlay().getRight():"";break;case 7:c=this._canDisplayOrientation$1()?this._frame.get__orientationOverlay().getTop():
"";break;case 8:c=this._canDisplayOrientation$1()?this._frame.get__orientationOverlay().getBottom():""}a.set__internalText(c)}},_clearPreviousOverlayText$1:function(a,b,c){var d=a=0;switch(b.get_alignment()){case 1:a-=b.get__drawnTextWidth();break;case 2:d-=this._overlayPadding$1;break;case 3:a-=b.get__drawnTextWidth();d-=this._overlayPadding$1;break;case 4:a-=b.get__drawnTextWidth()/2;break;case 5:d-=this._overlayPadding$1/2;break;case 6:a-=b.get__drawnTextWidth();d-=this._overlayPadding$1/2;break;
case 7:a-=b.get__drawnTextWidth()/2,d-=this._overlayPadding$1}b.set__clearRectangle(lt.LeadRectD.create(c.get_x()+a,c.get_y()+d,b.get__drawnTextWidth(),this._overlayPadding$1))},_createClearRect$1:function(a,b,c,d){var e=0,f=this._overlayPadding$1,e="";switch(d.get_type()){case 2:e=d.get_text();break;case 0:e=String.format("W: 56536 C: 56536");break;case 1:e=String.format("Instance: 1000");break;case 3:e=String.format("!");break;case 4:e=String.format("1000 / 1000");break;case 10:e=String.format("N11");
break;case 5:case 6:case 7:case 8:e=String.format("AAAAA")}e=a.measureText(e).width;switch(d.get_alignment()){case 4:case 7:b-=e/2;break;case 3:case 1:case 6:b-=e}return lt.LeadRectD.create(b,c,e,f)},_updateTag:function(a){if(!(null==this._frame||null==this._info$1)&&this._frame.get_enableDraw()){var b=0,c=this._cell$1.get_overlays().get_count(),d=this._overlayCanvas$1.getContext("2d");d.save();for(var e,f,b=0;b<c;b++)if(e=this._cell$1.get_overlays().get_item(b),f=this._info$1[b],a===e.get_type()){this._getOverlayPosition$1(d,
e,0);d.fillStyle=e.get_color();d.font=3===e.get_type()?this._fontSize$1+4+"px Arial":this._fontSize$1+"px Arial";this._prepareOverlayText$1(e);d.fillStyle=e.get_color();var g=this._createClearRect$1(d,f.rect.get_left(),f.rect.get_top(),e);null!=g&&d.clearRect(g.get_left()-4,g.get_top(),g.get_width()+8,g.get_height());f.visible&&e._draw(d,parseInt(f.rect.get_left()),parseInt(f.rect.get_top()))}d.restore()}},_renderOverlay$1:function(){if(!(null==this._frame||null==this._info$1)&&this._frame.get_enableDraw()){var a=
0,b=this._cell$1.get_overlays().get_count(),c=this._overlayCanvas$1.getContext("2d");c.clearRect(0,0,this._overlayCanvas$1.width,this._overlayCanvas$1.height);c.save();for(var d,a=0;a<b;a++)d=this._cell$1.get_overlays().get_item(a),this._getOverlayPosition$1(c,d,0),c.fillStyle=d.get_color(),c.font=3===d.get_type()?this._fontSize$1+4+"px Arial":this._fontSize$1+"px Arial",this._prepareOverlayText$1(d),this._info$1[a].visible&&d._draw(c,parseInt(this._info$1[a].rect.get_left()),parseInt(this._info$1[a].rect.get_top()));
c.restore()}},updateOverlay:function(){if(!(null==this._frame||null==this._info$1)&&this._frame.get_enableDraw()){var a=0,b=this._cell$1.get_overlays().get_count(),c=this._overlayCanvas$1.getContext("2d");c.save();for(var d,e,a=0;a<b;a++)if(d=this._cell$1.get_overlays().get_item(a),e=this._info$1[a],2!==d.get_type()){this._getOverlayPosition$1(c,d,0);c.fillStyle=d.get_color();c.font=3===d.get_type()?this._fontSize$1+4+"px Arial":this._fontSize$1+"px Arial";this._prepareOverlayText$1(d);var f=this._createClearRect$1(c,
e.rect.get_left(),e.rect.get_top(),d);null!=f&&c.clearRect(f.get_left()-4,f.get_top(),f.get_width()+8,f.get_height());e.visible&&d._draw(c,parseInt(e.rect.get_left()),parseInt(e.rect.get_top()))}c.restore()}},_initializeFrameMappingIndex$1:function(){if(null==this._cell$1.get_framesMappingIndex()){var a=0,b=this._cell$1.get_frames().get_count();this._cell$1._framesMappingIndex=lt.Controls.Medical.Tools._l_AllocateInt32Array(b);for(a=0;a<b;a++)this._cell$1._framesMappingIndex[a]=a}},_removeFrameFromMappingIndex$1:function(a){for(var a=
this._cell$1.get_frames().indexOf(a),b=0,c=this._cell$1.get_frames().get_count(),b=0;b<c;b++)this._cell$1.get_framesMappingIndex()[b]===a&&(this._cell$1.get_framesMappingIndex()[b]=-1)},get_attachedFrame:function(){return this._frame},set_attachedFrame:function(a){var b=-1;if(null!=a&&(b=this._cell$1.get_frames().indexOf(a),-1===b))throw Error("You must add to the frame to the cell frame list 'Cell.Frames'");if(null!=this._frame){var c=this._cell$1.get_imageViewer().get_items().indexOf(this);this._frame._attach(null);
this._initializeFrameMappingIndex$1();this._removeFrameFromMappingIndex$1(this._frame)}this._frame=a;null!=this._frame?(c=this._cell$1.get_imageViewer().get_items().indexOf(this),this._initializeFrameMappingIndex$1(),this._removeFrameFromMappingIndex$1(this._frame),this._cell$1.get_framesMappingIndex()[c]=b,this._cell$1._updateFrameWithSubCell(this._frame,this),this._frame._assignRenderer()):(this._clearAttachedCanvases$1(),this.invalidate());return a},_adjustViewerProperties$1:function(){},get__parentViewer:function(){return this._cell$1.get_imageViewer()},
_prepareOverlayCanvas$1:function(){var a=this.get__parentViewer().get_foreCanvas();this._overlayCanvas$1=document.createElement("canvas");this._overlayCanvas$1.id=this._subCellName$1+"_overalyCanvas";this._overlayCanvas$1.style.zIndex=99;this._overlayCanvas$1.width=parseInt(this.get_size().get_width());this._overlayCanvas$1.height=parseInt(this.get_size().get_height());a.parentNode.appendChild(this._overlayCanvas$1)},_annotationCanvas$1:null,_initializeAnnotationCanvas$1:function(a,b){var c=a.get_foreCanvas(),
d=b+"_annotationCanvas";this._annotationCanvas$1=document.createElement("canvas");this._annotationCanvas$1.width=c.width;this._annotationCanvas$1.height=c.height;this._annotationCanvas$1.width=1;this._annotationCanvas$1.height=1;this._annotationCanvas$1.id=d;this._annotationCanvas$1.style.pixelLeft=0;this._annotationCanvas$1.style.pixelTop=0;this._annotationCanvas$1.style.marginTop="0px";this._annotationCanvas$1.style.marginRight="auto";this._annotationCanvas$1.style.marginBottom="0px";this._annotationCanvas$1.style.marginLeft=
"auto";this._annotationCanvas$1.style.position="absolute";this._annotationCanvas$1.style.zIndex=100;this.get__parentViewer().get_foreCanvas().parentNode.appendChild(this._annotationCanvas$1);-1===this.get__parentViewer().get_interactiveService().get_userControls().indexOf(this._annotationCanvas$1)&&this.get__parentViewer().get_interactiveService().get_userControls().add(this._annotationCanvas$1)},get_annotationCanvas:function(){return this._annotationCanvas$1},set_annotationCanvas:function(a){return this._annotationCanvas$1=
a},onSizeChanged:function(){if(this._cell$1._canUpdate()&&null!=this.get_imageViewer()){var a=this.get__parentViewer().getItemViewBounds(this,lt.Controls.ImageViewerItemPart.view,!1);if(!a.get_isEmpty()){var b=a.get_width(),c=a.get_height();this._overlayCanvas$1.style.left=a.get_left()+"px";this._overlayCanvas$1.style.top=a.get_top()+"px";this._overlayCanvas$1.style.width=b+"px";this._overlayCanvas$1.style.height=c+"px";this._overlayCanvas$1.style.position="absolute";this._overlayCanvas$1.width=parseInt(b);
this._overlayCanvas$1.height=parseInt(c);this._annotationCanvas$1.style.left=a.get_left()+"px";this._annotationCanvas$1.style.top=a.get_top()+"px";this._annotationCanvas$1.style.width=b+"px";this._annotationCanvas$1.style.height=c+"px";this._annotationCanvas$1.style.position="absolute";this._annotationCanvas$1.width=parseInt(b);this._annotationCanvas$1.height=parseInt(c);this._updateOverlaySize$1(this._overlayCanvas$1.width,this._overlayCanvas$1.height);null!=this._frame&&(this._frame.get_container().set_isEnabled(!0),
this._frame._updateSubCellZoom(),this._frame.get_shutter().onSizeChanged())}}},dispose:function(){this.set_flip(!1);this.set_reverse(!1);this.set_rotateAngle(0);var a=this.get__parentViewer().get_foreCanvas().parentNode;lt.Controls.Medical.Tools._disposeCanvas(this._annotationCanvas$1);this._annotationCanvas$1=null;a.removeChild(this._overlayCanvas$1);lt.Controls.Medical.Tools._disposeCanvas(this._overlayCanvas$1);this._overlayCanvas$1=null},_subCellName$1:null,_prepareImageViewer$1:function(){this._subCellName$1=
this.get_div().id+"_subCell";this.get_div();this.set_size(lt.LeadSizeD.create(10,10))},_imageURLCompleted:function(a){null!=this.get_attachedFrame()&&this.get_attachedFrame()._requestSent&&!this.get_attachedFrame()._drawWindowLevel&&(this.get_attachedFrame().set__drawClientVersion(!1),this.get_attachedFrame()._fullImageReceived=!0,this._updateTag(3),this.get_attachedFrame()._updateSubCellZoom(),a.invalidate())}};Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"backColor",{get:lt.Controls.Medical.SubCell.prototype.get_backColor,
set:lt.Controls.Medical.SubCell.prototype.set_backColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"bounds",{get:lt.Controls.Medical.SubCell.prototype.get_bounds,set:lt.Controls.Medical.SubCell.prototype.set_bounds,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"selected",{get:lt.Controls.Medical.SubCell.prototype.get_selected,set:lt.Controls.Medical.SubCell.prototype.set_selected,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"div",{get:lt.Controls.Medical.SubCell.prototype.get_div,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"divID",{get:lt.Controls.Medical.SubCell.prototype.get_divID,set:lt.Controls.Medical.SubCell.prototype.set_divID,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"overlayCanvas",{get:lt.Controls.Medical.SubCell.prototype.get_overlayCanvas,enumerable:!0,
configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"parentCell",{get:lt.Controls.Medical.SubCell.prototype.get_parentCell,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"foreColor",{get:lt.Controls.Medical.SubCell.prototype.get_foreColor,set:lt.Controls.Medical.SubCell.prototype.set_foreColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"frameAttached",{get:lt.Controls.Medical.SubCell.prototype.__frameAttached$1_handler_get,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"attachedFrame",{get:lt.Controls.Medical.SubCell.prototype.get_attachedFrame,set:lt.Controls.Medical.SubCell.prototype.set_attachedFrame,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SubCell.prototype,"annotationCanvas",{get:lt.Controls.Medical.SubCell.prototype.get_annotationCanvas,set:lt.Controls.Medical.SubCell.prototype.set_annotationCanvas,enumerable:!0,configurable:!0});lt.Controls.Medical._chunkList=
function(a){this.resolution=a;this.list=[];this.used=[]};lt.Controls.Medical._chunkList.prototype={list:null,used:null,resolution:null};lt.Controls.Medical.MRTISubCell=function(a,b){this.thumbnailSize=lt.LeadSizeD.create(64,64);this._tileBackGroundResolution$2=lt.LeadSizeD.create(0,0);this._position$2=lt.LeadPointD.create(0,0);lt.Controls.Medical.MRTISubCell.initializeBase(this,[a,b]);this._initalizeMRTI$2()};lt.Controls.Medical.MRTISubCell.getFloatImageRect=function(a,b){return a.getItemImageFloatingPointTransform(b).transformRect(lt.LeadRectD.create(0,
0,b.get_imageSize().get_width(),b.get_imageSize().get_height()))};lt.Controls.Medical.MRTISubCell.prototype={_clearChunks:function(){this._frame.get__mrtiRenderer().remove_renderChunk(ss.Delegate.create(this,this._MRTIRenderer_RenderChunk$2));if(null!=this._chunkList$2){var a;a=this._chunkList$2.length;for(a-=1;0<=a;a--)lt.Controls.Medical.Tools._removeChunk(this._chunkList$2,this._chunkList$2[a])}if(null!=this._frame&&null!=this._frame.get__mrtiRenderer().get_alreadyRequested()){var b=this._frame.get__mrtiRenderer().get_alreadyRequested();
a=b.length;for(a-=1;0<=a;a--)lt.Controls.Medical.Tools._removeChunk(b,b[a])}},updateWindowlevel:function(a){if(null!=this._chunkList$2){for(var b=0,c=this._chunkList$2.length,d,b=0;b<c;b++)d=this._chunkList$2[b],(d.status.visible||a)&&this._frame._renderChunkWindowLevel(d);null!=this._frame.lowResImage&&(this._frame.lowResImage.status.visible||a)&&this._frame._renderChunkWindowLevel(this._frame.lowResImage);null!=this._frame.thumbnailImage&&(this._frame.thumbnailImage.status.visible||a)&&this._frame._renderChunkWindowLevel(this._frame.thumbnailImage)}},
updateWindowlevelOnTheRest:function(){if(null!=this._chunkList$2){for(var a=0,b=this._chunkList$2.length,c,a=0;a<b;a++)c=this._chunkList$2[a],c.status.visible||this._frame._renderChunkWindowLevel(c);null!=this._frame.lowResImage&&(this._frame.lowResImage.status.visible||this._frame._renderChunkWindowLevel(this._frame.lowResImage));null!=this._frame.thumbnailImage&&(this._frame.thumbnailImage.status.visible||this._frame._renderChunkWindowLevel(this._frame.thumbnailImage))}},_updateMRTIScale$2:function(){var a=
lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),this);if(null!=this._mrtiImage&&!a.get_isEmpty()){var b=this._mrtiImage.get_fullSize().get_width();this._mrtiImage.get_fullSize().get_height();a.get_height();this._scale$2=100*(a.get_width()/b)}},_onTransformChanged:function(){this._updateMRTIScale$2();this.updateView(0,!1)},_mrtiImage:null,_chunkList$2:null,get_chunkList:function(){return this._chunkList$2},_enableMRTI$2:!1,get_enableMRTI:function(){return this._enableMRTI$2},
set_enableMRTI:function(a){(this._enableMRTI$2=a)&&this.connect(this._frame.get_mrtiInfo());return a},fullScreenCanvas:null,mrtiBackCanvas:null,_qualityFactor$2:1,_updateMRTICanvasSize$2:function(){if(null!=this.get_imageViewer()){var a=this.get__parentViewer().getItemViewBounds(this,lt.Controls.ImageViewerItemPart.view,!1);this._updateMRTIScale$2();var b,c,d,e,f;null!=this._frame?(b=90===Math.abs(this._frame.get_rotateAngle())||270===Math.abs(this._frame.get_rotateAngle()),c=a.get_left(),d=a.get_top(),
e=b?a.get_height():a.get_width(),f=b?a.get_width():a.get_height()):(d=c=0,f=e=1);1<this._qualityFactor$2?(a=e,b=f):(a=4*e/3,b=4*f/3);this.fullScreenCanvas.style.left=c+"px";this.fullScreenCanvas.style.top=d+"px";this.fullScreenCanvas.style.width=a+"px";this.fullScreenCanvas.style.height=b+"px";this.fullScreenCanvas.style.position="absolute";this.fullScreenCanvas.width=parseInt(a);this.fullScreenCanvas.height=parseInt(b);this.mrtiBackCanvas.style.left="0px";this.mrtiBackCanvas.style.top="0px";this.mrtiBackCanvas.style.width=
e+"px";this.mrtiBackCanvas.style.height=f+"px";this.mrtiBackCanvas.style.position="absolute";this.mrtiBackCanvas.width=parseInt(e);this.mrtiBackCanvas.height=parseInt(f);this.updateView(0,!1)}},_initalizeMRTI$2:function(){var a=this.get_div().id+"_subCell";null==lt.Controls.Medical.Tools._recycledElements&&(lt.Controls.Medical.Tools._recycledElements=[]);this._qualityFactor$2=lt.LTHelper.device===lt.LTDevice.tablet?2:1;this.fullScreenCanvas=document.createElement("canvas");this.fullScreenCanvas.id=
a+"_fullScreen_Canvas";this.mrtiBackCanvas=document.createElement("canvas");this.mrtiBackCanvas.id=a+"_backCanvas_Canvas"},onSizeChanged:function(){lt.Controls.Medical.MRTISubCell.callBaseMethod(this,"onSizeChanged");this._updateMRTICanvasSize$2()},_applyTransform$2:function(a,b,c){a.translate(b,c);this._frame.get_rotateAngle()&&a.rotate(this._frame.get_rotateAngle()*Math.PI/180);this._frame.get_flipped()&&a.scale(1,-1);this._frame.get_reversed()&&a.scale(-1,1);a.translate(-b,-c)},_drawFullImage$2:function(a,
b){if(null!=this._frame){var c=!1;parseInt(this._mrtiImage.get_fullSize().get_width()/b.resolution.get_width()+0.5);var d=b.rect.clone();d.offset(-this._position$2.get_x(),-this._position$2.get_y());var d=lt.LeadRectD.create(d.get_left(),d.get_top(),d.get_width()*this._scale$2/100,d.get_height()*this._scale$2/100),e=(d.get_right()+d.get_left())/2,f=(d.get_bottom()+d.get_top())/2;if(c=this._frame.get_flipped()||this._frame.get_reversed()||!!this._frame.get_rotateAngle())a.save(),this._applyTransform$2(a,
e,f);a.drawImage(b.canvas,d.get_left(),d.get_top(),d.get_width(),d.get_height());c&&a.restore()}},_renderBackGroundImage$2:function(a,b){null!=this._frame.lowResImage&&!(null!=this._frame.thumbnailImage&&b.get_width()<=5*this._frame.thumbnailImage._image.naturalWidth/4)&&null!=this._frame.lowResImage._image&&this._frame.lowResImage.status.visible?this._drawFullImage$2(a,this._frame.lowResImage,this._position$2):null!=this._frame.thumbnailImage&&null!=this._frame.thumbnailImage._image&&this._frame.thumbnailImage.status.visible&&
this._drawFullImage$2(a,this._frame.thumbnailImage,this._position$2)},paintTiles:function(a){var b=null,c=null;if(null==this.fullScreenCanvas||null==this.mrtiBackCanvas||null==this._mrtiImage)return this.get_enableMRTI();b=this.fullScreenCanvas.getContext("2d");b.clearRect(0,0,this.fullScreenCanvas.width,this.fullScreenCanvas.height);c=this.mrtiBackCanvas.getContext("2d");c.clearRect(0,0,this.mrtiBackCanvas.width,this.mrtiBackCanvas.height);if(!this.get_enableMRTI())return this.get_enableMRTI();var d=
this.get_imageViewer().getItemImageFloatingPointTransform(this),e;if(!this.get_enableMRTI()||null==this._frame)return!1;this._updateMRTIScale$2();var f=this._chunkList$2.length;if(0<f||null!=this._frame.lowResImage||null!=this._frame.thumbnailImage){var g=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),this);if(g.get_isEmpty())return this.get_enableMRTI();var h=this.get_imageViewer().getItemViewBounds(this,lt.Controls.ImageViewerItemPart.item,!0);if(h.get_isEmpty())return this.get_enableMRTI();
b.clearRect(0,0,this.fullScreenCanvas.width,this.fullScreenCanvas.height);this._position$2.set_x(-d.get_offsetX()+h.get_x());this._position$2.set_y(-d.get_offsetY()+h.get_y());this._renderBackGroundImage$2(a,g);if(lt.Controls.Medical.Tools._noNeedForTiles(g,this._frame,this.get_tileResolution()))return this.get_enableMRTI();var i=0;this._position$2.set_x(-d.get_offsetX()+h.get_x());this._position$2.set_y(-d.get_offsetY()+h.get_y());d=this._frame.get_flipped()||this._frame.get_reversed()||!!this._frame.get_rotateAngle();
Date.get_now().getTime();lt.LeadRectD.create(0,0,this.fullScreenCanvas.width,this.fullScreenCanvas.height);for(var j=this._getArrangedResolution$2(),k=lt.Controls.Medical.Tools._getTopLeftPoints(this._chunkList$2,j),l=0,m=j.length,n,r,o,t,s=lt.LeadRectD.create(this._position$2.get_x(),this._position$2.get_y(),h.get_width(),h.get_height()),s=this._frame.get__mrtiRenderer().getTransformedRect(s,g.get_right()-g.get_left(),g.get_bottom()-g.get_top(),this._frame.get_flipped(),this._frame.get_reversed(),
-this._frame.get_rotateAngle()),l=0;l<m;l++){b.clearRect(0,0,this.fullScreenCanvas.width,this.fullScreenCanvas.height);i=this._mrtiImage.get_fullSize().get_width()/j[l].get_width();o=100*(s.get_x()/i)/this._scale$2;t=100*(s.get_y()/i)/this._scale$2;n=-((o-parseInt(o))*i*this._scale$2/100);r=-((t-parseInt(t))*i*this._scale$2/100);o=parseInt(o);t=parseInt(t);var q=0,p=0,p=100/(i*this._scale$2),q=lt.LeadRectD.create(g.get_x()*p,g.get_y()*p,g.get_width()*p,g.get_height()*p);q.get_right();q.get_left();
q.get_bottom();q.get_top();q=lt.LeadPointD.create(0,0);1<p&&(0<k[l].get_x()-o&&q.set_x(k[l].get_x()-o),0<k[l].get_y()-t&&q.set_y(k[l].get_y()-t));for(var p=!1,u=0;u<f;u++)e=this._chunkList$2[u].rect.clone(),j[l].get_width()===this._chunkList$2[u].resolution.get_width()&&this._chunkList$2[u].status.visible&&(p=!0,e.offset(-o-q.get_x(),-t-q.get_y()),lt.Controls.Medical.Tools._forDebug&&(b.beginPath(),b.strokeStyle="blue",b.rect(e.get_location().get_x(),e.get_location().get_y(),e.get_width(),e.get_height()),
b.stroke()),b.drawImage(this._chunkList$2[u].canvas,e.get_location().get_x(),e.get_location().get_y()));o=this.fullScreenCanvas.width*i*this._scale$2/100;t=this.fullScreenCanvas.height*i*this._scale$2/100;e=q.get_x()*i*this._scale$2/100;i=q.get_y()*i*this._scale$2/100;o=Math.round(1E3*o)/1E3;t=Math.round(1E3*t)/1E3;p&&(q=Math.round(1E3*(n+e))/1E3,p=Math.round(1E3*(r+i))/1E3,d?c.drawImage(this.fullScreenCanvas,q,p,o,t):a.drawImage(this.fullScreenCanvas,q,p,o,t))}d&&this.mrtiBackCanvas.width&&this.mrtiBackCanvas.height&&
(d&&(a.translate(-this.mrtiBackCanvas.width/2+h.get_width()/2,-this.mrtiBackCanvas.height/2+h.get_height()/2),this._applyTransform$2(a,this.mrtiBackCanvas.width/2,this.mrtiBackCanvas.height/2)),a.drawImage(this.mrtiBackCanvas,0,0));this._frame.get__mrtiRenderer().testDebug(this._chunkList$2.length,this._debug_time2$2,lt.Controls.Medical.Tools._recycledElements.length)}else this.updateView(0,!1);return this.get_enableMRTI()},connect:function(a){null!=a&&null==this._frame.get__mrtiRenderer()&&(this._frame.set__mrtiRenderer(new lt.Controls.Medical._mrtiRenderer(a)),
this._frame.get__mrtiRenderer().qualityFactor=this._qualityFactor$2,this._frame.set__magnifyMRTIRenderer(new lt.Controls.Medical._mrtiRenderer(a)));this._frame.get__mrtiRenderer().add_renderChunk(ss.Delegate.create(this,this._MRTIRenderer_RenderChunk$2));this._mrtiImage=a;null==this._chunkList$2&&(this._chunkList$2=[]);this._enableMRTI$2=!0},_applyImageProcessingOnTiles:function(){for(var a=0,b=this._chunkList$2.length,a=0;a<b;a++)this._frame._applyImageProcessingOnChunk(this._chunkList$2[a]);this._frame._applyImageProcessingOnChunk(this._frame.thumbnailImage);
this._frame._applyImageProcessingOnChunk(this._frame.lowResImage)},_MRTIRenderer_RenderChunk$2:function(a,b){var c=new lt.Controls.Medical.ChunkData(b.get_chunkImage(),b.get_chunkRect(),b.get_resolution(),b.get_chunkCanvas());c.backCanvas=b.get_backCanvas();this._frame._applyImageProcessingOnChunk(c);for(var d=0;d<this._chunkList$2.length;d++)if(c.equal(this._chunkList$2[d])){lt.Controls.Medical.Tools._removeChunk(this._chunkList$2,this._chunkList$2[d]);break}this._chunkList$2.add(c);c=Date.get_now().getTime();
this.clearUnnecessaryChunks();this._debug_time2$2=Date.get_now().getTime()-c;this._frame.get__mrtiRenderer().testDebug(this._chunkList$2.length,this._debug_time2$2,lt.Controls.Medical.Tools._recycledElements.length);this._isPaintScheduled()||this._schedulePaint$2()},_debug_time2$2:0,_repaintTiles$2:function(){this._cancelPaintSchedule();this.invalidate()},_cancelPaintSchedule:function(){this._isPaintingSceduled$2=!1;clearInterval(this._intervalId$2)},_isPaintScheduled:function(){return this._isPaintingSceduled$2},
_isPaintingSceduled$2:!1,_intervalId$2:0,_schedulePaint$2:function(){this._intervalId$2=setInterval(ss.Delegate.create(this,this._repaintTiles$2),500);this._isPaintingSceduled$2=!0},_MRTIRenderer_RenderCompleted$2:function(){this.get_imageViewer().invalidate(lt.LeadRectD.get_empty())},_tileResolution$2:null,get_tileResolution:function(){return this._tileResolution$2},set_tileResolution:function(a){return this._tileResolution$2=a},get_tileBackGroundResolution:function(){return this._tileBackGroundResolution$2},
set_tileBackGroundResolution:function(a){return this._tileBackGroundResolution$2=a},updateView:function(a,b){var c,d,e=this.get_imageViewer().getItemBounds(this,lt.Controls.ImageViewerItemPart.view);c=-e.get_x();d=-e.get_y();var f=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),this);if(!(null==this._mrtiImage||e.get_isEmpty())&&!f.get_isEmpty()){e.offset(c,d);f.offset(c,d);e.clone();c=lt.LeadRectD.create(0,0,e.get_width(),e.get_height());d=lt.LeadRectD.create(-f.get_x(),
-f.get_y(),this._mrtiImage.get_fullSize().get_width()*this._scale$2/100,this._mrtiImage.get_fullSize().get_height()*this._scale$2/100);for(var g=0,h=this._chunkList$2.length,e=[],g=0;g<h;g++)e.add(this._chunkList$2[g]._getInfo());g=parseInt(d.get_width()*d.get_height());this.set_tileResolution(this._frame.get__mrtiRenderer().getNewResolution(g,this._mrtiImage,this._qualityFactor$2));this._frame.get__mrtiRenderer().tileResolution=this.get_tileResolution();this.set_tileBackGroundResolution(this._frame.get__mrtiRenderer().findBackGroundResolution(this._mrtiImage,
this.get_tileResolution()));this._frame.get__mrtiRenderer().tileBackGroundResolution=this.get_tileBackGroundResolution();g=!1;lt.Controls.Medical.Tools._noNeedForTiles(f,this._frame,this.get_tileResolution())&&(g=!0);this._frame.get__mrtiRenderer().renderAsync(c,d,b?null:e,null,a,lt.Controls.Medical.Tools._recycledElements,this._frame.get_flipped(),this._frame.get_reversed(),this._frame.get_rotateAngle(),g)}},_scale$2:100,get_currentScale:function(){return this._scale$2},set_currentScale:function(a){return this._scale$2=
a},get_position:function(){return this._position$2},set_position:function(a){return this._position$2=a},_clearOverlappedChunks$2:function(){var a=this.get_imageViewer().getItemBounds(this,lt.Controls.ImageViewerItemPart.view),b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),this),c=-a.get_x(),d=-a.get_y();if(!a.get_isEmpty()&&!b.get_isEmpty()&&(a.offset(c,d),b.offset(c,d),a.clone(),a=lt.LeadRectD.create(0,0,a.get_width(),a.get_height()),b=lt.LeadRectD.create(-b.get_x(),-b.get_y(),
this._mrtiImage.get_fullSize().get_width()*this._scale$2/100,this._mrtiImage.get_fullSize().get_height()*this._scale$2/100),!(null==this.get_tileResolution()||this.get_tileResolution().get_isEmpty()))){var b=this._frame.get__mrtiRenderer().findExpectedNumberOfChunks2(null,this._mrtiImage.get_tileSize(),a,b,this.get_tileResolution()),a=!1,c=b.length,d=!0,e,f;for(f=0;f<this._chunkList$2.length;f++)this._chunkList$2[f].status.visible=!0;for(d=0;d<c;d++){e=b[d];a=!1;for(f=0;f<this._chunkList$2.length;f++)if(this._chunkList$2[f].equal(e)){a=
!0;break}if(!a)break}d=!a;null!=this._frame.lowResImage&&(this._frame.lowResImage.status.visible=d);null!=this._frame.thumbnailImage&&(this._frame.thumbnailImage.status.visible=d);if(a)for(f=this._chunkList$2.length-1;0<=f;f--)null!=this.get_tileResolution()&&!this.get_tileResolution().get_isEmpty()&&this._chunkList$2[f].resolution.get_width()===this.get_tileResolution().get_width()||(this._chunkList$2[f].status.visible=!1);else for(f=this._chunkList$2.length-1;0<=f;f--)this._chunkList$2[f].status.visible=
!0}},clearUnnecessaryChunks:function(){if(!(null==this._frame||null==this._frame.get__mrtiRenderer()||this._frame.get__mrtiRenderer()._dontRequest||null==this._mrtiImage)){var a=this.get_imageViewer().getItemBounds(this,lt.Controls.ImageViewerItemPart.view);if(!a.get_isEmpty()){var b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),this);if(!b.get_isEmpty()){var c=-a.get_x(),d=-a.get_y();a.offset(c,d);b.offset(c,d);lt.Controls.Medical.Tools._clearOutsideChunks(b,a,this._frame.get__mrtiRenderer(),
this._chunkList$2,this._frame,this._mrtiImage,this._scale$2);this._clearOverlappedChunks$2()}}}},_findResolutionInArray$2:function(a,b){for(var c=0,d=a.length,c=0;c<d;c++)if(a[c].get_width()===b.get_width())return c;return-1},_findResolution$2:function(a,b){for(var c=0,d=a.length,c=0;c<d;c++)if(a[c].get_width()===b.get_width())return c;return-1},_getArrangedResolution$2:function(){var a=[],b=0,c=0,d=this._chunkList$2.length,e=!1;lt.LeadPointD.create(1E6,1E6);for(var f,b=0;b<d;b++)if(f=this._chunkList$2[b].resolution,
this._chunkList$2[b].status.visible&&-1===this._findResolution$2(a,f))if(f.get_width()===this.get_tileResolution().get_width())e=!0;else{for(var g=!1,c=a.length-1;0<=c;c--)if(f.get_width()<a[c].get_width()){a.insert(c,f);g=!0;break}g||a.add(f)}e&&a.add(this.get_tileResolution());return a}};Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,"chunkList",{get:lt.Controls.Medical.MRTISubCell.prototype.get_chunkList,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,
"enableMRTI",{get:lt.Controls.Medical.MRTISubCell.prototype.get_enableMRTI,set:lt.Controls.Medical.MRTISubCell.prototype.set_enableMRTI,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,"tileResolution",{get:lt.Controls.Medical.MRTISubCell.prototype.get_tileResolution,set:lt.Controls.Medical.MRTISubCell.prototype.set_tileResolution,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,"tileBackGroundResolution",
{get:lt.Controls.Medical.MRTISubCell.prototype.get_tileBackGroundResolution,set:lt.Controls.Medical.MRTISubCell.prototype.set_tileBackGroundResolution,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,"currentScale",{get:lt.Controls.Medical.MRTISubCell.prototype.get_currentScale,set:lt.Controls.Medical.MRTISubCell.prototype.set_currentScale,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTISubCell.prototype,"position",{get:lt.Controls.Medical.MRTISubCell.prototype.get_position,
set:lt.Controls.Medical.MRTISubCell.prototype.set_position,enumerable:!0,configurable:!0});lt.Controls.Medical._fullRes_Thumb_ImageInfo=function(a,b){this.image=a;this.src=b};lt.Controls.Medical._fullRes_Thumb_ImageInfo.prototype={image:null,src:null};lt.Controls.Medical._imagesLoader=function(a){this._timerID=-1;this._imageElements=[];this._currentlyLoading=0;this._imageCount=a};lt.Controls.Medical._imagesLoader.prototype={_dummyImage:null,get_dummyImage:function(){null==this._dummyImage&&(this._dummyImage=
document.createElement("img"));return this._dummyImage},add_imageLoaded:function(a){this.__imageLoaded=ss.Delegate.combine(this.__imageLoaded,a)},remove_imageLoaded:function(a){this.__imageLoaded=ss.Delegate.remove(this.__imageLoaded,a)},__imageLoaded_handler_get:function(){null==this.__imageLoaded_handler&&(this.__imageLoaded_handler=ss.EventHandler.create(this,this.add_imageLoaded,this.remove_imageLoaded));return this.__imageLoaded_handler},__imageLoaded:null,__imageLoaded_handler:null,_imageElements:null,
get_imageElements:function(){return this._imageElements},_currentlyLoading:0,_imageCount:0,_loadAnotherImage:function(){clearInterval(this._timerID);this._timerID=-1;if(this._imageElements.length&&this._currentlyLoading<this._imageCount){var a=this._imageElements[0],b=ss.Delegate.create(this,this._imageLoadedSuccessfully);a.image.imageLoadedListener=b;a.image.addEventListener("load",b,!1);this._imageElements.removeAt(0);a.image.src=a.src;this._currentlyLoading++;this.startLoading()}},removeMyStuffFromTheList:function(a){this.pauseLoading();
for(var b=0,c,b=this._imageElements.length-1;0<b;b--)c=this._imageElements[b].image.Frame,c===a&&this._imageElements.removeAt(b);this.resumeLoading()},_paused:!1,pauseLoading:function(){this._paused=!0},resumeLoading:function(){this._paused=!1},startLoading:function(){!this._paused&&-1===this._timerID&&(this._timerID=setInterval(ss.Delegate.create(this,this._loadAnotherImage),1))},_imageLoadedSuccessfully:function(a){var b=a.currentTarget;b.removeEventListener("load",b.imageLoadedListener,!1);b=a.currentTarget.Frame;
null!=b?b._smallResolutionLoaded(a):null!=this.__imageLoaded&&this.__imageLoaded(this,lt.LeadEventArgs.Empty);this._currentlyLoading--;this.startLoading()}};Object.defineProperty(lt.Controls.Medical._imagesLoader.prototype,"imageLoaded",{get:lt.Controls.Medical._imagesLoader.prototype.__imageLoaded_handler_get,enumerable:!0,configurable:!0});lt.Controls.Medical.Frame=function(a){this._normalizedPosition=lt.LeadPointD.create(0,0);this._projectionOrientation=0;this._parent=a;this._sizeMode=2;this._zoom=
1;this._photometricInterpretation="MONOCHROME2";this._maX_RESIZE_TOLERANCE=this._getMaxResize();this._previewCanvas=null;this._retakes=new lt.Controls.Medical.LeadCollection;this._retakeIndex=-1;this._retakes.add_collectionChanged(ss.Delegate.create(this,this._retakes_CollectionChanged));this._originalRetakes=this._retakes;this._imageProcessingList=new lt.Controls.Medical.LeadCollection;this._imageProcessingList.add_collectionChanged(ss.Delegate.create(this,this._imageProcessingList_CollectionChanged));
this._createWindowLevelInteractive()};lt.Controls.Medical.Frame.prototype={_imagePosition:null,_imageOrientation:null,_orientationOverlay:null,_imagePNGData:null,_imagePNGCanvas:null,_previewCanvas:null,_width:0,_height:0,_rowSpacing:0,_columnSpacing:0,_patientProjection:null,_instanceNumber:0,_bitPerpixel:0,_windowWidth:0,_windowCenter:0,_defaultWindowLevelWidth:0,_defaultWindowLevelCenter:0,_minValue:0,_maxValue:0,_lowBit:0,_highBit:0,_bitStored:0,_rescaleintercept:0,_rescaleSlope:0,_voiLUTSequence:null,
_imageType:null,_lossyCompression:!1,_imageQuality:null,_isWaveForm:!1,_frameOfReferenceID:null,_photometricInterpretation:null,_originalPhotometricInterpretation:null,_flipped:!1,_reversed:!1,_rotation:0,_offsetX:0,_offsetY:0,_useDPI:!1,_userData:null,_parent:null,_information:null,_inverted:!1,_deltaWidth:0,_deltaCenter:0,_container:null,_subCell:null,_shutterObject:null,_lineProfileObject:null,_retakes:null,_originalRetakes:null,add_imageDataReady:function(a){this.__imageDataReady=ss.Delegate.combine(this.__imageDataReady,
a)},remove_imageDataReady:function(a){this.__imageDataReady=ss.Delegate.remove(this.__imageDataReady,a)},__imageDataReady_handler_get:function(){null==this.__imageDataReady_handler&&(this.__imageDataReady_handler=ss.EventHandler.create(this,this.add_imageDataReady,this.remove_imageDataReady));return this.__imageDataReady_handler},__imageDataReady:null,__imageDataReady_handler:null,_retakeIndex:0,lowResImage:null,thumbnailImage:null,_normalizedPositionDelta:null,_imageProcessingList:null,get_imageProcessingList:function(){return this._imageProcessingList},
getPreviewCanvas:function(){var a=document.createElement("canvas"),b=null!=this.lowResImage?this.lowResImage:this.thumbnailImage;if(null!=b){a.width=b.canvas.width;a.height=b.canvas.height;var c=a.getContext("2d");1===b.canvas.width?c.drawImage(b._image,0,0):c.drawImage(b.canvas,0,0)}return a},_savePosition:function(){if(null!=this._subCell){var a=this._subCell.get__parentViewer().getItemViewBounds(this._subCell,lt.Controls.ImageViewerItemPart.view,!1),b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this._subCell.get__parentViewer(),
this._subCell),c=(a.get_right()+a.get_left())/2,a=(a.get_bottom()+a.get_top())/2,d=(b.get_right()+b.get_left())/2,e=(b.get_bottom()+b.get_top())/2,c=d-c,a=e-a,c=Math.abs(c)<lt.Controls.Medical.Tools._epsilon?0:c,a=Math.abs(a)<lt.Controls.Medical.Tools._epsilon?0:a,c=c/(90===this.get_rotateAngle()||270===this.get_rotateAngle()?b.get_height():b.get_width()),b=a/(90===this.get_rotateAngle()||270===this.get_rotateAngle()?b.get_width():b.get_height());this._normalizedPositionDelta=lt.LeadPointD.create(c-
this._normalizedPosition.get_x(),b-this._normalizedPosition.get_y());this._normalizedPosition=lt.LeadPointD.create(c,b)}},_restorePosition:function(){if(null!=this._subCell){var a=this._subCell.get__parentViewer().getItemViewBounds(this._subCell,lt.Controls.ImageViewerItemPart.view,!1),b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this._subCell.get__parentViewer(),this._subCell),c=(a.get_right()+a.get_left())/2,a=(a.get_bottom()+a.get_top())/2,d=(b.get_right()+b.get_left())/2,e=(b.get_bottom()+
b.get_top())/2,c=d-c,e=e-a,a=this._normalizedPosition.get_x()*(90===this.get_rotateAngle()||270===this.get_rotateAngle()?b.get_height():b.get_width()),b=this._normalizedPosition.get_y()*(90===this.get_rotateAngle()||270===this.get_rotateAngle()?b.get_width():b.get_height())-e,c=a-c,c=Math.abs(c)<lt.Controls.Medical.Tools._epsilon?0:c,b=Math.abs(b)<lt.Controls.Medical.Tools._epsilon?0:b;this._subCell.offsetBy(lt.LeadPointD.create(c,b))}},_MRTIRenderer:null,_magnifyMRTIRenderer:null,_mrtiImage:null,
get__mrtiRenderer:function(){return this._MRTIRenderer},set__mrtiRenderer:function(a){return this._MRTIRenderer=a},get__magnifyMRTIRenderer:function(){return this._magnifyMRTIRenderer},set__magnifyMRTIRenderer:function(a){return this._magnifyMRTIRenderer=a},add__renderThumbnail:function(a){this.__renderThumbnail=ss.Delegate.combine(this.__renderThumbnail,a)},remove__renderThumbnail:function(a){this.__renderThumbnail=ss.Delegate.remove(this.__renderThumbnail,a)},__renderThumbnail_handler_get:function(){null==
this.__renderThumbnail_handler&&(this.__renderThumbnail_handler=ss.EventHandler.create(this,this.add__renderThumbnail,this.remove__renderThumbnail));return this.__renderThumbnail_handler},__renderThumbnail:null,add__renderLowResolution:function(a){this.__renderLowResolution=ss.Delegate.combine(this.__renderLowResolution,a)},remove__renderLowResolution:function(a){this.__renderLowResolution=ss.Delegate.remove(this.__renderLowResolution,a)},__renderLowResolution_handler_get:function(){null==this.__renderLowResolution_handler&&
(this.__renderLowResolution_handler=ss.EventHandler.create(this,this.add__renderLowResolution,this.remove__renderLowResolution));return this.__renderLowResolution_handler},__renderLowResolution:null,_getAutoScaleValue:function(a){var b=a.getContext("2d").getImageData(0,0,a.width,a.height),a=0,c=b.data.length,b=b.data,d,e="";d=b[0];if(12!==d)this.get_information().set_autoScaleSlope(1),this.get_information().set_autoScaleIntercept(0);else{for(a+=4;a<c;a+=4){d=b[a];if(11===d)d=".";else if(12===d)break;
else if(13===d)break;else d=14===d?"-":d;e+=d}this.get_information().set_autoScaleIntercept(parseFloat(e));a+=4;for(e="";a<c;a+=4){d=b[a];if(11===d)d=".";else if(12===d)break;else if(13===d)break;else d=14===d?"-":d;e+=d}this.get_information().set_autoScaleSlope(parseFloat(e));a+=4;this.get_information().set_signed(1===b[a]?!0:!1);a+=4;if(12!==b[a]){a+=4;for(e="";a<c;a+=4){d=b[a];if(11===d)d=".";else if(12===d)break;else if(13===d)break;else d=14===d?"-":d;e+=d}e&&this.get_information().set_minValue(parseInt(e));
a+=4;for(e="";a<c;a+=4){d=b[a];if(11===d)d=".";else if(12===d)break;else if(13===d)break;else d=14===d?"-":d;e+=d}e&&this.get_information().set_maxValue(parseInt(e))}}},_autoScaleValuesRetreived:!1,_smallResolutionLoaded:function(a){a=a.currentTarget;lt.Controls.Medical._parser.parseString(a.getAttribute("fullSize"),0);var b=a.Thumbnail,c=lt.LeadSizeD.create(a.ResWidth,a.ResHeight);this._updateAnnotationContainerSize();var d=lt.LeadRectD.create(0,0,this._mrtiImage.get_fullSize().get_width(),this._mrtiImage.get_fullSize().get_height()),
e=new lt.Controls.Medical.ChunkData(a,d,c,null);b?(null!=this.thumbnailImage&&(lt.Controls.Medical.Tools._removeChunk(null,this.thumbnailImage),this.thumbnailImage=null),null!=this._subCell&&lt.Controls.Medical._rendererTools.drawChunkOnCanvas(this._mrtiImage,null==this.thumbnailImage?e:this.thumbnailImage,a,lt.LeadSizeD.create(a.naturalWidth,a.naturalHeight)),null!=this.__renderThumbnail&&this.__renderThumbnail(this,new lt.Controls.Medical._mrtiRenderChunkEventArgs(null,null,null,d,a,c,e,e.canvas,
e.backCanvas)),this.remove__renderThumbnail(ss.Delegate.create(this,this._MRTIRenderer_RenderThumbnail))):(null!=this.lowResImage&&(lt.Controls.Medical.Tools._removeChunk(null,this.lowResImage),this.lowResImage=null),null!=this._subCell&&lt.Controls.Medical._rendererTools.drawChunkOnCanvas(this._mrtiImage,null==this.lowResImage?e:this.lowResImage,a,lt.LeadSizeD.create(a.naturalWidth,a.naturalHeight)),null!=this.__renderLowResolution&&this.__renderLowResolution(this,new lt.Controls.Medical._mrtiRenderChunkEventArgs(null,
null,null,d,a,c,e,e.canvas,e.backCanvas)),this.remove__renderLowResolution(ss.Delegate.create(this,this._mrtiRenderer_RenderLowResolution)))},_construct_fileName:function(a,b,c,d){var e=this._mrtiImage.get_imageUri(),e=String.format("{0}&frame={1}&x={2}&y={3}&w={4}&h={5}&xr={6}&yr={7}&wldata={8}",this._mrtiImage.get_imageUri(),this._mrtiImage.get_frameIndex(),a.get_left(),a.get_top(),c?0:a.get_width(),c?0:a.get_height(),b.get_width(),b.get_height(),this._mrtiImage.get_supportWindowLevel());if(null!=
d){var e=e+"&data="+d.get_command(),f=d.get_arguments(),g="";Object.keys(f).forEach(function(a){g+=","+a+":"+f[a]});e=e+(g+";")+("r="+Date.get_now().getTime())}return e},_refreshLowRes:function(){this.add__renderLowResolution(ss.Delegate.create(this,this._mrtiRenderer_RenderLowResolution));this.add__renderThumbnail(ss.Delegate.create(this,this._MRTIRenderer_RenderThumbnail));null!=this.lowResImage&&this._requestFullImage(this.lowResImage._image,this.lowResImage.resolution,!1);null!=this.thumbnailImage&&
this._requestFullImage(this.thumbnailImage._image,this.thumbnailImage.resolution,!0);lt.Controls.Medical.Frame._previewLoader.startLoading()},_requestFullImage:function(a,b,c){a.setAttribute("fullSize",lt.Controls.Medical._parser.convertToString(this._mrtiImage.get_fullSize()));a.Thumbnail=c;a.ResWidth=b.get_width();a.ResHeight=b.get_height();a.Frame=this;lt.Controls.Medical.Frame._previewLoader.get_imageElements().add(new lt.Controls.Medical._fullRes_Thumb_ImageInfo(a,lt.Controls.Medical._imageLoader.temp_construct_fileName(lt.LeadRectD.create(0,
0,0,0),b,!0,this._mrtiImage,this._MRTIRenderer)))},_requestLowRes:function(){var a=null,b=null,c=lt.LeadSizeD.get_empty(),d=lt.LeadSizeD.get_empty();if(null==a)if(this.add__renderLowResolution(ss.Delegate.create(this,this._mrtiRenderer_RenderLowResolution)),256>Math.max(this._mrtiImage.get_resolutions()[0].get_width(),this._mrtiImage.get_resolutions()[0].get_height()))c=this._mrtiImage.get_resolutions()[0];else for(var e=0;e<this._mrtiImage.get_resolutions().length;e++)if(256>=Math.max(this._mrtiImage.get_resolutions()[e].get_width(),
this._mrtiImage.get_resolutions()[e].get_height())){c=this._mrtiImage.get_resolutions()[e];break}if(null==b){this.add__renderThumbnail(ss.Delegate.create(this,this._MRTIRenderer_RenderThumbnail));for(e=0;e<this._mrtiImage.get_resolutions().length;e++)if(64>=Math.max(this._mrtiImage.get_resolutions()[e].get_width(),this._mrtiImage.get_resolutions()[e].get_height())){d=this._mrtiImage.get_resolutions()[e];break}}null==lt.Controls.Medical.Frame._previewLoader&&(lt.Controls.Medical.Frame._previewLoader=
new lt.Controls.Medical._imagesLoader(6));null==a&&(a=document.createElement("img"),this._requestFullImage(a,c,!1));null==b&&!d.get_isEmpty()&&(b=document.createElement("img"),this._requestFullImage(b,d,!0));lt.Controls.Medical.Frame._previewLoader.startLoading()},get_mrtiInfo:function(){return this._mrtiImage},set_mrtiInfo:function(a){if(!(null==a||null!=this._mrtiImage))return this._mrtiImage=a,this._requestLowRes(),null!=this._subCell&&(this._subCell._mrtiImage=this._mrtiImage,this._subCell.set_enableMRTI(!0),
null!=this._mrtiImage&&this._subCell.set_imageSize(this._mrtiImage.get_fullSize().clone()),this._updateAnnotationContainerSize(),this._subCell.set_offset(lt.LeadPointD.create(1,1)),this._updateSubCellZoom(),this._updateOffset(0,0)),a},get_retakeIndex:function(){return this._retakeIndex},set_retakeIndex:function(a){this._updateRetakeFrame(a);return a},_NFrame:null,get_nFrame:function(){return this._NFrame},set_nFrame:function(a){return this._NFrame=a},get_retakes:function(){return this._retakes},set_retakes:function(a){return this._retakes=
a},_updateRetakeFrame:function(a){var b=this._subCell,c=null,d=null;-1!==this._retakeIndex&&(c=this._retakes.get_item(this._retakeIndex));null!=this._NFrame?(d=this._NFrame,c.set_retakes(d.get_retakes()),c._retakeIndex=d.get_retakeIndex()):(d=this,c=this);var e=this._parent.get_frames().indexOf(c);this._retakeIndex!==a&&(c._attach(null),this._retakeIndex=a,this._retakeIndex>=this._retakes.get_count()&&(this._retakeIndex=-1),-1!==this._retakeIndex?(c=this._retakes.get_item(this._retakeIndex),this._parent.get_frames().set_item(e,
c),this._parent._updateFrameWithSubCell(c,b),c.set_retakes(this._retakes),c._retakeIndex=this._retakeIndex):(this._parent.get_frames().set_item(e,d),this._parent._updateFrameWithSubCell(d,b),d._retakeIndex=this._retakeIndex),b.updateOverlay(),b._updateTag(10))},get_subCell:function(){return this._subCell},get_shutter:function(){return this._shutterObject},get_lineProfile:function(){return this._lineProfileObject},get_imageQuality:function(){return this._imageQuality},get_container:function(){null==
this._container&&(this._createAnnotationContainer(),this._updateAnnotationContainerSize());return this._container},_enableDraw:!0,get_enableDraw:function(){return this._enableDraw},set_enableDraw:function(a){this._enableDraw!==a&&(this._enableDraw=a,null!=this._subCell&&this._subCell.invalidate());return a},get_parentCell:function(){return this._parent},_drawWindowLevel:!1,_drawClientVersion:!0,_fullImageReceived:!1,get__drawClientVersion:function(){return this._drawClientVersion},set__drawClientVersion:function(a){return this._drawClientVersion=
a},_getRender:function(){return this._WLRenderer},_maX_RESIZE_TOLERANCE:0,_getMaxResize:function(){return 225E4},get__orientationOverlay:function(){return this._orientationOverlay},get__deltaWidth:function(){return this._deltaWidth},set__deltaWidth:function(a){return this._deltaWidth=a},get__deltaCenter:function(){return this._deltaCenter},set__deltaCenter:function(a){return this._deltaCenter=a},_cancelAnyFullImageRequest:function(){this._requestSent=!1;this._timerID&&(clearInterval(this._timerID),
this._timerID=0);this.set__drawClientVersion(!0);this._fullImageReceived=!1},_invertPhotometric:function(a){var b=this._subCell;this._supportWindowLevel()?a?this._originalPhotometricInterpretation===this._photometricInterpretation&&(this._photometricInterpretation="MONOCHROME1"===this._originalPhotometricInterpretation?"MONOCHROME2":"MONOCHROME1",this._originalPhotometricInterpretation||(this._originalPhotometricInterpretation=this._photometricInterpretation),null!=b&&b._applyImageProcessingOnTiles()):
this._originalPhotometricInterpretation&&this._originalPhotometricInterpretation!==this._photometricInterpretation&&(this._photometricInterpretation=this._originalPhotometricInterpretation,null!=b&&b._applyImageProcessingOnTiles()):null!=b&&b._applyImageProcessingOnTiles()},get_inverted:function(){return this._inverted},set_inverted:function(a){this._inverted=a;this._invertPhotometric(this._inverted);null!=this._subCell&&(this._cancelAnyFullImageRequest(),this._subCell.invalidate(),this._invertFrame(this._subCell),
this._rerenderWindowLevel(-1,-1),this._parent._fireEvent(this,0,null));return a},_updatePanZoom:function(a){a.zoom(this._getImageViewerSizeMode(this._sizeMode),this._zoom,a.get_defaultZoomOrigin());this._updateOffset(this.get_offsetX(),this.get_offsetY())},_setDisplayVersion:function(){},_clearFrame:function(){null!=this.lowResImage&&(lt.Controls.Medical.Tools.resetCanvas(this.lowResImage.canvas),lt.Controls.Medical.Tools.resetCanvas(this.lowResImage.backCanvas));null!=this.thumbnailImage&&(lt.Controls.Medical.Tools.resetCanvas(this.thumbnailImage.canvas),
lt.Controls.Medical.Tools.resetCanvas(this.thumbnailImage.backCanvas))},_prepareCanvas:function(a,b){b.width=a.naturalWidth;b.height=a.naturalHeight;b.style.width=b.width+"px";b.style.height=b.height+"px"},_prepareFullImageChunk:function(a){if(null!=a){null==a.canvas&&(a.canvas=document.createElement("canvas"));this._prepareCanvas(a._image,a.canvas);if(this._supportWindowLevel()){null==a.backCanvas&&(a.backCanvas=document.createElement("canvas"));this._prepareCanvas(a._image,a.backCanvas);var b=a.backCanvas.getContext("2d")}else b=
a.canvas.getContext("2d");b.clearRect(0,0,a.canvas.width,a.canvas.height);b.drawImage(a._image,0,0);this._applyImageProcessingOnChunk(a)}},_prepareMRTIChunkCanvas:function(){this._prepareFullImageChunk(this.lowResImage);this._prepareFullImageChunk(this.thumbnailImage);null!=this._windowLevelData&&null!=this._information&&this._windowLevelData.set_canvas(this._information.get_canvas())},_attach:function(a){var b=null;null!=this._subCell&&(b=this._subCell.get_attachedFrame().get_container());Type.canCast(this._subCell,
lt.Controls.Medical.MRTISubCell)&&null!=this._mrtiImage&&(this._subCell._mrtiImage=null,this._subCell._clearChunks());this._subCell=a;null==this._subCell?this._clearFrame():this._prepareMRTIChunkCanvas();if(null!=this._parent&&(null==this._shutterObject&&null!=this._subCell&&(this._shutterObject=new lt.Controls.Medical.ShutterObject(this,this._parent.get_automation()),null!=this._shutterObject&&this._shutterObject.attach(this._subCell)),null==this._lineProfileObject))this._lineProfileObject=new lt.Controls.Medical.LineProfileObject(this);
if(null==this._subCell){if(null!=b&&(b.set_isVisible(!1),b.set_isEnabled(!1),b.AttachedSubCell=null,this._timerID&&(clearInterval(this._timerID),this._timerID=0)),null==this._mrtiImage&&this._dataReady)lt.Controls.Medical.Tools._disposeCanvas(this._previewCanvas),this._previewCanvas=null,lt.Controls.Medical.Tools._disposeCanvas(this._drawingCanvas),this._drawingCanvas=null,this._WLRenderer.get_information()._setAndPrepareCanvasData(null),this._information._setAndPrepareCanvasData(null)}else this._subCell._frame=
this,null!=this._subCell._frame&&this._subCell._frame._assignRenderer(),this._subCell.get_attachedFrame().get_container().set_isVisible(!0),this._subCell.get_attachedFrame().get_container().set_isEnabled(!0),null!=this._subCell&&Type.canCast(this._subCell,lt.Controls.Medical.MRTISubCell)&&null!=this._mrtiImage&&(this._subCell._mrtiImage=this._mrtiImage,this._subCell.set_enableMRTI(!0),null!=this._mrtiImage&&this._subCell.set_imageSize(this._mrtiImage.get_fullSize().clone())),null!=this._subCell.get_attachedFrame()&&
(b=this._subCell.get_attachedFrame().get_container()),null!=b&&(b.AttachedSubCell=this._subCell,this._updateAnnotationContainerSize()),this._updateWindowLevel(),this.zoom(this.get_scaleMode(),this.get_scale()),this._setImageDpi(),this._subCell._onFrameAttached(this._subCell,this)},_setDpi:function(){var a,b;b=this._columnSpacing?25.4/this._columnSpacing:150;a=this._rowSpacing?25.4/this._rowSpacing:150;this._subCell.get_resolution().set_width(parseInt(a));this._subCell.get_resolution().set_height(parseInt(b))},
_updateViewerPosition:function(){},_createAnnotationContainer:function(){this._container=new lt.Annotations.Core.AnnContainer;this._container.set_isEnabled(!1);this._container.set_isVisible(!1);this._container.AttachedSubCell=this._subCell;this._container.get_mapper().set_fontRelativeToDevice(!1);this._container.set_size(this._container.get_mapper().sizeToContainerCoordinates(lt.LeadSizeD.create(256,256)));this._parent.get_automation().get_containers().add(this._container);this._parent.get_automation().get_automationControl().automationInvalidate(lt.LeadRectD.get_empty())},
_imageLoaded:function(){this._drawImage()},_dpiY:0,_dpiX:0,_isAlreadyInverted:!1,_canvasData:null,_drawingCanvas:null,_errorLoad:!1,_dataReady:!1,_pngDataReady:!1,_zoom:0,_applyFilter:function(a,b){if(!(null==a||null==a.canvas)){var c=a.canvas.getContext("2d"),d=c.getImageData(0,0,a.canvas.width,a.canvas.height);b.set_imageData(d);b.run();c.putImageData(d,0,0)}},_removeNonVisibleChunks:function(){if(null!=this._subCell)for(var a=this._subCell.get_chunkList(),b=0,c,b=a.length-1;0<=b;b--)c=a[b],c.status.visible||
lt.Controls.Medical.Tools._removeChunk(a,c)},_imageProcessingList_CollectionChanged:function(a,b){null!=this._MRTIRenderer&&(this._MRTIRenderer.imageProcessingList=this._imageProcessingList);if(1===b.get_action()){var c=b.newItems[0],d=this._subCell;c.set_runInMainThread(!0);c.ReadyToProcess=!!c.get_jsFilePath().trim();var e=0,f=d.get_chunkList().length;if(c.ReadyToProcess){for(e=0;e<f;e++)this._applyFilter(d.get_chunkList()[e],c);this._applyFilter(this.lowResImage,c);this._applyFilter(this.thumbnailImage,
c);this._refreshLowRes()}else null==lt.Controls.Medical.Frame._previewLoader&&(lt.Controls.Medical.Frame._previewLoader=new lt.Controls.Medical._imagesLoader(6)),lt.Controls.Medical.Frame._previewLoader.add_imageLoaded(ss.Delegate.create(this,this._previewLoader_ImageLoaded)),lt.Controls.Medical.Frame._previewLoader.IP=c,lt.Controls.Medical.Frame._previewLoader.get_imageElements().add(new lt.Controls.Medical._fullRes_Thumb_ImageInfo(lt.Controls.Medical.Frame._previewLoader.get_dummyImage(),this._construct_fileName(lt.LeadRectD.create(0,
0,1,1),this._mrtiImage.get_resolutions()[this._mrtiImage.get_resolutions().length-1],!1,c))),lt.Controls.Medical.Frame._previewLoader.startLoading()}else 3===b.get_action()&&this._updateImageProcessingList()},_previewLoader_ImageLoaded:function(){lt.Controls.Medical.Frame._previewLoader.remove_imageLoaded(ss.Delegate.create(this,this._previewLoader_ImageLoaded));var a=lt.Controls.Medical.Frame._previewLoader.IP;a.ReadyToProcess=!0;null!=this._parent&&this._parent._fireEvent(this,3,new lt.Controls.Medical.ImageProcessingReadyEventArgs(this,
a));this._updateImageProcessingList()},_retakes_CollectionChanged:function(a,b){if(1===b.get_action())for(var c=0,d=b.newItems.length,e;c<d;c++)e=b.newItems[c],e.set_nFrame(this);else if(3===b.get_action()||!b.get_action()){c=0;for(d=b.newItems.length;c<d;c++)e=b.newItems[c],e._attach(null),e.dispose();this._retakeIndex>=this._retakes.get_count()&&this._updateRetakeFrame(this._retakes.get_count()-1)}},_originalWindowLevelWidth:0,_originalWindowLevelCenter:0,_windowLevel_Started:function(a){null==
this._WLRenderer?a.set_data(null):(null!=this._subCell&&(this.set__drawClientVersion(!0),this._drawWindowLevel=!0,this._subCell.invalidate()),a.set_data(this._windowLevelData),this._originalWindowLevelWidth=this._WLRenderer.get_windowLevelWidth(),this._originalWindowLevelCenter=this._WLRenderer.get_windowLevelCenter())},_windowLevel_Delta:function(a,b){var c=parseInt(b.get_change().get_x()),d=parseInt(b.get_change().get_y()),e=this._parent,f=this._subCell.get_attachedFrame();if(e.get_linked())for(var g=
0,h=e.get_frames().get_count(),i;g<h;g++)i=e.get_frames().get_item(g),i!==f&&(i.set__deltaWidth(i.get__deltaWidth()+c),i.set__deltaCenter(i.get__deltaCenter()+d))},_windowLevel_Completed:function(a){if(null!=this._WLRenderer){var b=this._WLRenderer.get_windowLevelWidth()-this._originalWindowLevelWidth,c=this._WLRenderer.get_windowLevelCenter()-this._originalWindowLevelCenter;a.get_imageViewer();var d=this._subCell.get_attachedFrame();if(3>=Math.abs(b)&&3>=Math.abs(c))this._fullImageReceived&&(this.set__drawClientVersion(!1),
this._drawWindowLevel=!1),this._subCell.invalidate();else{var e=this._parent;null!=this._subCell&&e._fireEvent(this,0,null);if(e.get_linked()){var f=0,g=e.get_frames().get_count(),h;for(e.get_imageViewer().beginUpdate();f<g;f++)if(h=e.get_frames().get_item(f),h!==d&&(b||c)&&null!=h.get_wlRenderer())a.set_data(h.get_wlData()),h.setWindowLevel(h.get_windowWidth(),h.get_windowCenter());a.set_data(d.get_wlData());e.get_imageViewer().endUpdate()}}}},_clearWindowLevelInteractiveMode:function(){},_deleteWindowLevelInteractiveMode:function(){this._clearWindowLevelInteractiveMode()},
get_wlData:function(){return this._windowLevelData},_windowLevelData:null,_createWindowLevelInteractive:function(){null==this._windowLevelData&&(this._windowLevelData=new lt.Controls.Medical.WindowLevelData,this._windowLevelData.Frame=this,this._windowLevelData.set_enableWindowLevelSensitivity(!0),this._windowLevelData.set_dragDeltaSensitivity(3))},get_userData:function(){return this._userData},set_userData:function(a){return this._userData=a},dispose:function(){null!=this._imagePNGData&&(this._imagePNGData.removeEventListener("load",
this._onImageLoadedSuccess,!1),this._imagePNGData.removeEventListener("error",this._onImageLoadedError,!1));if(null!=this._NFrame)for(var a=this._retakes.get_count()-1,b;-1<a;a--)b=this._retakes.get_item(a),this._retakes.removeAt(a),b.dispose();this._onImageLoadedSuccess=this._onImageLoadedError=null;this._originalRetakes.remove_collectionChanged(ss.Delegate.create(this,this._retakes_CollectionChanged));null!=this._imagePNGData&&(this._imagePNGData=this._imagePNGData.src=null,delete this._imagePNGData);
lt.Controls.Medical.Tools._disposeCanvas(this._imagePNGCanvas);this._deleteWindowLevelInteractiveMode();null!=lt.Controls.Medical.Frame._previewLoader&&lt.Controls.Medical.Frame._previewLoader.removeMyStuffFromTheList(this)},get_isDataReady:function(){return!this._supportWindowLevel()?null!=this._canvasData:this._dataReady?!0:null!=this._canvasData},_updatePhotometric:function(){var a=this._inverted,b=this._information.get_photometricInterpretation();if("MONOCHROME2"===b||"MONOCHROME1"===b){if(!a&&
this._photometricInterpretation===this._information.get_photometricInterpretation()||a&&this._photometricInterpretation!==this._information.get_photometricInterpretation())return!1;if("MONOCHROME2"===this._information.get_photometricInterpretation())return this._information.set_photometricInterpretation("MONOCHROME1"),!0;if("MONOCHROME1"===this._information.get_photometricInterpretation())return this._information.set_photometricInterpretation("MONOCHROME2"),!0}return!1},_applyWindowLevelOnTiles:function(){this._WLRenderer=
this._getWLRenderer();if(null!=this._WLRenderer){var a=this._subCell;if(null!=a)for(var b=0,c=a.get_chunkList().length,b=0;b<c;b++)this._WLRenderer.renderInPlace(a.get_chunkList()[b])}},_mrti_renderer_Changed:function(a){null!=this._subCell&&(this._windowWidth=a.get_windowLevelWidth(),this._windowCenter=a.get_windowLevelCenter(),this._deltaCenter=this._deltaWidth=0,null==this._subCell.get_imageViewer()||null==this._subCell.get_imageViewer().get_foreCanvas()||(this._subCell._updateTag(0),this._subCell.invalidate()))},
_mrti_renderer_UpdateImageData:function(){var a=this._subCell;null!=a&&!(null==a.get_imageViewer()||null==a.get_imageViewer().get_foreCanvas())&&this._subCell.invalidate()},_onWindowLevelRendererCreated:function(){this._checkImageQuality();var a=this._getWindowLevelValues();this._windowWidth||(this._defaultWindowLevelWidth?(this._windowWidth=this._defaultWindowLevelWidth,this._windowCenter=this._defaultWindowLevelCenter):(this._windowWidth=a.width,this._windowCenter=a.center,this._defaultWindowLevelWidth=
a.width,this._defaultWindowLevelCenter=a.center));this._dataReady=!0;this._incorporateDeltaIntoWindowLevel();null!=this._subCell&&(this._subCell._updateTag(0),this._subCell._updateTag(3));this._windowLevelData.set_canvas(this._information.get_canvas());this._windowLevelData.set_renderer(this._WLRenderer)},_getWLRenderer:function(){var a=null;if(null!=this._WLRenderer)return this._WLRenderer;if(null==this.get_information())return null;a=null!=this.lowResImage?this.lowResImage.backCanvas:null!=this.thumbnailImage?
this.thumbnailImage.backCanvas:null;if(null==a)return null;this._autoScaleValuesRetreived||this._getAutoScaleValue(a);null!=a&&this.get_information().set_canvas(a);a=new lt.Controls.Medical.DICOMImageInformationRenderer(this.get_information());a.add_updateImageData(ss.Delegate.create(this,this._mrti_renderer_UpdateImageData));a.add_changed(ss.Delegate.create(this,this._mrti_renderer_Changed));this._WLRenderer=a;this._onWindowLevelRendererCreated();return a},get_information:function(){return this._information},
set_information:function(a){this._information=a;this._photometricInterpretation=this._information.get_photometricInterpretation();null!=this._mrtiImage&&this._frameImageReady();this._supportWindowLevel()&&null!=this._mrtiImage&&this._applyWindowLevelOnTiles();this._inverted&&this._updatePhotometric();return a},get_imagePosition:function(){return this._imagePosition},set_imagePosition:function(a){return this._imagePosition=a},get_imageOrientation:function(){return this._imageOrientation},set_imageOrientation:function(a){this._imageOrientation=
a;null==this.get_patientProjection()&&(this._orientationOverlay=new lt.Controls.Medical._orientationLetters(this._imageOrientation));this._orientationOverlay.updateImageProjection(this._projectionOrientation);null!=this._subCell&&this._subCell._reRenderOverlay();return a},_onImageLoadedSuccess:null,_onImageLoadedError:null,_frameIndex:0,_WLRenderer:null,_prepareRendererImageData:function(a){this._WLRenderer=a;null==this._drawingCanvas&&(this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id=
"testingin");this._drawingCanvas.width=this.get_information().get_width();this._drawingCanvas.height=this.get_information().get_height()},_withinVisibleRange:function(a){if(null==this._parent)return!1;var b=this._parent.get_currentOffset(),c=Math.min(this._parent.get_frames().get_count(),b+this._parent.get_imageViewer().get_items().get_count());if(null!=this._parent.get_framesMappingIndex()){for(var d=0,d=b;d<c;d++)if(this._parent.get_framesMappingIndex()[d]===a)return!0;return!1}return a>=b&&a<c},
_getFrameIndex:function(){return null!=this._parent&&null!=this._parent.get_imageViewer()?this._parent.get_frames().indexOf(this):-1},_applyWindowLevel:function(){this._withinVisibleRange(this._getFrameIndex())&&this._parent.get_currentOffset();return!1},_supportWindowLevel:function(){var a=this.get_photometricInterpretation();null!=this.get_information()&&(a=this.get_information().get_photometricInterpretation());return"MONOCHROME2"===a||"MONOCHROME1"===a},_invertCanvas:function(a,b,c){for(var d=
a.getImageData(0,0,b,c),e=d.data,b=4*b*c,c=0;c<b;c+=4)e[c]=255-e[c],e[c+1]=255-e[c+1],e[c+2]=255-e[c+2];a.putImageData(d,0,0)},_updateOffset:function(){var a=this._getViewerImagePosition(this._subCell);if(!a.get_isEmpty()){var b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this._subCell.get_imageViewer(),this._subCell),c=this._subCell.get_imageViewer().getItemViewBounds(this._subCell,lt.Controls.ImageViewerItemPart.item,!1);lt.LeadPointD.create(parseInt(0.1+(a.get_x()-(b.get_left()-c.get_left())+
this.get_offsetX())),parseInt(0.1+(a.get_y()-(b.get_top()-c.get_top())+this.get_offsetY())));this._restorePosition()}},_getImageSize:function(){return null!=this._mrtiImage?this._mrtiImage.get_fullSize():null!=this._subCell&&!this._subCell.get_imageSize().get_isEmpty()?this._subCell.get_imageSize():lt.LeadSizeD.create(this._width,this._height)},_updateAnnotationContainerSize:function(){if(null!=this._subCell){var a=this._getImageSize().clone();if(a.get_width()&&a.get_height()){var b=this._container.get_mapper().get_transform().clone();
this._container.get_mapper().updateTransform(lt.LeadMatrix.get_identity());this._columnSpacing&&this._rowSpacing?this._container.get_mapper().mapResolutions(this._container.get_mapper().get_sourceDpiX(),this._container.get_mapper().get_sourceDpiY(),25.4/this._columnSpacing,25.4/this._rowSpacing):this._container.get_mapper().mapResolutions(this._container.get_mapper().get_sourceDpiX(),this._container.get_mapper().get_sourceDpiY(),150,150);this._container.set_size(this._container.get_mapper().sizeToContainerCoordinates(a));
this._container.get_mapper().updateTransform(b)}}},_drawImage:function(){this._parent.get_frames().indexOf(this);if(null!=this._subCell){var a=this._subCell;if(null!=a.get__parentViewer())if(this._errorLoad){a.get__parentViewer().beginTransform();var b=new lt.LeadSizeD;b.set_width(1);b.set_height(1);a.get__parentViewer().endTransform();this._updateOffset(0,0)}else if(this.get_isDataReady()){var b=parseInt(this._width),c=parseInt(this._height),b=b?b:null!=this.get_information()?this.get_information().get_width():
null.naturalWidth,c=c?c:null!=this.get_information()?this.get_information().get_height():null.height,d=lt.LeadSizeD.create(b,c);a.get__parentViewer().beginTransform();lt.LeadSizeD.equals(d,a.get_imageSize())||(null!=this._mrtiImage?a.set_imageSize(this._mrtiImage.get_fullSize().clone()):a.set_imageSize(d.clone()),this._updateAnnotationContainerSize(),this._subCell.set_offset(lt.LeadPointD.create(1,1)),this._updateSubCellZoom(),this._updateOffset(b,c));!this.get_isDataReady()&&!this._pngDataReady&&
1===(this._inverted^this._isAlreadyInverted)&&(this._invertCanvas(this._drawingCanvas.getContext("2d"),this._drawingCanvas.width,this._drawingCanvas.height),this._isAlreadyInverted=this._inverted);a.get__parentViewer().endTransform();this._setImageDpi();a.invalidate()}else null!=a.get__parentViewer()&&(a.get__parentViewer().beginTransform(),b=new lt.LeadSizeD,b.set_width(1),b.set_height(1),this._updateOffset(0,0),a.get__parentViewer().endTransform())}},_setImageDpi:function(){var a=this,b=0,c=0;null==
a&&(a=this._parent.get_frames().get_item(0));a.get_rowSpacing()||(a=this._parent.get_frames().get_item(0));a.get_columnSpacing()||(a=this._parent.get_frames().get_item(0));b=a.get_columnSpacing();c=a.get_rowSpacing();a._dpiY=b?25.4/b:150;a._dpiX=c?25.4/c:150;!ss.isNull(a._dpiX)&&!ss.isNull(a._dpiY)&&null!=this._subCell&&(this._subCell.get_imageViewer().beginTransform(),this._subCell.get_resolution().set_width(parseInt(a._dpiX)),this._subCell.get_resolution().set_height(parseInt(a._dpiY)),this._subCell.get_imageViewer().endTransform())},
_createDataCanvasElement:function(){if(null==this._imagePNGCanvas){var a=this.get_information().get_width(),b=this.get_information().get_height();this._imagePNGCanvas=document.createElement("canvas");this._imagePNGCanvas.id="frameCanvas"+this._frameIndex;this._imagePNGCanvas.width=a;this._imagePNGCanvas.height=b;this._imagePNGCanvas.style.position="absolute";this._imagePNGCanvas.style.left="0px";this._imagePNGCanvas.style.top="0px";this._imagePNGCanvas.style.width=a+"px";this._imagePNGCanvas.style.height=
b+"px"}},_createDataImageElement:function(){var a=this.get_information().get_width(),b=this.get_information().get_height();this._imagePNGData=document.createElement("img");this._imagePNGData.id="frameCanvas"+this._frameIndex;this._imagePNGData.width=a;this._imagePNGData.height=b;this._imagePNGData.style.position="absolute";this._imagePNGData.style.left="0px";this._imagePNGData.style.top="0px";this._imagePNGData.style.width=a+"px";this._imagePNGData.style.height=b+"px"},_checkImageQuality:function(){null!=
this._imageType&&2<=this._imageType.length&&("DERIVED"===this._imageType[0]||"SECONDARY"===this._imageType[0])?(this._imageQuality="D",this._subCell._updateTag(3)):this._lossyCompression&&(this._imageQuality="!",this._subCell._updateTag(3))},_getWindowLevelValues:function(){var a=new lt.Controls.Medical._windowLevelValues;this._supportWindowLevel()&&this.isImageDataAvailable()&&null!=this._WLRenderer&&(a.width=this._WLRenderer.get_windowLevelWidth(),a.center=this._WLRenderer.get_windowLevelCenter());
return a},isImageDataAvailable:function(){return this.get_isDataReady()||null!=this._WLRenderer},_assignRenderer:function(){var a=this._getFrameIndex();this._checkImageQuality();null==this._mrtiImage&&this._supportWindowLevel()&&this.isImageDataAvailable()&&this._applyWindowLevel(a)},_onImageDataReady:function(){var a=this._getFrameIndex();this._assignRenderer();var b=this._getWindowLevelValues();this._windowWidth||(this._defaultWindowLevelWidth?(this._windowWidth=this._defaultWindowLevelWidth,this._windowCenter=
this._defaultWindowLevelCenter):(this._windowWidth=b.width,this._windowCenter=b.center,this._defaultWindowLevelWidth=b.width,this._defaultWindowLevelCenter=b.center));this._dataReady=!0;this._rerenderWindowLevel(this._windowWidth+this._deltaWidth,this._windowCenter+this._deltaCenter);this._withinVisibleRange(a)&&null!=this._subCell&&(this._subCell._updateTag(0),this._subCell._updateTag(3));null!=this.__imageDataReady&&this.__imageDataReady(this,lt.LeadEventArgs.Empty)},_getViewerImagePosition:function(a){var b=
lt.Controls.Medical.MRTISubCell.getFloatImageRect(this._subCell.get_imageViewer(),this._subCell),c=b.get_width()/2,b=b.get_height()/2,d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1).get_size(),a=d.get_width()/2,d=d.get_height()/2;return lt.LeadPointD.create(a-c,d-b)},_updateFrameSize:function(){},_invertFrame:function(){var a=!1,b=this._WLRenderer,c="",d=null,e=this._inverted,d=null!=b?b.get_information():this.get_information();null!=d&&(c=d.get_photometricInterpretation());
var f=!1;if("MONOCHROME2"===c||"MONOCHROME1"===c){if(!e&&this._photometricInterpretation===d.get_photometricInterpretation()||e&&this._photometricInterpretation!==d.get_photometricInterpretation())return a;"MONOCHROME2"===d.get_photometricInterpretation()?(d.set_photometricInterpretation("MONOCHROME1"),f=!0):"MONOCHROME1"===d.get_photometricInterpretation()&&(d.set_photometricInterpretation("MONOCHROME2"),f=!0)}null!=b?f&&(b._updateRenderer(),a=!0):this._drawImage();return a},get_wlRenderer:function(){return this._WLRenderer},
_updateWindowLevel:function(){if(null!=this._subCell){var a=this._getRender(),b=0,c=0,d=!1;null!=this._subCell&&(d=this._invertFrame(this._subCell));if(null!=a){var e=a.get_windowLevelWidth(),f=a.get_windowLevelCenter(),b=this._windowWidth+this._deltaWidth,c=this._windowCenter+this._deltaCenter;if(e!==b||f!==c)null!=this._subCell&&(d=1===(d|1));this._windowWidth||(b=a.get_windowLevelWidth(),c=a.get_windowLevelCenter())}d&&this._rerenderWindowLevel(b,c)}},_rerenderWindowLevel:function(a,b){var c=null;
null==c&&(c=this._WLRenderer);if(null!=c){if(-1===a){var d=this._getWindowLevelValues();c.updateWindowLevelLUT(d.width,d.center)}else c.updateWindowLevelLUT(a,b);null!=this._subCell&&(this._subCell.updateWindowlevel(!0),this._subCell.invalidate())}},_timerID:0,_requestSent:!1,get_width:function(){return this._width},set_width:function(a){this._width=a;null!=this._parent&&this._parent.set__crossHairPosition(lt.LeadPointD.create(this._width/2,this._height/2));return a},get_height:function(){return this._height},
set_height:function(a){this._height=a;null!=this._parent&&this._parent.set__crossHairPosition(lt.LeadPointD.create(this._width/2,this._height/2));return a},get_rowSpacing:function(){return this._rowSpacing},set_rowSpacing:function(a){this._rowSpacing=a;this._updateAnnotationContainerSize();return a},get_columnSpacing:function(){return this._columnSpacing},set_columnSpacing:function(a){this._columnSpacing=a;this._updateAnnotationContainerSize();return a},get_projectionOrientation:function(){return this._projectionOrientation},
set_projectionOrientation:function(a){this._projectionOrientation!==a&&(this._projectionOrientation=a,null!=this._orientationOverlay&&this._orientationOverlay.updateImageProjection(this._projectionOrientation));return a},get_patientProjection:function(){return this._patientProjection},set_patientProjection:function(a){this._patientProjection=a;null==this._imageOrientation&&(this._orientationOverlay=new lt.Controls.Medical._orientationLetters([0,1,0,0,1,0]));this._orientationOverlay.updateImageProjection(this._projectionOrientation);
this._orientationOverlay.setProjectionRadiographOrientation(this._patientProjection);null!=this._subCell&&this._subCell._reRenderOverlay();return a},get_instanceNumber:function(){return this._instanceNumber},set_instanceNumber:function(a){return this._instanceNumber=a},get_bitPerpixel:function(){return this._bitPerpixel},set_bitPerpixel:function(a){return this._bitPerpixel=a},get_defaultWindowLevelWidth:function(){return this._defaultWindowLevelWidth},get_defaultWindowLevelCenter:function(){return this._defaultWindowLevelCenter},
setWindowLevelDefaultValues:function(a,b){null!=this._subCell&&(this._defaultWindowLevelWidth=a,this._defaultWindowLevelCenter=b,this._rerenderWindowLevel(this._defaultWindowLevelWidth+this._deltaWidth,this._defaultWindowLevelCenter+this._deltaCenter))},get_windowWidth:function(){return this._windowWidth+this._deltaWidth},get_windowCenter:function(){return this._windowCenter+this._deltaCenter},setWindowLevel:function(a,b){this._windowWidth=a;this._windowCenter=b;this._deltaWidth=this._deltaCenter=
0;this._rerenderWindowLevel(a,b);null!=this._subCell&&this._parent._fireEvent(this,0,null)},get_minValue:function(){return this._minValue},set_minValue:function(a){return this._minValue=a},get_maxValue:function(){return this._maxValue},set_maxValue:function(a){return this._maxValue=a},get_lowBit:function(){return this._lowBit},set_lowBit:function(a){return this._lowBit=a},get_highBit:function(){return this._highBit},set_highBit:function(a){return this._highBit=a},get_bitStored:function(){return this._bitStored},
set_bitStored:function(a){return this._bitStored=a},get_rescaleintercept:function(){return this._rescaleintercept},set_rescaleintercept:function(a){return this._rescaleintercept=a},get_rescaleSlope:function(){return this._rescaleSlope},set_rescaleSlope:function(a){return this._rescaleSlope=a},get_voiLUTSequence:function(){return this._voiLUTSequence},set_voiLUTSequence:function(a){return this._voiLUTSequence=a},get_imageType:function(){return this._imageType},set_imageType:function(a){this._imageType=
a;this._checkImageQuality();return a},get_lossyCompression:function(){return this._lossyCompression},set_lossyCompression:function(a){this._lossyCompression=a;this._checkImageQuality();return a},get_isWaveForm:function(){return this._isWaveForm},set_isWaveForm:function(a){return this._isWaveForm=a},_updateSubCell:function(){var a,b,c;null!=this._orientationOverlay?(a=(this._rotation+this._orientationOverlay.projectionRrotateAngle)%360,b=1===(this._flipped^this._orientationOverlay.projectionIsFlipped),
c=1===(this._reversed^this._orientationOverlay.projectionIsReversed)):(a=this._rotation,b=this._flipped,c=this._reversed);null!=this._orientationOverlay&&(this._orientationOverlay.set_rotateAngle(a),this._orientationOverlay.set_flip(b),this._orientationOverlay.set_reverse(c));null!=this._subCell&&(this._subCell._updateTag(8),this._subCell._updateTag(7),this._subCell._updateTag(6),this._subCell._updateTag(5))},get_frameOfReferenceID:function(){return this._frameOfReferenceID},set_frameOfReferenceID:function(a){return this._frameOfReferenceID=
a},get_photometricInterpretation:function(){return this._photometricInterpretation},set_photometricInterpretation:function(a){this._photometricInterpretation=a;null!=this._information&&this._information.set_photometricInterpretation(this._photometricInterpretation);this._originalPhotometricInterpretation||(this._originalPhotometricInterpretation=a);return a},get_flipped:function(){return this._flipped},set_flipped:function(a){if(this._flipped!==a)return this._flipped=a,this._normalizedPosition.set_y(-this._normalizedPosition.get_y()),
this._updateSubCell(),this._updateSubCellZoom(),this._invalidateAnnotation(),a},get_reversed:function(){return this._reversed},set_reversed:function(a){this._reversed=a;this._normalizedPosition.set_x(-this._normalizedPosition.get_x());this._updateSubCell();this._updateSubCellZoom();this._invalidateAnnotation();return a},_rotatePosition:function(){},_moveYourAss:function(){null!=this._subCell&&(this._subCell.offsetBy(lt.LeadPointD.create(1,0)),this._subCell.invalidate())},get_rotateAngle:function(){return this._rotation},
set_rotateAngle:function(a){var b=a,b=a%360;0>b&&(b+=360);if(this._rotation!==b){this._normalizedPosition=lt.Controls.Medical._mrtiRenderer.transformPoint(this._normalizedPosition,lt.LeadPointD.create(0,0),!1,!1,b-this._rotation);this._rotation=b;if(null!=this._subCell)this._subCell.onSizeChanged();this._updateSubCell();this._updateSubCellZoom();this._invalidateAnnotation();return a}},_invalidateAnnotation:function(){if(null!=this._subCell){var a=this._subCell.get_imageViewer();a.automationInvalidate(a.getItemViewBounds(this._subCell,
lt.Controls.ImageViewerItemPart.item,!1))}},get_offsetX:function(){return this._offsetX=this._normalizedPosition.get_x()*this.getFullSize().get_width()},set_offsetX:function(a){this._offsetX=a;this._normalizedPosition.set_x(this._offsetX/this.getFullSize().get_width());this._updateSubCell();return a},getFullSize:function(){return null!=this._mrtiImage?this._mrtiImage.get_fullSize():lt.LeadSizeD.create(this._width,this._height)},get_offsetY:function(){return this._offsetY=this._normalizedPosition.get_y()*
this.getFullSize().get_height()},set_offsetY:function(a){this._offsetY=a;this._normalizedPosition.set_y(this._offsetY/this.getFullSize().get_height());this._updateSubCell();return a},_sizeMode:0,_scaleFactor:1,_getImageViewerSizeMode:function(a){switch(a){case 2:return lt.Controls.ControlSizeMode.none;case 1:return lt.Controls.ControlSizeMode.actualSize;case 3:return lt.Controls.ControlSizeMode.none;default:return lt.Controls.ControlSizeMode.none}},get_scale:function(){return this._scaleFactor},set_scale:function(a){this._scaleFactor=
a;this._updateFramePanZoom();return a},_updateFramePanZoom:function(){},zoom:function(a,b){this._sizeMode=a;this._scaleFactor=b;this._updateSubCellZoom()},_getFrameImageRealSize:function(){return lt.LeadSizeD.create(this.get_width(),this.get_height())},_calculateScaleFactor:function(a){var b=this._getFrameImageRealSize();if(3===this._sizeMode)return this._scaleFactor*(this._subCell.get__parentViewer().get_screenDpi().get_width()/this._dpiX)*(b.get_height()/this._subCell.get_imageSize().get_height());
if(2===this._sizeMode){b=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1);if(b.get_isEmpty())return 0;var c=90===this._rotation||270===this._rotation,d;null!=this._mrtiImage?(d=c?this._mrtiImage.get_fullSize().get_height():this._mrtiImage.get_fullSize().get_width(),a=c?this._mrtiImage.get_fullSize().get_width():this._mrtiImage.get_fullSize().get_height()):(d=c?a.get_imageSize().get_height():a.get_imageSize().get_width(),a=c?a.get_imageSize().get_width():a.get_imageSize().get_height());
a=b.get_height()/a;b=b.get_width()/d;return this._scaleFactor*Math.min(b,a)}return this._scaleFactor},_updateSubCellZoom:function(){if(null!=this._subCell){var a=this._getImageViewerSizeMode(this._sizeMode),b=this._scaleFactor;if(3===this._sizeMode||2===this._sizeMode)b=this._calculateScaleFactor(this._subCell);b&&(a===lt.Controls.ControlSizeMode.actualSize&&1!==b?this._subCell.zoom(lt.Controls.ControlSizeMode.none,b,this._subCell.get_defaultZoomOrigin()):this._subCell.zoom(a,b,this._subCell.get_defaultZoomOrigin()),
this._updateOffset(this.get_offsetX(),this.get_offsetY()))}},get_scaleMode:function(){return this._sizeMode},reset:function(){this._imageProcessingList.remove_collectionChanged(ss.Delegate.create(this,this._imageProcessingList_CollectionChanged));this._imageProcessingList.clear();this._imageProcessingList.add_collectionChanged(ss.Delegate.create(this,this._imageProcessingList_CollectionChanged));this._updateImageProcessingList();this._scaleFactor=1;this._sizeMode=2;this._deltaCenter=this._deltaWidth=
this._offsetY=this._offsetX=0;null!=this._subCell&&this._subCell.get__parentViewer().beginTransform();this.set_rotateAngle(0);this.set_flipped(!1);this.set_reversed(!1);this.set_inverted(!1);null!=this._subCell&&(this._subCell.set_flip(!1),this._subCell.set_reverse(!1),this._subCell.set_rotateAngle(0),this._updateSubCellZoom(),this._rerenderWindowLevel(this._defaultWindowLevelWidth,this._defaultWindowLevelCenter));null!=this._subCell&&this._subCell.get__parentViewer().endTransform()},_updateImageProcessingList:function(){this._removeNonVisibleChunks();
null!=this._subCell&&this._subCell.updateView(0,!0);this._refreshLowRes()},get_useDPI:function(){return this._useDPI},set_useDPI:function(a){this._useDPI=a;null!=this._subCell&&this._updateFrameSize(this._subCell);return a},_incorporateDeltaIntoWindowLevel:function(){if(this._deltaWidth||this._deltaCenter)this._windowWidth+=this._deltaWidth,this._windowCenter+=this._deltaCenter,this._deltaCenter=this._deltaWidth=0,this._WLRenderer.updateWindowLevelLUT(this._windowWidth,this._windowCenter)},_renderChunkWindowLevel:function(a){if(this._mrtiImage.get_supportWindowLevel()&&
(this._getWLRenderer(),!(null==this.get_wlRenderer()||null==a))){var b=a.canvas.getContext("2d");b.clearRect(0,0,a.backCanvas.width,a.backCanvas.height);b.drawImage(a.backCanvas,0,0);this._incorporateDeltaIntoWindowLevel();this.get_wlRenderer().renderInPlace(a)}},_frameDataReady:!1,_frameImageReady:function(){if(!this._frameDataReady&&(null!=this.lowResImage||null!=this.thumbnailImage)&&null!=this.get_information())this.get_parentCell().get_progress().set_progress(this.get_parentCell().get_progress().get_progress()+
1),this._WLRenderer=this._getWLRenderer(),null!=this._WLRenderer&&(this._frameDataReady=!0,this._onImageDataReady())},_mrtiRenderer_RenderLowResolution:function(a,b){null!=this.lowResImage&&(lt.Controls.Medical.Tools._removeChunk(null,this.lowResImage),this.lowResImage=null);null==this.lowResImage&&(this.lowResImage=new lt.Controls.Medical.ChunkData(b.get_chunkImage(),b.get_chunkRect(),b.get_resolution(),b.get_chunkCanvas()),this.lowResImage.backCanvas=b.get_backCanvas(),null!=this._subCell&&this._applyImageProcessingOnChunk(this.lowResImage));
null==this.thumbnailImage&&(this._frameDataReady&&this._subCell.invalidate(),this._frameImageReady())},_MRTIRenderer_RenderThumbnail:function(a,b){null!=this.thumbnailImage&&(lt.Controls.Medical.Tools._removeChunk(null,this.thumbnailImage),this.thumbnailImage=null);null==this.thumbnailImage&&(this.thumbnailImage=new lt.Controls.Medical.ChunkData(b.get_chunkImage(),b.get_chunkRect(),b.get_resolution(),b.get_chunkCanvas()),this.thumbnailImage.backCanvas=b.get_backCanvas(),null!=this._subCell&&this._applyImageProcessingOnChunk(this.thumbnailImage));
null==this.lowResImage&&this._frameImageReady()},_applyImageProcessingOnChunk:function(a){null!=a&&(this._mrtiImage.get_supportWindowLevel()?this._renderChunkWindowLevel(a):this.get_inverted()!==a.status.inverted&&(this._invertCanvas(a.canvas.getContext("2d"),a.canvas.width,a.canvas.height),a.status.inverted=!a.status.inverted))}};Object.defineProperty(lt.Controls.Medical.Frame.prototype,"imageDataReady",{get:lt.Controls.Medical.Frame.prototype.__imageDataReady_handler_get,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.Frame.prototype,"imageProcessingList",{get:lt.Controls.Medical.Frame.prototype.get_imageProcessingList,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"mrtiInfo",{get:lt.Controls.Medical.Frame.prototype.get_mrtiInfo,set:lt.Controls.Medical.Frame.prototype.set_mrtiInfo,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"retakeIndex",{get:lt.Controls.Medical.Frame.prototype.get_retakeIndex,
set:lt.Controls.Medical.Frame.prototype.set_retakeIndex,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"nFrame",{get:lt.Controls.Medical.Frame.prototype.get_nFrame,set:lt.Controls.Medical.Frame.prototype.set_nFrame,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"retakes",{get:lt.Controls.Medical.Frame.prototype.get_retakes,set:lt.Controls.Medical.Frame.prototype.set_retakes,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,
"subCell",{get:lt.Controls.Medical.Frame.prototype.get_subCell,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"shutter",{get:lt.Controls.Medical.Frame.prototype.get_shutter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"lineProfile",{get:lt.Controls.Medical.Frame.prototype.get_lineProfile,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"imageQuality",{get:lt.Controls.Medical.Frame.prototype.get_imageQuality,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"container",{get:lt.Controls.Medical.Frame.prototype.get_container,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"enableDraw",{get:lt.Controls.Medical.Frame.prototype.get_enableDraw,set:lt.Controls.Medical.Frame.prototype.set_enableDraw,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"parentCell",{get:lt.Controls.Medical.Frame.prototype.get_parentCell,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"inverted",{get:lt.Controls.Medical.Frame.prototype.get_inverted,set:lt.Controls.Medical.Frame.prototype.set_inverted,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"wlData",{get:lt.Controls.Medical.Frame.prototype.get_wlData,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"userData",{get:lt.Controls.Medical.Frame.prototype.get_userData,
set:lt.Controls.Medical.Frame.prototype.set_userData,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"isDataReady",{get:lt.Controls.Medical.Frame.prototype.get_isDataReady,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"information",{get:lt.Controls.Medical.Frame.prototype.get_information,set:lt.Controls.Medical.Frame.prototype.set_information,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,
"imagePosition",{get:lt.Controls.Medical.Frame.prototype.get_imagePosition,set:lt.Controls.Medical.Frame.prototype.set_imagePosition,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"imageOrientation",{get:lt.Controls.Medical.Frame.prototype.get_imageOrientation,set:lt.Controls.Medical.Frame.prototype.set_imageOrientation,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"wlRenderer",{get:lt.Controls.Medical.Frame.prototype.get_wlRenderer,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"width",{get:lt.Controls.Medical.Frame.prototype.get_width,set:lt.Controls.Medical.Frame.prototype.set_width,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"height",{get:lt.Controls.Medical.Frame.prototype.get_height,set:lt.Controls.Medical.Frame.prototype.set_height,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"rowSpacing",
{get:lt.Controls.Medical.Frame.prototype.get_rowSpacing,set:lt.Controls.Medical.Frame.prototype.set_rowSpacing,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"columnSpacing",{get:lt.Controls.Medical.Frame.prototype.get_columnSpacing,set:lt.Controls.Medical.Frame.prototype.set_columnSpacing,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"projectionOrientation",{get:lt.Controls.Medical.Frame.prototype.get_projectionOrientation,
set:lt.Controls.Medical.Frame.prototype.set_projectionOrientation,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"patientProjection",{get:lt.Controls.Medical.Frame.prototype.get_patientProjection,set:lt.Controls.Medical.Frame.prototype.set_patientProjection,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"instanceNumber",{get:lt.Controls.Medical.Frame.prototype.get_instanceNumber,set:lt.Controls.Medical.Frame.prototype.set_instanceNumber,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"bitPerpixel",{get:lt.Controls.Medical.Frame.prototype.get_bitPerpixel,set:lt.Controls.Medical.Frame.prototype.set_bitPerpixel,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"defaultWindowLevelWidth",{get:lt.Controls.Medical.Frame.prototype.get_defaultWindowLevelWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"defaultWindowLevelCenter",
{get:lt.Controls.Medical.Frame.prototype.get_defaultWindowLevelCenter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"windowWidth",{get:lt.Controls.Medical.Frame.prototype.get_windowWidth,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"windowCenter",{get:lt.Controls.Medical.Frame.prototype.get_windowCenter,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"minValue",{get:lt.Controls.Medical.Frame.prototype.get_minValue,
set:lt.Controls.Medical.Frame.prototype.set_minValue,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"maxValue",{get:lt.Controls.Medical.Frame.prototype.get_maxValue,set:lt.Controls.Medical.Frame.prototype.set_maxValue,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"lowBit",{get:lt.Controls.Medical.Frame.prototype.get_lowBit,set:lt.Controls.Medical.Frame.prototype.set_lowBit,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,
"highBit",{get:lt.Controls.Medical.Frame.prototype.get_highBit,set:lt.Controls.Medical.Frame.prototype.set_highBit,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"bitStored",{get:lt.Controls.Medical.Frame.prototype.get_bitStored,set:lt.Controls.Medical.Frame.prototype.set_bitStored,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"rescaleintercept",{get:lt.Controls.Medical.Frame.prototype.get_rescaleintercept,set:lt.Controls.Medical.Frame.prototype.set_rescaleintercept,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"rescaleSlope",{get:lt.Controls.Medical.Frame.prototype.get_rescaleSlope,set:lt.Controls.Medical.Frame.prototype.set_rescaleSlope,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"voiLUTSequence",{get:lt.Controls.Medical.Frame.prototype.get_voiLUTSequence,set:lt.Controls.Medical.Frame.prototype.set_voiLUTSequence,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,
"imageType",{get:lt.Controls.Medical.Frame.prototype.get_imageType,set:lt.Controls.Medical.Frame.prototype.set_imageType,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"lossyCompression",{get:lt.Controls.Medical.Frame.prototype.get_lossyCompression,set:lt.Controls.Medical.Frame.prototype.set_lossyCompression,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"isWaveForm",{get:lt.Controls.Medical.Frame.prototype.get_isWaveForm,
set:lt.Controls.Medical.Frame.prototype.set_isWaveForm,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"frameOfReferenceID",{get:lt.Controls.Medical.Frame.prototype.get_frameOfReferenceID,set:lt.Controls.Medical.Frame.prototype.set_frameOfReferenceID,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"photometricInterpretation",{get:lt.Controls.Medical.Frame.prototype.get_photometricInterpretation,set:lt.Controls.Medical.Frame.prototype.set_photometricInterpretation,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"flipped",{get:lt.Controls.Medical.Frame.prototype.get_flipped,set:lt.Controls.Medical.Frame.prototype.set_flipped,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"reversed",{get:lt.Controls.Medical.Frame.prototype.get_reversed,set:lt.Controls.Medical.Frame.prototype.set_reversed,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,
"rotateAngle",{get:lt.Controls.Medical.Frame.prototype.get_rotateAngle,set:lt.Controls.Medical.Frame.prototype.set_rotateAngle,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"offsetX",{get:lt.Controls.Medical.Frame.prototype.get_offsetX,set:lt.Controls.Medical.Frame.prototype.set_offsetX,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"offsetY",{get:lt.Controls.Medical.Frame.prototype.get_offsetY,set:lt.Controls.Medical.Frame.prototype.set_offsetY,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"scale",{get:lt.Controls.Medical.Frame.prototype.get_scale,set:lt.Controls.Medical.Frame.prototype.set_scale,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"scaleMode",{get:lt.Controls.Medical.Frame.prototype.get_scaleMode,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.Frame.prototype,"useDPI",{get:lt.Controls.Medical.Frame.prototype.get_useDPI,
set:lt.Controls.Medical.Frame.prototype.set_useDPI,enumerable:!0,configurable:!0});lt.Controls.Medical._windowLevelValues=function(){};lt.Controls.Medical._windowLevelValues.prototype={width:0,center:0};lt.Controls.Medical.OverlayText=function(){this._text="";this._alignment=this._positionIndex=0;this._type=2};lt.Controls.Medical.OverlayText.prototype={_text:null,_positionIndex:0,_alignment:0,_type:0,_color:"#FFFFFF",_weight:0,_previousWidth:0,_rect:null,get__clearRectangle:function(){return this._rect},
set__clearRectangle:function(a){return this._rect=a},_draw:function(a,b,c){null!=this._text&&(this._previousWidth=parseInt(a.measureText(this._text).width));a.fillText(this._text,b,c)},get__drawnTextWidth:function(){return this._previousWidth},get__internalText:function(){return this._text},set__internalText:function(a){return this._text=a},get_text:function(){return this._text},set_text:function(a){return this._text=a},get_positionIndex:function(){return this._positionIndex},set_positionIndex:function(a){return this._positionIndex=
a},get_alignment:function(){return this._alignment},set_alignment:function(a){return this._alignment=a},get_type:function(){return this._type},set_type:function(a){return this._type=a},get_color:function(){return this._color},set_color:function(a){return this._color=a},get_weight:function(){return this._weight},set_weight:function(a){return this._weight=a}};Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"text",{get:lt.Controls.Medical.OverlayText.prototype.get_text,set:lt.Controls.Medical.OverlayText.prototype.set_text,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"positionIndex",{get:lt.Controls.Medical.OverlayText.prototype.get_positionIndex,set:lt.Controls.Medical.OverlayText.prototype.set_positionIndex,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"alignment",{get:lt.Controls.Medical.OverlayText.prototype.get_alignment,set:lt.Controls.Medical.OverlayText.prototype.set_alignment,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"type",{get:lt.Controls.Medical.OverlayText.prototype.get_type,set:lt.Controls.Medical.OverlayText.prototype.set_type,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"color",{get:lt.Controls.Medical.OverlayText.prototype.get_color,set:lt.Controls.Medical.OverlayText.prototype.set_color,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.OverlayText.prototype,"weight",
{get:lt.Controls.Medical.OverlayText.prototype.get_weight,set:lt.Controls.Medical.OverlayText.prototype.set_weight,enumerable:!0,configurable:!0});lt.Controls.Medical.LeadCollectionChangedEventArgs=function(a){lt.Controls.Medical.LeadCollectionChangedEventArgs.initializeBase(this);this.newItems=[];this._action$1=a};lt.Controls.Medical.LeadCollectionChangedEventArgs.create=function(a){return new lt.Controls.Medical.LeadCollectionChangedEventArgs(a)};lt.Controls.Medical.LeadCollectionChangedEventArgs.prototype=
{_action$1:0,get_action:function(){return this._action$1},newItems:null};Object.defineProperty(lt.Controls.Medical.LeadCollectionChangedEventArgs.prototype,"action",{get:lt.Controls.Medical.LeadCollectionChangedEventArgs.prototype.get_action,enumerable:!0,configurable:!0});lt.Controls.Medical.LeadCollection=function(){this._elements=[]};lt.Controls.Medical.LeadCollection.prototype={get_count:function(){return this._elements.length},clear:function(){for(var a=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(0),
b=ss.IEnumerator.getEnumerator(this._elements);b.moveNext();)a.newItems.add(b.current);this._elements.clear();this.onCollectionChanged(a)},insert:function(a,b){this._elements.insert(b,a);var c=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(5);c.newItems.add(a);this.onCollectionChanged(c)},remove:function(a){this._elements.remove(a);var b=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(3);b.newItems.add(a);this.onCollectionChanged(b)},add:function(a){this._elements.add(a);var b=
lt.Controls.Medical.LeadCollectionChangedEventArgs.create(1);b.newItems.add(a);this.onCollectionChanged(b)},contains:function(a){return this._elements.contains(a)},getEnumerator:function(){return this._elements.getEnumerator()},_copyTo:function(a,b,c){for(var d=0,b=ss.IEnumerator.getEnumerator(b);b.moveNext();)d<c||(a[d]=b.current,d++)},toArray:function(){var a=Array(this._elements.length);this._copyTo(a,this._elements,0);return a},insertItem:function(a,b){this._elements[a]=b;var c=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(1);
c.newItems.add(b);this.onCollectionChanged(c)},move:function(a,b){this.moveItem(a,b)},moveItem:function(a,b){var c=this._elements[a];this._elements.remove(c);this._elements.insert(b,c);this.onCollectionChanged(lt.Controls.Medical.LeadCollectionChangedEventArgs.create(2))},onCollectionChanged:function(a){null!=this.__collectionChanged&&this.__collectionChanged(this,a)},removeAt:function(a){this.removeItem(this.get_item(a))},removeItem:function(a){var b=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(3);
b.newItems.add(a);this._elements.remove(a);this.onCollectionChanged(b)},setItem:function(a,b){this._elements[a]=b;this.onCollectionChanged(lt.Controls.Medical.LeadCollectionChangedEventArgs.create(4))},clearItems:function(){for(var a=lt.Controls.Medical.LeadCollectionChangedEventArgs.create(0),b=ss.IEnumerator.getEnumerator(this._elements);b.moveNext();)a.newItems.add(b.current);this._elements.clear();this.onCollectionChanged(a)},indexOf:function(a){return this._elements.indexOf(a)},add_collectionChanged:function(a){this.__collectionChanged=
ss.Delegate.combine(this.__collectionChanged,a)},remove_collectionChanged:function(a){this.__collectionChanged=ss.Delegate.remove(this.__collectionChanged,a)},__collectionChanged_handler_get:function(){null==this.__collectionChanged_handler&&(this.__collectionChanged_handler=ss.EventHandler.create(this,this.add_collectionChanged,this.remove_collectionChanged));return this.__collectionChanged_handler},__collectionChanged:null,__collectionChanged_handler:null,get_item:function(a){return this._elements[a]},
set_item:function(a,b){return this._elements[a]=b},item:function(a,b){return void 0===b?this.get_item(a):this.set_item(a,b)}};Object.defineProperty(lt.Controls.Medical.LeadCollection.prototype,"count",{get:lt.Controls.Medical.LeadCollection.prototype.get_count,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LeadCollection.prototype,"collectionChanged",{get:lt.Controls.Medical.LeadCollection.prototype.__collectionChanged_handler_get,enumerable:!0,configurable:!0});lt.Controls.Medical.Tools=
function(){};lt.Controls.Medical.Tools._l_AllocateInt32Array=function(a){var b=null;return b=lt.LTHelper.supportsTypedArray?new Int32Array(a):Array(a)};lt.Controls.Medical.Tools._l_AllocateUint32ArrayInit=function(a){var b=null;if(lt.LTHelper.supportsTypedArray)b=new Uint32Array(a);else for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};lt.Controls.Medical.Tools._testData=function(a){for(var b=a.getContext("2d").getImageData(0,0,a.width,a.height),a=0,c=b.data.length,b=b.data;a<c&&!b[a]&&!b[a+1]&&!b[a+
2];a+=4);};lt.Controls.Medical.Tools._clearOutsideChunks=function(a,b,c,d,e,f,g){for(var h=0,i,j=lt.Controls.Medical.Tools._noNeedForTiles(a,e,c.tileResolution),b=lt.LeadRectD.create(0,0,b.get_width(),b.get_height()),k=0,h=d.length-1;0<=h;h--)3<d[h].resolution.get_width()/c.tileResolution.get_width()||j?i=!0:(k=parseInt(f.get_fullSize().get_width()/d[h].resolution.get_width()+0.5),i=c.getTransformedRect(d[h].rect,d[h].resolution.get_width(),d[h].resolution.get_height(),e.get_flipped(),e.get_reversed(),
e.get_rotateAngle()),i.set_x(parseInt(i.get_left()*k*g/100)+a.get_x()),i.set_y(parseInt(i.get_top()*k*g/100)+a.get_y()),i.set_width(parseInt(i.get_width()*k*g/100)),i.set_height(parseInt(i.get_height()*k*g/100)),i=!b.intersectsWith(i)),i&&lt.Controls.Medical.Tools._removeChunk(d,d[h])};lt.Controls.Medical.Tools._noNeedForTiles=function(a,b,c){return null==c||c.get_isEmpty()||null!=b.lowResImage&&b.lowResImage.resolution.get_width()>=c.get_width()||null!=b.thumbnailImage&&b.thumbnailImage.resolution.get_width()>=
c.get_width()?!0:!1};lt.Controls.Medical.Tools._removeChunk=function(a,b){lt.Controls.Medical.Tools._recycledElements.add(new lt.Controls.Medical.RecycledData(b.canvas,b.backCanvas));b.canvas=null;b.backCanvas=null;b._image=null;null!=a&&a.remove(b)};lt.Controls.Medical.Tools.get__useOldCode=function(){return!0};lt.Controls.Medical.Tools._logicalToPhysical=function(a,b){var c,d;if(null==a)return lt.LeadPointD.get_empty();a.get_size();d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,
!1);c=d.get_width()/a.get_size().get_width();d=d.get_height()/a.get_size().get_height();c*=b.get_x();d*=b.get_y();return lt.LeadPointD.create(c,d)};lt.Controls.Medical.Tools._physicalToLogical=function(a,b){if(null==a)return lt.LeadPointD.get_empty();var c,d;a.get_size();d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1);c=d.get_width()/a.get_size().get_width();d=d.get_height()/a.get_size().get_height();c=b.get_x()/c;d=b.get_y()/d;return lt.LeadPointD.create(c,d)};
lt.Controls.Medical.Tools._parseColor=function(a){null==lt.Controls.Medical.Tools._colorsByName&&(lt.Controls.Medical.Tools._colorsByName={});a=a.trim().toLowerCase();return null!=a.match(/#/)?(a=a.remove(0,1),parseInt("0x"+a)):0};lt.Controls.Medical.Tools._unreferencedParameter=function(){};lt.Controls.Medical.Tools._getTopLeftPoints=function(a,b){for(var c=0,d=a.length,e=[],f=ss.IEnumerator.getEnumerator(b);f.moveNext();){for(var g=f.current,h=lt.LeadPointD.create(1E6,1E6),c=0;c<d;c++)a[c].resolution.get_width()===
g.get_width()&&h.get_x()>=a[c].rect.get_x()&&h.get_y()>=a[c].rect.get_y()&&(h.set_x(a[c].rect.get_x()),h.set_y(a[c].rect.get_y()));e.add(h)}return e};lt.Controls.Medical.Tools._updateLocationsThumb=function(a){var b=new lt.Annotations.Rendering.AnnRectangleThumbStyle;lt.LTHelper.device===lt.LTDevice.desktop?b.set_size(lt.LeadSizeD.create(72,72)):b.set_size(lt.LeadSizeD.create(144,144));b.set_stroke(lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));
b.set_fill(lt.Annotations.Core.AnnSolidColorBrush.create("rgba(173, 216, 230, .4)"));var c=new lt.Annotations.Rendering.AnnEllipseThumbStyle;c.set_size(lt.LeadSizeD.create(54,54));c.set_stroke(lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));c.set_fill(lt.Annotations.Core.AnnSolidColorBrush.create("rgba(144, 238, 144, .4)"));var d=new lt.Annotations.Rendering.AnnEllipseThumbStyle;d.set_size(lt.LeadSizeD.create(108,108));d.set_stroke(lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("black"),
lt.LeadLengthD.create(1)));d.set_fill(lt.Annotations.Core.AnnSolidColorBrush.create("rgba(144, 238, 144, .4)"));for(var e=ss.IEnumerator.getEnumerator(Object.keys(a));e.moveNext();){var f=a[e.current];f.set_locationsThumbStyle(b);f.set_rotateCenterThumbStyle(c);f.set_rotateGripperThumbStyle(d)}};lt.Controls.Medical.Tools._activateAutomation=function(a){a.set_active(!0);lt.Controls.Medical.Tools._updateLocationsThumb(a.get_manager().get_renderingEngine().get_renderers())};lt.Controls.Medical.Tools.resetCanvas=
function(a){if(null!=a){var b=a.getContext("2d");a.width=1;a.height=1;a.style.width="1px";a.style.height="1px";b.clearRect(0,0,a.width,a.height)}};lt.Controls.Medical.Tools._disposeCanvas=function(a){if(null!=a){var b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);a.width=1;a.height=1;a.style.width="1px";a.style.height="1px";b.clearRect(0,0,a.width,a.height);delete a}};lt.Controls.Medical.ActionCommand=function(){this._mouseButton=lt.Controls.MouseButtons.left};lt.Controls.Medical.ActionCommand.prototype=
{_parent:null,_startCommand:!1,_imageViewer:null,get_parent:function(){return this._parent},set_parent:function(a){return this._parent=a},get_viewer:function(){return this._imageViewer},set_viewer:function(a){return this._imageViewer=a},get_button:function(){return this._mouseButton},set_button:function(a){return this._mouseButton=a},_items_CollectionChanged:function(){},dispose:function(){},get_isStarted:function(){return this._startCommand},set_isStarted:function(a){return this._startCommand=a},
_setInteractiveMode:function(a){if(null!=this._imageViewer){this._imageViewer.get_interactiveModes().beginUpdate();for(var b=0,c=this._imageViewer.get_interactiveModes().get_count(),d=!1,e,b=lt.LTHelper.supportsMultiTouch?1:0;b<c;b++)e=this._imageViewer.get_interactiveModes().get_item(b),e.get_mouseButtons()===this._mouseButton&&e.set_isEnabled(!1),e===a&&(d=!0);a.set_isEnabled(!0);d||(a.set_mouseButtons(this._mouseButton),this._imageViewer.get_interactiveModes().add(a));this._imageViewer.get_interactiveModes().endUpdate()}}};
Object.defineProperty(lt.Controls.Medical.ActionCommand.prototype,"parent",{get:lt.Controls.Medical.ActionCommand.prototype.get_parent,set:lt.Controls.Medical.ActionCommand.prototype.set_parent,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ActionCommand.prototype,"viewer",{get:lt.Controls.Medical.ActionCommand.prototype.get_viewer,set:lt.Controls.Medical.ActionCommand.prototype.set_viewer,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ActionCommand.prototype,
"button",{get:lt.Controls.Medical.ActionCommand.prototype.get_button,set:lt.Controls.Medical.ActionCommand.prototype.set_button,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ActionCommand.prototype,"isStarted",{get:lt.Controls.Medical.ActionCommand.prototype.get_isStarted,set:lt.Controls.Medical.ActionCommand.prototype.set_isStarted,enumerable:!0,configurable:!0});lt.Controls.Medical.PinchAction=function(){lt.Controls.Medical.PinchAction.initializeBase(this)};lt.Controls.Medical.PinchAction.prototype=
{init:function(){var a=new lt.Controls.Medical._imageViewerTransformInteractiveMode(!1);a.isPinch=!0;a.set_workOnBounds(!1);a.add_pinchWorkStarted(ss.Delegate.create(this,this._panInteractiveMode_PinchStarted$1));a.add_pinchWorkCompleted(ss.Delegate.create(this,this._panInteractiveMode_PinchCompleted$1));this._workaroundScaleAction$1=new lt.Controls.Medical.ScaleAction;return a},_workaroundScaleAction$1:null,_panInteractiveMode_PinchCompleted$1:function(a,b){this._workaroundScaleAction$1._zoomToInteractiveMode_WorkCompleted(a,
b)},_startOffsetX$1:0,_startOffsetY$1:0,_panInteractiveMode_PinchStarted$1:function(a,b){this._workaroundScaleAction$1._zoomToInteractiveMode_WorkStarted(a,b)},_getViewerImagePosition$1:function(a){var b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(a.get_imageViewer(),a),c=b.get_width()/2,b=b.get_height()/2,d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1).get_size(),a=d.get_width()/2,d=d.get_height()/2;return lt.LeadPointD.create(a-c,d-b)},_calculateOffset$1:function(a){var b=
this._getViewerImagePosition$1(a);if(b.get_isEmpty())return lt.LeadPointD.get_empty();var c=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1),a=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1);return lt.LeadPointD.create(b.get_x()-(c.get_left()-a.get_left()),b.get_y()-(c.get_top()-a.get_top()))},_offsetInteractiveMode_WorkCompleted$1:function(a){var b=a.get_item(),c=a.SubCellAttached,d=b.get_attachedFrame(),e=a.get__cursorPoint();e.get_x();
e.get_y();d._savePosition();if(c.get_linked()){for(var e=c.get_frames().get_count(),f=0,f=0;f<e;f++)b=c.get_frames().get_item(f),b!==d&&(b._normalizedPosition.set_x(b._normalizedPosition.get_x()+d._normalizedPositionDelta.get_x()),b._normalizedPosition.set_y(b._normalizedPosition.get_y()+d._normalizedPositionDelta.get_y()));e=c.get_imageViewer().get_items().get_count();for(f=0;f<e;f++)b=c.get_imageViewer().get_items().get_item(f),b=b.get_attachedFrame(),b!==d&&null!=b&&b._updateOffset(b.get_offsetX(),
b.get_offsetY())}else d._updateOffset(d.get_offsetX(),d.get_offsetY());a.get_imageViewer().automationInvalidate(lt.LeadRectD.get_empty())},_offsetInteractiveMode_WorkStarted$1:function(a){a.get_item();a=a.get__cursorPoint();this._startOffsetX$1=a.get_x();this._startOffsetY$1=a.get_y()},start:function(a){this._setInteractiveMode(a)},dispose:function(a){a.remove_pinchWorkStarted(ss.Delegate.create(this,this._panInteractiveMode_PinchStarted$1));a.remove_pinchWorkCompleted(ss.Delegate.create(this,this._panInteractiveMode_PinchCompleted$1))}};
lt.Controls.Medical.OffsetAction=function(){lt.Controls.Medical.OffsetAction.initializeBase(this)};lt.Controls.Medical.OffsetAction.prototype={init:function(){var a=new lt.Controls.Medical._imageViewerTransformInteractiveMode(!1);a.set_idleCursor("default");a.set_workingCursor("crosshair");a.enablePan=!0;a.enableZoom=!1;a.set_workOnBounds(!1);a.add_workCompleted(ss.Delegate.create(this,this._offsetInteractiveMode_WorkCompleted$1));a.add_workStarted(ss.Delegate.create(this,this._offsetInteractiveMode_WorkStarted$1));
return a},_panInteractiveMode_PinchCompleted$1:function(){},_startOffsetX$1:0,_startOffsetY$1:0,_panInteractiveMode_PinchStarted$1:function(){},_getViewerImagePosition$1:function(a){var b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(a.get_imageViewer(),a),c=b.get_width()/2,b=b.get_height()/2,d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1).get_size(),a=d.get_width()/2,d=d.get_height()/2;return lt.LeadPointD.create(a-c,d-b)},_calculateOffset$1:function(a){var b=
this._getViewerImagePosition$1(a);if(b.get_isEmpty())return lt.LeadPointD.get_empty();var c=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1),a=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1);return lt.LeadPointD.create(b.get_x()-(c.get_left()-a.get_left()),b.get_y()-(c.get_top()-a.get_top()))},_offsetInteractiveMode_WorkCompleted$1:function(a){var b=a.get_item(),c=a.SubCellAttached,d=b.get_attachedFrame(),e=a.get__cursorPoint();e.get_x();
e.get_y();d._savePosition();if(c.get_linked()){for(var e=c.get_frames().get_count(),f=0,f=0;f<e;f++)b=c.get_frames().get_item(f),b!==d&&(b._normalizedPosition.set_x(b._normalizedPosition.get_x()+d._normalizedPositionDelta.get_x()),b._normalizedPosition.set_y(b._normalizedPosition.get_y()+d._normalizedPositionDelta.get_y()));e=c.get_imageViewer().get_items().get_count();for(f=0;f<e;f++)b=c.get_imageViewer().get_items().get_item(f),b=b.get_attachedFrame(),b!==d&&null!=b&&b._updateOffset(b.get_offsetX(),
b.get_offsetY())}else d._updateOffset(d.get_offsetX(),d.get_offsetY());a.get_imageViewer().automationInvalidate(lt.LeadRectD.get_empty())},_offsetInteractiveMode_WorkStarted$1:function(a){a.get_item();a=a.get__cursorPoint();this._startOffsetX$1=a.get_x();this._startOffsetY$1=a.get_y()},start:function(a){this._setInteractiveMode(a)},dispose:function(a){a.remove_workCompleted(ss.Delegate.create(this,this._offsetInteractiveMode_WorkCompleted$1));a.remove_workStarted(ss.Delegate.create(this,this._offsetInteractiveMode_WorkStarted$1));
a.remove_pinchWorkStarted(ss.Delegate.create(this,this._panInteractiveMode_PinchStarted$1));a.remove_pinchWorkCompleted(ss.Delegate.create(this,this._panInteractiveMode_PinchCompleted$1))}};lt.Controls.Medical.LineProfileAction=function(){lt.Controls.Medical.LineProfileAction.initializeBase(this)};lt.Controls.Medical.LineProfileAction.prototype={init:function(){return null},start:function(a){this._setInteractiveMode(a)},dispose:function(){}};lt.Controls.Medical.ScaleAction=function(){lt.Controls.Medical.ScaleAction.initializeBase(this)};
lt.Controls.Medical.ScaleAction.prototype={init:function(){var a=new lt.Controls.Medical._imageViewerTransformInteractiveMode(!0);a.set_idleCursor("default");a.set_workingCursor("crosshair");a.enablePan=!1;a.enableZoom=!0;a.set_scaleAtPosition(!0);a.set_workOnBounds(!1);a.add_workCompleted(ss.Delegate.create(this,this._zoomToInteractiveMode_WorkCompleted));a.add_workStarted(ss.Delegate.create(this,this._zoomToInteractiveMode_WorkStarted));return a},_getImageControlRectangle$1:function(a,b){return a.get_imageViewer().getItemViewBounds(a,
lt.Controls.ImageViewerItemPart.image,b)},_getViewerImagePosition$1:function(a){var b=lt.Controls.Medical.MRTISubCell.getFloatImageRect(a.get_imageViewer(),a),c=b.get_width()/2,b=b.get_height()/2,d=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1).get_size(),a=d.get_width()/2,d=d.get_height()/2;return lt.LeadPointD.create(a-c,d-b)},_calculateOffset$1:function(a){var b=this._getViewerImagePosition$1(a);if(b.get_isEmpty())return lt.LeadPointD.get_empty();var c=lt.Controls.Medical.MRTISubCell.getFloatImageRect(a.get_imageViewer(),
a),a=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.item,!1);return lt.LeadPointD.create(b.get_x()-(c.get_left()-a.get_left()),b.get_y()-(c.get_top()-a.get_top()))},_calculateZoom$1:function(a,b){var c=0;switch(b){case lt.Controls.ControlSizeMode.fit:case lt.Controls.ControlSizeMode.fitAlways:case lt.Controls.ControlSizeMode.fitWidth:case lt.Controls.ControlSizeMode.fitHeight:c=a.get_scaleFactor();break;case lt.Controls.ControlSizeMode.actualSize:c=a.get_scaleFactor()}return c},
_zoomToInteractiveMode_WorkCompleted:function(a){var b=a.get_item(),c=a.SubCellAttached,d=b.get_attachedFrame(),e=b.get_scaleFactor()-this._startValue$1,e=e/(b.get_scaleFactor()-e),f=this._calculateOffset$1(b);f.get_x();f.get_y();d._savePosition();if(c.get_linked()){for(var f=c.get_frames().get_count(),g=0,h,g=0;g<f;g++)b=c.get_frames().get_item(g),h=b.get_scale()+e*b.get_scale(),b!==d&&(b._normalizedPosition.set_x(b._normalizedPosition.get_x()+d._normalizedPositionDelta.get_x()),b._normalizedPosition.set_y(b._normalizedPosition.get_y()+
d._normalizedPositionDelta.get_y())),b.zoom(b.get_scaleMode(),h);f=c.get_imageViewer().get_items().get_count();for(g=0;g<f;g++)b=c.get_imageViewer().get_items().get_item(g),b=b.get_attachedFrame(),b!==d&&null!=b&&b._updateOffset(b.get_offsetX(),b.get_offsetY())}else d.set_scale(d.get_scale()+e*d.get_scale()),d.zoom(d.get_scaleMode(),d.get_scale());a.get_imageViewer().automationInvalidate(lt.LeadRectD.get_empty())},_startValue$1:0,_startOffsetX$1:0,_startOffsetY$1:0,_zoomToInteractiveMode_WorkStarted:function(a){var a=
a.get_item(),b=this._calculateOffset$1(a);this._startOffsetX$1=b.get_x();this._startOffsetY$1=b.get_y();this._startValue$1=a.get_scaleFactor()},start:function(a){this._setInteractiveMode(a)},dispose:function(a){a.remove_workCompleted(ss.Delegate.create(this,this._zoomToInteractiveMode_WorkCompleted));a.remove_workStarted(ss.Delegate.create(this,this._zoomToInteractiveMode_WorkStarted))}};lt.Controls.Medical.MagnifyAction=function(){lt.Controls.Medical.MagnifyAction.initializeBase(this)};lt.Controls.Medical.MagnifyAction.prototype=
{init:function(){var a=new lt.Controls.ImageViewerMagnifyGlassInteractiveMode;a.set_idleCursor("default");a.set_workingCursor("none");a.set_backgroundColor("black");lt.LTHelper.supportsTouch&&(a.set_offset(lt.LeadPointD.create(0,-1*(a.get_size().get_height()/2))),a.set_ensureVisible(!1));return a},start:function(a){this._setInteractiveMode(a)}};lt.Controls.Medical.LeadPoint3D=function(a,b,c){this._x=a;this._y=b;this._z=c};lt.Controls.Medical.LeadPoint3D.create=function(a,b,c){return new lt.Controls.Medical.LeadPoint3D(a,
b,c)};lt.Controls.Medical.LeadPoint3D.get_empty=function(){return new lt.Controls.Medical.LeadPoint3D(0,0,0)};lt.Controls.Medical.LeadPoint3D.prototype={_x:0,_y:0,_z:0,get_x:function(){return this._x},set_x:function(a){return this._x=a},get_y:function(){return this._y},set_y:function(a){return this._y=a},get_z:function(){return this._z},set_z:function(a){return this._z=a}};Object.defineProperty(lt.Controls.Medical.LeadPoint3D.prototype,"x",{get:lt.Controls.Medical.LeadPoint3D.prototype.get_x,set:lt.Controls.Medical.LeadPoint3D.prototype.set_x,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LeadPoint3D.prototype,"y",{get:lt.Controls.Medical.LeadPoint3D.prototype.get_y,set:lt.Controls.Medical.LeadPoint3D.prototype.set_y,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LeadPoint3D.prototype,"z",{get:lt.Controls.Medical.LeadPoint3D.prototype.get_z,set:lt.Controls.Medical.LeadPoint3D.prototype.set_z,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LeadPoint3D,"empty",
{get:lt.Controls.Medical.LeadPoint3D.get_empty,enumerable:!0,configurable:!0});lt.Controls.Medical.CrossHairInteractiveMode=function(){lt.Controls.Medical.CrossHairInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item)};lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor=function(a,b,c){if(null==b||!b.get_frames().get_count())return lt.Controls.Medical.LeadPoint3D.get_empty();var d=-1,e=-1;
Type.canCast(a,lt.Controls.Medical.MPRCell)&&(d=a.get_mprType());Type.canCast(b,lt.Controls.Medical.MPRCell)&&(e=b.get_mprType());if(d===e)return lt.Controls.Medical.LeadPoint3D.get_empty();if(-1===d)if(b.get_generator()===a)d=0;else return lt.Controls.Medical.LeadPoint3D.get_empty();if(-1===e)if(a.get_generator()===b)e=0;else return lt.Controls.Medical.LeadPoint3D.get_empty();var f=b.get_frames().get_item(0).get_width(),g=b.get_frames().get_item(0).get_height(),b=b.get_frames().get_count();if(0>
c.get_x()||c.get_x()>f||0>c.get_y()||c.get_y()>g||0>c.get_z()||c.get_z()>b)return lt.Controls.Medical.LeadPoint3D.get_empty();var h=a.get_frames().get_item(0).get_width(),i=a.get_frames().get_item(0).get_height(),a=a.get_frames().get_count(),j=0,k=0,l=0,m=c.get_x(),n=c.get_y(),c=c.get_z();switch(e){case 0:1===d?(j=n*h/g,k=c*i/b,l=m*a/f):(j=m*h/f,k=c*i/b,l=n*a/g);break;case 1:d?(j=c*h/b,k=n*i/g,l=m*a/f):(j=c*h/b,k=m*i/f,l=n*a/g);break;case 2:d?(j=c*h/b,k=n*i/g,l=m*a/f):(j=m*h/f,k=c*i/b,l=n*a/g)}return lt.Controls.Medical.LeadPoint3D.create(j,
k,l)};lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1=function(a,b){for(var c=0,d=a.get_children().get_count(),e,c=0;c<d;c++)if(e=a.get_children().get_item(c),Type.canCast(e,lt.Controls.Medical.MPRCell)&&e!==b)return e;return null};lt.Controls.Medical.CrossHairInteractiveMode.scrollCrossHair=function(a,b,c){var d=a.get_imageViewer().get_items().get_item(0);lt.Controls.Medical.MRTISubCell.getFloatImageRect(d.get_imageViewer(),d);a.set__crossHairPosition(lt.LeadPointD.create(b,c));if(Type.canCast(a,
lt.Controls.Medical.MPRCell)){var d=a,a=d.get_generator(),e=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,d),f;null!=a&&(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(a,d,new lt.Controls.Medical.LeadPoint3D(b,c,d._getActiveSubCellIndex())),a.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),a.invalidate());null!=e&&(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(e,d,new lt.Controls.Medical.LeadPoint3D(b,c,d._getActiveSubCellIndex())),e.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),
f.get_y())),e.invalidate())}else if(a.get_children().get_count()&&(d=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,null),e=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,d),null!=d&&(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(d,a,new lt.Controls.Medical.LeadPoint3D(b,c,a._getActiveSubCellIndex())),d.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),d.invalidate()),null!=e))f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(e,a,new lt.Controls.Medical.LeadPoint3D(b,
c,a._getActiveSubCellIndex())),e.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),e.invalidate()};lt.Controls.Medical.CrossHairInteractiveMode._updateCorssHair$1=function(a,b,c){var d=a.get_parentCell();a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1);d.set__crossHairPosition(lt.LeadPointD.create(b,c));if(Type.canCast(d,lt.Controls.Medical.MPRCell)){var a=d.get_generator(),e=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,d),f;null!=a&&
(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(a,d,new lt.Controls.Medical.LeadPoint3D(b,c,d._getActiveSubCellIndex())),a.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),a.get_currentOffset()!==parseInt(f.get_z()+0.5)?a.set_currentOffset(parseInt(f.get_z()+0.5)):a.invalidate());null!=e&&(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(e,d,new lt.Controls.Medical.LeadPoint3D(b,c,d._getActiveSubCellIndex())),e.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),
f.get_y())),e.get_currentOffset()!==parseInt(f.get_z()+0.5)?e.set_currentOffset(parseInt(f.get_z()+0.5)):e.invalidate())}else if(d.get_children().get_count()&&(a=d,d=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,null),e=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,d),null!=d&&(f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(d,a,new lt.Controls.Medical.LeadPoint3D(b,c,a._getActiveSubCellIndex())),d.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),
d.get_currentOffset()!==parseInt(f.get_z()+0.5)?d.set_currentOffset(parseInt(f.get_z()+0.5)):d.invalidate()),null!=e))f=lt.Controls.Medical.CrossHairInteractiveMode.get3DCursor(e,a,new lt.Controls.Medical.LeadPoint3D(b,c,a._getActiveSubCellIndex())),e.set__crossHairPosition(lt.LeadPointD.create(f.get_x(),f.get_y())),e.get_currentOffset()!==parseInt(f.get_z()+0.5)?e.set_currentOffset(parseInt(f.get_z()+0.5)):e.invalidate()};lt.Controls.Medical.CrossHairInteractiveMode.prototype={_viewer$1:null,get_id:function(){return 104},
start:function(a){lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,"start",[a]);this._viewer$1=a;a=lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,
"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,"stop",[a])}},_service_DragCompleted$1:function(){if(this.get_isWorking())this.onWorkCompleted(lt.LeadEventArgs.Empty)},_updateMPRPositions$1:function(a,b,c){var d=a.get_parentCell(),e=
a.get_attachedFrame(),f=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1),b=Math.max(0,Math.min(e.get_width(),(b-f.get_left())*e.get_width()/f.get_width())),c=Math.max(0,Math.min(e.get_height(),(c-f.get_top())*e.get_height()/f.get_height()));lt.Controls.Medical.CrossHairInteractiveMode._updateCorssHair$1(a,b,c);d.invalidate()},_service_DragDelta$1:function(a,b){var c=lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,"get_item");this.get_isWorking()&&
this._updateMPRPositions$1(c,b.get_position().get_x(),b.get_position().get_y())},_service_DragStarted$1:function(a,b){var c=lt.Controls.Medical.CrossHairInteractiveMode.callBaseMethod(this,"get_item");if(this.canStartWork(b)&&(null==c&&(c=this.get_item()),null!=this.get_item()&&(b.get_mouseButton()===this.get_mouseButtons()||b.get_nativeEvent().type===lt.LTHelper.mouseWheelEvent)))this._cells$1=this._getAllCellsInvolved$1(c),this._updateMPRPositions$1(c,b.get_position().get_x(),b.get_position().get_y()),
this.onWorkStarted(lt.LeadEventArgs.Empty)},_getAllCellsInvolved$1:function(a){var b=[],a=a.get_parentCell();if(Type.canCast(a,lt.Controls.Medical.MPRCell)){var c=a,a=c.get_generator(),d=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,c);b.add(c);b.add(a);b.add(d)}else a.get_children().get_count()&&(c=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,null),d=lt.Controls.Medical.CrossHairInteractiveMode._getMPRCell$1(a,c),b.add(a),b.add(c),b.add(d));return b},_cells$1:null,
get_name:function(){return"Probe Tool"}};Object.defineProperty(lt.Controls.Medical.CrossHairInteractiveMode.prototype,"id",{get:lt.Controls.Medical.CrossHairInteractiveMode.prototype.get_id,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CrossHairInteractiveMode.prototype,"name",{get:lt.Controls.Medical.CrossHairInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});lt.Controls.Medical.CrossHairAction=function(){lt.Controls.Medical.CrossHairAction.initializeBase(this)};
lt.Controls.Medical.CrossHairAction.prototype={init:function(){var a=new lt.Controls.Medical.CrossHairInteractiveMode;a.set_idleCursor("default");a.set_workingCursor("crosshair");return a},start:function(a){this._setInteractiveMode(a)}};lt.Controls.Medical.ProbeToolAction=function(){lt.Controls.Medical.ProbeToolAction.initializeBase(this)};lt.Controls.Medical.ProbeToolAction.prototype={add_probeToolUpdated:function(a){this.__probeToolUpdated$1=ss.Delegate.combine(this.__probeToolUpdated$1,a)},remove_probeToolUpdated:function(a){this.__probeToolUpdated$1=
ss.Delegate.remove(this.__probeToolUpdated$1,a)},__probeToolUpdated$1_handler_get:function(){null==this.__probeToolUpdated$1_handler&&(this.__probeToolUpdated$1_handler=ss.EventHandler.create(this,this.add_probeToolUpdated,this.remove_probeToolUpdated));return this.__probeToolUpdated$1_handler},__probeToolUpdated$1:null,__probeToolUpdated$1_handler:null,_magnifyInteractiveMode_WorkCompleted$1:function(){},_probeInteractiveMode$1:null,init:function(){this._probeInteractiveMode$1=new lt.Controls.Medical.ProbeToolInteractiveMode(this.get_parent());
this._probeInteractiveMode$1.add_probeToolUpdated(ss.Delegate.create(this,this._probeInteractiveMode_ProbeToolUpdated$1));this._probeInteractiveMode$1.set_idleCursor("default");this._probeInteractiveMode$1.set_workingCursor("default");return this._probeInteractiveMode$1},get_interactiveObject:function(){return this._probeInteractiveMode$1},_probeInteractiveMode_ProbeToolUpdated$1:function(a,b){if(null!=this.__probeToolUpdated$1){var c=new lt.Controls.Medical.ProbeToolEventArgs(b.get_position(),b.get_target());
this.__probeToolUpdated$1(a,c);b.set_pixelValue(c.get_pixelValue())}},_probeInteractiveMode_WorkCompleted$1:function(){},start:function(a){this._setInteractiveMode(a)}};Object.defineProperty(lt.Controls.Medical.ProbeToolAction.prototype,"probeToolUpdated",{get:lt.Controls.Medical.ProbeToolAction.prototype.__probeToolUpdated$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolAction.prototype,"interactiveObject",{get:lt.Controls.Medical.ProbeToolAction.prototype.get_interactiveObject,
enumerable:!0,configurable:!0});lt.Controls.Medical.SpyGlassAction=function(){lt.Controls.Medical.SpyGlassAction.initializeBase(this)};lt.Controls.Medical.SpyGlassAction.prototype={add_imageRequested:function(a){this.__imageRequested$2=ss.Delegate.combine(this.__imageRequested$2,a)},remove_imageRequested:function(a){this.__imageRequested$2=ss.Delegate.remove(this.__imageRequested$2,a)},__imageRequested$2_handler_get:function(){null==this.__imageRequested$2_handler&&(this.__imageRequested$2_handler=
ss.EventHandler.create(this,this.add_imageRequested,this.remove_imageRequested));return this.__imageRequested$2_handler},__imageRequested$2:null,__imageRequested$2_handler:null,add_workCompleted:function(a){this.__workCompleted$2=ss.Delegate.combine(this.__workCompleted$2,a)},remove_workCompleted:function(a){this.__workCompleted$2=ss.Delegate.remove(this.__workCompleted$2,a)},__workCompleted$2_handler_get:function(){null==this.__workCompleted$2_handler&&(this.__workCompleted$2_handler=ss.EventHandler.create(this,
this.add_workCompleted,this.remove_workCompleted));return this.__workCompleted$2_handler},__workCompleted$2:null,__workCompleted$2_handler:null,add_positionChanged:function(a){this.__positionChanged$2=ss.Delegate.combine(this.__positionChanged$2,a)},remove_positionChanged:function(a){this.__positionChanged$2=ss.Delegate.remove(this.__positionChanged$2,a)},__positionChanged$2_handler_get:function(){null==this.__positionChanged$2_handler&&(this.__positionChanged$2_handler=ss.EventHandler.create(this,
this.add_positionChanged,this.remove_positionChanged));return this.__positionChanged$2_handler},__positionChanged$2:null,__positionChanged$2_handler:null,add_chunkLoaded:function(a){this.__chunkLoaded$2=ss.Delegate.combine(this.__chunkLoaded$2,a)},remove_chunkLoaded:function(a){this.__chunkLoaded$2=ss.Delegate.remove(this.__chunkLoaded$2,a)},__chunkLoaded$2_handler_get:function(){null==this.__chunkLoaded$2_handler&&(this.__chunkLoaded$2_handler=ss.EventHandler.create(this,this.add_chunkLoaded,this.remove_chunkLoaded));
return this.__chunkLoaded$2_handler},__chunkLoaded$2:null,__chunkLoaded$2_handler:null,tiling:!0,_subCell$2:null,init:function(){var a=new lt.Controls.Medical.MedicalSpyGlassInteractiveMode;a.set_idleCursor("default");a.set_workingCursor("none");a.set_backgroundColor("black");a.set_shape(lt.Controls.ImageViewerSpyGlassShape.ellipse);a.set_crosshair(lt.Controls.ImageViewerSpyGlassCrosshair.none);a.add_imageRequested(ss.Delegate.create(this,this._magnifyInteractiveMode_ImageRequested$2));a.add_workCompleted(ss.Delegate.create(this,
this._magnifyInteractiveMode_WorkCompleted$2));a.add_positionChanged(ss.Delegate.create(this,this._magnifyInteractiveMode_PositionChanged$2));a.add__chunkLoaded(ss.Delegate.create(this,this._magnifyInteractiveMode_ChunkLoaded$2));a.tiling=this.tiling;lt.LTHelper.supportsTouch&&(a.set_offset(lt.LeadPointD.create(0,-1*(a.get_size().get_height()/2))),a.set_ensureVisible(!1));return a},_magnifyInteractiveMode_ChunkLoaded$2:function(a,b){null!=this.__chunkLoaded$2&&this.__chunkLoaded$2(a,b)},_magnifyInteractiveMode_PositionChanged$2:function(a,
b){null!=this.__positionChanged$2&&this.__positionChanged$2(a,b)},_magnifyInteractiveMode_WorkCompleted$2:function(a){null!=this.__workCompleted$2&&this.__workCompleted$2(a,new lt.Controls.Medical.SpyGlassEventArgs(null,null,this._subCell$2))},_magnifyInteractiveMode_ImageRequested$2:function(a,b){this._subCell$2=b.get_userData();null!=this.__imageRequested$2&&this.__imageRequested$2(a,b)},start:function(a){this._setInteractiveMode(a)}};Object.defineProperty(lt.Controls.Medical.SpyGlassAction.prototype,
"imageRequested",{get:lt.Controls.Medical.SpyGlassAction.prototype.__imageRequested$2_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassAction.prototype,"workCompleted",{get:lt.Controls.Medical.SpyGlassAction.prototype.__workCompleted$2_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassAction.prototype,"positionChanged",{get:lt.Controls.Medical.SpyGlassAction.prototype.__positionChanged$2_handler_get,enumerable:!0,
configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassAction.prototype,"chunkLoaded",{get:lt.Controls.Medical.SpyGlassAction.prototype.__chunkLoaded$2_handler_get,enumerable:!0,configurable:!0});lt.Controls.Medical.StackAction=function(){lt.Controls.Medical.StackAction.initializeBase(this)};lt.Controls.Medical.StackAction.prototype={_stackInteractiveMode1$1:null,_stackInteractiveMode$1:null,init:function(){this._stackInteractiveMode$1=new lt.Controls.Medical.StackModeInteractiveMode;
this._stackInteractiveMode$1.loadImages(null);this._stackInteractiveMode$1.set_idleCursor("default");this._stackInteractiveMode$1.set_workingCursor("crosshair");this._stackInteractiveMode$1.add_workCompleted(ss.Delegate.create(this,this._stack_Started$1));this._stackInteractiveMode1$1=new lt.Controls.Medical.StackModeInteractiveMode;this._stackInteractiveMode1$1.loadImages(null);this._stackInteractiveMode1$1.set_idleCursor("default");this._stackInteractiveMode1$1.set_workingCursor("crosshair");this._stackInteractiveMode1$1.add_workCompleted(ss.Delegate.create(this,
this._stack_Started$1));this._stackInteractiveMode1$1._selectedOnly=!0;return this._stackInteractiveMode$1},_stack_Started$1:function(){},start:function(a){this._stackInteractiveMode1$1.loadImages(this.get_parent());this._stackInteractiveMode$1.loadImages(this.get_parent());this._setInteractiveMode(a)}};lt.Controls.Medical.StackModeInteractiveMode=function(){lt.Controls.Medical.StackModeInteractiveMode.initializeBase(this)};lt.Controls.Medical.StackModeInteractiveMode.prototype={_cell$1:null,loadImages:function(a){this._cell$1=
a},get_id:function(){return 101},start:function(a){lt.Controls.Medical.StackModeInteractiveMode.callBaseMethod(this,"start",[a]);a=lt.Controls.Medical.StackModeInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.StackModeInteractiveMode.callBaseMethod(this,
"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));lt.Controls.Medical.StackModeInteractiveMode.callBaseMethod(this,"stop",[a])}},_selectedOnly:!1,_getMaxAllowed$1:function(){return Math.max(1,this._cell$1.get_frames().get_count()-this._cell$1.get_imageViewer().get_items().get_count()+1)},_service_DragCompleted$1:function(){if(this.get_isWorking())this.onWorkCompleted(lt.LeadEventArgs.Empty)},
_service_DragDelta$1:function(a,b){if(this.get_isWorking()){this.get_imageViewer();var c=this._cell$1.get_currentOffset(),d=b.get_nativeEvent().type===lt.LTHelper.mouseWheelEvent?1:2;b.get_change().get_y()<=-d?c++:b.get_change().get_y()>=d&&c--;d=this._getMaxAllowed$1();c=Math.max(0,Math.min(d-1,c));this._cell$1.set_currentOffset(c)}},_service_DragStarted$1:function(a,b){this.get_imageViewer();if(!this._selectedOnly||this._cell$1.get_selected())if(b.get_mouseButton()===this.get_mouseButtons()||b.get_nativeEvent().type===
lt.LTHelper.mouseWheelEvent)this.onWorkStarted(lt.LeadEventArgs.Empty)},get_name:function(){return"Stack mode"}};Object.defineProperty(lt.Controls.Medical.StackModeInteractiveMode.prototype,"id",{get:lt.Controls.Medical.StackModeInteractiveMode.prototype.get_id,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.StackModeInteractiveMode.prototype,"name",{get:lt.Controls.Medical.StackModeInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});lt.Controls.Medical.WindowLevelAction=
function(){lt.Controls.Medical.WindowLevelAction.initializeBase(this)};lt.Controls.Medical.WindowLevelAction.prototype={_windowLevel$1:null,init:function(){this._windowLevel$1=new lt.Controls.Medical.WindowLevelInteractiveMode;this._windowLevel$1.add_workCompleted(ss.Delegate.create(this,this._windowLevel_Completed$1));this._windowLevel$1.add_workStarted(ss.Delegate.create(this,this._windowLevel_Started$1));this._windowLevel$1.add_workDelta(ss.Delegate.create(this,this._windowLevel_WorkDelta$1));
this._windowLevel$1.add_render(ss.Delegate.create(this,this._windowLevel_Render$1));this._windowLevel$1.add_renderCompleted(ss.Delegate.create(this,this._windowLevel_RenderCompleted$1));this._windowLevel$1.set_mrtiEnabled(!0);return this._windowLevel$1},_windowLevel_WorkDelta$1:function(a,b){var c=a.get_item().get_attachedFrame();a.set_data(c.get_wlData());c._windowLevel_Delta(a,b)},_windowLevel_RenderCompleted$1:function(a){a=a.get_item();Type.canCast(a,lt.Controls.Medical.MRTISubCell)&&a.updateWindowlevelOnTheRest()},
_windowLevel_Render$1:function(a){a=a.get_item();Type.canCast(a,lt.Controls.Medical.MRTISubCell)&&a.updateWindowlevel(!1)},_windowLevel_Started$1:function(a,b){var c=a.get_item().get_attachedFrame();null!=c&&c._windowLevel_Started(a,b)},_windowLevel_Completed$1:function(a,b){var c=a.get_item().get_attachedFrame();null!=c&&c._windowLevel_Completed(a,b)},dispose:function(){this._windowLevel$1.remove_workCompleted(ss.Delegate.create(this,this._windowLevel_Completed$1));this._windowLevel$1.remove_workStarted(ss.Delegate.create(this,
this._windowLevel_Started$1))},start:function(a){this._setInteractiveMode(a)}};lt.Controls.Medical.AutomationInteractiveAction=function(a){lt.Controls.Medical.AutomationInteractiveAction.initializeBase(this);this._objectID$1=a};lt.Controls.Medical.AutomationInteractiveAction.prototype={_objectID$1:0,init:function(){return new lt.Controls.Medical.AutomationInteractiveMode},get_objectID:function(){return this._objectID$1},set_objectID:function(a){this._objectID$1=a;this.get_parent().get_imageViewer().get_items().get_count();
return a},start:function(a){var b=this.get_parent().get_automation();this._setInteractiveMode(a);b.get_manager().get_currentObjectId()!==this._objectID$1&&b.get_manager().set_currentObjectId(this._objectID$1)}};Object.defineProperty(lt.Controls.Medical.AutomationInteractiveAction.prototype,"objectID",{get:lt.Controls.Medical.AutomationInteractiveAction.prototype.get_objectID,set:lt.Controls.Medical.AutomationInteractiveAction.prototype.set_objectID,enumerable:!0,configurable:!0});lt.Controls.Medical.CobbAngle=
function(a,b,c){this._automation=a;this._container=this._automation.get_container();this._line1=b;this._line2=c;this._backgroundColor="rgba(255, 255, 255, 255)";this._borderColor="rgba(0, 0, 255, 255)";this._automation.add_edit(ss.Delegate.create(this,this._automation_Edit));this._container.get_children().add_collectionChanged(ss.Delegate.create(this,this._children_CollectionChanged));this._calculate()};lt.Controls.Medical.CobbAngle.prototype={_line1:null,_line2:null,_needsRecalculation:!1,_container:null,
_automation:null,_backgroundColor:null,_borderColor:null,add_cobbAngleChanged:function(a){this.__cobbAngleChanged=ss.Delegate.combine(this.__cobbAngleChanged,a)},remove_cobbAngleChanged:function(a){this.__cobbAngleChanged=ss.Delegate.remove(this.__cobbAngleChanged,a)},__cobbAngleChanged_handler_get:function(){null==this.__cobbAngleChanged_handler&&(this.__cobbAngleChanged_handler=ss.EventHandler.create(this,this.add_cobbAngleChanged,this.remove_cobbAngleChanged));return this.__cobbAngleChanged_handler},
__cobbAngleChanged:null,__cobbAngleChanged_handler:null,dispose:function(){this._automation.remove_edit(ss.Delegate.create(this,this._automation_Edit))},_designer_Edit:function(){this._recalculate()},_synchLine:function(a){return-1===this._automation.get_container().get_children().indexOf(a)?null:a},_children_CollectionChanged:function(){var a=this._line1,b=this._line2;this._line1=this._synchLine(a);this._line2=this._synchLine(b);(this._line1!==a||this._line2!==b)&&null!=this.__cobbAngleChanged&&
this.__cobbAngleChanged(this,lt.LeadEventArgs.Empty)},_automation_Edit:function(){this._calculate()},get_line1:function(){return this._line1},set_line1:function(a){this._line1=a;this._calculate();return a},get_line2:function(){return this._line2},set_line2:function(a){this._line2=a;this._calculate();return a},get_angle:function(){return 0},get_backgroundColor:function(){return this._backgroundColor},set_backgroundColor:function(a){this._backgroundColor=a;this._repaint();return a},get_borderColor:function(){return this._borderColor},
set_borderColor:function(a){this._borderColor=a;this._repaint();return a},get__needsRecalculation:function(){return this._needsRecalculation},set__needsRecalculation:function(a){return this._needsRecalculation=a},draw:function(a){if(!(null==this._line1||null==this._line2)){a.save();var b=this._container.get_mapper(),c=b.pointFromContainerCoordinates(this._point1,lt.Annotations.Core.AnnFixedStateOperations.none),d=b.pointFromContainerCoordinates(this._point2,lt.Annotations.Core.AnnFixedStateOperations.none),
b=b.pointFromContainerCoordinates(this._intersectionPoint,lt.Annotations.Core.AnnFixedStateOperations.none);a.beginPath();a.lineWidth=1;this._line1.get_stroke().get_stroke();a.strokeStyle=this._borderColor;a.moveTo(c.get_x(),c.get_y());a.lineTo(b.get_x(),b.get_y());this._line2.get_stroke().get_stroke();a.strokeStyle=this._borderColor;a.moveTo(d.get_x(),d.get_y());a.lineTo(b.get_x(),b.get_y());a.stroke();a.textAlign="center";a.textBaseline="middle";a.font=String.format("{0}px Arial",12);c=String.format("{0} \u00b0",
Math.round(100*this._resultAngle)/100);d=parseInt(a.measureText(c).width)+10;a.beginPath();a.fillStyle=this._backgroundColor;a.fillRect(b.get_x(),b.get_y()-9,d,17);a.stroke();a.beginPath();a.strokeStyle=this._borderColor;a.rect(b.get_x(),b.get_y()-9,d,17);a.stroke();a.beginPath();a.fillStyle="blue";a.strokeStyle=this._borderColor;a.fillText(c,b.get_x()+d/2,b.get_y());a.stroke();a.restore()}},_calculate:function(){this._recalculate();return 1},_resultAngle:0,_startPoint1:null,_endPoint1:null,_startPoint2:null,
_endPoint2:null,_angle2:0,_factor1:0,_intersectionPoint:null,_point1:null,_point2:null,_annContainer:null,_repaint:function(){},_recalculate:function(){if(!(null==this._line1||null==this._line2)){this._startPoint1=this._container.get_mapper().pointFromContainerCoordinates(this._line1.get_points().get_item(0),lt.Annotations.Core.AnnFixedStateOperations.none);this._endPoint1=this._container.get_mapper().pointFromContainerCoordinates(this._line1.get_points().get_item(1),lt.Annotations.Core.AnnFixedStateOperations.none);
this._startPoint2=this._container.get_mapper().pointFromContainerCoordinates(this._line2.get_points().get_item(0),lt.Annotations.Core.AnnFixedStateOperations.none);this._endPoint2=this._container.get_mapper().pointFromContainerCoordinates(this._line2.get_points().get_item(1),lt.Annotations.Core.AnnFixedStateOperations.none);var a=this._getLineAngle(this._startPoint1,this._endPoint1);this._angle2=this._getLineAngle(this._startPoint2,this._endPoint2);var b,c,d;b=this._distance(this._startPoint1.get_x(),
this._startPoint1.get_y(),this._startPoint2.get_x(),this._startPoint2.get_y());c=this._distance(this._startPoint1.get_x(),this._startPoint1.get_y(),this._endPoint2.get_x(),this._endPoint2.get_y());d=this._distance(this._endPoint1.get_x(),this._endPoint1.get_y(),this._startPoint2.get_x(),this._startPoint2.get_y());var e=this._distance(this._endPoint1.get_x(),this._endPoint1.get_y(),this._endPoint2.get_x(),this._endPoint2.get_y()),f=!1;b<c&&(f=!0);this._factor1=1;switch(d<e?f?b<d?0:2:c<d?1:2:f?b<e?
0:3:c<e?1:3){case 0:this._factor1=-1;b=this._startPoint1;c=this._startPoint2;break;case 1:this._factor1=-1;b=this._startPoint1;c=this._endPoint2;break;case 2:b=this._endPoint1;c=this._startPoint2;break;default:b=this._endPoint1,c=this._endPoint2}d=this._getPointExtension(b,a,40,this._factor1);this._point1=this._container.get_mapper().pointToContainerCoordinates(b);this._point2=this._container.get_mapper().pointToContainerCoordinates(c);this._intersectionPoint=this._container.get_mapper().pointToContainerCoordinates(d);
0>a&&(a+=Math.PI);0>this._angle2&&(this._angle2+=Math.PI);this._resultAngle=180*(a-this._angle2)/Math.PI;0>this._resultAngle&&(this._resultAngle+=180);90<this._resultAngle&&(this._resultAngle=180-this._resultAngle);null!=this.__cobbAngleChanged&&this.__cobbAngleChanged(this,lt.LeadEventArgs.Empty)}},_removeLineIfAssigned:function(){},_getLineAngle:function(a,b){return Math.atan2(b.get_y()-a.get_y(),b.get_x()-a.get_x())},_distance:function(a,b,c,d){a-=c;b-=d;return Math.sqrt(a*a+b*b)},_getPointExtension:function(a,
b,c,d){var e=d*c*Math.cos(b),b=d*c*Math.sin(b);return lt.LeadPointD.create(a.get_x()+e,a.get_y()+b)}};Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"cobbAngleChanged",{get:lt.Controls.Medical.CobbAngle.prototype.__cobbAngleChanged_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"line1",{get:lt.Controls.Medical.CobbAngle.prototype.get_line1,set:lt.Controls.Medical.CobbAngle.prototype.set_line1,enumerable:!0,configurable:!0});
Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"line2",{get:lt.Controls.Medical.CobbAngle.prototype.get_line2,set:lt.Controls.Medical.CobbAngle.prototype.set_line2,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"angle",{get:lt.Controls.Medical.CobbAngle.prototype.get_angle,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"backgroundColor",{get:lt.Controls.Medical.CobbAngle.prototype.get_backgroundColor,
set:lt.Controls.Medical.CobbAngle.prototype.set_backgroundColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.CobbAngle.prototype,"borderColor",{get:lt.Controls.Medical.CobbAngle.prototype.get_borderColor,set:lt.Controls.Medical.CobbAngle.prototype.set_borderColor,enumerable:!0,configurable:!0});lt.Controls.Medical.ProgressLoading=function(a){this._cell=a;this._fillColorValues(this._red,this._green,this._blue)};lt.Controls.Medical.ProgressLoading.prototype={_totalFrames:0,
_currentProgress:0,_currentProgressPercent:0,_cell:null,_lineWidth:10,_red:239,_green:228,_blue:126,_color:null,_darkColor:null,draw:function(a,b){if(!(this._currentProgress>=this._totalFrames)){a.save();b.get_width();var c=b.get_height();this._lineWidth=10;a.beginPath();a.strokeStyle=this._darkColor;a.fillStyle=this._darkColor;a.lineWidth=2;a.fillRect(2*this._lineWidth,1*c/5,this._lineWidth,3*c/5);var d=3*this._currentProgressPercent*c/500,c=4*c/5-d;a.strokeStyle=this._color;a.fillStyle=this._color;
a.fillRect(2*this._lineWidth,c,this._lineWidth,d);a.textAlign="left";a.textBaseline="top";a.font="12px Arial";a.fillText(String.format("{0} of {1} Loaded",this._currentProgress,this._totalFrames),10,c+d+10);a.stroke();a.restore()}},_fillColorValues:function(a,b,c){this._color=String.format("rgba({0}, {1}, {2}, 255)",a,b,c);this._red=a;this._green=b;this._blue=c;this._darkColor=String.format("rgba({0}, {1}, {2}, 255)",a>>1,b>>1,c>>1)},setColor:function(a,b,c){this._fillColorValues(a,b,c);null!=this._cell&&
this._cell.invalidate()},get_totalFrames:function(){return this._totalFrames},set_totalFrames:function(a){this._totalFrames=a;null!=this._cell&&this._cell.invalidate();return a},get_progressPercent:function(){return this._currentProgressPercent},set_progressPercent:function(a){this._currentProgressPercent=a;this._currentProgress=this._totalFrames*this._currentProgressPercent/100;null!=this._cell&&this._cell.invalidate();return a},get_progress:function(){return this._currentProgress},set_progress:function(a){this._currentProgress=
a;this._totalFrames&&(this._currentProgressPercent=parseInt(100*a/this._totalFrames));null!=this._cell&&this._currentProgress===this._totalFrames&&this._cell._fireEvent(null,2,null);null!=this._cell&&this._cell.invalidate();return a}};Object.defineProperty(lt.Controls.Medical.ProgressLoading.prototype,"totalFrames",{get:lt.Controls.Medical.ProgressLoading.prototype.get_totalFrames,set:lt.Controls.Medical.ProgressLoading.prototype.set_totalFrames,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProgressLoading.prototype,
"progressPercent",{get:lt.Controls.Medical.ProgressLoading.prototype.get_progressPercent,set:lt.Controls.Medical.ProgressLoading.prototype.set_progressPercent,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProgressLoading.prototype,"progress",{get:lt.Controls.Medical.ProgressLoading.prototype.get_progress,set:lt.Controls.Medical.ProgressLoading.prototype.set_progress,enumerable:!0,configurable:!0});lt.Controls.Medical.LineProfileObject=function(a){this._frame=a};lt.Controls.Medical.LineProfileObject.getLinePoints=
function(a,b){var c=null;if(a.get_isEmpty()||b.get_isEmpty()||a.get_x()===b.get_x()||a.get_y()===b.get_y())return null;var d=a.get_x(),c=a.get_y(),e=b.get_y(),f=b.get_x();if(Math.abs(d-c)>Math.abs(f-e))for(var g=(e-f)/(c-d),e=0,h=Math.abs(d-c)+1,c=Array(h),e=0;e<h;e++)f=g*e+d,c[e]=lt.LeadPointD.create(d,f);else{g=(c-d)/(e-f);h=Math.abs(f-e)+1;c=Array(h);for(e=0;e<h;e++)d=g*e+f,c[e]=lt.LeadPointD.create(d,f)}return c};lt.Controls.Medical.LineProfileObject.prototype={_logicalStartPoint:null,_logicalEndPoint:null,
_physicalStartPoint:null,_physicalEndPoint:null,_context:null,_updateCounter:0,_frame:null,beginUpdate:function(){this._updateCounter++},endUpdate:function(){this._updateCounter--;this._canUpdate()&&null!=this.get_context()&&this.draw(this.get_context())},_canUpdate:function(){return!this._updateCounter},_getLineProfile:function(a){var b=this._frame.get_information().get_canvas(),c=b.getContext("2d"),d=Math.abs(this._logicalStartPoint.get_x()-this._logicalEndPoint.get_x())+1;Math.abs(this._logicalStartPoint.get_y()-
this._logicalEndPoint.get_y());var e=Math.min(this._logicalStartPoint.get_x(),this._logicalEndPoint.get_x()),f=Math.min(this._logicalStartPoint.get_y(),this._logicalEndPoint.get_y());c.getImageData(0,0,b.width,b.height);var b=lt.Controls.Medical.LineProfileObject.getLinePoints(this._logicalStartPoint,this._logicalEndPoint),c=0,g=b.length,h=0;if(3===a)for(c=0;c<g;c++)parseInt(4*(b[c].get_x()-e+(b[c].get_y()-f)*d));else for(c=0;c<g;c+=4)h++;return null},get_logicalStartPoint:function(){return this._logicalStartPoint},
set_logicalStartPoint:function(a){this._logicalStartPoint=a;this._physicalStartPoint=lt.Controls.Medical.Tools._logicalToPhysical(this._frame.get_subCell(),this._logicalStartPoint);this._canUpdate()&&null!=this.get_context()&&this.draw(this.get_context());return a},get_logicalEndPoint:function(){return this._logicalEndPoint},set_logicalEndPoint:function(a){this._logicalEndPoint=a;this._physicalEndPoint=lt.Controls.Medical.Tools._logicalToPhysical(this._frame.get_subCell(),this._logicalEndPoint);this._canUpdate()&&
null!=this.get_context()&&this.draw(this.get_context());return a},get_physicalStartPoint:function(){return lt.Controls.Medical.Tools._logicalToPhysical(this._frame.get_subCell(),this._logicalStartPoint)},set_physicalStartPoint:function(a){this._physicalStartPoint=a;this._logicalStartPoint=lt.Controls.Medical.Tools._physicalToLogical(this._frame.get_subCell(),this._physicalStartPoint);this._canUpdate()&&null!=this.get_context()&&this.draw(this.get_context());return a},get_physicalEndPoint:function(){return lt.Controls.Medical.Tools._logicalToPhysical(this._frame.get_subCell(),
this._logicalEndPoint)},set_physicalEndPoint:function(a){this._physicalEndPoint=a;this._logicalEndPoint=lt.Controls.Medical.Tools._physicalToLogical(this._frame.get_subCell(),this._physicalEndPoint);this._canUpdate()&&null!=this.get_context()&&this.draw(this.get_context());return a},get_context:function(){return this._context},set_context:function(a){return this._context=a},draw:function(a){var b=this._frame.get_subCell();if(null!=b){var b=b.get_imageViewer().getItemViewBounds(b,lt.Controls.ImageViewerItemPart.view,
!1),c=this.get_physicalStartPoint(),d=this.get_physicalEndPoint();a.beginPath();a.moveTo(b.get_left()+c.get_x(),b.get_top()+c.get_y());a.lineTo(b.get_left()+d.get_x(),b.get_top()+d.get_y());a.stroke()}}};Object.defineProperty(lt.Controls.Medical.LineProfileObject.prototype,"logicalStartPoint",{get:lt.Controls.Medical.LineProfileObject.prototype.get_logicalStartPoint,set:lt.Controls.Medical.LineProfileObject.prototype.set_logicalStartPoint,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LineProfileObject.prototype,
"logicalEndPoint",{get:lt.Controls.Medical.LineProfileObject.prototype.get_logicalEndPoint,set:lt.Controls.Medical.LineProfileObject.prototype.set_logicalEndPoint,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LineProfileObject.prototype,"physicalStartPoint",{get:lt.Controls.Medical.LineProfileObject.prototype.get_physicalStartPoint,set:lt.Controls.Medical.LineProfileObject.prototype.set_physicalStartPoint,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LineProfileObject.prototype,
"physicalEndPoint",{get:lt.Controls.Medical.LineProfileObject.prototype.get_physicalEndPoint,set:lt.Controls.Medical.LineProfileObject.prototype.set_physicalEndPoint,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.LineProfileObject.prototype,"context",{get:lt.Controls.Medical.LineProfileObject.prototype.get_context,set:lt.Controls.Medical.LineProfileObject.prototype.set_context,enumerable:!0,configurable:!0});lt.Controls.Medical.ShutterObject=function(a,b){this._frame=a;
this._automation=b;this._initialize()};lt.Controls.Medical.ShutterObject.isValid=function(a){return Type.canCast(a,lt.Annotations.Core.AnnSelectionObject)||Type.canCast(a,lt.Annotations.Core.AnnCurveObject)?!1:Type.canCast(a,lt.Annotations.Core.AnnRectangleObject)||Type.canCast(a,lt.Annotations.Core.AnnPolylineObject)&&a.get_isClosed()?!0:!1};lt.Controls.Medical.ShutterObject.prototype={_shutterArea:null,_canvasElement:null,_fillStyle:null,_visible:!1,_automation:null,_viewer:null,_frame:null,_objects:null,
get_objects:function(){return this._objects},set_objects:function(a){return this._objects=a},_initialize:function(){this._objects=new lt.Controls.Medical.LeadCollection;this._objects.add_collectionChanged(ss.Delegate.create(this,this._objects_CollectionChanged));this._fillStyle="rgba(32, 32, 32, 0.8)"},_updateShutter:function(){for(var a=ss.IEnumerator.getEnumerator(this._objects);a.moveNext();)this._updateShutterBorder(a.current);this.onSizeChanged();this._automation.invalidate(null)},_restoreStrokes:function(a){for(var b=
0,c=a.length,d,e,f,b=0;b<c;b++)d=a[b],e=d.OldColor,f=d.OldStroke,d.set_stroke(lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create(e),lt.LeadLengthD.create(f)))},_objects_CollectionChanged:function(a,b){switch(b.get_action()){case 1:case 5:this._updateShutter();break;case 3:case 0:this._restoreStrokes(b.newItems),this._updateShutter()}},_dispose:function(){this._deattach();lt.Controls.Medical.Tools._disposeCanvas(this._canvasElement)},get_visible:function(){return this._visible},
set_visible:function(a){this._visible=a;this._shutterArea.style.visibility=this._visible?"visible":"hidden";this._canvasElement.style.visibility=this._visible?"visible":"hidden";return a},_createShutterArea:function(a){null==this._shutterArea&&(this._shutterArea=document.createElement("div"),this._shutterArea.style.zIndex=98);a.appendChild(this._shutterArea);null==this._canvasElement&&(this._canvasElement=document.createElement("canvas"),this._canvasElement.width=1,this._canvasElement.height=1,this._canvasElement.style.zIndex=
99);this._shutterArea.appendChild(this._canvasElement)},_synchShutterObjects:function(){for(var a=0,b=this._objects.get_count(),c,d=!1,a=0;a<b;a++)c=this._objects.get_item(a),-1===this._automation.get_container().get_children().indexOf(c)&&(this._objects.remove(c),a--,b--,d=!0);d&&this.updateView()},_children_CollectionChanged:function(){this._synchShutterObjects()},_deattach:function(){null!=this._viewer&&null!=this._viewer.get_imageViewer()&&(this._viewer.get_imageViewer().get_interactiveService().get_userControls().remove(this._canvasElement),
this._viewer.get_imageViewer().get_interactiveService().get_userControls().remove(this._shutterArea),this._viewer.get_imageViewer().get_foreCanvas().parentNode.removeChild(this._shutterArea),this._shutterArea.removeChild(this._canvasElement));null!=this._automation&&(this._automation.remove_edit(ss.Delegate.create(this,this._automation_Edit)),this._frame.get_container().get_children().remove_collectionChanged(ss.Delegate.create(this,this._children_CollectionChanged)));null!=this._objects&&this._objects.remove_collectionChanged(ss.Delegate.create(this,
this._objects_CollectionChanged));null!=this._canvasElement&&(this._canvasElement.style.width="1px",this._canvasElement.style.height="1px");this._viewer=null},attach:function(a){this._deattach();this._viewer=a;null!=this._viewer&&(this._automation.add_edit(ss.Delegate.create(this,this._automation_Edit)),this._frame.get_container().get_children().add_collectionChanged(ss.Delegate.create(this,this._children_CollectionChanged)),this._objects.add_collectionChanged(ss.Delegate.create(this,this._objects_CollectionChanged)),
this._createShutterArea(this._viewer.get_imageViewer().get_foreCanvas().parentNode),null!=this._viewer&&(this._viewer.get_imageViewer().get_interactiveService().get_userControls().add(this._canvasElement),this._viewer.get_imageViewer().get_interactiveService().get_userControls().add(this._shutterArea)),this._updateShutter(),this.onSizeChanged())},_saveStrokeValue:function(a){if(void 0==a.OldColor){var b=null;Type.canCast(a.get_stroke().get_stroke(),lt.Annotations.Core.AnnSolidColorBrush)&&(b=a.get_stroke().get_stroke());
null!=b&&(a.OldColor=b.get_color(),a.OldStroke=a.get_stroke().get_strokeThickness())}},_updateShutterBorder:function(a){this._saveStrokeValue(a);a.set_stroke(lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("rgba(255, 255, 255, 0)"),lt.LeadLengthD.create(1)))},_automation_Edit:function(){this.updateView()},onSizeChanged:function(){var a=this._frame.get_subCell();if(!(null==a||null==this._objects)){if(this._objects.get_count()){var a=a.get_imageViewer().getItemViewBounds(a,
lt.Controls.ImageViewerItemPart.view,!1),b=a.get_width(),c=a.get_height();this._shutterArea.style.left=a.get_left()+"px";this._shutterArea.style.top=a.get_top()+"px";this._shutterArea.style.width=b+"px";this._shutterArea.style.height=c+"px";this._shutterArea.style.position="absolute";this._canvasElement.style.left="0px";this._canvasElement.style.top="0px";this._canvasElement.style.width=b+"px";this._canvasElement.style.height=c+"px";this._canvasElement.style.position="absolute";this._canvasElement.width=
parseInt(b);this._canvasElement.height=parseInt(c)}else this._canvasElement.style.left="0px",this._canvasElement.style.top="0px",this._canvasElement.style.width="1px",this._canvasElement.style.height="1px",this._canvasElement.width=1,this._canvasElement.height=1;this.updateView()}},_getAngle:function(a){if(Type.canCast(a,lt.Annotations.Core.AnnRectangleObject))return a.get_angle();Type.canCast(a,lt.Annotations.Core.AnnPolylineObject);return 0},updateView:function(){var a=this._canvasElement.getContext("2d"),
b=this._frame.get_subCell();if(null!=b){b=b.get_imageViewer().getItemViewBounds(b,lt.Controls.ImageViewerItemPart.view,!1);a.save();var c=this._objects.get_count(),d=0;a.clearRect(0,0,this._canvasElement.width,this._canvasElement.height);if(c){a.fillStyle=this._fillStyle;a.fillRect(0,0,this._canvasElement.width,this._canvasElement.height);a.fillStyle="rgba(255, 255, 255, 1)";a.globalCompositeOperation="destination-out";for(d=0;d<c;d++){var e=this._objects.get_item(d);Type.canCast(e.get_parent(),lt.Annotations.Core.AnnGroupObject)&&
e.get_parent();if(Type.canCast(this._objects.get_item(d),lt.Annotations.Core.AnnRectangleObject)||Type.canCast(this._objects.get_item(d),lt.Annotations.Core.AnnPolylineObject)){var f=this._objects.get_item(d),g=this._getAngle(f),h=f.get_rotateCenter();f.get_rotateCenter().get_isEmpty()&&(h=lt.LeadPointD.create((f.get_points().get_item(0).get_x()+f.get_points().get_item(2).get_x())/2,(f.get_points().get_item(0).get_y()+f.get_points().get_item(2).get_y())/2));f.rotate(-g,h);var i=this._frame.get_container().get_mapper(),
j=e=null,k=null;if(Type.canCast(this._objects.get_item(d),lt.Annotations.Core.AnnPolylineObject))for(var l=this._objects.get_item(d),k=Array(l.get_points().get_count()),m=0;m<k.length;m++)k[m]=i.pointFromContainerCoordinates(l.get_points().get_item(m),lt.Annotations.Core.AnnFixedStateOperations.none),k[m].set_x(k[m].get_x()-b.get_left()),k[m].set_y(k[m].get_y()-b.get_top());else e=i.pointFromContainerCoordinates(f.get_points().get_item(0),lt.Annotations.Core.AnnFixedStateOperations.none),e.set_x(e.get_x()-
b.get_left()),e.set_y(e.get_y()-b.get_top()),j=i.pointFromContainerCoordinates(f.get_points().get_item(2),lt.Annotations.Core.AnnFixedStateOperations.none),j.set_x(j.get_x()-b.get_left()),j.set_y(j.get_y()-b.get_top());i=i.pointFromContainerCoordinates(h,lt.Annotations.Core.AnnFixedStateOperations.none);i.set_x(i.get_x()-b.get_left());i.set_y(i.get_y()-b.get_top());a.translate(i.get_x(),i.get_y());a.rotate(g*Math.PI/180);a.translate(-i.get_x(),-i.get_y());f.rotate(g,h);if(Type.canCast(this._objects.get_item(d),
lt.Annotations.Core.AnnEllipseObject))f=(j.get_y()-e.get_y())/(j.get_x()-e.get_x()),g=(e.get_x()+j.get_x())/2,h=(e.get_y()+j.get_y())/2,a.beginPath(),a.translate(g,h),a.scale(1,f),a.translate(-g,-h),a.arc(g,h,(j.get_x()-e.get_x())/2,0,2*Math.PI,!1),a.fill(),a.stroke();else if(Type.canCast(this._objects.get_item(d),lt.Annotations.Core.AnnRectangleObject))a.fillRect(e.get_x(),e.get_y(),j.get_x()-e.get_x(),j.get_y()-e.get_y());else if(Type.canCast(this._objects.get_item(d),lt.Annotations.Core.AnnPolylineObject)){a.beginPath();
a.moveTo(k[0].get_x(),k[0].get_y());for(m=0;m<k.length-1;m++)a.lineTo(k[m+1].get_x(),k[m+1].get_y());a.lineTo(k[0].get_x(),k[0].get_y());a.closePath();a.fill();a.stroke()}}}}a.restore()}},get_fillStyle:function(){return this._fillStyle},set_fillStyle:function(a){if(this._fillStyle!==a)return this._fillStyle=a,this.updateView(),a}};Object.defineProperty(lt.Controls.Medical.ShutterObject.prototype,"objects",{get:lt.Controls.Medical.ShutterObject.prototype.get_objects,set:lt.Controls.Medical.ShutterObject.prototype.set_objects,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ShutterObject.prototype,"visible",{get:lt.Controls.Medical.ShutterObject.prototype.get_visible,set:lt.Controls.Medical.ShutterObject.prototype.set_visible,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ShutterObject.prototype,"fillStyle",{get:lt.Controls.Medical.ShutterObject.prototype.get_fillStyle,set:lt.Controls.Medical.ShutterObject.prototype.set_fillStyle,enumerable:!0,configurable:!0});lt.Controls.Medical.SpyGlassPositionChangedEventArgs=
function(a,b,c,d,e){lt.Controls.Medical.SpyGlassPositionChangedEventArgs.initializeBase(this);this._displayRect$1=c;this._canvas$1=a;this._inputCanvas$1=b;this._subCell$1=d;this._chunkList$1=e};lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype={_inputCanvas$1:null,_canvas$1:null,_displayRect$1:null,_subCell$1:null,_chunkList$1:null,get_chunkList:function(){return this._chunkList$1},get_displayRect:function(){return this._displayRect$1},get_canvas:function(){return this._canvas$1},get_inputCanvas:function(){return this._inputCanvas$1},
get_subCell:function(){return this._subCell$1}};Object.defineProperty(lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype,"chunkList",{get:lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype.get_chunkList,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype,"displayRect",{get:lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype.get_displayRect,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype,
"canvas",{get:lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype.get_canvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype,"inputCanvas",{get:lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype.get_inputCanvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype,"subCell",{get:lt.Controls.Medical.SpyGlassPositionChangedEventArgs.prototype.get_subCell,
enumerable:!0,configurable:!0});lt.Controls.Medical.SpyGlassEventArgs=function(a,b,c){lt.Controls.Medical.SpyGlassEventArgs.initializeBase(this);this._inputCanvas$1=a;this._canvas$1=b;this._userData$1=c};lt.Controls.Medical.SpyGlassEventArgs.prototype={_inputCanvas$1:null,_canvas$1:null,_userData$1:null,get_inputCanvas:function(){return this._inputCanvas$1},set_inputCanvas:function(a){return this._inputCanvas$1=a},get_canvas:function(){return this._canvas$1},set_canvas:function(a){return this._canvas$1=
a},get_userData:function(){return this._userData$1},set_userData:function(a){return this._userData$1=a}};Object.defineProperty(lt.Controls.Medical.SpyGlassEventArgs.prototype,"inputCanvas",{get:lt.Controls.Medical.SpyGlassEventArgs.prototype.get_inputCanvas,set:lt.Controls.Medical.SpyGlassEventArgs.prototype.set_inputCanvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassEventArgs.prototype,"canvas",{get:lt.Controls.Medical.SpyGlassEventArgs.prototype.get_canvas,
set:lt.Controls.Medical.SpyGlassEventArgs.prototype.set_canvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.SpyGlassEventArgs.prototype,"userData",{get:lt.Controls.Medical.SpyGlassEventArgs.prototype.get_userData,set:lt.Controls.Medical.SpyGlassEventArgs.prototype.set_userData,enumerable:!0,configurable:!0});lt.Controls.Medical.MedicalSpyGlassInteractiveMode=function(){lt.Controls.Medical.MedicalSpyGlassInteractiveMode.initializeBase(this);this._chunkList$3=[];this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);
this.set_itemPart(lt.Controls.ImageViewerItemPart.item);this.set_backgroundColor("black");this.set_scaleFactor(1);this._window_MouseWheelListener$3=ss.Delegate.create(this,this._window_MouseWheel$3);window.addEventListener(lt.LTHelper.mouseWheelEvent,this._window_MouseWheelListener$3,!1)};lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype={_canvas$3:null,_window_MouseWheelListener$3:null,_oldEnableMouseWheel$3:!1,_text$3:"",_showOverlayText$3:!0,_positionScale$3:"",_userElementCanvas$3:null,
_topTextCanvas$3:null,_bottomTextCanvas$3:null,add_imageRequested:function(a){this.__imageRequested$3=ss.Delegate.combine(this.__imageRequested$3,a)},remove_imageRequested:function(a){this.__imageRequested$3=ss.Delegate.remove(this.__imageRequested$3,a)},__imageRequested$3_handler_get:function(){null==this.__imageRequested$3_handler&&(this.__imageRequested$3_handler=ss.EventHandler.create(this,this.add_imageRequested,this.remove_imageRequested));return this.__imageRequested$3_handler},__imageRequested$3:null,
__imageRequested$3_handler:null,add_positionChanged:function(a){this.__positionChanged$3=ss.Delegate.combine(this.__positionChanged$3,a)},remove_positionChanged:function(a){this.__positionChanged$3=ss.Delegate.remove(this.__positionChanged$3,a)},__positionChanged$3_handler_get:function(){null==this.__positionChanged$3_handler&&(this.__positionChanged$3_handler=ss.EventHandler.create(this,this.add_positionChanged,this.remove_positionChanged));return this.__positionChanged$3_handler},__positionChanged$3:null,
__positionChanged$3_handler:null,add__chunkLoaded:function(a){this.__chunkLoaded$3=ss.Delegate.combine(this.__chunkLoaded$3,a)},remove__chunkLoaded:function(a){this.__chunkLoaded$3=ss.Delegate.remove(this.__chunkLoaded$3,a)},__chunkLoaded$3_handler_get:function(){null==this.__chunkLoaded$3_handler&&(this.__chunkLoaded$3_handler=ss.EventHandler.create(this,this.add__chunkLoaded,this.remove__chunkLoaded));return this.__chunkLoaded$3_handler},__chunkLoaded$3:null,tiling:!0,refresh:function(){if(null!=
this._userElementCanvas$3){var a=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_item");null!=this._canvas$3&&this._drawElement$3(a,this._canvas$3);this.invalidate()}},dispose:function(){this.get_imageViewer();window.removeEventListener(lt.LTHelper.mouseWheelEvent,this._window_MouseWheelListener$3);var a=this.get_interactiveModeCanvas().parentNode;a.removeChild(this._topTextCanvas$3);a.removeChild(this._bottomTextCanvas$3);lt.Controls.Medical.Tools._disposeCanvas(this._topTextCanvas$3);
lt.Controls.Medical.Tools._disposeCanvas(this._bottomTextCanvas$3)},_window_MouseWheel$3:function(a){if(this.get_isWorking()){var b=0;a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3);b=parseInt(b);0<b?(a=this.get_scale()+0.05,this.set_scale(a)):(a=this.get_scale()-0.05,this.set_scale(Math.max(1,a)));this.tiling||this.set_scaleFactor(this.get_scale());this._sendPositionChanged$3(this);this.invalidate();this._calculatePositionScale$3();this._updateBottomText$3()}},_frame$3:null,_createBackCanvas$3:function(a){null==
a.backCanvas&&(a.backCanvas=document.createElement("canvas"));a.backCanvas.width=a.canvas.width;a.backCanvas.height=a.canvas.height;var b=a.backCanvas.getContext("2d");b.clearRect(0,0,a.backCanvas.width,a.backCanvas.height);b.drawImage(a.canvas,0,0)},_magnifyMRTIRenderer_RenderChunk$3:function(a,b){var c=new lt.Controls.Medical.ChunkData(b.get_chunkImage(),b.get_chunkRect(),b.get_resolution(),b.get_chunkCanvas());c.backCanvas=b.get_backCanvas();if(null!=this._frame$3){this._frame$3._applyImageProcessingOnChunk(c);
for(var d=0;d<this._chunkList$3.length;d++)if(c.equal(this._chunkList$3[d])){lt.Controls.Medical.Tools._removeChunk(this._chunkList$3,this._chunkList$3[d]);break}this._createBackCanvas$3(c);this._chunkList$3.add(c)}else lt.Controls.Medical.Tools._removeChunk(this._chunkList$3,c);null!=this.__chunkLoaded$3&&this.__chunkLoaded$3(this,new lt.Controls.Medical.ChunkLoadedEventArgs(c));this.refresh()},_createUserCanvasElement$3:function(a){if(null==this._userElementCanvas$3){var b=a.get_imageViewer().getItemViewBounds(a,
lt.Controls.ImageViewerItemPart.item,!1);b.get_width();b.get_height();this._userElementCanvas$3=document.createElement("canvas");this._userElementCanvas$3.style.zIndex=100;this._userElementCanvas$3.style.left="0px";this._userElementCanvas$3.style.top="0px";this._userElementCanvas$3.style.width=a.get_imageViewer().get_foreCanvas().width.toString()+"px";this._userElementCanvas$3.style.height=a.get_imageViewer().get_foreCanvas().height.toString()+"px";this._userElementCanvas$3.width=a.get_imageViewer().get_foreCanvas().width;
this._userElementCanvas$3.height=a.get_imageViewer().get_foreCanvas().height;this._userElementCanvas$3.style.position="absolute";this._userElementCanvas$3.style.visibility="visible";b=this._userElementCanvas$3.getContext("2d");b.fillStyle="black";b.fillRect(0,0,this._userElementCanvas$3.width,this._userElementCanvas$3.height);b=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_interactiveModeCanvas").parentNode;this._topTextCanvas$3=document.createElement("canvas");this._topTextCanvas$3.style.left=
"0px";this._topTextCanvas$3.style.top="0px";this._topTextCanvas$3.style.width="100px";this._topTextCanvas$3.style.height="100px";this._topTextCanvas$3.style.zIndex=5;this._topTextCanvas$3.style.position="absolute";this._topTextCanvas$3.style.visibility=this._showOverlayText$3?"visible":"hidden";b.appendChild(this._topTextCanvas$3);this._bottomTextCanvas$3=document.createElement("canvas");this._bottomTextCanvas$3.style.left="0px";this._bottomTextCanvas$3.style.top="0px";this._bottomTextCanvas$3.style.width=
"100px";this._bottomTextCanvas$3.style.height="100px";this._bottomTextCanvas$3.style.zIndex=5;this._bottomTextCanvas$3.style.position="absolute";this._bottomTextCanvas$3.style.visibility=this._showOverlayText$3?"visible":"hidden";b.appendChild(this._bottomTextCanvas$3)}this._addCanvasAsUserElement$3(a.get_imageViewer())},_removeCanvasAsUserElement$3:function(a){null!=this._userElementCanvas$3&&-1!==a.get_interactiveService().get_userControls().indexOf(this._userElementCanvas$3)&&a.get_interactiveService().get_userControls().remove(this._userElementCanvas$3)},
_addCanvasAsUserElement$3:function(a){null!=this._userElementCanvas$3&&-1===a.get_interactiveService().get_userControls().indexOf(this._userElementCanvas$3)&&a.get_interactiveService().get_userControls().add(this._userElementCanvas$3)},_chunkList$3:null,_tileResolution$3:null,_enlargeImageRect$3:function(a){var b=this.get_interactiveModeCanvas(),c=b.offsetLeft+b.width/2,b=b.offsetTop+b.height/2,c=c+(a.get_x()-c)*this.get_scale(),b=b+(a.get_y()-b)*this.get_scale(),d=a.get_width()*this.get_scale(),
a=a.get_height()*this.get_scale();return lt.LeadRectD.create(c,b,d,a)},_clearUneccessaryChunks$3:function(a){var b,c,d=a.get_imageViewer().getItemBounds(a,lt.Controls.ImageViewerItemPart.view);b=-d.get_x();c=-d.get_y();var e=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),a),e=this._enlargeImageRect$3(e),a=a.get_attachedFrame(),f=a.get_mrtiInfo(),g=a.get_mrtiInfo().get_fullSize().get_width(),g=e.get_width()/g;if(!(null==f||d.get_isEmpty())&&!e.get_isEmpty())d.offset(b,c),
e.offset(b,c),d.clone(),b=this.get_interactiveModeCanvas(),b=lt.LeadRectD.create(b.offsetLeft,b.offsetTop,b.width,b.height),e=lt.LeadRectD.create(-e.get_x(),-e.get_y(),e.get_width(),e.get_height()),lt.Controls.Medical.Tools._clearOutsideChunks(b,e,a.get__magnifyMRTIRenderer(),this._chunkList$3,a,a.get_mrtiInfo(),g)},updateView:function(a){if(this.tiling){var b=a.get_attachedFrame();if(null!=b.get__magnifyMRTIRenderer()){var c,d,e=a.get_imageViewer().getItemBounds(a,lt.Controls.ImageViewerItemPart.view);
c=-e.get_x();d=-e.get_y();var a=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),a),a=this._enlargeImageRect$3(a),f=b.get_mrtiInfo();if(!(null==f||e.get_isEmpty())&&!a.get_isEmpty()){e.offset(c,d);a.offset(c,d);e.clone();e=this.get_interactiveModeCanvas();c=lt.LeadRectD.create(e.offsetLeft+c,e.offsetTop+d,e.width,e.height);d=lt.LeadRectD.create(-a.get_x(),-a.get_y(),a.get_width(),a.get_height());for(var g=0,h=this._chunkList$3.length,e=[],g=0;g<h;g++)e.add(this._chunkList$3[g]._getInfo());
g=parseInt(d.get_width()*d.get_height());this._tileResolution$3=b.get__magnifyMRTIRenderer().getNewResolution(g*this.get_scale(),f,1);b.get__magnifyMRTIRenderer().tileResolution=this._tileResolution$3;f=!1;lt.Controls.Medical.Tools._noNeedForTiles(a,b,this._tileResolution$3)&&(b.get__magnifyMRTIRenderer().tileResolution=this._tileResolution$3,f=!0);b.get__magnifyMRTIRenderer().renderAsync(c,d,e,null,0,lt.Controls.Medical.Tools._recycledElements,b.get_flipped(),b.get_reversed(),b.get_rotateAngle(),
f)}}}},start:function(a){lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"start",[a]);a=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$3));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$3));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$3))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,
"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$3));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$3));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$3));lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"stop",[a])}},_service_DragCompleted$3:function(){null!=this._userElementCanvas$3&&(this._frame$3=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_item").get_attachedFrame(),
null!=this._frame$3&&null!=this._frame$3.get__magnifyMRTIRenderer()&&this._frame$3.get__magnifyMRTIRenderer().remove_renderChunk(ss.Delegate.create(this,this._magnifyMRTIRenderer_RenderChunk$3)),this._spyDone$3(),this.onWorkCompleted(lt.LeadEventArgs.Empty),lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_interactiveService").set_enableMouseWheel(this._oldEnableMouseWheel$3),this._removeCanvasAsUserElement$3(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,
"get_imageViewer")),lt.Controls.Medical.Tools.resetCanvas(this._userElementCanvas$3),this._canvas$3=null,this._topTextCanvas$3.style.visibility="hidden",this._bottomTextCanvas$3.style.visibility="hidden")},_updateTopText$3:function(){var a=this.get_interactiveModeCanvas();null!=this._topTextCanvas$3&&(this._topTextCanvas$3.style.left=a.style.left,this._topTextCanvas$3.style.top=(a.offsetTop-100).toString()+"px",this._topTextCanvas$3.style.width=a.style.width,this._topTextCanvas$3.style.height="100px",
this._topTextCanvas$3.style.visibility=this._showOverlayText$3?"visible":"hidden",this._topTextCanvas$3.width=a.width,this._topTextCanvas$3.height=100,a=this._topTextCanvas$3.getContext("2d"),a.textAlign="center",a.textBaseline="bottom",a.font="8pt Arial",a.fillStyle="yellow",a.fillText(this._text$3,this._topTextCanvas$3.width/2,this._topTextCanvas$3.height-4),a.stroke())},_updateBottomText$3:function(){if(null!=this._topTextCanvas$3){this._calculatePositionScale$3();var a=this.get_interactiveModeCanvas();
this._bottomTextCanvas$3.style.left=a.style.left;this._bottomTextCanvas$3.style.top=(a.offsetTop+a.height).toString()+"px";this._bottomTextCanvas$3.style.width=a.style.width;this._bottomTextCanvas$3.style.height="100px";this._bottomTextCanvas$3.style.visibility=this._showOverlayText$3?"visible":"hidden";this._bottomTextCanvas$3.width=a.width;this._bottomTextCanvas$3.height=100;a=this._bottomTextCanvas$3.getContext("2d");a.textAlign="center";a.textBaseline="top";a.font="8pt Arial";a.fillStyle="yellow";
a.fillText(this._positionScale$3,this._topTextCanvas$3.width/2,4);a.stroke()}},_getDisplayedRect$3:function(a){var b=this.get_interactiveModeCanvas(),b=lt.LeadRectD.create(b.offsetLeft,b.offsetTop,b.width,b.height),a=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1),c=b.get_width();b.set_width(b.get_width()/this.get_scale());b.set_height(b.get_height()/this.get_scale());b.offset((c-b.get_width())/2,(c-b.get_width())/2);b.intersect(a);return b},_sendPositionChanged$3:function(a){if(null!=
this.__positionChanged$3){var b=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_item"),c=this._getDisplayedRect$3(b),d=this._getInputCanvas$3(b),c=new lt.Controls.Medical.SpyGlassPositionChangedEventArgs(this._canvas$3,d,c,b,this._chunkList$3);this.__positionChanged$3(a,c);this.updateView(b);this.refresh()}},_service_DragDelta$3:function(a){this.get_isWorking()&&(this._sendPositionChanged$3(a),this._updateTopText$3(),this._updateBottomText$3())},_updateUserCanvasSize$3:function(a){var b=
a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1);b.get_width();b.get_height();null!=this._userElementCanvas$3&&(this._userElementCanvas$3.style.left="0px",this._userElementCanvas$3.style.top="0px",this._userElementCanvas$3.style.width=a.get_imageViewer().get_foreCanvas().width.toString()+"px",this._userElementCanvas$3.style.height=a.get_imageViewer().get_foreCanvas().height.toString()+"px",this._userElementCanvas$3.width=a.get_imageViewer().get_foreCanvas().width,this._userElementCanvas$3.height=
a.get_imageViewer().get_foreCanvas().height)},_mContext$3:null,_mMatrix$3:null,_magnifedCanvas$3:null,_spyStarted$3:function(a){this._mContext$3=this._userElementCanvas$3.getContext("2d");this._mContext$3.setTransform(1,0,0,1,0,0);this._mMatrix$3=a.get_imageViewer().getItemImageTransform(a);this._mContext$3.transform(this._mMatrix$3.get_m11(),this._mMatrix$3.get_m12(),this._mMatrix$3.get_m21(),this._mMatrix$3.get_m22(),this._mMatrix$3.get_offsetX(),this._mMatrix$3.get_offsetY());this.tiling||this.set_scaleFactor(this.get_scale());
var b=this.get_interactiveModeCanvas();if(null!=this._frame$3.get_mrtiInfo()&&(null==this._magnifedCanvas$3&&(this._magnifedCanvas$3=document.createElement("canvas")),a=(2+Math.round(b.width/this._frame$3.get_mrtiInfo().get_tileSize().get_width()))*this._frame$3.get_mrtiInfo().get_tileSize().get_width(),b=(2+Math.round(b.height/this._frame$3.get_mrtiInfo().get_tileSize().get_height()))*this._frame$3.get_mrtiInfo().get_tileSize().get_height(),this._magnifedCanvas$3.width!==a&&(this._magnifedCanvas$3.width=
a),this._magnifedCanvas$3.height!==b))this._magnifedCanvas$3.height=b},_clearChunks$3:function(a){if(null!=a){var b;for(b=a.length-1;0<=b;b--)lt.Controls.Medical.Tools._removeChunk(a,a[b])}},_spyDone$3:function(){this._clearChunks$3(this._chunkList$3);null!=this._frame$3.get__magnifyMRTIRenderer()&&this._clearChunks$3(this._frame$3.get__magnifyMRTIRenderer().get_alreadyRequested());this.set_scaleFactor(1);null!=this._magnifedCanvas$3&&lt.Controls.Medical.Tools.resetCanvas(this._magnifedCanvas$3);
this._mContext$3.setTransform(1,0,0,1,0,0)},_drawElement$3:function(a){var b=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1),c=lt.Controls.Medical.MRTISubCell.getFloatImageRect(this.get_imageViewer(),a);a.get_attachedFrame();this._mContext$3.setTransform(1,0,0,1,0,0);this._mContext$3.fillRect(0,0,b.get_width(),b.get_height());if(null!=this._chunkList$3){a=[];a.add(this._tileResolution$3);var a=lt.Controls.Medical.Tools._getTopLeftPoints(this._chunkList$3,a),d=0,e,
f,g=this.get_interactiveModeCanvas(),h=g.offsetLeft+g.width/2-c.get_left(),d=g.offsetTop+g.height/2-c.get_top(),h=h-h*this.get_scale()+c.get_left(),i=d-d*this.get_scale()+c.get_top();e=c.get_width()*this.get_scale();f=c.get_height()*this.get_scale();this.tiling?this._mContext$3.drawImage(this._canvas$3,h,i,e,f):this._mContext$3.drawImage(this._canvas$3,b.get_left(),b.get_top());if(null!=this._frame$3.get_mrtiInfo()){e=this._magnifedCanvas$3.getContext("2d");e.clearRect(0,0,this._magnifedCanvas$3.width,
this._magnifedCanvas$3.height);for(d=0;d<this._chunkList$3.length;d++)b=this._chunkList$3[d],b.resolution.get_width()===this._tileResolution$3.get_width()&&e.drawImage(b.canvas,b.rect.get_left()-a[0].get_x(),b.rect.get_top()-a[0].get_y(),b.canvas.width,b.canvas.height);if(this._chunkList$3.length){g=lt.LeadRectD.create(g.offsetLeft,g.offsetTop,g.width,g.height);for(d=0;d<this._chunkList$3.length;d++)b=this._chunkList$3[d],e=c.get_width()/b.resolution.get_width()*this.get_scale(),f=c.get_height()/
b.resolution.get_height()*this.get_scale(),e=lt.LeadRectD.create(b.rect.get_left()*e+h,b.rect.get_top()*f+i,b.canvas.width*e,b.canvas.height*f),b.resolution.get_width()!==this._tileResolution$3.get_width()&&this._mContext$3.drawImage(b.canvas,e.get_left(),e.get_top(),e.get_width(),e.get_height()),g.intersectsWith(e)||(lt.Controls.Medical.Tools._removeChunk(this._chunkList$3,b),d--);e=c.get_width()/this._tileResolution$3.get_width()*this.get_scale();f=c.get_height()/this._tileResolution$3.get_height()*
this.get_scale();e=lt.LeadRectD.create(a[0].get_x()*e+h,a[0].get_y()*f+i,this._magnifedCanvas$3.width*e,this._magnifedCanvas$3.height*f);this._mContext$3.drawImage(this._magnifedCanvas$3,e.get_left(),e.get_top(),e.get_width(),e.get_height())}}}},_scale$3:2,get_scale:function(){return this._scale$3},set_scale:function(a){return this._scale$3=a},_calculatePositionScale$3:function(){var a=this.get_interactiveModeCanvas(),b=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_item"),
c=a.offsetLeft+a.width/2,a=a.offsetTop+a.height/2,d=b.get_imageViewer().getItemViewBounds(b,lt.Controls.ImageViewerItemPart.image,!1),c=(c-d.get_left())/d.get_width(),a=(a-d.get_top())/d.get_height();this._getDisplayedRect$3(b);this._positionScale$3=String.format("X: {0} \t Y: {1} \t {2}X",c.toFixed(2),a.toFixed(2),this.get_scale().toFixed(2))},_getInputCanvas$3:function(a){var b=null!=this._frame$3.lowResImage?this._frame$3.lowResImage.canvas:null!=this._frame$3.thumbnailImage?this._frame$3.thumbnailImage.canvas:
null;Type.canCast(a.get_parentCell(),lt.Controls.Medical.MPRCell)&&(b=a.get_parentCell().mprImage);this.tiling||(b=a.get_parentCell().get_imageViewer().get_foreCanvas(),null==this._magnifedCanvas$3&&(this._magnifedCanvas$3=document.createElement("canvas")),a=a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.view,!1),this._magnifedCanvas$3.width=parseInt(a.get_width()),this._magnifedCanvas$3.height=parseInt(a.get_height()),this._magnifedCanvas$3.getContext("2d").drawImage(b,-a.get_left(),
-a.get_top()),b=this._magnifedCanvas$3);return b},_service_DragStarted$3:function(a,b){if(this.get_mouseButtons()===b.get_mouseButton()){var c=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,"get_item");this._frame$3=c.get_attachedFrame();null!=this._frame$3&&null!=this._frame$3.get__magnifyMRTIRenderer()&&this._frame$3.get__magnifyMRTIRenderer().add_renderChunk(ss.Delegate.create(this,this._magnifyMRTIRenderer_RenderChunk$3));var d=lt.Controls.Medical.MedicalSpyGlassInteractiveMode.callBaseMethod(this,
"get_interactiveService");this._oldEnableMouseWheel$3=d.get_enableMouseWheel();d.set_enableMouseWheel(!1);null!=this.__imageRequested$3&&(d=this._getInputCanvas$3(c),d=new lt.Controls.Medical.SpyGlassEventArgs(d,this._canvas$3,c),this.__imageRequested$3(this,d),null!=d.get_canvas()&&(this._canvas$3=d.get_canvas()));this._sendPositionChanged$3(a);null!=this._canvas$3&&this._createUserCanvasElement$3(c);this._spyStarted$3(c);this._updateUserCanvasSize$3(c);this._updateTopText$3();this._updateBottomText$3();
null!=this._canvas$3&&this._drawElement$3(c,this._canvas$3);if(b.get_mouseButton()===this.get_mouseButtons())this.onWorkStarted(lt.LeadEventArgs.Empty);this.invalidate()}},get_text:function(){return this._text$3},set_text:function(a){this._text$3=a;this._updateTopText$3();return a},get_showOverlayText:function(){return this._showOverlayText$3},set_showOverlayText:function(a){this._showOverlayText$3=a;if(this.get_isWorking())return null!=this._topTextCanvas$3&&(this._topTextCanvas$3.style.visibility=
this._showOverlayText$3?"visible":"hidden"),null!=this._bottomTextCanvas$3&&(this._bottomTextCanvas$3.style.visibility=this._showOverlayText$3?"visible":"hidden"),a},get_name:function(){return"Medical Spy Glass"}};Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,"imageRequested",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.__imageRequested$3_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,
"positionChanged",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.__positionChanged$3_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,"scale",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.get_scale,set:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.set_scale,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,
"text",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.get_text,set:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.set_text,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,"showOverlayText",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.get_showOverlayText,set:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.set_showOverlayText,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype,
"name",{get:lt.Controls.Medical.MedicalSpyGlassInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});lt.Controls.Medical.ProbeToolEventArgs=function(a,b){lt.Controls.Medical.ProbeToolEventArgs.initializeBase(this);this._position$1=a;this._pixelValue$1="";this._target$1=b};lt.Controls.Medical.ProbeToolEventArgs.prototype={_position$1:null,_pixelValue$1:"",_target$1:null,get_position:function(){return this._position$1},get_pixelValue:function(){return this._pixelValue$1},set_pixelValue:function(a){return this._pixelValue$1=
a},get_target:function(){return this._target$1}};Object.defineProperty(lt.Controls.Medical.ProbeToolEventArgs.prototype,"position",{get:lt.Controls.Medical.ProbeToolEventArgs.prototype.get_position,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolEventArgs.prototype,"pixelValue",{get:lt.Controls.Medical.ProbeToolEventArgs.prototype.get_pixelValue,set:lt.Controls.Medical.ProbeToolEventArgs.prototype.set_pixelValue,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolEventArgs.prototype,
"target",{get:lt.Controls.Medical.ProbeToolEventArgs.prototype.get_target,enumerable:!0,configurable:!0});lt.Controls.Medical.ProbeToolInteractiveMode=function(a){lt.Controls.Medical.ProbeToolInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item);this._cell$1=a;this._createTool$1(null!=this._cell$1.get_viewer()?this._cell$1.get_viewer().get_divId():this._cell$1.get_divID())};lt.Controls.Medical.ProbeToolInteractiveMode._isGray$1=
function(a){return"MONOCHROME2"===a.get_photometricInterpretation()||"MONOCHROME1"===a.get_photometricInterpretation()};lt.Controls.Medical.ProbeToolInteractiveMode.getPixelValue=function(a,b,c){var d=a.get_mrtiInfo(),e=a.get_information();if(d.get_fullSize().get_width()>=b&&d.get_fullSize().get_height()>=c){var f=lt.Controls.Medical.ProbeToolInteractiveMode._getPointChunk$1(a,b,c);null==f&&(f=null!=a.lowResImage?a.lowResImage:a.thumbnailImage);if(null==f)return[0,0,0];a=d.get_fullSize().get_width()/
f.resolution.get_width();b=parseInt(b/a);c=parseInt(c/a);f=(16===e.get_bitsPerPixel()||12===e.get_bitsPerPixel()?f.backCanvas:f.canvas).getContext("2d").getImageData(b-f.rect.get_left(),c-f.rect.get_top(),1,1).data;return 16===e.get_bitsPerPixel()||12===e.get_bitsPerPixel()?[f[1]<<8|f[2]]:[f[0],f[1],f[2]]}return null};lt.Controls.Medical.ProbeToolInteractiveMode._getPointChunk$1=function(a,b,c){var d=a.get_mrtiInfo();a.get_information();for(var e=a.get_subCell().get_chunkList(),f=e.length,g,h=0,i=
g=0;i<f;i++)if(a.get__mrtiRenderer().tileResolution.get_width()===e[i].resolution.get_width()&&(g=d.get_fullSize().get_width()/e[i].resolution.get_width(),h=parseInt(b/g),g=parseInt(c/g),e[i].rect.contains(h,g)))return e[i];return null};lt.Controls.Medical.ProbeToolInteractiveMode.getHuValue=function(a,b,c,d){var e=a.get_mrtiInfo(),f=a.get_information();if(e.get_fullSize().get_width()>=b&&e.get_fullSize().get_height()>=c){d=lt.Controls.Medical.ProbeToolInteractiveMode._getPointChunk$1(a,b,c);null==
d&&(d=a.lowResImage);a=e.get_fullSize().get_width()/d.resolution.get_width();b=parseInt(b/a);c=parseInt(c/a);if(null==d||null==d.backCanvas)return"N/A";c=d.backCanvas.getContext("2d").getImageData(b-d.rect.get_left(),c-d.rect.get_top(),1,1).data;d=c[1]<<8|c[2];return 8<f.get_bitsPerPixel()&&lt.Controls.Medical.ProbeToolInteractiveMode._isGray$1(f)?(f.get_signed()&&32767<d&&(d-=65536),c=f.get_highBit()?f.get_highBit():f.get_bitsPerPixel()-1,1===(f.get_highBit()<f.get_bitsPerPixel()-1|0<f.get_lowBit())&&
(f.get_lowBit()&&(d>>=f.get_lowBit(),c=f.get_highBit()-f.get_lowBit()),b=Math.pow(2,c+1)/2,d=parseInt((d-f.get_autoScaleIntercept())/f.get_autoScaleSlope()+0.5),d>=b&&(d-=Math.pow(2,c+1))),d.toString()):String.format("{0}, {1}, {2}",d>>16&255,d>>8&255,d&255)}return"N/A"};lt.Controls.Medical.ProbeToolInteractiveMode.prototype={_cell$1:null,_probeToolDiv$1:null,_viewer$1:null,_spanDiv$1:null,get_id:function(){return 102},_createTool$1:function(a){a=document.getElementById(a);this._probeToolDiv$1=document.createElement("div");
this._probeToolDiv$1.id="probeToolDiv";this._probeToolDiv$1.style.position="absolute";this._probeToolDiv$1.style.visibility="visible";this._probeToolDiv$1.style.zIndex=100;this._probeToolDiv$1.style.background="#0";this._probeToolDiv$1.style.width="200px";a.appendChild(this._probeToolDiv$1);this._spanDiv$1=document.createElement("span");this._spanDiv$1.style.cssText="background: #FFEECC; color: #010101; display: block; font-family: arial; font-weight: bold; font-size: 130%;  padding: 6px 15px; text-shadow: 1px 1px black, 0px 1px black, -1px 1px black, 1px 0px black, -1px 0px black, 1px -1px black, 0px -1px black, -1px -1px black;  cursor: pointer; text-decoration:none;";
this._spanDiv$1.innerText="Select Series \n Something something";this._spanDiv$1.style.border="black 1px solid";this._probeToolDiv$1.appendChild(this._spanDiv$1);this._probeToolDiv$1.style.visibility="hidden";this._backgroundColor$1="#FFEECC";this._textColor$1="#010101";this._showBorder$1=!0},start:function(a){lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"start",[a]);this._viewer$1=a;a=lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,
this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,
this._service_DragCompleted$1));lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"stop",[a])}},_service_DragCompleted$1:function(){this._probeToolDiv$1.style.visibility="hidden";if(this.get_isWorking())this.onWorkCompleted(lt.LeadEventArgs.Empty)},_service_DragDelta$1:function(a,b){var c=lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"get_item");this.get_isWorking()&&this._updateProbeTool$1(c,b.get_position())},add_probeToolUpdated:function(a){this.__probeToolUpdated$1=
ss.Delegate.combine(this.__probeToolUpdated$1,a)},remove_probeToolUpdated:function(a){this.__probeToolUpdated$1=ss.Delegate.remove(this.__probeToolUpdated$1,a)},__probeToolUpdated$1_handler_get:function(){null==this.__probeToolUpdated$1_handler&&(this.__probeToolUpdated$1_handler=ss.EventHandler.create(this,this.add_probeToolUpdated,this.remove_probeToolUpdated));return this.__probeToolUpdated$1_handler},__probeToolUpdated$1:null,__probeToolUpdated$1_handler:null,_updateProbeTool$1:function(a,b){var c=
a.get_imageViewer().getItemViewBounds(a,lt.Controls.ImageViewerItemPart.image,!1),d=parseInt(a.get_imageSize().get_width()),e=parseInt(a.get_imageSize().get_height()),f=parseInt((b.get_x()-c.get_left())*(d-1)/c.get_width())>>0,g=parseInt((b.get_y()-c.get_top())*(e-1)/c.get_height())>>0;c.contains(b.get_x(),b.get_y())?(f=Math.max(0,Math.min(d,f)),g=Math.max(0,Math.min(e,g)),this._probeToolDiv$1.style.left=this._cell$1.get_div().offsetLeft+b.get_x()+10+"px",this._probeToolDiv$1.style.top=this._cell$1.get_div().offsetTop+
b.get_y()+10+"px",c="",null!=this.__probeToolUpdated$1?(c=new lt.Controls.Medical.ProbeToolEventArgs(lt.LeadPointD.create(f,g),a.get_attachedFrame()),this.__probeToolUpdated$1(this,c),c="\n"+c.get_pixelValue()):(c=this._cell$1.get_frames().get_item(this._cell$1._getActiveSubCellIndex()),c="\nHu = "+lt.Controls.Medical.ProbeToolInteractiveMode.getHuValue(c,parseInt(f),parseInt(g),-1)),this._spanDiv$1.innerText="X = "+f+" Y = "+g+c):this._spanDiv$1.innerText=""},_backgroundColor$1:null,get_backgroundColor:function(){return this._backgroundColor$1},
set_backgroundColor:function(a){this._backgroundColor$1=a;this._spanDiv$1.style.background=this._backgroundColor$1;return a},_textColor$1:null,get_textColor:function(){return this._textColor$1},set_textColor:function(a){this._textColor$1=a;this._spanDiv$1.style.color=this._textColor$1;return a},_showBorder$1:!1,get_showBorder:function(){return this._showBorder$1},set_showBorder:function(a){this._showBorder$1=a;this._spanDiv$1.style.border=this._showBorder$1?"black 1px solid":"";return a},_service_DragStarted$1:function(a,
b){var c=lt.Controls.Medical.ProbeToolInteractiveMode.callBaseMethod(this,"get_item");if(this.canStartWork(b)&&(null==c&&(c=this.get_item()),null!=this.get_item()&&(this._updateProbeTool$1(c,b.get_position()),this._probeToolDiv$1.style.visibility="visible",b.get_mouseButton()===this.get_mouseButtons()||b.get_nativeEvent().type===lt.LTHelper.mouseWheelEvent)))this.onWorkStarted(lt.LeadEventArgs.Empty)},get_name:function(){return"Probe Tool"}};Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,
"id",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.get_id,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,"probeToolUpdated",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.__probeToolUpdated$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,"backgroundColor",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.get_backgroundColor,set:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.set_backgroundColor,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,"textColor",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.get_textColor,set:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.set_textColor,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,"showBorder",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.get_showBorder,set:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.set_showBorder,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.ProbeToolInteractiveMode.prototype,"name",{get:lt.Controls.Medical.ProbeToolInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});lt.Controls.Medical._imageViewerGridViewLayout=function(a){lt.Controls.Medical._imageViewerGridViewLayout.initializeBase(this);this._cell$1=a};lt.Controls.Medical._imageViewerGridViewLayout.prototype={get_name:function(){return"Grid"},_cell$1:null,get_cell:function(){return this._cell$1},
set_cell:function(a){return this._cell$1=a},updateTransform:function(a,b,c,d,e,f){null==a&&lt.Annotations.Core.ExceptionHelper.argumentNullException("imageViewer");null==f&&lt.Annotations.Core.ExceptionHelper.argumentNullException("itemBounds");f.length===this._cell$1.get_imageViewer().get_items().get_count()&&this._cell$1._layoutCell(e,f)}};lt.Controls.Medical._imageViewerTransformInteractiveMode=function(a){this._scaleKeyModifier$1=lt.Controls.Keys.control;this._origin$1=lt.LeadPointD.get_empty();
lt.Controls.Medical._imageViewerTransformInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item);this.enableZoom=a;this.enablePan=!a};lt.Controls.Medical._imageViewerTransformInteractiveMode.prototype={isPinch:!1,_scaleAtPosition$1:!1,get_scaleAtPosition:function(){return this._scaleAtPosition$1},set_scaleAtPosition:function(a){return this._scaleAtPosition$1=a},get_scaleKeyModifier:function(){return this._scaleKeyModifier$1},
set_scaleKeyModifier:function(a){switch(a){case lt.Controls.Keys.none:case lt.Controls.Keys.alt:case lt.Controls.Keys.shift:case lt.Controls.Keys.control:this._scaleKeyModifier$1=a;break;default:throw Error("Invalid value ScaleKeyModifier");}return a},get_name:function(){return"ItemTransform"},get_id:function(){return lt.Controls.ImageViewerInteractiveMode.userModeId+1},start:function(a){lt.Controls.Medical._imageViewerTransformInteractiveMode.callBaseMethod(this,"start",[a]);a=lt.Controls.Medical._imageViewerTransformInteractiveMode.callBaseMethod(this,
"get_interactiveService");this.isPinch&&(a.add_pinchStarted(ss.Delegate.create(this,this._service_PinchStarted$1)),a.add_pinchCompleted(ss.Delegate.create(this,this._service_PinchCompleted$1)),a.add_pinchDelta(ss.Delegate.create(this,this._service_PinchDelta$1)));a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=
lt.Controls.Medical._imageViewerTransformInteractiveMode.callBaseMethod(this,"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));this.isPinch&&(b.remove_pinchStarted(ss.Delegate.create(this,this._service_PinchStarted$1)),b.remove_pinchCompleted(ss.Delegate.create(this,this._service_PinchCompleted$1)),
b.remove_pinchDelta(ss.Delegate.create(this,this._service_PinchDelta$1)));lt.Controls.Medical._imageViewerTransformInteractiveMode.callBaseMethod(this,"stop",[a])}},_previousLength$1:0,_calculateDistance$1:function(a,b){var c=a.get_x()-b.get_x(),d=a.get_y()-b.get_y();return Math.sqrt(c*c+d*d)},_scaleFactor$1:0,_service_PinchDelta$1:function(a,b){if(this.get_isWorking()&&this._isPinching$1){var c=this.get_item();if(null!=c){this._scaleFactor$1||(this._scaleFactor$1=c.get_scaleFactor());var d=this.get_imageViewer(),
e=b.get_distanceRatio()*this._scaleFactor$1;c.zoom(lt.Controls.ControlSizeMode.none,e,this._origin$1);var e=(b.get_position().get_x()+b.get_position2().get_x())/2,f=(b.get_position().get_y()+b.get_position2().get_y())/2;this._translate$1(d,c,parseInt(this._origin$1.get_x()-e),parseInt(this._origin$1.get_y()-f));this._origin$1.set_x(e);this._origin$1.set_y(f);d.automationInvalidate(d.getItemViewBounds(c,lt.Controls.ImageViewerItemPart.item,!1));b.set_isHandled(!0)}}},_service_PinchStarted$1:function(a,
b){this.canStartWork(b)&&(this._startPoint$1=b.get_origin().clone(),this._stopPoint$1=b.get_position().clone(),this._scaleFactor$1=0,this._previousLength$1=b.get_distance(),this._origin$1=lt.LeadPointD.create((b.get_position().get_x()+b.get_position2().get_x())/2,(b.get_position().get_y()+b.get_position2().get_y())/2),this._isPinching$1=!0,b.set_isHandled(!0),this.onWorkStarted(lt.LeadEventArgs.Empty),this._onPinchStarted$1(lt.LeadEventArgs.Empty))},_fingers$1:0,_service_PinchCompleted$1:function(a,
b){this._stopPoint$1=b.get_position().clone();b.set_isHandled(!0);this.onWorkCompleted(lt.LeadEventArgs.Empty);this._fingers$1=0;this._isPinching$1=!1;this._onPinchCompleted$1(lt.LeadEventArgs.Empty)},add_pinchWorkCompleted:function(a){this.__pinchWorkCompleted$1=ss.Delegate.combine(this.__pinchWorkCompleted$1,a)},remove_pinchWorkCompleted:function(a){this.__pinchWorkCompleted$1=ss.Delegate.remove(this.__pinchWorkCompleted$1,a)},__pinchWorkCompleted$1_handler_get:function(){null==this.__pinchWorkCompleted$1_handler&&
(this.__pinchWorkCompleted$1_handler=ss.EventHandler.create(this,this.add_pinchWorkCompleted,this.remove_pinchWorkCompleted));return this.__pinchWorkCompleted$1_handler},__pinchWorkCompleted$1:null,__pinchWorkCompleted$1_handler:null,add_pinchWorkStarted:function(a){this.__pinchWorkStarted$1=ss.Delegate.combine(this.__pinchWorkStarted$1,a)},remove_pinchWorkStarted:function(a){this.__pinchWorkStarted$1=ss.Delegate.remove(this.__pinchWorkStarted$1,a)},__pinchWorkStarted$1_handler_get:function(){null==
this.__pinchWorkStarted$1_handler&&(this.__pinchWorkStarted$1_handler=ss.EventHandler.create(this,this.add_pinchWorkStarted,this.remove_pinchWorkStarted));return this.__pinchWorkStarted$1_handler},__pinchWorkStarted$1:null,__pinchWorkStarted$1_handler:null,_onPinchStarted$1:function(a){null!=this.__pinchWorkStarted$1&&this.__pinchWorkStarted$1(this,a)},_onPinchCompleted$1:function(a){null!=this.__pinchWorkCompleted$1&&this.__pinchWorkCompleted$1(this,a)},_startPoint$1:null,get__startPoint:function(){return this._startPoint$1},
_stopPoint$1:null,get__stopPoint:function(){return this._stopPoint$1},_isPinching$1:!1,_service_DragStarted$1:function(a,b){this._fingers$1+=1;if(!(this.isPinch||!this.canStartWork(b)||null==this.get_item())&&!(this._isPinching$1||1<this._fingers$1))this._cursorPoint$1=b.get_position().clone(),b.set_isHandled(!0),this.onWorkStarted(lt.LeadEventArgs.Empty)},enablePan:!1,enableZoom:!1,_service_DragDelta$1:function(a,b){if(this.get_isWorking()&&!(this._isPinching$1||1<this._fingers$1)){var c=this.get_item();
if(null!=c){var d=b.get_change().get_x(),e=b.get_change().get_y(),f=this.get_imageViewer();this.enableZoom&&this._scale$1(f,c,parseInt(e),b.get_origin());this.enablePan&&this._translate$1(f,c,parseInt(d),parseInt(e));b.set_isHandled(!0)}}},_service_DragCompleted$1:function(a,b){this._fingers$1=Math.max(0,this._fingers$1-1);this.get_isWorking()&&!this._isPinching$1&&(this._cursorPoint$1=b.get_position().clone(),b.set_isHandled(!0),this.onWorkCompleted(lt.LeadEventArgs.Empty))},_service_DoubleTap$1:function(a,
b){if(!this.isPinch&&!this.get_isWorking()&&this.canStartWork(b)){var c=this.get_item();null!=c&&(b.set_isHandled(!0),this.onWorkStarted(lt.LeadEventArgs.Empty),this._identity$1(this.get_imageViewer(),c),this.onWorkCompleted(lt.LeadEventArgs.Empty))}},_identity$1:function(a,b){a.beginTransform();b.set_offset(lt.LeadPointD.create(0,0));b.set_scale(lt.LeadSizeD.create(1,1));b.set_flip(!1);b.set_reverse(!1);b.set_rotateAngle(0);a.endTransform()},_scale$1:function(a,b,c,d){if(c){var e=a.getItemViewBounds(b,
lt.Controls.ImageViewerItemPart.item,!1).get_height(),c=b.get_scaleFactor()*(0<e?1-2*c/e:1),d=this.get_scaleAtPosition()?a.convertPoint(b,lt.Controls.ImageViewerCoordinateType.control,lt.Controls.ImageViewerCoordinateType.item,d):b.get_defaultZoomOrigin();a.beginUpdate();b.zoom(lt.Controls.ControlSizeMode.none,c,d);a.endUpdate()}},_translate$1:function(a,b,c,d){if(c||d)lt.Controls.Medical.MRTISubCell.getFloatImageRect(b.get_imageViewer(),b),a=lt.LeadPointD.create(-c,-d),b.offsetBy(a)},_cursorPoint$1:null,
get__cursorPoint:function(){return this._cursorPoint$1}};Object.defineProperty(lt.Controls.Medical._imageViewerTransformInteractiveMode.prototype,"pinchWorkCompleted",{get:lt.Controls.Medical._imageViewerTransformInteractiveMode.prototype.__pinchWorkCompleted$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical._imageViewerTransformInteractiveMode.prototype,"pinchWorkStarted",{get:lt.Controls.Medical._imageViewerTransformInteractiveMode.prototype.__pinchWorkStarted$1_handler_get,
enumerable:!0,configurable:!0});lt.Controls.Medical._lineProfileInteractiveMode=function(){lt.Controls.Medical._lineProfileInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item)};lt.Controls.Medical._lineProfileInteractiveMode.prototype={get_name:function(){return"LineProfile"},get_id:function(){return lt.Controls.ImageViewerInteractiveMode.userModeId+2},start:function(a){lt.Controls.Medical._lineProfileInteractiveMode.callBaseMethod(this,
"start",[a]);a=lt.Controls.Medical._lineProfileInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical._lineProfileInteractiveMode.callBaseMethod(this,"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,
this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));lt.Controls.Medical._lineProfileInteractiveMode.callBaseMethod(this,"stop",[a])}},_startPoint$1:null,_stopPoint$1:null,_service_DragStarted$1:function(a,b){this.canStartWork(b)&&null!=this.get_item()&&(this._startPoint$1=b.get_origin().clone(),this._stopPoint$1=b.get_position().clone(),b.set_isHandled(!0),this.onWorkStarted(lt.LeadEventArgs.Empty))},
_service_DragDelta$1:function(a,b){if(this.get_isWorking()){var c=this.get_item();if(null!=c){this._stopPoint$1=b.get_position().clone();var d=this.get_imageViewer();d.automationInvalidate(d.getItemViewBounds(c,lt.Controls.ImageViewerItemPart.item,!1));b.set_isHandled(!0)}}},_service_DragCompleted$1:function(a,b){this.get_isWorking()&&(b.set_isHandled(!0),this.onWorkCompleted(lt.LeadEventArgs.Empty))},_service_DoubleTap$1:function(a,b){!this.get_isWorking()&&this.canStartWork(b)&&null!=this.get_item()&&
(b.set_isHandled(!0),this.onWorkStarted(lt.LeadEventArgs.Empty),this.onWorkCompleted(lt.LeadEventArgs.Empty))}};lt.Controls.Medical._mrtiRenderChunkEventArgs=function(a,b,c,d,e,f,g,h,i){this._sourceRect$1=lt.LeadRectD.get_empty();this._targetRect$1=lt.LeadRectD.get_empty();this._chunkRect$1=lt.LeadRectD.get_empty();lt.Controls.Medical._mrtiRenderChunkEventArgs.initializeBase(this);this._sender$1=a;this._sourceRect$1=b;this._targetRect$1=c;this._chunkRect$1=d;this._chunkImage$1=e;this._userState$1=
g;this._resolution$1=f;this._chunkCanvas$1=h;this._backCanvas$1=i};lt.Controls.Medical._mrtiRenderChunkEventArgs.prototype={_chunkCanvas$1:null,_backCanvas$1:null,get_backCanvas:function(){return this._backCanvas$1},get_chunkCanvas:function(){return this._chunkCanvas$1},_sender$1:null,get_sender:function(){return this._sender$1},get_sourceRect:function(){return this._sourceRect$1},get_targetRect:function(){return this._targetRect$1},_userState$1:null,get_userState:function(){return this._userState$1},
get_chunkRect:function(){return this._chunkRect$1},_chunkImage$1:null,get_chunkImage:function(){return this._chunkImage$1},_resolution$1:null,get_resolution:function(){return this._resolution$1}};lt.Controls.Medical.ChunkLoadedEventArgs=function(a){lt.Controls.Medical.ChunkLoadedEventArgs.initializeBase(this);this._chunk$1=a};lt.Controls.Medical.ChunkLoadedEventArgs.prototype={_renderer$1:null,_chunk$1:null,get_chunk:function(){return this._chunk$1}};Object.defineProperty(lt.Controls.Medical.ChunkLoadedEventArgs.prototype,
"chunk",{get:lt.Controls.Medical.ChunkLoadedEventArgs.prototype.get_chunk,enumerable:!0,configurable:!0});lt.Controls.Medical._chunkEventArgs=function(a,b,c){lt.Controls.Medical._chunkEventArgs.initializeBase(this);this.chunk=a.clone();this.image=c;this.renderer=b};lt.Controls.Medical._chunkEventArgs.prototype={chunk:null,image:null,renderer:null};lt.Controls.Medical.DebugEventArgs=function(a,b,c,d){lt.Controls.Medical.DebugEventArgs.initializeBase(this);this.param1=b;this.param2=c;this.param3=d;
this.text=a};lt.Controls.Medical.DebugEventArgs.prototype={param1:0,param2:0,param3:0,text:null};lt.Controls.Medical.ChunkStatus=function(){this.inverted=!1;this.visible=!0;this.processed=!1};lt.Controls.Medical.ChunkStatus.prototype={inverted:!1,visible:!1,processed:!1};lt.Controls.Medical.ChunkData=function(a,b,c,d){this._image=a;this.rect=b;this.resolution=c;this.canvas=d;this.status=new lt.Controls.Medical.ChunkStatus};lt.Controls.Medical.ChunkData.prototype={canvas:null,backCanvas:null,_image:null,
resolution:null,rect:null,status:null,_disposeImage:function(a){a.src="onepixel.png"},dispose:function(){this._disposeImage(this._image)},_getInfo:function(){return new lt.Controls.Medical._chunkInfo(this.rect,this.resolution)},equal:function(a){return this.rect.get_left()===a.rect.get_left()&&this.rect.get_top()===a.rect.get_top()&&this.rect.get_width()===a.rect.get_width()&&this.rect.get_height()===a.rect.get_height()&&this.resolution.get_width()===a.resolution.get_width()&&this.resolution.get_height()===
a.resolution.get_height()?!0:!1},clone:function(){return new lt.Controls.Medical.ChunkData(this._image,this.rect,this.resolution,this.canvas)}};lt.Controls.Medical.RecycledData=function(a,b){this.canvas=a;this.backCanvas=b;null!=a&&(a.width=1,a.height=1);null!=this.backCanvas&&(this.backCanvas.width=1,this.backCanvas.height=1)};lt.Controls.Medical.RecycledData.prototype={canvas:null,backCanvas:null};lt.Controls.Medical._chunkInfo=function(a,b){this.rect=a;this.resolution=b};lt.Controls.Medical._chunkInfo.prototype=
{resolution:null,rect:null,equal:function(a){return this.rect.get_left()===a.rect.get_left()&&this.rect.get_top()===a.rect.get_top()&&this.rect.get_width()===a.rect.get_width()&&this.rect.get_height()===a.rect.get_height()&&this.resolution.get_width()===a.resolution.get_width()&&this.resolution.get_height()===a.resolution.get_height()?!0:!1},clone:function(){return new lt.Controls.Medical._chunkInfo(this.rect,this.resolution)},dispose:function(){}};lt.Controls.Medical._mrtiRenderer=function(a){this.tileResolution=
lt.LeadSizeD.get_empty();this.tileBackGroundResolution=lt.LeadSizeD.get_empty();this._image=a};lt.Controls.Medical._mrtiRenderer.transformPoint=function(a,b,c,d,e){var f=a.get_x()-b.get_x(),a=a.get_y()-b.get_y(),g=0,h=1;switch(e){case 90:case -270:g=1;h=0;break;case -90:case 270:g=-1;h=0;break;case 180:case -180:g=0,h=-1}e=f*h-a*g;f=f*g+a*h;c&&(f=-f);d&&(e=-e);e+=b.get_x();f+=b.get_y();return lt.LeadPointD.create(e,f)};lt.Controls.Medical._mrtiRenderer.prototype={_dontRequest:!1,imageProcessingList:null,
getTransformedRect:function(a,b,c,d,e,f){c=lt.LeadPointD.create(b/2,c/2);b=lt.Controls.Medical._mrtiRenderer.transformPoint(lt.LeadPointD.create(a.get_left(),a.get_top()),c,d,e,f);f=lt.Controls.Medical._mrtiRenderer.transformPoint(lt.LeadPointD.create(a.get_right(),a.get_bottom()),c,d,e,f);a=Math.min(b.get_x(),f.get_x());d=Math.min(b.get_y(),f.get_y());e=Math.max(b.get_x(),f.get_x());b=Math.max(b.get_y(),f.get_y());return lt.LeadRectD.create(a,d,e-a,b-d)},addTextLine:function(){},dispose:function(){},
_isChunkAlreadyRequested:function(a){for(var b=0,b=0;b<this._alreadyRequested.length;b++)if(a.equal(this._alreadyRequested[b]))return b;return-1},_isChunkAlreadyDownloading:function(a){for(var b=0,b=0;b<this._downloading.length;b++)if(a.equal(this._downloading[b]))return b;return-1},_updateRequestedChunksAndRectList:function(a){for(var b=0,c,b=a.rectList.length-1;0<=b;b--)c=a.rectList[b],-1!==this._isChunkAlreadyRequested(c)?a.rectList.removeAt(b):-1!==this._isChunkAlreadyDownloading(c)&&a.rectList.removeAt(b)},
_arrangeRectList:function(a,b,c){var d,e=[],f=[],g=0;d=this._alreadyRequested;for(var h=d.length,i,j,k,l=parseInt(b.get_left()+b.get_width())/2,b=parseInt(b.get_top()+b.get_height())/2,g=0;g<h;g++)i=1*a.targetRect.get_width()/d[g].resolution.get_width(),j=1*a.targetRect.get_height()/d[g].resolution.get_height(),k=this.getTransformedRect(d[g].rect,d[g].resolution.get_width(),d[g].resolution.get_height(),this._flipped,this._reversed,this._rotateAngle),k=lt.LeadRectD.create(k.get_left()*i,k.get_top()*
j,k.get_width()*i,k.get_height()*j),i=k.get_left()+k.get_width()/2-c.get_left()-l,k=k.get_top()+k.get_height()/2-c.get_top()-b,k=Math.sqrt(i*i+k*k),a.tileResolution!==d[g].resolution&&(k/=2*a.tileResolution.get_width()/d[g].resolution.get_width()),e.add(k);for(a=-1;e.length;){k=1E5;a=-1;for(g=0;g<e.length;g++)e[g]<k&&(k=e[g],a=g);if(-1===a)return;f.add(d[a]);d.removeAt(a);e.removeAt(a)}this._alreadyRequested=f},cancelRequestsForUselessChunks:function(a,b,c,d,e){for(var f=0,f=this._alreadyRequested.length,
g,h=b.get_width()/this._image.get_fullSize().get_width(),i=b.get_height()/this._image.get_fullSize().get_height(),a=lt.LeadRectD.create(0,0,a.get_width(),a.get_height()),j=0,f=f-1;0<=f;f--)if(this._alreadyRequested[f].resolution.get_width()!==d.get_width()&&this._alreadyRequested[f].resolution.get_width()!==e.get_width()?j=!0:2<=(this._alreadyRequested[f].resolution.get_width()+0.5)/this.tileResolution.get_width()?j=!0:(j=parseInt(this._image.get_fullSize().get_width()/this._alreadyRequested[f].resolution.get_width()+
0.5),g=this.getTransformedRect(this._alreadyRequested[f].rect,this._alreadyRequested[f].resolution.get_width(),this._alreadyRequested[f].resolution.get_height(),this._flipped,this._reversed,this._rotateAngle),g.set_x(parseInt(g.get_left()*j*h)-b.get_x()),g.set_y(parseInt(g.get_top()*j*i)-b.get_y()),g.set_width(parseInt(g.get_width()*j*h)),g.set_height(parseInt(g.get_height()*j*i)),j=!a.intersectsWith(g)),j)c.add(new lt.Controls.Medical.RecycledData(this._alreadyRequested[f].canvas,this._alreadyRequested[f].backCanvas)),
this._alreadyRequested.removeAt(f)},_updateCanvas:function(a){if(null==a)return null;a.width=parseInt(this._image.get_tileSize().get_width());a.height=parseInt(this._image.get_tileSize().get_height());return a},_initializeChunks:function(a){for(var b=0,c=a.rectList.length,b=0;b<c;b++){if(0<a.recycledList.length){var d=a.recycledList.length-1;a.rectList[b].canvas=this._updateCanvas(a.recycledList[d].canvas);a.rectList[b].backCanvas=this._updateCanvas(a.recycledList[d].backCanvas);a.recycledList.removeAt(d)}this._alreadyRequested.add(a.rectList[b].clone())}},
testDebug:function(){},_alreadyRequested:null,_downloading:null,get_downloading:function(){return this._downloading},get_alreadyRequested:function(){return this._alreadyRequested},_flipped:!1,_reversed:!1,_rotateAngle:0,_previousRect:null,_scaling:!1,qualityFactor:0,renderAsync:function(a,b,c,d,e,f,g,h,i,j){if(!this._dontRequest&&(this._flipped=g,this._reversed=h,this._rotateAngle=i,!a.get_isEmpty()&&!b.get_isEmpty())){this._scaling=!1;null!=this._previousRect&&!this._previousRect.get_isEmpty()&&
1<Math.abs(b.get_width()-this._previousRect.get_width())&&1<Math.abs(b.get_height()-this._previousRect.get_height())&&(this._scaling=!0);this._previousRect=b.clone();null==lt.Controls.Medical._mrtiRenderer._loader&&(lt.Controls.Medical._mrtiRenderer._loader=new lt.Controls.Medical._imageLoader(4));lt.Controls.Medical._mrtiRenderer._loader.slowStart=this._scaling;null==this._alreadyRequested&&(this._alreadyRequested=[],this._downloading=[]);if(null==this._image||null==this._image.get_imageUri()&&String.isNullOrEmpty(this._image.get_imageName()))throw new lt.ArgumentException("Make sure that 'IMRTIRenderer.Image' is valid and contains valid image Uri/Name",
"_image");g=this._image.get_tileSize();c=new lt.Controls.Medical._myWorkItemData(null,this._image,lt.LeadSizeD.get_empty(),lt.LeadRectD.get_empty(),0,this._image.get_mimeType(),a,b,g,0,c,d);c.tileResolution=this.tileResolution;c.tileBackGroundResolution=this.tileBackGroundResolution;this.cancelRequestsForUselessChunks(a,b,f,this.tileResolution,this.tileBackGroundResolution);if(!j){c.testingValue=e;c.recycledList=f;this.tileResolution=c.tileResolution;c.rectList=this.findExpectedNumberOfChunks2(c.excludedRect,
c.tileSize,c.sourceRect,c.targetRect,c.tileResolution);if(!this.tileBackGroundResolution.get_isEmpty()){a=this.findExpectedNumberOfChunks2(c.excludedRect,c.tileSize,c.sourceRect,c.targetRect,c.tileBackGroundResolution);for(b=b=0;b<a.length;b++)c.rectList.add(a[b])}this._updateRequestedChunksAndRectList(c);this._initializeChunks(c);this._arrangeRectList(c,c.sourceRect,c.targetRect);c.rectList.length?(c.expectedNumberOfChunks=c.rectList.length+1,lt.Controls.Medical._mrtiRenderer._loader.addRenderer(this),
lt.Controls.Medical._mrtiRenderer._loader.lookForChunksToLoad()):this.addTextLine("Nothing to request")}}},chunkLoaded:function(a){var b=a.chunk,a=a.image,c=this._isChunkAlreadyRequested(new lt.Controls.Medical.ChunkData(null,b.rect,b.resolution,null));-1!==c&&this.get_alreadyRequested().removeAt(c);c=this._isChunkAlreadyDownloading(new lt.Controls.Medical.ChunkData(null,b.rect,b.resolution,null));-1!==c&&this._downloading.removeAt(c);if(!(b.resolution.get_width()!==this.tileResolution.get_width()&&
b.resolution.get_width()!==this.tileBackGroundResolution.get_width())&&(lt.Controls.Medical._rendererTools.drawChunkOnCanvas(this._image,b,a,this._image.get_tileSize()),null!=a))this.onRenderChunk(new lt.Controls.Medical._mrtiRenderChunkEventArgs(this,lt.LeadRectD.get_empty(),lt.LeadRectD.get_empty(),b.rect,a,b.resolution,b,b.canvas,b.backCanvas))},_uselessChunk:function(a,b,c){if(null==c)return!1;for(var d=0,e=c.length,f,d=0;d<e;d++)if(f=c[d].rect,b.get_width()===c[d].resolution.get_width()&&f.get_x()<=
a.get_x()&&f.get_y()<=a.get_y()&&f.get_bottom()>=a.get_bottom()&&f.get_right()>=a.get_right())return!0;return!1},findBackGroundResolution:function(a,b){for(var c=0,d=a.get_resolutions().length,c=0;c<d;c++)if(a.get_resolutions()[c].get_width()===b.get_width()){if(c+3>=d)break;else if(512>Math.max(a.get_resolutions()[c+3].get_width(),a.get_resolutions()[c+3].get_height()))break;return lt.LeadSizeD.create(a.get_resolutions()[c+3].get_width(),a.get_resolutions()[c+3].get_height())}return lt.LeadSizeD.get_empty()},
findExpectedNumberOfChunks2:function(a,b,c,d,e){var f=1*e.get_width()/d.get_width(),g=1*e.get_height()/d.get_height();d.set_x(-d.get_x());d.set_y(-d.get_y());for(var c=this.getTransformedRect(c,d.get_right()+d.get_left(),d.get_bottom()+d.get_top(),this._flipped,this._reversed,-this._rotateAngle),h=lt.LeadRectD.create(c.get_left()*f,c.get_top()*g,c.get_width()*f,c.get_height()*g),i=lt.LeadRectD.create(-d.get_left()*f,-d.get_top()*g,d.get_width()*f,d.get_height()*g),j=parseInt(h.get_left()+i.get_left()+
0.5),c=parseInt(h.get_top()+i.get_top()+0.5),f=parseInt(b.get_width()),b=parseInt(b.get_height()),k=parseInt(Math.max(0,j)/f),g=parseInt(Math.max(0,c)/b),j=Math.min(j+h.get_width(),i.get_width()),c=Math.min(c+h.get_height(),i.get_height()),h=parseInt(Math.min(j-1,e.get_width())/f)+1,i=parseInt(Math.min(c-1,e.get_height())/b)+1,l=[],m=0,n;k<h;k++)for(n=g;n<i;n++)m++,j=k*f,c=n*b,c=lt.LeadRectD.create(j,c,Math.min(parseInt(e.get_width()-j),f),Math.min(parseInt(e.get_height()-c),b)),this._uselessChunk(c,
e,a)||l.add(new lt.Controls.Medical.ChunkData(null,c,e,null));d.set_x(-d.get_x());d.set_y(-d.get_y());return l},getNewResolution:function(a,b){for(var c=lt.LeadSizeD.get_empty(),d=lt.LeadSizeD.get_empty(),e=lt.LeadSizeD.get_empty(),e=b.get_resolutions().length-1;0<=e;e--){var f=b.get_resolutions()[e];if(parseInt(f.get_width()*f.get_height())>=a){c=f;e+1<=b.get_resolutions().length-1&&(d=b.get_resolutions()[e+1]);break}}e=parseInt(c.get_width()*c.get_height());f=parseInt(d.get_width()*d.get_height());
return e=c.get_isEmpty()&&d.get_isEmpty()?b.get_resolutions()[0]:1<this.qualityFactor?d:Math.abs(e-a)<Math.abs(f-a)?c:d},_image:null,get_image:function(){return this._image},set_image:function(a){return this._image=a},add_renderChunk:function(a){this.__renderChunk=ss.Delegate.combine(this.__renderChunk,a)},remove_renderChunk:function(a){this.__renderChunk=ss.Delegate.remove(this.__renderChunk,a)},__renderChunk_handler_get:function(){null==this.__renderChunk_handler&&(this.__renderChunk_handler=ss.EventHandler.create(this,
this.add_renderChunk,this.remove_renderChunk));return this.__renderChunk_handler},__renderChunk:null,__renderChunk_handler:null,onRenderChunk:function(a){var b=a.get_userState(),c=this._isChunkAlreadyRequested(new lt.Controls.Medical.ChunkData(null,a.get_chunkRect(),a.get_resolution(),null));-1!==c&&this._alreadyRequested.removeAt(c);c=this._isChunkAlreadyDownloading(new lt.Controls.Medical.ChunkData(null,a.get_chunkRect(),a.get_resolution(),null));-1!==c&&this._downloading.removeAt(c);null!=this.__renderChunk&&
this.__renderChunk(this,new lt.Controls.Medical._mrtiRenderChunkEventArgs(this,a.get_sourceRect(),a.get_targetRect(),a.get_chunkRect(),a.get_chunkImage(),a.get_resolution(),b,a.get_chunkCanvas(),a.get_backCanvas()))}};Object.defineProperty(lt.Controls.Medical._mrtiRenderer.prototype,"renderChunk",{get:lt.Controls.Medical._mrtiRenderer.prototype.__renderChunk_handler_get,enumerable:!0,configurable:!0});lt.Controls.Medical._parser=function(){};lt.Controls.Medical._parser.convertToString=function(a){var b=
"";Type.canCast(a,lt.LeadRectD)?b=a.get_left()+","+a.get_top()+","+a.get_width()+","+a.get_height():Type.canCast(a,lt.LeadSizeD)&&(b=a.get_width()+","+a.get_height());return b};lt.Controls.Medical._parser.parseString=function(a,b){if(1===b){var c=a.split(",");return lt.LeadRectD.create(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),parseInt(c[3]))}return!b?(c=a.split(","),lt.LeadSizeD.create(parseInt(c[0]),parseInt(c[1]))):null};lt.Controls.Medical._imageLoader=function(a){this._timerID=-1;var b;this._readyList=
[];this._imageElements=[];this._rendererList=[];for(var c=0,c=0;c<a;c++){b=document.createElement("img");this._imageElements.add(b);this._readyList.add(b);var d=ss.Delegate.create(this,this._chunkImageLoaded1);b.addEventListener("load",d,!1)}};lt.Controls.Medical._imageLoader._constructIPAddress=function(a){var b=0,c="&data=";if(null==a||null==a.imageProcessingList)return c;for(var d=a.imageProcessingList.get_count(),e=null;b<d;b++)if(e=a.imageProcessingList.get_item(b),e.ReadyToProcess){var c=c+
e.get_command(),f=e.get_arguments(),g="";Object.keys(f).forEach(function(a){g+=","+a+":"+f[a]});c+=g+";"}return c};lt.Controls.Medical._imageLoader.temp_construct_fileName=function(a,b,c,d,e){var f=d.get_imageUri(),f=String.format("{0}&frame={1}&x={2}&y={3}&w={4}&h={5}&xr={6}&yr={7}&wldata={8}",d.get_imageUri(),d.get_frameIndex(),a.get_left(),a.get_top(),c?0:a.get_width(),c?0:a.get_height(),b.get_width(),b.get_height(),d.get_supportWindowLevel()),a=lt.Controls.Medical._imageLoader._constructIPAddress(e);
return f+a};lt.Controls.Medical._imageLoader.prototype={_imageElements:null,_readyList:null,slowStart:!1,_fetchNewChunk:function(){clearInterval(this._timerID);this._timerID=-1;if(this._rendererList.length){var a=this._rendererList[this._rendererList.length-1];if(this._readyList.length)if(a.get_alreadyRequested().length){var b=a.get_alreadyRequested()[0];this._readyList[this._readyList.length-1].ChunkData=b.clone();this._readyList[this._readyList.length-1].Renderer=a;this._readyList[this._readyList.length-
1].src=lt.Controls.Medical._imageLoader.temp_construct_fileName(b.rect,b.resolution,!1,a.get_image(),a);this._readyList.removeAt(this._readyList.length-1);a.get_alreadyRequested().removeAt(0);a.get_downloading().add(b);this._readyList.length&&this.lookForChunksToLoad()}else this._rendererList.removeAt(this._rendererList.length-1),this.lookForChunksToLoad()}},_rendererList:null,addRenderer:function(a){this._rendererList.add(a)},lookForChunksToLoad:function(){-1===this._timerID&&(this._timerID=setInterval(ss.Delegate.create(this,
this._fetchNewChunk),this.slowStart?400:10),this.slowStart=!1)},_chunkImageLoaded1:function(a){var b=a.currentTarget.Renderer;b.chunkLoaded(new lt.Controls.Medical._chunkEventArgs(a.currentTarget.ChunkData,b,a.currentTarget));-1===this._readyList.indexOf(a.currentTarget)&&this._readyList.add(a.currentTarget);this.lookForChunksToLoad()},_loader_ChunkLoaded:function(){}};lt.Controls.Medical._rendererTools=function(){};lt.Controls.Medical._rendererTools.allocateArray=function(a){return lt.LTHelper.supportsTypedArray?
new Uint32Array(a):Array(a)};lt.Controls.Medical._rendererTools.extract16BitData=function(a,b){null==a&&(a=b.getContext("2d"));for(var c=a.getImageData(0,0,b.width,b.height),d=0,e=c.data.length,f=lt.Controls.Medical._rendererTools.allocateArray(e),c=c.data,g=-1,d=0;d<e;d+=4)f[++g]=c[d+1]<<8|c[d+2];return f};lt.Controls.Medical._rendererTools.drawChunkOnCanvas=function(a,b,c,d){null==b.canvas&&(b.canvas=document.createElement("canvas"));b.canvas.width=parseInt(d.get_width());b.canvas.height=parseInt(d.get_height());
if(a.get_supportWindowLevel()){null==b.backCanvas&&(b.backCanvas=document.createElement("canvas"));b.backCanvas.width=parseInt(d.get_width());b.backCanvas.height=parseInt(d.get_height());a=b.backCanvas.getContext("2d");(c.naturalWidth!==b.backCanvas.width||c.naturalHeight!==b.backCanvas.height)&&a.clearRect(0,0,b.backCanvas.width,b.backCanvas.height);try{a.drawImage(c,0,0)}catch(e){alert(e.message)}}else{a=b.canvas.getContext("2d");(c.naturalWidth!==b.canvas.width||c.naturalHeight!==b.canvas.height)&&
a.clearRect(0,0,b.canvas.width,b.canvas.height);try{a.drawImage(c,0,0)}catch(f){alert(f.message)}}};lt.Controls.Medical.MRTIImage=function(){};lt.Controls.Medical.MRTIImage.prototype={_frameIndex:0,get_frameIndex:function(){return this._frameIndex},set_frameIndex:function(a){return this._frameIndex=a},_imageUri:null,get_imageUri:function(){return this._imageUri},set_imageUri:function(a){return this._imageUri=a},_imageName:null,get_imageName:function(){return this._imageName},set_imageName:function(a){return this._imageName=
a},_mimeType:null,get_mimeType:function(){return this._mimeType},set_mimeType:function(a){return this._mimeType=a},_fullSize:null,get_fullSize:function(){return this._fullSize},set_fullSize:function(a){return this._fullSize=a},_fullDpi:null,get_fullDpi:function(){return this._fullDpi},set_fullDpi:function(a){return this._fullDpi=a},_resolutions:null,get_resolutions:function(){return this._resolutions},set_resolutions:function(a){return this._resolutions=a},_tileSize:null,get_tileSize:function(){return this._tileSize},
set_tileSize:function(a){return this._tileSize=a},_supportWindowLevel:!1,get_supportWindowLevel:function(){return this._supportWindowLevel},set_supportWindowLevel:function(a){return this._supportWindowLevel=a}};Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"frameIndex",{get:lt.Controls.Medical.MRTIImage.prototype.get_frameIndex,set:lt.Controls.Medical.MRTIImage.prototype.set_frameIndex,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"imageUri",
{get:lt.Controls.Medical.MRTIImage.prototype.get_imageUri,set:lt.Controls.Medical.MRTIImage.prototype.set_imageUri,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"imageName",{get:lt.Controls.Medical.MRTIImage.prototype.get_imageName,set:lt.Controls.Medical.MRTIImage.prototype.set_imageName,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"mimeType",{get:lt.Controls.Medical.MRTIImage.prototype.get_mimeType,
set:lt.Controls.Medical.MRTIImage.prototype.set_mimeType,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"fullSize",{get:lt.Controls.Medical.MRTIImage.prototype.get_fullSize,set:lt.Controls.Medical.MRTIImage.prototype.set_fullSize,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"fullDpi",{get:lt.Controls.Medical.MRTIImage.prototype.get_fullDpi,set:lt.Controls.Medical.MRTIImage.prototype.set_fullDpi,enumerable:!0,
configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"resolutions",{get:lt.Controls.Medical.MRTIImage.prototype.get_resolutions,set:lt.Controls.Medical.MRTIImage.prototype.set_resolutions,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,"tileSize",{get:lt.Controls.Medical.MRTIImage.prototype.get_tileSize,set:lt.Controls.Medical.MRTIImage.prototype.set_tileSize,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.MRTIImage.prototype,
"supportWindowLevel",{get:lt.Controls.Medical.MRTIImage.prototype.get_supportWindowLevel,set:lt.Controls.Medical.MRTIImage.prototype.set_supportWindowLevel,enumerable:!0,configurable:!0});lt.Controls.Medical._d3DXVECTOR3=function(a,b,c){this.x=a;this.y=b;this.z=c};lt.Controls.Medical._d3DXVECTOR3.prototype={x:0,y:0,z:0};lt.Controls.Medical._orientationLetters=function(a){this._orientCol=Array(3);this._orientRow=Array(3);this._originalOrientationCol=Array(3);this._originalOrientationRow=Array(3);this._findOrientationLetter(a);
this.updateImageProjection(this._projectionOrientation);this._applyTransformation()};lt.Controls.Medical._orientationLetters.create=function(a){return new lt.Controls.Medical._orientationLetters(a)};lt.Controls.Medical._orientationLetters.prototype={_orientCol:null,_orientRow:null,_originalOrientationCol:null,_originalOrientationRow:null,projectionRrotateAngle:0,projectionIsFlipped:!1,projectionIsReversed:!1,_rotateAngle:0,get_rotateAngle:function(){return this._rotateAngle},set_rotateAngle:function(a){this._rotateAngle=
a%360;this._applyTransformation();return a},_rotateOrientation:function(){switch(this._rotateAngle){case 0:break;case 90:case -270:this._swapArray(this._orientRow,this._orientCol);this._flipOrientation(this._orientRow);break;case 180:case -180:this._flipOrientation(this._orientRow);this._flipOrientation(this._orientCol);break;case -90:case 270:this._swapArray(this._orientRow,this._orientCol);this._flipOrientation(this._orientCol);break;default:throw Error("invalid angle value, the angle must be a multiple of 90");
}},_swapArray:function(a,b){var c,d;for(d=0;3>d;d++)c=a[d],a[d]=b[d],b[d]=c},_isFlipped:!1,get_flip:function(){return this._isFlipped},set_flip:function(a){this._isFlipped!==a&&(this._isFlipped=a,this._applyTransformation());return a},_isReversed:!1,get_reverse:function(){return this._isReversed},set_reverse:function(a){this._isReversed!==a&&(this._isReversed=a,this._applyTransformation());return a},_revertToOriginal:function(){var a;for(a=0;3>a;a++)this._orientRow[a]=this._originalOrientationRow[a],
this._orientCol[a]=this._originalOrientationCol[a]},updateImageProjection:function(a){this._projectionOrientation!==a&&(this._projectionOrientation=a);if(1===this._projectionOrientation)if("R"===this.getOriginalTop().charAt(0)||"L"===this.getOriginalBottom().charAt(0))this.projectionRrotateAngle=270;else if("L"===this.getOriginalTop().charAt(0)||"R"===this.getOriginalBottom().charAt(0))this.projectionRrotateAngle=90;else{if("R"===this.getOriginalRight().charAt(0)||"L"===this.getOriginalLeft().charAt(0))this.projectionIsReversed=
!0}else if(2===this._projectionOrientation)if("L"===this.getOriginalTop().charAt(0)||"R"===this.getOriginalBottom().charAt(0))this.projectionRrotateAngle=270;else if("R"===this.getOriginalTop().charAt(0)||"L"===this.getOriginalBottom().charAt(0))this.projectionRrotateAngle=90;else if("L"===this.getOriginalRight().charAt(0)||"R"===this.getOriginalLeft().charAt(0))this.projectionIsReversed=!0},_applyTransformation:function(){this._revertToOriginal();this._rotateOrientation(this._rotateAngle);this._isFlipped&&
this._flipOrientation(this._orientCol);this._isReversed&&this._flipOrientation(this._orientRow)},_projectionOrientation:0,get_projectionOrientation:function(){return this._projectionOrientation},set_projectionOrientation:function(a){this._projectionOrientation=a;this._applyTransformation();return a},getLeft:function(){return this._createOrientation(0,this._orientRow,this._orientCol)},getRight:function(){return this._createOrientation(1,this._orientRow,this._orientCol)},getTop:function(){return this._createOrientation(2,
this._orientRow,this._orientCol)},getBottom:function(){return this._createOrientation(3,this._orientRow,this._orientCol)},getOriginalLeft:function(){return this._createOrientation(0,this._originalOrientationRow,this._originalOrientationCol)},getOriginalRight:function(){return this._createOrientation(1,this._originalOrientationRow,this._originalOrientationCol)},getOriginalTop:function(){return this._createOrientation(2,this._originalOrientationRow,this._originalOrientationCol)},getOriginalBottom:function(){return this._createOrientation(3,
this._originalOrientationRow,this._originalOrientationCol)},_createOrientation:function(a,b,c){switch(a){case 0:return this._getOrientationText(!0,b,!1);case 1:return this._getOrientationText(!1,b,!1);case 2:return this._getOrientationText(!0,c,!1);case 3:return this._getOrientationText(!1,c,!1)}return null},_flipOrientation:function(a){for(var b=0;3>b;b++)switch(a[b]){case 0:a[b]=1;break;case 1:a[b]=0;break;case 2:a[b]=3;break;case 3:a[b]=2;break;case 4:a[b]=5;break;case 5:a[b]=4;break;case 6:return}},
_getOrientationText:function(a,b,c){for(var d=0,e="",a=1===(a^c),d=0;3>d;d++)switch(b[d]){case 0:e+=a?"L":"R";break;case 1:e+=a?"R":"L";break;case 2:e+=a?"S":"I";break;case 3:e+=a?"I":"S";break;case 4:e+=a?"A":"P";break;case 5:e+=a?"P":"A";break;case 6:return e}return e},_getOrientationNumbers:function(a,b){for(var c=0,c=0;3>c;c++)switch(b.charAt(c)){case "L":a[c]=0;break;case "R":a[c]=1;break;case "S":case "H":a[c]=2;break;case "I":case "F":a[c]=3;break;case "A":a[c]=4;break;case "P":a[c]=5;break;
case "\x00":a[c]=6;return}},setProjectionRadiographOrientation:function(a){var b=a[0].toUpperCase(),a=a[1].toUpperCase(),c=Array(3),d=Array(3);this._getOrientationNumbers(c,b);this._getOrientationNumbers(d,a);b=this._getOrientationText(!1,c,!1);a=this._getOrientationText(!1,d,!1);this._orientCol=Array(3);this._orientRow=Array(3);this._originalOrientationCol=Array(3);this._originalOrientationRow=Array(3);this._getOrientationNumbers(this._originalOrientationRow,b);this._getOrientationNumbers(this._originalOrientationCol,
a);this._applyTransformation()},_findOrientationLetter:function(a){var b=new lt.Controls.Medical._d3DXVECTOR3(a[0],a[1],a[2]),a=new lt.Controls.Medical._d3DXVECTOR3(a[3],a[4],a[5]);this._createOrientationLetters(b,a)},_createOrientationLetters:function(a,b){for(var c=Array(3),d=Array(3),e=0<a.x?1:0,f=0<a.y?4:5,g=0<a.z?3:2,h=Math.abs(a.x),i=Math.abs(a.y),j=Math.abs(a.z),k=0,l=0;3>l;l++)0.01<h&&h>i&&h>j?(c[k++]=e,h=0):0.01<i&&i>h&&i>j?(c[k++]=f,i=0):0.01<j&&j>h&&j>i?(c[k++]=g,j=0):c[k++]=6;e=0<b.x?
1:0;f=0<b.y?4:5;g=0<b.z?3:2;h=Math.abs(b.x);i=Math.abs(b.y);j=Math.abs(b.z);for(l=k=0;3>l;l++)0.01<h&&h>i&&h>j?(d[k++]=e,h=0):0.01<i&&i>h&&i>j?(d[k++]=f,i=0):0.01<j&&j>h&&j>i?(d[k++]=g,j=0):d[k++]=6;this._originalOrientationRow[0]=this._orientRow[0]=c[0];this._originalOrientationRow[1]=this._orientRow[1]=c[1];this._originalOrientationRow[2]=this._orientRow[2]=c[2];this._originalOrientationCol[0]=this._orientCol[0]=d[0];this._originalOrientationCol[1]=this._orientCol[1]=d[1];this._originalOrientationCol[2]=
this._orientCol[2]=d[2]}};lt.Controls.Medical.FramePosition=function(){};lt.Controls.Medical.FramePosition.prototype={orientation:null,position:null};lt.Controls.Medical.StackSynchronization=function(){};lt.Controls.Medical.StackSynchronization._angleBetweenPlane=function(a,b){if(null==a||null==b)return 0;var c=[a[0],a[1],a[2]],d=[a[3],a[4],a[5]],e=[b[0],b[1],b[2]],f=[b[3],b[4],b[5]],g=Array(3),h=Array(3);g[0]=c[1]*d[2]-c[2]*d[1];g[1]=c[2]*d[0]-c[0]*d[2];g[2]=c[0]*d[1]-c[1]*d[0];h[0]=e[1]*f[2]-e[2]*
f[1];h[1]=e[2]*f[0]-e[0]*f[2];h[2]=e[0]*f[1]-e[1]*f[0];c=g[0]*h[0]+g[1]*h[1]+g[2]*h[2];1<c&&(c=1);-1>c&&(c=-1);return Math.abs(180*Math.acos(c)/Math.PI)};lt.Controls.Medical.StackSynchronization._isImagePositionFilled=function(a){return null!=a.position};lt.Controls.Medical.StackSynchronization.alignFrames=function(a,b){if(null==a.get_imagePosition()||null==a.get_imageOrientation())return-1;var c=new lt.Controls.Medical._d3DXVECTOR3(a.get_imagePosition()[0],a.get_imagePosition()[1],a.get_imagePosition()[2]),
d=0,e,f,g,h=0,i=-1;if(null==a.get_imagePosition())throw Error("The frame you want to align to doesn't have a valid position value");for(var j=b.get_frames().get_count(),d=0;d<j;d++)if(g=b.get_frames().get_item(d),null!=g.get_imagePosition()&&null!=g.get_imageOrientation()&&!(30<lt.Controls.Medical.StackSynchronization._angleBetweenPlane(a.get_imageOrientation(),g.get_imageOrientation()))&&(e=g.get_imagePosition()[0]-c.x,f=g.get_imagePosition()[1]-c.y,g=g.get_imagePosition()[2]-c.z,e=e*e+f*f+g*g,e<
h||-1===i))i=d,h=e;return i};lt.Controls.Medical.StackSynchronization.findBestAlignment=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR3(a.position[0],a.position[1],a.position[2]),d=0,e,f,g,h=0,i=-1;if(!lt.Controls.Medical.StackSynchronization._isImagePositionFilled(a))throw Error("The frame you want to align to doesn't have a valid position value");for(var j=b.length,d=0;d<j;d++)if(lt.Controls.Medical.StackSynchronization._isImagePositionFilled(b[d])&&!(30<lt.Controls.Medical.StackSynchronization._angleBetweenPlane(a.orientation,
b[d].orientation))&&(e=b[d].position[0]-c.x,f=b[d].position[1]-c.y,g=b[d].position[2]-c.z,e=e*e+f*f+g*g,e<h||-1===i))i=d,h=e;return i};lt.Controls.Medical._d3DXPLANE=function(){};lt.Controls.Medical._d3DXPLANE.prototype={a:0,b:0,c:0,d:0};lt.Controls.Medical._d3DXVECTOR4=function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d};lt.Controls.Medical._d3DXVECTOR4.prototype={x:0,y:0,z:0,w:0};lt.Controls.Medical._d3DXMATRIX=function(){this.m=Array(4);for(var a=0;4>a;a++)this.m[a]=Array(4)};lt.Controls.Medical._d3DXMATRIX.prototype=
{m:null,get_m_11:function(){return this.m[0][0]},set_m_11:function(a){return this.m[0][0]=a},get_m_12:function(){return this.m[0][1]},set_m_12:function(a){return this.m[0][1]=a},get_m_13:function(){return this.m[0][2]},set_m_13:function(a){return this.m[0][2]=a},get_m_14:function(){return this.m[0][3]},set_m_14:function(a){return this.m[0][3]=a},get_m_21:function(){return this.m[1][0]},set_m_21:function(a){return this.m[1][0]=a},get_m_22:function(){return this.m[1][1]},set_m_22:function(a){return this.m[1][1]=
a},get_m_23:function(){return this.m[1][2]},set_m_23:function(a){return this.m[1][2]=a},get_m_24:function(){return this.m[1][3]},set_m_24:function(a){return this.m[1][3]=a},get_m_31:function(){return this.m[2][0]},set_m_31:function(a){return this.m[2][0]=a},get_m_32:function(){return this.m[2][1]},set_m_32:function(a){return this.m[2][1]=a},get_m_33:function(){return this.m[2][2]},set_m_33:function(a){return this.m[2][2]=a},get_m_34:function(){return this.m[2][3]},set_m_34:function(a){return this.m[2][3]=
a},get_m_41:function(){return this.m[3][0]},set_m_41:function(a){return this.m[3][0]=a},get_m_42:function(){return this.m[3][1]},set_m_42:function(a){return this.m[3][1]=a},get_m_43:function(){return this.m[3][2]},set_m_43:function(a){return this.m[3][2]=a},get_m_44:function(){return this.m[3][3]},set_m_44:function(a){return this.m[3][3]=a}};lt.Controls.Medical._d3DXVECTOR2=function(a,b){this.x=a;this.y=b};lt.Controls.Medical._d3DXVECTOR2.prototype={x:0,y:0,clone:function(){return new lt.Controls.Medical._d3DXVECTOR2(this.x,
this.y)}};lt.Controls.Medical._MVSINGLEREFERENCELINE=function(){this.rowDirLocal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.colDirLocal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.normDirLocal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.rowDirReal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.colDirReal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.normDirReal=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.dxImagePosition=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.realImagePosition=
new lt.Controls.Medical._d3DXVECTOR3(0,0,0);this.worldDX_Hieght=this.worldDX_Width=0;this._viewMatTrans=new lt.Controls.Medical._d3DXMATRIX;this._projMatTrans=new lt.Controls.Medical._d3DXMATRIX;this._worldMatTrans=new lt.Controls.Medical._d3DXMATRIX;this.incrementDirection=new lt.Controls.Medical._d3DXVECTOR2(0,0)};lt.Controls.Medical._MVSINGLEREFERENCELINE.prototype={rowDirLocal:null,colDirLocal:null,normDirLocal:null,rowDirReal:null,colDirReal:null,normDirReal:null,dxImagePosition:null,realImagePosition:null,
worldDX_Width:0,worldDX_Hieght:0,_viewMatTrans:null,_projMatTrans:null,_worldMatTrans:null,incrementDirection:null};lt.Controls.Medical._MVREFLINEPARAM=function(){this.diffParam=new lt.Controls.Medical._MVSINGLEREFERENCELINE;this._rotMatScan2Stand=new lt.Controls.Medical._d3DXMATRIX;this._dxCoord2RealWorldCoor=new lt.Controls.Medical._d3DXMATRIX;this._realWorldCoor2DXCoord=new lt.Controls.Medical._d3DXMATRIX};lt.Controls.Medical._MVREFLINEPARAM.prototype={imageWidth:0,imageHight:0,screenShiftY:0,
screenShiftX:0,_rotMatScan2Stand:null,_dxCoord2RealWorldCoor:null,_realWorldCoor2DXCoord:null,jf:0,diffParam:null,m_uInHight:0,m_uInWidth:0,m_fWidthRatio:0,m_fHightRatio:0,m_fDepthRatio:0,vhSliceThickness:0,orientRow:null,orientCol:null,orientationType:0};lt.Controls.Medical.LeadLine=function(a,b,c,d){this.point1=lt.LeadPointD.create(a,b);this.point2=lt.LeadPointD.create(c,d)};lt.Controls.Medical.LeadLine.prototype={point1:null,point2:null};lt.Controls.Medical.ReferenceLine=function(){};lt.Controls.Medical.ReferenceLine._getLineEquationUnmodified=
function(a,b,c,d){a=c-a?(d-b)/(c-a):1E8;1E5<a?a=1E8:-1E4>a&&(a=-1E8);lt.Controls.Medical.ReferenceLine._outM=a;lt.Controls.Medical.ReferenceLine._outC=1E4<a||-1E4>a?c:d-a*c};lt.Controls.Medical.ReferenceLine._getIntersectionPointWithBoundary=function(a,b,c,d,e,f,g,h){var i=Math.abs(d-b)>Math.abs(1E3*(a-c));if(i){var j;j=a;a=b;b=j;j=c;c=d;d=j;j=e;e=f;f=j;j=g;g=h;h=j}lt.Controls.Medical.ReferenceLine._getLineEquationUnmodified(a,b,c,d);a=lt.Controls.Medical.ReferenceLine._outM;b=lt.Controls.Medical.ReferenceLine._outC;
if(e===g){g=a*e+b;if(g<f||g>h)return!1;lt.Controls.Medical.ReferenceLine._intersectionX=e;lt.Controls.Medical.ReferenceLine._intersectionY=g}else{f=(h-b)/a;if(f<e||f>g)return!1;lt.Controls.Medical.ReferenceLine._intersectionX=f;lt.Controls.Medical.ReferenceLine._intersectionY=h}i&&(j=lt.Controls.Medical.ReferenceLine._intersectionX,lt.Controls.Medical.ReferenceLine._intersectionX=lt.Controls.Medical.ReferenceLine._intersectionY,lt.Controls.Medical.ReferenceLine._intersectionY=j);return!0};lt.Controls.Medical.ReferenceLine.rotate=
function(a,b,c,d){a=new lt.Controls.Medical.LeadLine(a.point1.get_x(),a.point1.get_y(),a.point2.get_x(),a.point2.get_y());0>b&&(b+=360);for(var e=b/90,f,g,b=0;b<e;b++)g=a.point1.get_x(),f=d-a.point1.get_y(),a.point1.set_x(f),a.point1.set_y(g),g=a.point2.get_x(),f=d-a.point2.get_y(),a.point2.set_x(f),a.point2.set_y(g),f=d,d=c,c=f;return a};lt.Controls.Medical.ReferenceLine.flip=function(a,b,c){a=new lt.Controls.Medical.LeadLine(a.point1.get_x(),a.point1.get_y(),a.point2.get_x(),a.point2.get_y());a.point1.set_y(c-
a.point1.get_y());a.point2.set_y(c-a.point2.get_y());return a};lt.Controls.Medical.ReferenceLine.reverse=function(a,b){var c=new lt.Controls.Medical.LeadLine(a.point1.get_x(),a.point1.get_y(),a.point2.get_x(),a.point2.get_y());c.point1.set_x(b-c.point1.get_x());c.point2.set_x(b-c.point2.get_x());return c};lt.Controls.Medical.ReferenceLine.draw=function(a,b,c,d,e){if(null==a||b.get_isEmpty()||c.get_isEmpty())return!1;var f=d.point1,d=d.point2,g=Math.max(1+b.get_left(),c.get_left()),h=Math.max(1,c.get_top()),
i=Math.min(b.get_right()-2,c.get_right()),j=Math.min(b.get_bottom()-2,c.get_bottom()),k=Math.max(21,c.get_top()),l=Math.min(b.get_bottom()-2-18,c.get_bottom()),b=Math.min(b.get_right()-2-36,c.get_right()),c=!1,m=0,n=!1,r=0,o=Array(2);o[0]=new lt.Controls.Medical._d3DXVECTOR2(0,0);o[1]=new lt.Controls.Medical._d3DXVECTOR2(0,0);var t="center",s="middle";if(c=lt.Controls.Medical.ReferenceLine._getIntersectionPointWithBoundary(f.get_x(),f.get_y(),d.get_x(),d.get_y(),b,h,b,j)){if(b<=g)return!1;n=!0;r=
m;o[m].x=parseInt(lt.Controls.Medical.ReferenceLine._intersectionX+0.5);o[m].y=parseInt(lt.Controls.Medical.ReferenceLine._intersectionY+0.5);t="left";s="middle";m++}n&&(k=h);if(c=lt.Controls.Medical.ReferenceLine._getIntersectionPointWithBoundary(f.get_x(),f.get_y(),d.get_x(),d.get_y(),g,k,i,k)){if(k>=j)return!1;o[m].x=parseInt(lt.Controls.Medical.ReferenceLine._intersectionX+0.5);o[m].y=parseInt(lt.Controls.Medical.ReferenceLine._intersectionY+0.5);n||(n=!0,r=m,t="center",s="bottom");m++}if(2>m&&
(n&&(l=j),c=lt.Controls.Medical.ReferenceLine._getIntersectionPointWithBoundary(f.get_x(),f.get_y(),d.get_x(),d.get_y(),g,l,i,l))){if(l<=h)return!1;o[m].x=parseInt(lt.Controls.Medical.ReferenceLine._intersectionX+0.5);o[m].y=parseInt(lt.Controls.Medical.ReferenceLine._intersectionY+0.5);n||(r=m,t="center",s="top");m++}if(2>m&&(c=lt.Controls.Medical.ReferenceLine._getIntersectionPointWithBoundary(f.get_x(),f.get_y(),d.get_x(),d.get_y(),g,h,g,j)))o[m].x=parseInt(lt.Controls.Medical.ReferenceLine._intersectionX+
0.5),o[m].y=parseInt(lt.Controls.Medical.ReferenceLine._intersectionY+0.5),m++;2===m&&(a.moveTo(o[0].x,o[0].y),a.lineTo(o[1].x,o[1].y),a.textAlign=t,a.textBaseline=s,a.fillText(" "+e+" ",o[r].x,o[r].y));return!0};lt.Controls.Medical.ReferenceLine.find=function(a,b,c,d,e,f,g,h,i,j){if(null==a||null==b||null==f||null==g)return new lt.Controls.Medical.LeadLine(0,0,1,1);var k=new lt.Controls.Medical._d3DXVECTOR3(a[0],a[1],a[2]),l=new lt.Controls.Medical._d3DXVECTOR3(a[3],a[4],a[5]),a=new lt.Controls.Medical._MVREFLINEPARAM,
b=new lt.Controls.Medical._d3DXVECTOR3(b[0],b[1],b[2]),g=new lt.Controls.Medical._d3DXVECTOR3(g[0],g[1],g[2]);lt.Controls.Medical.ReferenceLine._mvMapLocalizerImage(b,k,l,c.get_x(),c.get_y(),d,e,1,a);k=new lt.Controls.Medical._d3DXVECTOR3(f[0],f[1],f[2]);l=new lt.Controls.Medical._d3DXVECTOR3(f[3],f[4],f[5]);c=new lt.Controls.Medical._MVREFLINEPARAM;lt.Controls.Medical.ReferenceLine._mvMapLocalizerImage(g,k,l,h.get_x(),h.get_y(),i,j,1,c);h=new lt.Controls.Medical._d3DXVECTOR2(0,0);k=new lt.Controls.Medical._d3DXVECTOR2(0,
0);lt.Controls.Medical.ReferenceLine._mvFindReferenceObj1OnObj2(a,c,h,k);c=a=0;j<i?c=(512-512*j/i)/2:j>i&&(a=(512-512*i/j)/2);h.x-=a;h.y-=c;k.x-=a;k.y-=c;i=Math.max(i,j)/512;h.x*=i;h.y*=i;k.x*=i;k.y*=i;return new lt.Controls.Medical.LeadLine(h.x,h.y,k.x,k.y)};lt.Controls.Medical.ReferenceLine._mV_D3DXVec4Cross=function(a,b,c,d){if(null==b||null==c||null==d||null==a)return null;a.x=b.y*(c.z*d.w-d.z*c.w)-b.z*(c.y*d.w-d.y*c.w)+b.w*(c.y*d.z-c.z*d.y);a.y=-(b.x*(c.z*d.w-d.z*c.w)-b.z*(c.x*d.w-d.x*c.w)+b.w*
(c.x*d.z-d.x*c.z));a.z=b.x*(c.y*d.w-d.y*c.w)-b.y*(c.x*d.w-d.x*c.w)+b.w*(c.x*d.y-d.x*c.y);a.w=-(b.x*(c.y*d.z-d.y*c.z)-b.y*(c.x*d.z-d.x*c.z)+b.z*(c.x*d.y-d.x*c.y));return a};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross=function(a,b,c){if(null==b||null==c||null==a)return null;a.x=b.y*c.z-b.z*c.y;a.y=b.z*c.x-b.x*c.z;a.z=b.x*c.y-b.y*c.x;return a};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal=function(a,b,c){if(null==c||null==b||null==a)return null;a.x=c.m[0][0]*b.x+c.m[1][0]*b.y+
c.m[2][0]*b.z;a.y=c.m[0][1]*b.x+c.m[1][1]*b.y+c.m[2][1]*b.z;a.z=c.m[0][2]*b.x+c.m[1][2]*b.y+c.m[2][2]*b.z;return a};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot=function(a,b){return null==a||null==b?0:a.x*b.x+a.y*b.y+a.z*b.z};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord=function(a,b,c){if(null==c||null==b||null==a)return null;var d;(d=c.m[0][3]*b.x+c.m[1][3]*b.y+c.m[2][3]*b.z+c.m[3][3])?(a.x=(c.m[0][0]*b.x+c.m[1][0]*b.y+c.m[2][0]*b.z+c.m[3][0])/d,a.y=(c.m[0][1]*b.x+c.m[1][1]*
b.y+c.m[2][1]*b.z+c.m[3][1])/d,a.z=(c.m[0][2]*b.x+c.m[1][2]*b.y+c.m[2][2]*b.z+c.m[3][2])/d):(a.x=0,a.y=0,a.z=0);return a};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize=function(a,b){if(null==a||null==b)return null;var c=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);if(1.0E-8>c)return a.x=0,a.y=0,a.z=0,a;a.x=b.x/c;a.y=b.y/c;a.z=b.z/c;return a};lt.Controls.Medical.ReferenceLine._mV_D3DXPlaneFromPointNormal=function(a,b,c){if(null==c||null==b||null==a)return null;a.a=c.x;a.b=c.y;a.c=c.z;a.d=-lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(b,
c);return a};lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length=function(a){return null==a?0:Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixfDeterminant=function(a){if(null==a)return 0;var b=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0),c=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0),d=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0),e=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0),f=0;c.x=a.m[0][0];c.y=a.m[1][0];c.z=a.m[2][0];c.w=a.m[3][0];d.x=a.m[0][1];d.y=a.m[1][1];
d.z=a.m[2][1];d.w=a.m[3][1];e.x=a.m[0][2];e.y=a.m[1][2];e.z=a.m[2][2];e.w=a.m[3][2];lt.Controls.Medical.ReferenceLine._mV_D3DXVec4Cross(b,c,d,e);return f=-(a.m[0][3]*b.x+a.m[1][3]*b.y+a.m[2][3]*b.z+a.m[3][3]*b.w)};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixInverse=function(a,b,c){if(null==c||null==a)return null;var d,b=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0),e=Array(3);for(d=0;3>d;d++)e[d]=new lt.Controls.Medical._d3DXVECTOR4(0,0,0,0);var f=0,g,h,i;g=lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixfDeterminant(c);
if(!g)return null;lt.Controls.Medical.ReferenceLine._deter111=g;for(h=0;4>h;h++){for(i=0;4>i;i++)i!==h&&(d=i,i>h&&(d-=1),e[d].x=c.m[i][0],e[d].y=c.m[i][1],e[d].z=c.m[i][2],e[d].w=c.m[i][3]);lt.Controls.Medical.ReferenceLine._mV_D3DXVec4Cross(b,e[0],e[1],e[2]);for(i=0;4>i;i++){switch(i){case 0:f=b.x;break;case 1:f=b.y;break;case 2:f=b.z;break;case 3:f=b.w}a.m[i][h]=Math.pow(-1,h)*f/g}}return a};lt.Controls.Medical.ReferenceLine._mvFindReferenceObj1OnObj2=function(a,b,c,d){var e=new lt.Controls.Medical._d3DXVECTOR3(0,
0,0),f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord(e,a.diffParam.realImagePosition,b._realWorldCoor2DXCoord);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(f,a.diffParam.normDirReal,b._realWorldCoor2DXCoord);a=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(f,f);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(b.diffParam.normDirLocal,b.diffParam.normDirLocal);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(a,
f,b.diffParam.normDirLocal);if(1.0E-6>lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(a))return new lt.Controls.Medical._d3DXVECTOR2(1E5,1E6),new lt.Controls.Medical._d3DXVECTOR2(1E5,1000010),!1;lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(a,a);var g=new lt.Controls.Medical._d3DXPLANE,h=new lt.Controls.Medical._d3DXPLANE;lt.Controls.Medical.ReferenceLine._mV_D3DXPlaneFromPointNormal(g,e,f);lt.Controls.Medical.ReferenceLine._mV_D3DXPlaneFromPointNormal(h,b.diffParam.dxImagePosition,
b.diffParam.normDirLocal);e=new lt.Controls.Medical._d3DXMATRIX;e.set_m_11(f.x);e.set_m_12(f.y);e.set_m_13(f.z);e.set_m_14(0);e.set_m_21(b.diffParam.normDirLocal.x);e.set_m_22(b.diffParam.normDirLocal.y);e.set_m_23(b.diffParam.normDirLocal.z);e.set_m_24(0);e.set_m_31(a.x);e.set_m_32(a.y);e.set_m_33(a.z);e.set_m_34(0);e.set_m_41(0);e.set_m_42(0);e.set_m_43(0);e.set_m_44(1);var i=new lt.Controls.Medical._d3DXMATRIX;if(null==lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixInverse(i,0,e)||!lt.Controls.Medical.ReferenceLine._deter111)return!1;
f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);e=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);f.x=-(i.get_m_11()*g.d+i.get_m_12()*h.d);f.y=-(i.get_m_21()*g.d+i.get_m_22()*h.d);f.z=-(i.get_m_31()*g.d+i.get_m_32()*h.d);e=lt.Controls.Medical.ReferenceLine._addVectors3(f,a);a=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);g=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord(a,f,b.diffParam._worldMatTrans);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord(g,
e,b.diffParam._worldMatTrans);var i=b.diffParam._viewMatTrans,j=b.diffParam._projMatTrans,b=2/512,h=2/512,f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),e=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);f.x=a.x*j.get_m_11()*i.get_m_11();f.y=a.y*j.get_m_22()*i.get_m_22();f.z=0;e.x=g.x*j.get_m_11()*i.get_m_11();e.y=g.y*j.get_m_22()*i.get_m_22();e.z=0;a=new lt.Controls.Medical._d3DXVECTOR2(0,0);g=new lt.Controls.Medical._d3DXVECTOR2(0,0);a.x=(1+f.x)/b;a.y=(1-f.y)/h;g.x=(1+e.x)/b;g.y=(1-e.y)/h;b=lt.Controls.Medical.ReferenceLine._subtractVectors2(g,
a);if(h=Math.sqrt(b.x*b.x+b.y*b.y))b.x/=h,b.y/=h;b=lt.Controls.Medical.ReferenceLine._multiplyVectors2ByNumber(b,1500);a=lt.Controls.Medical.ReferenceLine._subtractVectors2(a,b);g=lt.Controls.Medical.ReferenceLine._addVectors2(g,b);c.x=a.x;c.y=a.y;d.x=g.x;d.y=g.y;return!0};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity=function(a){if(null==a)return null;a.set_m_11(1);a.set_m_12(0);a.set_m_13(0);a.set_m_14(0);a.set_m_21(0);a.set_m_22(1);a.set_m_23(0);a.set_m_24(0);a.set_m_31(0);a.set_m_32(0);
a.set_m_33(1);a.set_m_34(0);a.set_m_41(0);a.set_m_42(0);a.set_m_43(0);a.set_m_44(1);return a};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixRotationAxis=function(a,b,c){if(null==b||null==a)return null;var d=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(d,b);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(a);a.set_m_11((1-Math.cos(c))*d.x*d.x+Math.cos(c));a.set_m_12((1-Math.cos(c))*d.y*d.x+Math.sin(c)*d.z);a.set_m_13((1-Math.cos(c))*
d.z*d.x-Math.sin(c)*d.y);a.set_m_21((1-Math.cos(c))*d.x*d.y-Math.sin(c)*d.z);a.set_m_22((1-Math.cos(c))*d.y*d.y+Math.cos(c));a.set_m_23((1-Math.cos(c))*d.z*d.y+Math.sin(c)*d.x);a.set_m_31((1-Math.cos(c))*d.x*d.z+Math.sin(c)*d.y);a.set_m_32((1-Math.cos(c))*d.y*d.z-Math.sin(c)*d.x);a.set_m_33((1-Math.cos(c))*d.z*d.z+Math.cos(c));return a};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixLookAtLH=function(a,b,c,d){if(null==a||null==b||null==c||null==d)return null;var e=new lt.Controls.Medical._d3DXVECTOR3(0,
0,0),f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),g=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),h=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),i=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),j=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);j.x=c.x-b.x;j.y=c.y-b.y;j.z=c.z-b.z;lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(i,j);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(e,d,i);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(g,i,e);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(f,
e);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(h,g);a.m[0][0]=f.x;a.m[1][0]=f.y;a.m[2][0]=f.z;a.m[3][0]=-lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(f,b);a.m[0][1]=h.x;a.m[1][1]=h.y;a.m[2][1]=h.z;a.m[3][1]=-lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(h,b);a.m[0][2]=i.x;a.m[1][2]=i.y;a.m[2][2]=i.z;a.m[3][2]=-lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(i,b);a.m[0][3]=0;a.m[1][3]=0;a.m[2][3]=0;a.m[3][3]=1;return a};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixOrthoLH=
function(a,b,c,d,e){if(null==a)return null;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(a);a.m[0][0]=2/b;a.m[1][1]=2/c;a.m[2][2]=1/(e-d);a.m[3][2]=d/(d-e);return a};lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply=function(a,b,c){if(null==b||null==c||null==a)return null;var d=new lt.Controls.Medical._d3DXMATRIX,e,f;for(e=0;4>e;e++)for(f=0;4>f;f++)d.m[e][f]=b.m[e][0]*c.m[0][f]+b.m[e][1]*c.m[1][f]+b.m[e][2]*c.m[2][f]+b.m[e][3]*c.m[3][f];for(e=0;4>e;e++)for(f=0;4>f;f++)a.m[e][f]=
d.m[e][f];return a};lt.Controls.Medical.ReferenceLine._mvMapLocalizerImage=function(a,b,c,d,e,f,g,h,i){if(null==i)return!1;i.screenShiftX=0;i.screenShiftY=0;i.imageWidth=f;i.imageHight=g;if(g<f){i.screenShiftY=(f-g)/2;var j=lt.Controls.Medical.ReferenceLine._multiplyVectors3ByNumber(c,(f-g)*e/2),a=lt.Controls.Medical.ReferenceLine._subtractVectors3(a,j),g=f}else g>f&&(i.screenShiftX=(g-f)/2,j=lt.Controls.Medical.ReferenceLine._multiplyVectors3ByNumber(b,(g-f)*d/2),a=lt.Controls.Medical.ReferenceLine._subtractVectors3(a,
j),f=g);var j=i.diffParam,k=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(k,c,b);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(b,b);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(c,c);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(k,k);var l=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0),m=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0),n=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1),r=lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(n,
k);1<r&&(r=1);-1>r&&(r=-1);r=Math.acos(r);0.001>Math.abs(r)&&(r=0);var o=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(o,k,n);1.0E-4>lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(o)&&(o=m);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(o,o);m=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixRotationAxis(m,o,r);var r=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),o=new lt.Controls.Medical._d3DXVECTOR3(0,
0,0),t=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(r,b,m);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(o,c,m);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(t,k,m);b=lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(l,r);1<b&&(b=1);-1>b&&(b=-1);b=Math.acos(b);0.001>Math.abs(b)&&(b=0);c=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(c,r,l);1.0E-4>lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(c)&&
(c=n);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(c,c);l=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixRotationAxis(l,c,b);n=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(n,m,l);l=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixInverse(l,0,n);i._rotMatScan2Stand=l;n=Math.max(f,g);l=f/(2*n);n=g/(2*n);j.dxImagePosition=new lt.Controls.Medical._d3DXVECTOR3(l,n,0);j.rowDirLocal=
new lt.Controls.Medical._d3DXVECTOR3(-1,0,0);j.colDirLocal=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0);j.normDirLocal=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(j.rowDirReal,j.rowDirLocal,i._rotMatScan2Stand);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(j.colDirReal,j.colDirLocal,i._rotMatScan2Stand);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(j.normDirReal,j.normDirLocal,i._rotMatScan2Stand);m=0;m=
Math.max(l,n);b=new lt.Controls.Medical._d3DXMATRIX;c=new lt.Controls.Medical._d3DXMATRIX;k=new lt.Controls.Medical._d3DXVECTOR3(0,0,100);r=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);o=new lt.Controls.Medical._d3DXVECTOR3(0,1,0);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixLookAtLH(b,k,r,o);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixOrthoLH(c,2*m/h,2*m/h,1,200);j._viewMatTrans=b;j._projMatTrans=c;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(j._worldMatTrans);j.worldDX_Width=2*
l;j.worldDX_Hieght=2*n;d*=f;g*=e;e=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(e);e.set_m_11(d/(2*l));e.set_m_22(g/(2*n));e.set_m_33(e.get_m_22());f=j.dxImagePosition;g=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(g);g.set_m_33(-1);h=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(h,e,g);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(h,h,i._rotMatScan2Stand);
d=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord(d,f,h);f=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixIdentity(f);f.set_m_41(a.x-d.x);f.set_m_42(a.y-d.y);f.set_m_43(a.z-d.z);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(i._dxCoord2RealWorldCoor,e,g);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(i._dxCoord2RealWorldCoor,i._dxCoord2RealWorldCoor,i._rotMatScan2Stand);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(i._dxCoord2RealWorldCoor,
i._dxCoord2RealWorldCoor,f);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixInverse(i._realWorldCoor2DXCoord,0,i._dxCoord2RealWorldCoor);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformCoord(j.realImagePosition,j.dxImagePosition,i._dxCoord2RealWorldCoor);return!0};lt.Controls.Medical.ReferenceLine._addVectors3=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);c.x=a.x+b.x;c.y=a.y+b.y;c.z=a.z+b.z;return c};lt.Controls.Medical.ReferenceLine._subtractVectors3=function(a,b){var c=
new lt.Controls.Medical._d3DXVECTOR3(0,0,0);c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c};lt.Controls.Medical.ReferenceLine._multiplyVectors3=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);c.x=a.x*b.x;c.y=a.y*b.y;c.z=a.z*b.z;return c};lt.Controls.Medical.ReferenceLine._multiplyVectors3ByNumber=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);c.x=a.x*b;c.y=a.y*b;c.z=a.z*b;return c};lt.Controls.Medical.ReferenceLine._addVectors2=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR2(0,
0);c.x=a.x+b.x;c.y=a.y+b.y;return c};lt.Controls.Medical.ReferenceLine._subtractVectors2=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR2(0,0);c.x=a.x-b.x;c.y=a.y-b.y;return c};lt.Controls.Medical.ReferenceLine._multiplyVectors2=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR2(0,0);c.x=a.x*b.x;c.y=a.y*b.y;return c};lt.Controls.Medical.ReferenceLine._multiplyVectors2ByNumber=function(a,b){var c=new lt.Controls.Medical._d3DXVECTOR2(0,0);c.x=a.x*b;c.y=a.y*b;return c};lt.Controls.Medical.ReferenceLine._foo=
function(a,b,c,d,e){var d=1,b=lt.Controls.Medical.ReferenceLine._subtractVectors3(c,b),f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(f,b);b=new lt.Controls.Medical._d3DXVECTOR3(a[0],a[1],a[2]);a=new lt.Controls.Medical._d3DXVECTOR3(a[3],a[4],a[5]);c=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(c,a,b);var g=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(g,
a,b);f=lt.Controls.Medical.ReferenceLine._subtractVectors3(f,g);1<lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(f)&&(d=-1);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(b,b);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(a,a);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(c,c);var f=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0),h=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0),g=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1),i=lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(g,
c);1<i&&(i=1);-1>i&&(i=-1);i=Math.acos(i);0.001>Math.abs(i)&&(i=0);var j=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(j,c,g);1.0E-4>lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(j)&&(j=h);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(j,j);h=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixRotationAxis(h,j,i);var i=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),j=new lt.Controls.Medical._d3DXVECTOR3(0,
0,0),k=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(i,b,h);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(j,a,h);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(k,c,h);b=lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Dot(f,i);1<b&&(b=1);-1>b&&(b=-1);b=Math.acos(b);0.001>Math.abs(b)&&(b=0);a=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(a,i,f);1.0E-4>lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Length(a)&&
(a=g);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Normalize(a,a);c=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixRotationAxis(c,a,b);b=new lt.Controls.Medical._d3DXMATRIX;lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixMultiply(b,h,c);lt.Controls.Medical.ReferenceLine._mV_D3DXMatrixInverse(e,0,b);return d};lt.Controls.Medical.ReferenceLine._indentifyOrientation=function(a,b,c,d,e,f){a.z*=e;b.z*=e;var g=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),e=new lt.Controls.Medical._d3DXVECTOR3(0,
0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(g,a,f);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(e,b,f);for(var a=Array(3),b=Array(3),f=0<g.x?1:0,h=0<g.y?4:5,i=0<g.z?3:2,j=Math.abs(g.x),k=Math.abs(g.y),g=Math.abs(g.z),l=0,m=0;3>m;m++)0.01<j&&j>k&&j>g?(a[l++]=f,j=0):0.01<k&&k>j&&k>g?(a[l++]=h,k=0):0.01<g&&g>j&&g>k?(a[l++]=i,g=0):a[l++]=6;f=0<e.x?1:0;h=0<e.y?4:5;i=0<e.z?3:2;j=Math.abs(e.x);k=Math.abs(e.y);g=Math.abs(e.z);for(m=l=0;3>m;m++)0.01<j&&j>k&&j>g?(b[l++]=
f,j=0):0.01<k&&k>j&&k>g?(b[l++]=h,k=0):0.01<g&&g>j&&g>k?(b[l++]=i,g=0):b[l++]=6;c[0]=a[0];c[1]=a[1];c[2]=a[2];d[0]=b[0];d[1]=b[1];d[2]=b[2]};lt.Controls.Medical.ReferenceLine._indentifyMPRDICOMTages=function(a,b,c,d,e){a.z*=d;b.z*=d;var d=new lt.Controls.Medical._d3DXVECTOR3(0,0,0),f=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(d,a,e);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3TransformNormal(f,b,e);c.xOrientation[0]=d.x;c.xOrientation[1]=
d.y;c.xOrientation[2]=d.z;c.yOrientation[0]=f.x;c.yOrientation[1]=f.y;c.yOrientation[2]=f.z;a=new lt.Controls.Medical._d3DXVECTOR3(0,0,0);lt.Controls.Medical.ReferenceLine._mV_D3DXVec3Cross(a,d,f);c.zOrientation[0]=a.x;c.zOrientation[1]=a.y;c.zOrientation[2]=a.z};lt.Controls.Medical.ReferenceLine._l_FMEMCPY=function(a,b,c){for(var c=parseInt(c),d=0,d=0;d<c;d++)a[d]=b[d]};lt.Controls.Medical.ReferenceLine._l_MEMCPY=function(a,b,c){for(var d=0,d=0;d<c;d++)a[d]=b[d]};lt.Controls.Medical.ReferenceLine._set3OrthogonalOrientation=
function(a,b,c){var d=Array(5),e=Array(5),f=Array(3),g=Array(3),h=Array(3),i=new lt.Controls.Medical._NEWDICOMTAGES,j=Array(3),k=Array(3),l=Array(3),m=new lt.Controls.Medical._NEWDICOMTAGES,n=Array(3),r=Array(3),o=Array(3),t=new lt.Controls.Medical._NEWDICOMTAGES,s=0,q=new lt.Controls.Medical._d3DXMATRIX,s=lt.Controls.Medical.ReferenceLine._foo(a,b,c,s,q),a=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0),b=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0);lt.Controls.Medical.ReferenceLine._indentifyOrientation(a,
b,f,g,s,q);a=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0);b=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1);lt.Controls.Medical.ReferenceLine._indentifyOrientation(a,b,j,k,s,q);a=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0);b=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1);lt.Controls.Medical.ReferenceLine._indentifyOrientation(a,b,n,r,s,q);a=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0);b=new lt.Controls.Medical._d3DXVECTOR3(0,-1,0);lt.Controls.Medical.ReferenceLine._indentifyMPRDICOMTages(a,b,i,s,q);a=
new lt.Controls.Medical._d3DXVECTOR3(0,-1,0);b=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1);lt.Controls.Medical.ReferenceLine._indentifyMPRDICOMTages(a,b,m,s,q);a=new lt.Controls.Medical._d3DXVECTOR3(-1,0,0);b=new lt.Controls.Medical._d3DXVECTOR3(0,0,-1);lt.Controls.Medical.ReferenceLine._indentifyMPRDICOMTages(a,b,t,s,q);s=i;q=m;a=t;d[4]=2!==f[0]&&3!==f[0]&&2!==g[0]&&3!==g[0]?4:2!==j[0]&&3!==j[0]&&2!==k[0]&&3!==k[0]?1:2;d[1]=f[0]&&1!==f[0]&&g[0]&&1!==g[0]?4:j[0]&&1!==j[0]&&k[0]&&1!==k[0]?1:2;d[2]=
4!==f[0]&&5!==f[0]&&4!==g[0]&&5!==g[0]?4:4!==j[0]&&5!==j[0]&&4!==k[0]&&5!==k[0]?1:2;var b=Array(3),p=Array(3),c=Array(3),u=new lt.Controls.Medical._NEWDICOMTAGES;4!==d[4]&&(1===d[4]?(u=q.clone(),q=s.clone(),s=u.clone(),lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,k,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(p,j,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(k,g,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(j,f,3)):(u=a.clone(),a=s.clone(),s=u.clone(),lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,
r,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(p,n,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(r,g,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(n,f,3)),lt.Controls.Medical.ReferenceLine._l_MEMCPY(g,b,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(f,p,3));1!==d[1]&&(u=q.clone(),q=a.clone(),a=u.clone(),lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,k,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(p,j,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(k,r,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(j,
n,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(r,b,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(n,p,3));p=Array(7);p[0]=1;p[1]=0;p[2]=3;p[3]=2;p[4]=5;p[5]=4;p[6]=6;h[0]=-1;h[1]=-1;h[2]=-1;o[0]=-1;o[1]=-1;o[2]=-1;l[0]=-1;l[1]=-1;l[2]=-1;u=0;f[0]&&1!==f[0]&&(lt.Controls.Medical.ReferenceLine._l_FMEMCPY(c,s.xOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(s.xOrientation,s.yOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(s.yOrientation,c,3),s.yOrientation[0]*=-1,s.yOrientation[1]*=
-1,s.yOrientation[2]*=-1,lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,g,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(g,f,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(f,b,3),f[0]=p[f[0]],f[1]=p[f[1]],f[2]=p[f[2]],h[u]=1,u++);1!==f[0]&&(s.yOrientation[0]*=-1,s.yOrientation[1]*=-1,s.yOrientation[2]*=-1,f[0]=p[f[0]],f[1]=p[f[1]],f[2]=p[f[2]],h[u]=2,u++);4!==g[0]&&(s.xOrientation[0]*=-1,s.xOrientation[1]*=-1,s.xOrientation[2]*=-1,g[0]=p[g[0]],g[1]=p[g[1]],g[2]=p[g[2]],h[u]=3);u=0;n[0]&&1!==n[0]&&
(lt.Controls.Medical.ReferenceLine._l_FMEMCPY(c,a.xOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(a.xOrientation,a.yOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(a.yOrientation,c,3),a.yOrientation[0]*=-1,a.yOrientation[1]*=-1,a.yOrientation[2]*=-1,lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,r,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(r,n,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(n,b,3),n[0]=p[n[0]],n[1]=p[n[1]],n[2]=p[n[2]],o[u]=1,u++);1!==n[0]&&(a.yOrientation[0]*=
-1,a.yOrientation[1]*=-1,a.yOrientation[2]*=-1,n[0]=p[n[0]],n[1]=p[n[1]],n[2]=p[n[2]],o[u]=2,u++);2!==r[0]&&(a.xOrientation[0]*=-1,a.xOrientation[1]*=-1,a.xOrientation[2]*=-1,r[0]=p[r[0]],r[1]=p[r[1]],r[2]=p[r[2]],o[u]=3);u=0;4!==j[0]&&5!==j[0]&&(lt.Controls.Medical.ReferenceLine._l_FMEMCPY(c,q.xOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(q.xOrientation,q.yOrientation,3),lt.Controls.Medical.ReferenceLine._l_FMEMCPY(q.yOrientation,c,3),q.yOrientation[0]*=-1,q.yOrientation[1]*=-1,q.yOrientation[2]*=
-1,lt.Controls.Medical.ReferenceLine._l_MEMCPY(b,k,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(k,j,3),lt.Controls.Medical.ReferenceLine._l_MEMCPY(j,b,3),j[0]=p[j[0]],j[1]=p[j[1]],j[2]=p[j[2]],l[u]=1,u++);4!==j[0]&&(q.yOrientation[0]*=-1,q.yOrientation[1]*=-1,q.yOrientation[2]*=-1,j[0]=p[j[0]],j[1]=p[j[1]],j[2]=p[j[2]],l[u]=2,u++);2!==k[0]&&(q.xOrientation[0]*=-1,q.xOrientation[1]*=-1,q.xOrientation[2]*=-1,k[0]=p[k[0]],k[1]=p[k[1]],k[2]=p[k[2]],l[u]=3);for(s=0;5>s;s++)for(q=0;5>q;q++)d[q]===s&&
(e[s]=4===q?0:q);i.r=f;i.c=g;i.flip=h;i.map3DOrthMPRToItsConventionalNames=d;i.map3DOrthMPRToItsConventionalNamesInv=e;m.r=j;m.c=k;m.flip=l;m.map3DOrthMPRToItsConventionalNames=d;m.map3DOrthMPRToItsConventionalNamesInv=e;t.r=n;t.c=r;t.flip=o;t.map3DOrthMPRToItsConventionalNames=d;t.map3DOrthMPRToItsConventionalNamesInv=e;d=new lt.Controls.Medical._mprCellsInfo;d.axial_DICOMTage=i;d.sag_DICOMTage=m;d.coro_DICOMTage=t;return d};lt.Controls.Medical._mprOrientationInfo=function(){};lt.Controls.Medical._mprOrientationInfo.prototype=
{mprType:0,orientation:null,transform:null};lt.Controls.Medical._mprCellsInfo=function(){};lt.Controls.Medical._mprCellsInfo.prototype={axial_DICOMTage:null,sag_DICOMTage:null,coro_DICOMTage:null};lt.Controls.Medical._NEWDICOMTAGES=function(){this.xOrientation=Array(3);this.yOrientation=Array(3);this.zOrientation=Array(3);this.startPosition=Array(3);this.distanceBetweenFrames=Array(3)};lt.Controls.Medical._NEWDICOMTAGES.prototype={clone:function(){for(var a=new lt.Controls.Medical._NEWDICOMTAGES,
b=0;3>b;b++)a.xOrientation[b]=this.xOrientation[b],a.yOrientation[b]=this.yOrientation[b],a.zOrientation[b]=this.zOrientation[b],a.startPosition[b]=this.startPosition[b],a.distanceBetweenFrames[b]=this.distanceBetweenFrames[b];return a},xOrientation:null,yOrientation:null,zOrientation:null,startPosition:null,distanceBetweenFrames:null,r:null,c:null,flip:null,map3DOrthMPRToItsConventionalNames:null,map3DOrthMPRToItsConventionalNamesInv:null};lt.Controls.Medical.WindowLevelData=function(){};lt.Controls.Medical.WindowLevelData.prototype=
{_renderer:null,_interactiveMode:null,get_interactiveMode:function(){return this._interactiveMode},set_interactiveMode:function(a){return this._interactiveMode=a},get_renderer:function(){return this._renderer},set_renderer:function(a){this._renderer!==a&&(this._renderer=a,this._calculateSensitivyValue());return a},_calculateSensitivyValue:function(){if(null==this._renderer)this._windowLevelSensitivity=1;else{var a=this._renderer.get_information();-1===a.get_maxValue()&&a.get_bitsPerPixel();a.get_minValue();
this._windowLevelSensitivity=Math.max(1,this._renderer.get_originalWindowLevelWidth()>>10)}},_image:null,get_image:function(){return this._image},set_image:function(a){return this._image=a},_canvas:null,get_canvas:function(){return this._canvas},set_canvas:function(a){return this._canvas=a},_dragDeltaSensitivityToUse:0,_dragDeltaSensitivity:0,get_dragDeltaSensitivity:function(){return this._dragDeltaSensitivity},set_dragDeltaSensitivity:function(a){return this._dragDeltaSensitivityToUse=this._dragDeltaSensitivity=
a},_windowLevelSensitivity:0,get_windowLevelSensitivity:function(){return this._enableWindowLevelSensitivity?this._windowLevelSensitivity:1},_enableWindowLevelSensitivity:!1,get_enableWindowLevelSensitivity:function(){return this._enableWindowLevelSensitivity},set_enableWindowLevelSensitivity:function(a){return this._enableWindowLevelSensitivity=a}};Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"interactiveMode",{get:lt.Controls.Medical.WindowLevelData.prototype.get_interactiveMode,
set:lt.Controls.Medical.WindowLevelData.prototype.set_interactiveMode,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"renderer",{get:lt.Controls.Medical.WindowLevelData.prototype.get_renderer,set:lt.Controls.Medical.WindowLevelData.prototype.set_renderer,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"image",{get:lt.Controls.Medical.WindowLevelData.prototype.get_image,set:lt.Controls.Medical.WindowLevelData.prototype.set_image,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"canvas",{get:lt.Controls.Medical.WindowLevelData.prototype.get_canvas,set:lt.Controls.Medical.WindowLevelData.prototype.set_canvas,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"dragDeltaSensitivity",{get:lt.Controls.Medical.WindowLevelData.prototype.get_dragDeltaSensitivity,set:lt.Controls.Medical.WindowLevelData.prototype.set_dragDeltaSensitivity,
enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"windowLevelSensitivity",{get:lt.Controls.Medical.WindowLevelData.prototype.get_windowLevelSensitivity,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelData.prototype,"enableWindowLevelSensitivity",{get:lt.Controls.Medical.WindowLevelData.prototype.get_enableWindowLevelSensitivity,set:lt.Controls.Medical.WindowLevelData.prototype.set_enableWindowLevelSensitivity,
enumerable:!0,configurable:!0});lt.Controls.Medical.WindowLevelInteractiveMode=function(){lt.Controls.Medical.WindowLevelInteractiveMode.initializeBase(this);this.set_autoItemMode(lt.Controls.ImageViewerAutoItemMode.autoSet);this.set_itemPart(lt.Controls.ImageViewerItemPart.item);this._data$1=new lt.Controls.Medical.WindowLevelData};lt.Controls.Medical.WindowLevelInteractiveMode.prototype={_previousX$1:0,_previousY$1:0,get_id:function(){return 103},_data$1:null,get_data:function(){return this._data$1},
set_data:function(a){null!=this._data$1&&this._data$1.set_interactiveMode(null);this._data$1=a;null!=this._data$1&&this._data$1.set_interactiveMode(this);return a},get_name:function(){return"WindowLevel"},reset:function(){this.get_isStarted()&&(this._data$1.get_renderer().updateWindowLevelLUT(this._data$1.get_renderer().get_originalWindowLevelWidth(),this._data$1.get_renderer().get_originalWindowLevelCenter()),this._data$1.get_renderer()._renderUsingCanvasInternal(this._data$1.get_canvas(),!1))},
start:function(a){lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,"start",[a]);a=lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,"get_interactiveService");a.add_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));a.add_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));a.add_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1))},stop:function(a){if(this.get_isStarted()){var b=lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,
"get_interactiveService");b.remove_dragStarted(ss.Delegate.create(this,this._service_DragStarted$1));b.remove_dragDelta(ss.Delegate.create(this,this._service_DragDelta$1));b.remove_dragCompleted(ss.Delegate.create(this,this._service_DragCompleted$1));lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,"stop",[a])}},_service_DragStarted$1:function(a,b){if(b.get_nativeEvent().type!==lt.LTHelper.mouseWheelEvent&&this.canStartWork(b)&&(this.onWorkStarted(lt.LeadEventArgs.Empty),null!=this._data$1)){if(null==
this._data$1.get_renderer())throw Error("Must call SetRenderer with a valid DICOMImageInformationRenderer first");this._previousX$1=parseInt(b.get_position().get_x());this._previousY$1=parseInt(b.get_position().get_y())}},_service_DragDelta$1:function(a,b){if(!(b.get_nativeEvent().type===lt.LTHelper.mouseWheelEvent||null==this._data$1)&&this.get_isWorking()){var c=parseInt(b.get_change().get_x()),d=parseInt(b.get_change().get_y()),e=parseInt(b.get_position().get_x()),f=parseInt(b.get_position().get_y()),
g=e-this._previousX$1,h=f-this._previousY$1,i=this._data$1._dragDeltaSensitivityToUse;this._data$1._dragDeltaSensitivityToUse!==this._data$1.get_dragDeltaSensitivity()&&this._data$1.set_dragDeltaSensitivity(this._data$1._dragDeltaSensitivityToUse);if(!(Math.abs(g)<=i&&Math.abs(h)<=i)&&(c||d))lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,"get_item"),this._previousX$1=e,this._previousY$1=f,c=this._data$1.get_renderer().get_windowLevelWidth()+g*this._data$1.get_windowLevelSensitivity(),
d=this._data$1.get_renderer().get_windowLevelCenter()+h*this._data$1.get_windowLevelSensitivity(),b.set_change(lt.LeadPointD.create(g*this._data$1.get_windowLevelSensitivity(),h*this._data$1.get_windowLevelSensitivity())),null!=this.__workDelta$1&&this.__workDelta$1(this,b),this._data$1.get_renderer().updateWindowLevelLUT(c,d),this._needsRender$1||(this._needsRender$1=!0,lt.LTHelper.requestAnimationFrame(ss.Delegate.create(this,this._doRender$1)))}},_needsRender$1:!1,_mrtiEnabled$1:!1,get_mrtiEnabled:function(){return this._mrtiEnabled$1},
set_mrtiEnabled:function(a){return this._mrtiEnabled$1=a},add_render:function(a){this.__render$1=ss.Delegate.combine(this.__render$1,a)},remove_render:function(a){this.__render$1=ss.Delegate.remove(this.__render$1,a)},__render$1_handler_get:function(){null==this.__render$1_handler&&(this.__render$1_handler=ss.EventHandler.create(this,this.add_render,this.remove_render));return this.__render$1_handler},__render$1:null,__render$1_handler:null,add_workDelta:function(a){this.__workDelta$1=ss.Delegate.combine(this.__workDelta$1,
a)},remove_workDelta:function(a){this.__workDelta$1=ss.Delegate.remove(this.__workDelta$1,a)},__workDelta$1_handler_get:function(){null==this.__workDelta$1_handler&&(this.__workDelta$1_handler=ss.EventHandler.create(this,this.add_workDelta,this.remove_workDelta));return this.__workDelta$1_handler},__workDelta$1:null,__workDelta$1_handler:null,add_renderCompleted:function(a){this.__renderCompleted$1=ss.Delegate.combine(this.__renderCompleted$1,a)},remove_renderCompleted:function(a){this.__renderCompleted$1=
ss.Delegate.remove(this.__renderCompleted$1,a)},__renderCompleted$1_handler_get:function(){null==this.__renderCompleted$1_handler&&(this.__renderCompleted$1_handler=ss.EventHandler.create(this,this.add_renderCompleted,this.remove_renderCompleted));return this.__renderCompleted$1_handler},__renderCompleted$1:null,__renderCompleted$1_handler:null,_doRender$1:function(){this._needsRender$1&&(this._needsRender$1=!1,this._mrtiEnabled$1&&(null!=this.__render$1&&this.__render$1(this,lt.LeadEventArgs.Empty),
this._data$1.get_renderer().onUpdateImageData(lt.LeadEventArgs.Empty)))},_service_DragCompleted$1:function(a,b){if(b.get_nativeEvent().type!==lt.LTHelper.mouseWheelEvent)if(null==this._data$1)this.onWorkCompleted(lt.LeadEventArgs.Empty);else this.get_isWorking()&&(null!=this.__renderCompleted$1&&this.__renderCompleted$1(this,lt.LeadEventArgs.Empty),this.onWorkCompleted(lt.LeadEventArgs.Empty))},dispose:function(){this._clear$1()},_clear$1:function(){},_flip$1:function(a,b){a.translate(0,b.height);
a.scale(1,-1)},_reverse$1:function(a,b){a.translate(b.width,0);a.scale(-1,1)},_rotate$1:function(a,b,c){var d=lt.Controls.Medical.WindowLevelInteractiveMode.callBaseMethod(this,"get_item"),e=d.get_flip(),d=d.get_reverse(),f=1;if(e||d)e!==d&&(f=-1);c*=f;e=c*Math.PI/180;c=parseInt(c);d=b.height/b.width;f=b.width/b.height;switch(c){case 90:case -270:a.rotate(e);a.scale(d,f);a.translate(0,-b.height);break;case -180:case 180:a.translate(b.width/2,b.height/2);a.rotate(e);a.translate(-b.width/2,-b.height/
2);break;case -90:case 270:a.rotate(e),a.scale(d,f),a.translate(-b.width,0)}}};Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"id",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.get_id,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"data",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.get_data,set:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.set_data,enumerable:!0,
configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"name",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.get_name,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"mrtiEnabled",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.get_mrtiEnabled,set:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.set_mrtiEnabled,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,
"render",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.__render$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"workDelta",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.__workDelta$1_handler_get,enumerable:!0,configurable:!0});Object.defineProperty(lt.Controls.Medical.WindowLevelInteractiveMode.prototype,"renderCompleted",{get:lt.Controls.Medical.WindowLevelInteractiveMode.prototype.__renderCompleted$1_handler_get,
enumerable:!0,configurable:!0});lt.Controls.Medical._workItem=function(a,b){this._state=a;this._data=b};lt.Controls.Medical._workItem.prototype={_state:null,get__state:function(){return this._state},_data:null};lt.Controls.Medical._myWorkItemData=function(a,b,c,d,e,f,g,h,i,j,k,l){this.client=a;this.image=b;this.resolution=c;this.tileRect=d;this.bitsPerPixel=e;this.mimeType=f;this.sourceRect=g;this.targetRect=h;this.tileSize=i;this.expectedNumberOfChunks=j;this.excludedRect=k;this.userState=l};lt.Controls.Medical._myWorkItemData.prototype=
{testingValue:0,client:null,image:null,resolution:null,tileRect:null,tileResolution:null,tileBackGroundResolution:null,bitsPerPixel:0,mimeType:null,sourceRect:null,targetRect:null,tileSize:null,userState:null,expectedNumberOfChunks:0,rectList:null,recycledList:null,excludedRect:null,canceled:!1};lt.Controls.Medical._lT_VersionNumber.registerClass("lt.Controls.Medical._lT_VersionNumber");lt.Controls.Medical.AutomationImageViewer.registerClass("lt.Controls.Medical.AutomationImageViewer",lt.Controls.ImageViewer,
lt.Annotations.Core.IAnnAutomationControl);lt.Controls.Medical.AutomationInteractiveMode.registerClass("lt.Controls.Medical.AutomationInteractiveMode",lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical._imageDataStreamer.registerClass("lt.Controls.Medical._imageDataStreamer");lt.Controls.Medical.DICOMImageInformation.registerClass("lt.Controls.Medical.DICOMImageInformation");lt.Controls.Medical.DICOMImageInformationRenderer.registerClass("lt.Controls.Medical.DICOMImageInformationRenderer");
lt.Controls.Medical._layerInfo.registerClass("lt.Controls.Medical._layerInfo");lt.Controls.Medical.ImageProcessing.registerClass("lt.Controls.Medical.ImageProcessing");lt.Controls.Medical._seriesReferenceLines.registerClass("lt.Controls.Medical._seriesReferenceLines");lt.Controls.Medical._referenceLineInformation.registerClass("lt.Controls.Medical._referenceLineInformation");lt.Controls.Medical._frameReferenceLines.registerClass("lt.Controls.Medical._frameReferenceLines");lt.Controls.Medical.LayoutManagerItem.registerClass("lt.Controls.Medical.LayoutManagerItem");
lt.Controls.Medical._rightClickMenuItem.registerClass("lt.Controls.Medical._rightClickMenuItem");lt.Controls.Medical.LayoutManager.registerClass("lt.Controls.Medical.LayoutManager");lt.Controls.Medical.GridLayout.registerClass("lt.Controls.Medical.GridLayout");lt.Controls.Medical.MedicalViewer.registerClass("lt.Controls.Medical.MedicalViewer",lt.Controls.InteractiveService);lt.Controls.Medical.CellGridLayout.registerClass("lt.Controls.Medical.CellGridLayout");lt.Controls.Medical.EmptyCell.registerClass("lt.Controls.Medical.EmptyCell",
lt.Controls.Medical.LayoutManagerItem);lt.Controls.Medical.CellEventArgs.registerClass("lt.Controls.Medical.CellEventArgs",lt.LeadEventArgs);lt.Controls.Medical.ImageURLChangedEventArgs.registerClass("lt.Controls.Medical.ImageURLChangedEventArgs",lt.Controls.Medical.CellEventArgs);lt.Controls.Medical.ImageProcessingReadyEventArgs.registerClass("lt.Controls.Medical.ImageProcessingReadyEventArgs",lt.LeadEventArgs);lt.Controls.Medical.CellExplodedEventArgs.registerClass("lt.Controls.Medical.CellExplodedEventArgs",
lt.LeadEventArgs);lt.Controls.Medical.FrameAttachedEventArgs.registerClass("lt.Controls.Medical.FrameAttachedEventArgs",lt.LeadEventArgs);lt.Controls.Medical.Cell.registerClass("lt.Controls.Medical.Cell",lt.Controls.Medical.LayoutManagerItem);lt.Controls.Medical.MPRCell.registerClass("lt.Controls.Medical.MPRCell",lt.Controls.Medical.Cell);lt.Controls.Medical.ScrollChangedEventArgs.registerClass("lt.Controls.Medical.ScrollChangedEventArgs",lt.LeadEventArgs);lt.Controls.Medical._overlayInfo.registerClass("lt.Controls.Medical._overlayInfo");
lt.Controls.Medical._actionInfo.registerClass("lt.Controls.Medical._actionInfo");lt.Controls.Medical.SubCell.registerClass("lt.Controls.Medical.SubCell",lt.Controls.ImageViewerItem);lt.Controls.Medical._chunkList.registerClass("lt.Controls.Medical._chunkList");lt.Controls.Medical.MRTISubCell.registerClass("lt.Controls.Medical.MRTISubCell",lt.Controls.Medical.SubCell);lt.Controls.Medical._fullRes_Thumb_ImageInfo.registerClass("lt.Controls.Medical._fullRes_Thumb_ImageInfo");lt.Controls.Medical._imagesLoader.registerClass("lt.Controls.Medical._imagesLoader");
lt.Controls.Medical.Frame.registerClass("lt.Controls.Medical.Frame");lt.Controls.Medical._windowLevelValues.registerClass("lt.Controls.Medical._windowLevelValues");lt.Controls.Medical.OverlayText.registerClass("lt.Controls.Medical.OverlayText");lt.Controls.Medical.LeadCollectionChangedEventArgs.registerClass("lt.Controls.Medical.LeadCollectionChangedEventArgs",lt.LeadEventArgs);lt.Controls.Medical.LeadCollection.registerClass("lt.Controls.Medical.LeadCollection");lt.Controls.Medical.Tools.registerClass("lt.Controls.Medical.Tools");
lt.Controls.Medical.ActionCommand.registerClass("lt.Controls.Medical.ActionCommand");lt.Controls.Medical.PinchAction.registerClass("lt.Controls.Medical.PinchAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.OffsetAction.registerClass("lt.Controls.Medical.OffsetAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.LineProfileAction.registerClass("lt.Controls.Medical.LineProfileAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.ScaleAction.registerClass("lt.Controls.Medical.ScaleAction",
lt.Controls.Medical.ActionCommand);lt.Controls.Medical.MagnifyAction.registerClass("lt.Controls.Medical.MagnifyAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.LeadPoint3D.registerClass("lt.Controls.Medical.LeadPoint3D");lt.Controls.Medical.CrossHairInteractiveMode.registerClass("lt.Controls.Medical.CrossHairInteractiveMode",lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical.CrossHairAction.registerClass("lt.Controls.Medical.CrossHairAction",lt.Controls.Medical.ActionCommand);
lt.Controls.Medical.ProbeToolAction.registerClass("lt.Controls.Medical.ProbeToolAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.SpyGlassAction.registerClass("lt.Controls.Medical.SpyGlassAction",lt.Controls.Medical.MagnifyAction);lt.Controls.Medical.StackAction.registerClass("lt.Controls.Medical.StackAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.StackModeInteractiveMode.registerClass("lt.Controls.Medical.StackModeInteractiveMode",lt.Controls.ImageViewerInteractiveMode);
lt.Controls.Medical.WindowLevelAction.registerClass("lt.Controls.Medical.WindowLevelAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.AutomationInteractiveAction.registerClass("lt.Controls.Medical.AutomationInteractiveAction",lt.Controls.Medical.ActionCommand);lt.Controls.Medical.CobbAngle.registerClass("lt.Controls.Medical.CobbAngle");lt.Controls.Medical.ProgressLoading.registerClass("lt.Controls.Medical.ProgressLoading");lt.Controls.Medical.LineProfileObject.registerClass("lt.Controls.Medical.LineProfileObject");
lt.Controls.Medical.ShutterObject.registerClass("lt.Controls.Medical.ShutterObject");lt.Controls.Medical.SpyGlassPositionChangedEventArgs.registerClass("lt.Controls.Medical.SpyGlassPositionChangedEventArgs",lt.LeadEventArgs);lt.Controls.Medical.SpyGlassEventArgs.registerClass("lt.Controls.Medical.SpyGlassEventArgs",lt.LeadEventArgs);lt.Controls.Medical.MedicalSpyGlassInteractiveMode.registerClass("lt.Controls.Medical.MedicalSpyGlassInteractiveMode",lt.Controls.ImageViewerMagnifyGlassInteractiveMode);
lt.Controls.Medical.ProbeToolEventArgs.registerClass("lt.Controls.Medical.ProbeToolEventArgs",lt.LeadEventArgs);lt.Controls.Medical.ProbeToolInteractiveMode.registerClass("lt.Controls.Medical.ProbeToolInteractiveMode",lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical._imageViewerGridViewLayout.registerClass("lt.Controls.Medical._imageViewerGridViewLayout",lt.Controls.ImageViewerViewLayout);lt.Controls.Medical._imageViewerTransformInteractiveMode.registerClass("lt.Controls.Medical._imageViewerTransformInteractiveMode",
lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical._lineProfileInteractiveMode.registerClass("lt.Controls.Medical._lineProfileInteractiveMode",lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical._mrtiRenderChunkEventArgs.registerClass("lt.Controls.Medical._mrtiRenderChunkEventArgs",lt.LeadEventArgs);lt.Controls.Medical.ChunkLoadedEventArgs.registerClass("lt.Controls.Medical.ChunkLoadedEventArgs",lt.LeadEventArgs);lt.Controls.Medical._chunkEventArgs.registerClass("lt.Controls.Medical._chunkEventArgs",
lt.LeadEventArgs);lt.Controls.Medical.DebugEventArgs.registerClass("lt.Controls.Medical.DebugEventArgs",lt.LeadEventArgs);lt.Controls.Medical.ChunkStatus.registerClass("lt.Controls.Medical.ChunkStatus");lt.Controls.Medical.ChunkData.registerClass("lt.Controls.Medical.ChunkData");lt.Controls.Medical.RecycledData.registerClass("lt.Controls.Medical.RecycledData");lt.Controls.Medical._chunkInfo.registerClass("lt.Controls.Medical._chunkInfo");lt.Controls.Medical._mrtiRenderer.registerClass("lt.Controls.Medical._mrtiRenderer",
null,lt.Controls.Medical._imrtiRenderer);lt.Controls.Medical._parser.registerClass("lt.Controls.Medical._parser");lt.Controls.Medical._imageLoader.registerClass("lt.Controls.Medical._imageLoader");lt.Controls.Medical._rendererTools.registerClass("lt.Controls.Medical._rendererTools");lt.Controls.Medical.MRTIImage.registerClass("lt.Controls.Medical.MRTIImage");lt.Controls.Medical._d3DXVECTOR3.registerClass("lt.Controls.Medical._d3DXVECTOR3");lt.Controls.Medical._orientationLetters.registerClass("lt.Controls.Medical._orientationLetters");
lt.Controls.Medical.FramePosition.registerClass("lt.Controls.Medical.FramePosition");lt.Controls.Medical.StackSynchronization.registerClass("lt.Controls.Medical.StackSynchronization");lt.Controls.Medical._d3DXPLANE.registerClass("lt.Controls.Medical._d3DXPLANE");lt.Controls.Medical._d3DXVECTOR4.registerClass("lt.Controls.Medical._d3DXVECTOR4");lt.Controls.Medical._d3DXMATRIX.registerClass("lt.Controls.Medical._d3DXMATRIX");lt.Controls.Medical._d3DXVECTOR2.registerClass("lt.Controls.Medical._d3DXVECTOR2");
lt.Controls.Medical._MVSINGLEREFERENCELINE.registerClass("lt.Controls.Medical._MVSINGLEREFERENCELINE");lt.Controls.Medical._MVREFLINEPARAM.registerClass("lt.Controls.Medical._MVREFLINEPARAM");lt.Controls.Medical.LeadLine.registerClass("lt.Controls.Medical.LeadLine");lt.Controls.Medical.ReferenceLine.registerClass("lt.Controls.Medical.ReferenceLine");lt.Controls.Medical._mprOrientationInfo.registerClass("lt.Controls.Medical._mprOrientationInfo");lt.Controls.Medical._mprCellsInfo.registerClass("lt.Controls.Medical._mprCellsInfo");
lt.Controls.Medical._NEWDICOMTAGES.registerClass("lt.Controls.Medical._NEWDICOMTAGES");lt.Controls.Medical.WindowLevelData.registerClass("lt.Controls.Medical.WindowLevelData");lt.Controls.Medical.WindowLevelInteractiveMode.registerClass("lt.Controls.Medical.WindowLevelInteractiveMode",lt.Controls.ImageViewerInteractiveMode);lt.Controls.Medical._workItem.registerClass("lt.Controls.Medical._workItem");lt.Controls.Medical._myWorkItemData.registerClass("lt.Controls.Medical._myWorkItemData");lt.Controls.Medical._lT_VersionNumber.l_VER_PRODUCT=
"LEADTOOLS\u00ae for JavaScript";lt.Controls.Medical._lT_VersionNumber.l_VER_COMPANYNAME_STR="LEAD Technologies, Inc.";lt.Controls.Medical._lT_VersionNumber.l_VER_LEGALTRADEMARKS_STR="LEADTOOLS\u00ae is a trademark of LEAD Technologies, Inc.";lt.Controls.Medical._lT_VersionNumber.l_VER_LEGALCOPYRIGHT_STR="\u00a9 1991-2016 LEAD Technologies, Inc.";lt.Controls.Medical._lT_VersionNumber.l_VER_DLLEXT=".dll";lt.Controls.Medical._lT_VersionNumber.l_VER_EXEEXT=".exe";lt.Controls.Medical._lT_VersionNumber.l_VER_PLATFORM=
"";lt.Controls.Medical._lT_VersionNumber.l_VER_PLATFORM_FOR="";lt.Controls.Medical._lT_VersionNumber.l_VER_PRODUCTNAME_STR="LEADTOOLS\u00ae for JavaScript";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_XXX="Leadtools.Xxx.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_XXX="LEADTOOLS Xxx";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_KERNEL="lt.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_KERNEL="Leadtools";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_CONTROLS=
"lt.Controls.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_CONTROLS="Controls";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_DOCUMENTS_UI="lt.Documents.UI.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_DOCUMENTS_UI="Documents User Interface";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_CONTROLS_MEDICAL="lt.Controls.Medical.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_CONTROLS_MEDICAL="Medical Controls";
lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_DOCUMENTS="lt.Documents.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_DOCUMENTS="Documents";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_CORE="lt.Annotations.Core.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_CORE="Annotations Core";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_AUTOMATION="lt.Annotations.Automation.dll";
lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_AUTOMATION="Annotations Automation";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_DESIGNERS="lt.Annotations.Designers.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_DESIGNERS="Annotations Designers";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_RENDERING="lt.Annotations.Rendering.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_RENDERING=
"Annotations Rendering";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_CCOW="Leadtools.Ccow.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_CCOW="Leadtools CCOW Library";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_DOCUMENTS="Leadtools.Annotations.Documents.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_DOCUMENTS="Annotations Documents";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_LEGACY=
"Leadtools.Annotations.Legacy.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_LEGACY="Annotations Legacy";lt.Controls.Medical._lT_VersionNumber.l_VER_ORIGINALFILENAME_STR_ANNOTATIONS_JAVASCRIPT="Leadtools.Annotations.JavaScript.dll";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEDESCRIPTION_STR_ANNOTATIONS_JAVASCRIPT="JavaScripot Annotations";lt.Controls.Medical._lT_VersionNumber.l_VER_PRODUCTVERSION_DOT_STR="19.0.0.0";lt.Controls.Medical._lT_VersionNumber.l_VER_FILEVERSION_DOT_STR=
"19.0.0.6";lt.Controls.Medical.AutomationImageViewer._activeStroke$1=lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("red"),lt.LeadLengthD.create(4));lt.Controls.Medical.AutomationImageViewer._normalStroke$1=lt.Annotations.Core.AnnStroke.create(lt.Annotations.Core.AnnSolidColorBrush.create("green"),lt.LeadLengthD.create(4));lt.Controls.Medical.DICOMImageInformationRenderer._waitTime=0;lt.Controls.Medical.Frame._previewLoader=null;lt.Controls.Medical.Tools._pointerdown=
null;lt.Controls.Medical.Tools._pointerup=null;lt.Controls.Medical.Tools._pointercancel=null;lt.Controls.Medical.Tools._pointermove=null;lt.Controls.Medical.Tools._forDebug=!1;lt.Controls.Medical.Tools._recycledElements=null;lt.Controls.Medical.Tools._colorsByName=null;lt.Controls.Medical.Tools._epsilon=1.0E-8;(function(){var a=lt.LTHelper.OS===lt.LTOS.windows&&lt.LTHelper.device===lt.LTDevice.mobile;-1!==window.navigator.userAgent.toLocaleLowerCase().indexOf("windows nt 6.2")||a?(lt.Controls.Medical.Tools._pointerdown=
"MSPointerDown",lt.Controls.Medical.Tools._pointerup="MSPointerUp",lt.Controls.Medical.Tools._pointercancel="MSPointerCancel",lt.Controls.Medical.Tools._pointermove="MSPointerMove"):(lt.Controls.Medical.Tools._pointerdown="pointerdown",lt.Controls.Medical.Tools._pointerup="pointerup",lt.Controls.Medical.Tools._pointercancel="pointercancel",lt.Controls.Medical.Tools._pointermove="pointermove")})();lt.Controls.Medical._mrtiRenderer._loader=null;lt.Controls.Medical.ReferenceLine._outM=0;lt.Controls.Medical.ReferenceLine._outC=
0;lt.Controls.Medical.ReferenceLine._intersectionX=0;lt.Controls.Medical.ReferenceLine._intersectionY=0;lt.Controls.Medical.ReferenceLine._deter111=0})();
